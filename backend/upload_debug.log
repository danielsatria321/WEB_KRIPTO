[2025-11-07 13:17:12] === NEW REQUEST STARTED ===
[2025-11-07 13:17:12] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-07 13:17:12] Database connected successfully
[2025-11-07 13:17:12] Request method: POST
[2025-11-07 13:17:12] === START PROCESSING FORM DATA ===
[2025-11-07 13:17:12] POST data: Array
(
    [namaPasien] => adasds
    [tanggalLahir] => 2025-11-20
    [alamat] => aa d jan jadjads
    [jenisLayanan] => rawat-inap
    [statusPasien] => perawatan
    [hasilPemeriksaan] => asdasdadasdad
    [jumlahPembayaran] => 534212
)

[2025-11-07 13:17:12] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [type] => image/webp
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpwVMNbY
            [error] => 0
            [size] => 70498
        )

    [pdfDokumen] => Array
        (
            [name] => Aplikasi.pdf
            [full_path] => Aplikasi.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpCwlhis
            [error] => 0
            [size] => 4040002
        )

)

[2025-11-07 13:17:13] Detected MIME type: image/webp
[2025-11-07 13:17:13] Image validation: VALID
[2025-11-07 13:17:13] Detected MIME type: application/pdf
[2025-11-07 13:17:13] PDF validation: VALID
[2025-11-07 13:17:13] Form data sanitized successfully
[2025-11-07 13:17:13] Data encrypted successfully
[2025-11-07 13:17:13] Starting file upload process...
[2025-11-07 13:17:13] === START FILE UPLOAD: fotoPasien ===
[2025-11-07 13:17:13] File info: Array
(
    [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [type] => image/webp
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpwVMNbY
    [error] => 0
    [size] => 70498
)

[2025-11-07 13:17:13] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-07 13:17:13] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 13:17:13] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 13:17:13] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 13:17:13] ERROR: Directory is not writable
[2025-11-07 13:17:13] Directory permissions: 0755
[2025-11-07 13:17:13] === START FILE UPLOAD: pdfDokumen ===
[2025-11-07 13:17:13] File info: Array
(
    [name] => Aplikasi.pdf
    [full_path] => Aplikasi.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpCwlhis
    [error] => 0
    [size] => 4040002
)

[2025-11-07 13:17:13] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-07 13:17:13] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 13:17:13] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 13:17:13] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 13:17:13] ERROR: Directory is not writable
[2025-11-07 13:17:13] Directory permissions: 0755
[2025-11-07 13:17:13] File upload results - Foto: NULL, PDF: NULL
[2025-11-07 13:17:13] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-07 13:17:13] Data successfully inserted with ID: 60
[2025-11-07 13:17:13] Sending success response
[2025-11-07 13:17:13] === REQUEST COMPLETED ===
[2025-11-07 13:18:09] === NEW REQUEST STARTED ===
[2025-11-07 13:18:09] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-07 13:18:09] Database connected successfully
[2025-11-07 13:18:09] Request method: POST
[2025-11-07 13:18:09] === START PROCESSING FORM DATA ===
[2025-11-07 13:18:09] POST data: Array
(
    [namaPasien] => idcnkjsnck
    [tanggalLahir] => 2025-11-19
    [alamat] => kaodsjsnssjnjd
    [jenisLayanan] => rawat-inap
    [statusPasien] => perawatan
    [hasilPemeriksaan] => hari ini
    [jumlahPembayaran] => 098098
)

[2025-11-07 13:18:09] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [type] => image/webp
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpp03AAT
            [error] => 0
            [size] => 70498
        )

    [pdfDokumen] => Array
        (
            [name] => 
            [full_path] => 
            [type] => 
            [tmp_name] => 
            [error] => 4
            [size] => 0
        )

)

[2025-11-07 13:18:09] Detected MIME type: image/webp
[2025-11-07 13:18:09] Image validation: VALID
[2025-11-07 13:18:09] Form data sanitized successfully
[2025-11-07 13:18:09] Data encrypted successfully
[2025-11-07 13:18:09] Starting file upload process...
[2025-11-07 13:18:09] === START FILE UPLOAD: fotoPasien ===
[2025-11-07 13:18:09] File info: Array
(
    [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [type] => image/webp
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpp03AAT
    [error] => 0
    [size] => 70498
)

[2025-11-07 13:18:09] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-07 13:18:09] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 13:18:09] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 13:18:09] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 13:18:09] ERROR: Directory is not writable
[2025-11-07 13:18:09] Directory permissions: 0755
[2025-11-07 13:18:09] === START FILE UPLOAD: pdfDokumen ===
[2025-11-07 13:18:09] File info: Array
(
    [name] => 
    [full_path] => 
    [type] => 
    [tmp_name] => 
    [error] => 4
    [size] => 0
)

[2025-11-07 13:18:09] ERROR: Upload error code: 4
[2025-11-07 13:18:09] Upload error meaning: No file was uploaded
[2025-11-07 13:18:09] File upload results - Foto: NULL, PDF: NULL
[2025-11-07 13:18:09] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-07 13:18:09] Data successfully inserted with ID: 61
[2025-11-07 13:18:09] Sending success response
[2025-11-07 13:18:09] === REQUEST COMPLETED ===
[2025-11-07 13:21:52] === NEW REQUEST STARTED ===
[2025-11-07 13:21:52] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-07 13:21:52] Database connected successfully
[2025-11-07 13:21:52] Request method: POST
[2025-11-07 13:21:52] === START PROCESSING FORM DATA ===
[2025-11-07 13:21:52] POST data: Array
(
    [namaPasien] => testate
    [tanggalLahir] => 2025-11-12
    [alamat] => okeajalah
    [jenisLayanan] => rawat-inap
    [statusPasien] => menunggu
    [hasilPemeriksaan] => tes ajalah bin
    [jumlahPembayaran] => 534453
)

[2025-11-07 13:21:52] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [type] => image/webp
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpLhMMVt
            [error] => 0
            [size] => 70498
        )

    [pdfDokumen] => Array
        (
            [name] => Aplikasi.pdf
            [full_path] => Aplikasi.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpGpTVfk
            [error] => 0
            [size] => 4040002
        )

)

[2025-11-07 13:21:52] Detected MIME type: image/webp
[2025-11-07 13:21:52] Image validation: VALID
[2025-11-07 13:21:52] Detected MIME type: application/pdf
[2025-11-07 13:21:52] PDF validation: VALID
[2025-11-07 13:21:52] Form data sanitized successfully
[2025-11-07 13:21:52] Data encrypted successfully
[2025-11-07 13:21:52] Starting file upload process...
[2025-11-07 13:21:52] === START FILE UPLOAD: fotoPasien ===
[2025-11-07 13:21:52] File info: Array
(
    [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [type] => image/webp
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpLhMMVt
    [error] => 0
    [size] => 70498
)

[2025-11-07 13:21:52] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-07 13:21:52] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 13:21:52] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 13:21:52] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 13:21:52] Directory is writable
[2025-11-07 13:21:52] Detected MIME type: image/webp
[2025-11-07 13:21:52] Image validation: VALID
[2025-11-07 13:21:52] File validation passed
[2025-11-07 13:21:52] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/690de460984cb_1762518112.webp
[2025-11-07 13:21:52] Temp file exists: YES
[2025-11-07 13:21:52] Temp file size: 70498
[2025-11-07 13:21:52] File moved successfully
[2025-11-07 13:21:52] File verified - Size: 70498 bytes
[2025-11-07 13:21:52] === START FILE UPLOAD: pdfDokumen ===
[2025-11-07 13:21:52] File info: Array
(
    [name] => Aplikasi.pdf
    [full_path] => Aplikasi.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpGpTVfk
    [error] => 0
    [size] => 4040002
)

[2025-11-07 13:21:52] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-07 13:21:52] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 13:21:52] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 13:21:52] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 13:21:52] Directory is writable
[2025-11-07 13:21:52] Detected MIME type: application/pdf
[2025-11-07 13:21:52] PDF validation: VALID
[2025-11-07 13:21:52] File validation passed
[2025-11-07 13:21:52] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690de46099183_1762518112.pdf
[2025-11-07 13:21:52] Temp file exists: YES
[2025-11-07 13:21:52] Temp file size: 4040002
[2025-11-07 13:21:52] File moved successfully
[2025-11-07 13:21:52] File verified - Size: 4040002 bytes
[2025-11-07 13:21:52] File upload results - Foto: 690de460984cb_1762518112.webp, PDF: 690de46099183_1762518112.pdf
[2025-11-07 13:21:52] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-07 13:21:52] Data successfully inserted with ID: 62
[2025-11-07 13:21:52] Sending success response
[2025-11-07 13:21:52] === REQUEST COMPLETED ===
[2025-11-07 14:10:43] === NEW REQUEST STARTED ===
[2025-11-07 14:10:43] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-07 14:10:43] Database connected successfully
[2025-11-07 14:10:43] Request method: POST
[2025-11-07 14:10:43] === START PROCESSING FORM DATA ===
[2025-11-07 14:10:43] POST data: Array
(
    [namaPasien] => jajjasdj
    [tanggalLahir] => 2025-11-04
    [alamat] => qwmdjkqmdj
    [jenisLayanan] => pemeriksaan
    [statusPasien] => perawatan
    [hasilPemeriksaan] => navnsasnkskskas
    [medmsg] => halloos
    [jumlahPembayaran] => 543543
)

[2025-11-07 14:10:43] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [type] => image/webp
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpVU1Hhp
            [error] => 0
            [size] => 70498
        )

    [pdfDokumen] => Array
        (
            [name] => Aplikasi.pdf
            [full_path] => Aplikasi.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpZrGLfN
            [error] => 0
            [size] => 4040002
        )

)

[2025-11-07 14:10:43] Detected MIME type: image/webp
[2025-11-07 14:10:43] Image validation: VALID
[2025-11-07 14:10:43] Detected MIME type: application/pdf
[2025-11-07 14:10:43] PDF validation: VALID
[2025-11-07 14:10:43] Form data sanitized successfully
[2025-11-07 14:10:43] Pesan medis: halloos
[2025-11-07 14:10:43] Data encrypted successfully
[2025-11-07 14:10:43] Starting file upload process...
[2025-11-07 14:10:43] === START FILE UPLOAD: fotoPasien ===
[2025-11-07 14:10:43] File info: Array
(
    [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [type] => image/webp
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpVU1Hhp
    [error] => 0
    [size] => 70498
)

[2025-11-07 14:10:43] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-07 14:10:43] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:10:43] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:10:43] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:10:43] Directory is writable
[2025-11-07 14:10:43] Detected MIME type: image/webp
[2025-11-07 14:10:43] Image validation: VALID
[2025-11-07 14:10:43] File validation passed
[2025-11-07 14:10:43] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/690defd3acd07_1762521043.webp
[2025-11-07 14:10:43] Temp file exists: YES
[2025-11-07 14:10:43] Temp file size: 70498
[2025-11-07 14:10:43] File moved successfully
[2025-11-07 14:10:43] File verified - Size: 70498 bytes
[2025-11-07 14:10:43] === START FILE UPLOAD: pdfDokumen ===
[2025-11-07 14:10:43] File info: Array
(
    [name] => Aplikasi.pdf
    [full_path] => Aplikasi.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpZrGLfN
    [error] => 0
    [size] => 4040002
)

[2025-11-07 14:10:43] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-07 14:10:43] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:10:43] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:10:43] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:10:43] Directory is writable
[2025-11-07 14:10:43] Detected MIME type: application/pdf
[2025-11-07 14:10:43] PDF validation: VALID
[2025-11-07 14:10:43] File validation passed
[2025-11-07 14:10:43] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690defd3ad168_1762521043.pdf
[2025-11-07 14:10:43] Temp file exists: YES
[2025-11-07 14:10:43] Temp file size: 4040002
[2025-11-07 14:10:43] File moved successfully
[2025-11-07 14:10:43] File verified - Size: 4040002 bytes
[2025-11-07 14:10:43] Applying steganography to photo...
[2025-11-07 14:10:43] Steganography - Image path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/690defd3acd07_1762521043.webp
[2025-11-07 14:10:43] Steganography - Encrypted message length: 24
[2025-11-07 14:10:43] Steganography ERROR: Cannot read image info
[2025-11-07 14:10:43] Steganography failed, but continuing without it
[2025-11-07 14:10:43] File upload results - Foto: 690defd3acd07_1762521043.webp, PDF: 690defd3ad168_1762521043.pdf
[2025-11-07 14:10:43] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran,
                medmsg
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-07 14:10:43] ERROR: Unknown column 'medmsg' in 'field list'
[2025-11-07 14:10:43] Sending error response: Unknown column 'medmsg' in 'field list'
[2025-11-07 14:10:43] === REQUEST COMPLETED ===
[2025-11-07 14:11:16] === NEW REQUEST STARTED ===
[2025-11-07 14:11:16] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-07 14:11:16] Database connected successfully
[2025-11-07 14:11:16] Request method: POST
[2025-11-07 14:11:16] === START PROCESSING FORM DATA ===
[2025-11-07 14:11:16] POST data: Array
(
    [namaPasien] => jajjasdj
    [tanggalLahir] => 2025-11-04
    [alamat] => qwmdjkqmdj
    [jenisLayanan] => pemeriksaan
    [statusPasien] => perawatan
    [hasilPemeriksaan] => navnsasnkskskas
    [medmsg] => halobos
    [jumlahPembayaran] => 543543
)

[2025-11-07 14:11:16] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [type] => image/webp
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpOpFcTq
            [error] => 0
            [size] => 70498
        )

    [pdfDokumen] => Array
        (
            [name] => Aplikasi.pdf
            [full_path] => Aplikasi.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpTFteHz
            [error] => 0
            [size] => 4040002
        )

)

[2025-11-07 14:11:16] Detected MIME type: image/webp
[2025-11-07 14:11:16] Image validation: VALID
[2025-11-07 14:11:16] Detected MIME type: application/pdf
[2025-11-07 14:11:16] PDF validation: VALID
[2025-11-07 14:11:16] Form data sanitized successfully
[2025-11-07 14:11:16] Pesan medis: halobos
[2025-11-07 14:11:16] Data encrypted successfully
[2025-11-07 14:11:16] Starting file upload process...
[2025-11-07 14:11:16] === START FILE UPLOAD: fotoPasien ===
[2025-11-07 14:11:16] File info: Array
(
    [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [type] => image/webp
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpOpFcTq
    [error] => 0
    [size] => 70498
)

[2025-11-07 14:11:16] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-07 14:11:16] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:16] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:16] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:16] Directory is writable
[2025-11-07 14:11:16] Detected MIME type: image/webp
[2025-11-07 14:11:16] Image validation: VALID
[2025-11-07 14:11:16] File validation passed
[2025-11-07 14:11:16] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/690deff465c63_1762521076.webp
[2025-11-07 14:11:16] Temp file exists: YES
[2025-11-07 14:11:16] Temp file size: 70498
[2025-11-07 14:11:16] File moved successfully
[2025-11-07 14:11:16] File verified - Size: 70498 bytes
[2025-11-07 14:11:16] === START FILE UPLOAD: pdfDokumen ===
[2025-11-07 14:11:16] File info: Array
(
    [name] => Aplikasi.pdf
    [full_path] => Aplikasi.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpTFteHz
    [error] => 0
    [size] => 4040002
)

[2025-11-07 14:11:16] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-07 14:11:16] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:16] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:16] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:16] Directory is writable
[2025-11-07 14:11:16] Detected MIME type: application/pdf
[2025-11-07 14:11:16] PDF validation: VALID
[2025-11-07 14:11:16] File validation passed
[2025-11-07 14:11:16] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690deff466847_1762521076.pdf
[2025-11-07 14:11:16] Temp file exists: YES
[2025-11-07 14:11:16] Temp file size: 4040002
[2025-11-07 14:11:16] File moved successfully
[2025-11-07 14:11:16] File verified - Size: 4040002 bytes
[2025-11-07 14:11:16] Applying steganography to photo...
[2025-11-07 14:11:16] Steganography - Image path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/690deff465c63_1762521076.webp
[2025-11-07 14:11:16] Steganography - Encrypted message length: 24
[2025-11-07 14:11:16] Steganography ERROR: Cannot read image info
[2025-11-07 14:11:16] Steganography failed, but continuing without it
[2025-11-07 14:11:16] File upload results - Foto: 690deff465c63_1762521076.webp, PDF: 690deff466847_1762521076.pdf
[2025-11-07 14:11:16] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran,
                medmsg
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-07 14:11:16] ERROR: Unknown column 'medmsg' in 'field list'
[2025-11-07 14:11:16] Sending error response: Unknown column 'medmsg' in 'field list'
[2025-11-07 14:11:16] === REQUEST COMPLETED ===
[2025-11-07 14:11:17] === NEW REQUEST STARTED ===
[2025-11-07 14:11:17] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-07 14:11:17] Database connected successfully
[2025-11-07 14:11:17] Request method: POST
[2025-11-07 14:11:17] === START PROCESSING FORM DATA ===
[2025-11-07 14:11:17] POST data: Array
(
    [namaPasien] => jajjasdj
    [tanggalLahir] => 2025-11-04
    [alamat] => qwmdjkqmdj
    [jenisLayanan] => pemeriksaan
    [statusPasien] => perawatan
    [hasilPemeriksaan] => navnsasnkskskas
    [medmsg] => halobos
    [jumlahPembayaran] => 543543
)

[2025-11-07 14:11:17] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [type] => image/webp
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpHUcNl2
            [error] => 0
            [size] => 70498
        )

    [pdfDokumen] => Array
        (
            [name] => Aplikasi.pdf
            [full_path] => Aplikasi.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpcVmcSf
            [error] => 0
            [size] => 4040002
        )

)

[2025-11-07 14:11:17] Detected MIME type: image/webp
[2025-11-07 14:11:17] Image validation: VALID
[2025-11-07 14:11:17] Detected MIME type: application/pdf
[2025-11-07 14:11:17] PDF validation: VALID
[2025-11-07 14:11:17] Form data sanitized successfully
[2025-11-07 14:11:17] Pesan medis: halobos
[2025-11-07 14:11:17] Data encrypted successfully
[2025-11-07 14:11:17] Starting file upload process...
[2025-11-07 14:11:17] === START FILE UPLOAD: fotoPasien ===
[2025-11-07 14:11:17] File info: Array
(
    [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [type] => image/webp
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpHUcNl2
    [error] => 0
    [size] => 70498
)

[2025-11-07 14:11:17] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-07 14:11:17] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:17] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:17] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:17] Directory is writable
[2025-11-07 14:11:17] Detected MIME type: image/webp
[2025-11-07 14:11:17] Image validation: VALID
[2025-11-07 14:11:17] File validation passed
[2025-11-07 14:11:17] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/690deff5652ea_1762521077.webp
[2025-11-07 14:11:17] Temp file exists: YES
[2025-11-07 14:11:17] Temp file size: 70498
[2025-11-07 14:11:17] File moved successfully
[2025-11-07 14:11:17] File verified - Size: 70498 bytes
[2025-11-07 14:11:17] === START FILE UPLOAD: pdfDokumen ===
[2025-11-07 14:11:17] File info: Array
(
    [name] => Aplikasi.pdf
    [full_path] => Aplikasi.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpcVmcSf
    [error] => 0
    [size] => 4040002
)

[2025-11-07 14:11:17] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-07 14:11:17] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:17] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:17] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:17] Directory is writable
[2025-11-07 14:11:17] Detected MIME type: application/pdf
[2025-11-07 14:11:17] PDF validation: VALID
[2025-11-07 14:11:17] File validation passed
[2025-11-07 14:11:17] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690deff5657c4_1762521077.pdf
[2025-11-07 14:11:17] Temp file exists: YES
[2025-11-07 14:11:17] Temp file size: 4040002
[2025-11-07 14:11:17] File moved successfully
[2025-11-07 14:11:17] File verified - Size: 4040002 bytes
[2025-11-07 14:11:17] Applying steganography to photo...
[2025-11-07 14:11:17] Steganography - Image path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/690deff5652ea_1762521077.webp
[2025-11-07 14:11:17] Steganography - Encrypted message length: 24
[2025-11-07 14:11:17] Steganography ERROR: Cannot read image info
[2025-11-07 14:11:17] Steganography failed, but continuing without it
[2025-11-07 14:11:17] File upload results - Foto: 690deff5652ea_1762521077.webp, PDF: 690deff5657c4_1762521077.pdf
[2025-11-07 14:11:17] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran,
                medmsg
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-07 14:11:17] ERROR: Unknown column 'medmsg' in 'field list'
[2025-11-07 14:11:17] Sending error response: Unknown column 'medmsg' in 'field list'
[2025-11-07 14:11:17] === REQUEST COMPLETED ===
[2025-11-07 14:11:18] === NEW REQUEST STARTED ===
[2025-11-07 14:11:18] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-07 14:11:18] Database connected successfully
[2025-11-07 14:11:18] Request method: POST
[2025-11-07 14:11:18] === START PROCESSING FORM DATA ===
[2025-11-07 14:11:18] POST data: Array
(
    [namaPasien] => jajjasdj
    [tanggalLahir] => 2025-11-04
    [alamat] => qwmdjkqmdj
    [jenisLayanan] => pemeriksaan
    [statusPasien] => perawatan
    [hasilPemeriksaan] => navnsasnkskskas
    [medmsg] => halobos
    [jumlahPembayaran] => 543543
)

[2025-11-07 14:11:18] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [type] => image/webp
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpV3Tq7Q
            [error] => 0
            [size] => 70498
        )

    [pdfDokumen] => Array
        (
            [name] => Aplikasi.pdf
            [full_path] => Aplikasi.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpBSuKPL
            [error] => 0
            [size] => 4040002
        )

)

[2025-11-07 14:11:18] Detected MIME type: image/webp
[2025-11-07 14:11:18] Image validation: VALID
[2025-11-07 14:11:18] Detected MIME type: application/pdf
[2025-11-07 14:11:18] PDF validation: VALID
[2025-11-07 14:11:18] Form data sanitized successfully
[2025-11-07 14:11:18] Pesan medis: halobos
[2025-11-07 14:11:18] Data encrypted successfully
[2025-11-07 14:11:18] Starting file upload process...
[2025-11-07 14:11:18] === START FILE UPLOAD: fotoPasien ===
[2025-11-07 14:11:18] File info: Array
(
    [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [type] => image/webp
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpV3Tq7Q
    [error] => 0
    [size] => 70498
)

[2025-11-07 14:11:18] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-07 14:11:18] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:18] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:18] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:18] Directory is writable
[2025-11-07 14:11:18] Detected MIME type: image/webp
[2025-11-07 14:11:18] Image validation: VALID
[2025-11-07 14:11:18] File validation passed
[2025-11-07 14:11:18] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/690deff641538_1762521078.webp
[2025-11-07 14:11:18] Temp file exists: YES
[2025-11-07 14:11:18] Temp file size: 70498
[2025-11-07 14:11:18] File moved successfully
[2025-11-07 14:11:18] File verified - Size: 70498 bytes
[2025-11-07 14:11:18] === START FILE UPLOAD: pdfDokumen ===
[2025-11-07 14:11:18] File info: Array
(
    [name] => Aplikasi.pdf
    [full_path] => Aplikasi.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpBSuKPL
    [error] => 0
    [size] => 4040002
)

[2025-11-07 14:11:18] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-07 14:11:18] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:18] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:18] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:18] Directory is writable
[2025-11-07 14:11:18] Detected MIME type: application/pdf
[2025-11-07 14:11:18] PDF validation: VALID
[2025-11-07 14:11:18] File validation passed
[2025-11-07 14:11:18] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690deff641ec9_1762521078.pdf
[2025-11-07 14:11:18] Temp file exists: YES
[2025-11-07 14:11:18] Temp file size: 4040002
[2025-11-07 14:11:18] File moved successfully
[2025-11-07 14:11:18] File verified - Size: 4040002 bytes
[2025-11-07 14:11:18] Applying steganography to photo...
[2025-11-07 14:11:18] Steganography - Image path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/690deff641538_1762521078.webp
[2025-11-07 14:11:18] Steganography - Encrypted message length: 24
[2025-11-07 14:11:18] Steganography ERROR: Cannot read image info
[2025-11-07 14:11:18] Steganography failed, but continuing without it
[2025-11-07 14:11:18] File upload results - Foto: 690deff641538_1762521078.webp, PDF: 690deff641ec9_1762521078.pdf
[2025-11-07 14:11:18] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran,
                medmsg
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-07 14:11:18] ERROR: Unknown column 'medmsg' in 'field list'
[2025-11-07 14:11:18] Sending error response: Unknown column 'medmsg' in 'field list'
[2025-11-07 14:11:18] === REQUEST COMPLETED ===
[2025-11-07 14:11:18] === NEW REQUEST STARTED ===
[2025-11-07 14:11:18] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-07 14:11:18] Database connected successfully
[2025-11-07 14:11:18] Request method: POST
[2025-11-07 14:11:18] === START PROCESSING FORM DATA ===
[2025-11-07 14:11:18] POST data: Array
(
    [namaPasien] => jajjasdj
    [tanggalLahir] => 2025-11-04
    [alamat] => qwmdjkqmdj
    [jenisLayanan] => pemeriksaan
    [statusPasien] => perawatan
    [hasilPemeriksaan] => navnsasnkskskas
    [medmsg] => halobos
    [jumlahPembayaran] => 543543
)

[2025-11-07 14:11:18] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [type] => image/webp
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phptn6DaE
            [error] => 0
            [size] => 70498
        )

    [pdfDokumen] => Array
        (
            [name] => Aplikasi.pdf
            [full_path] => Aplikasi.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpUekw4G
            [error] => 0
            [size] => 4040002
        )

)

[2025-11-07 14:11:18] Detected MIME type: image/webp
[2025-11-07 14:11:18] Image validation: VALID
[2025-11-07 14:11:18] Detected MIME type: application/pdf
[2025-11-07 14:11:18] PDF validation: VALID
[2025-11-07 14:11:18] Form data sanitized successfully
[2025-11-07 14:11:18] Pesan medis: halobos
[2025-11-07 14:11:18] Data encrypted successfully
[2025-11-07 14:11:18] Starting file upload process...
[2025-11-07 14:11:18] === START FILE UPLOAD: fotoPasien ===
[2025-11-07 14:11:18] File info: Array
(
    [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [type] => image/webp
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phptn6DaE
    [error] => 0
    [size] => 70498
)

[2025-11-07 14:11:18] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-07 14:11:18] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:18] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:18] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:18] Directory is writable
[2025-11-07 14:11:18] Detected MIME type: image/webp
[2025-11-07 14:11:18] Image validation: VALID
[2025-11-07 14:11:18] File validation passed
[2025-11-07 14:11:18] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/690deff6c35cd_1762521078.webp
[2025-11-07 14:11:18] Temp file exists: YES
[2025-11-07 14:11:18] Temp file size: 70498
[2025-11-07 14:11:18] File moved successfully
[2025-11-07 14:11:18] File verified - Size: 70498 bytes
[2025-11-07 14:11:18] === START FILE UPLOAD: pdfDokumen ===
[2025-11-07 14:11:18] File info: Array
(
    [name] => Aplikasi.pdf
    [full_path] => Aplikasi.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpUekw4G
    [error] => 0
    [size] => 4040002
)

[2025-11-07 14:11:18] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-07 14:11:18] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:18] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:18] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:18] Directory is writable
[2025-11-07 14:11:18] Detected MIME type: application/pdf
[2025-11-07 14:11:18] PDF validation: VALID
[2025-11-07 14:11:18] File validation passed
[2025-11-07 14:11:18] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690deff6c3f49_1762521078.pdf
[2025-11-07 14:11:18] Temp file exists: YES
[2025-11-07 14:11:18] Temp file size: 4040002
[2025-11-07 14:11:18] File moved successfully
[2025-11-07 14:11:18] File verified - Size: 4040002 bytes
[2025-11-07 14:11:18] Applying steganography to photo...
[2025-11-07 14:11:18] Steganography - Image path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/690deff6c35cd_1762521078.webp
[2025-11-07 14:11:18] Steganography - Encrypted message length: 24
[2025-11-07 14:11:18] Steganography ERROR: Cannot read image info
[2025-11-07 14:11:18] Steganography failed, but continuing without it
[2025-11-07 14:11:18] File upload results - Foto: 690deff6c35cd_1762521078.webp, PDF: 690deff6c3f49_1762521078.pdf
[2025-11-07 14:11:18] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran,
                medmsg
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-07 14:11:18] ERROR: Unknown column 'medmsg' in 'field list'
[2025-11-07 14:11:18] Sending error response: Unknown column 'medmsg' in 'field list'
[2025-11-07 14:11:18] === REQUEST COMPLETED ===
[2025-11-07 14:11:19] === NEW REQUEST STARTED ===
[2025-11-07 14:11:19] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-07 14:11:19] Database connected successfully
[2025-11-07 14:11:19] Request method: POST
[2025-11-07 14:11:19] === START PROCESSING FORM DATA ===
[2025-11-07 14:11:19] POST data: Array
(
    [namaPasien] => jajjasdj
    [tanggalLahir] => 2025-11-04
    [alamat] => qwmdjkqmdj
    [jenisLayanan] => pemeriksaan
    [statusPasien] => perawatan
    [hasilPemeriksaan] => navnsasnkskskas
    [medmsg] => halobos
    [jumlahPembayaran] => 543543
)

[2025-11-07 14:11:19] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [type] => image/webp
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php7jURjP
            [error] => 0
            [size] => 70498
        )

    [pdfDokumen] => Array
        (
            [name] => Aplikasi.pdf
            [full_path] => Aplikasi.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php7OzAof
            [error] => 0
            [size] => 4040002
        )

)

[2025-11-07 14:11:19] Detected MIME type: image/webp
[2025-11-07 14:11:19] Image validation: VALID
[2025-11-07 14:11:19] Detected MIME type: application/pdf
[2025-11-07 14:11:19] PDF validation: VALID
[2025-11-07 14:11:19] Form data sanitized successfully
[2025-11-07 14:11:19] Pesan medis: halobos
[2025-11-07 14:11:19] Data encrypted successfully
[2025-11-07 14:11:19] Starting file upload process...
[2025-11-07 14:11:19] === START FILE UPLOAD: fotoPasien ===
[2025-11-07 14:11:19] File info: Array
(
    [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [type] => image/webp
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php7jURjP
    [error] => 0
    [size] => 70498
)

[2025-11-07 14:11:19] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-07 14:11:19] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:19] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:19] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:19] Directory is writable
[2025-11-07 14:11:19] Detected MIME type: image/webp
[2025-11-07 14:11:19] Image validation: VALID
[2025-11-07 14:11:19] File validation passed
[2025-11-07 14:11:19] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/690deff733c72_1762521079.webp
[2025-11-07 14:11:19] Temp file exists: YES
[2025-11-07 14:11:19] Temp file size: 70498
[2025-11-07 14:11:19] File moved successfully
[2025-11-07 14:11:19] File verified - Size: 70498 bytes
[2025-11-07 14:11:19] === START FILE UPLOAD: pdfDokumen ===
[2025-11-07 14:11:19] File info: Array
(
    [name] => Aplikasi.pdf
    [full_path] => Aplikasi.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php7OzAof
    [error] => 0
    [size] => 4040002
)

[2025-11-07 14:11:19] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-07 14:11:19] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:19] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:19] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:19] Directory is writable
[2025-11-07 14:11:19] Detected MIME type: application/pdf
[2025-11-07 14:11:19] PDF validation: VALID
[2025-11-07 14:11:19] File validation passed
[2025-11-07 14:11:19] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690deff734c02_1762521079.pdf
[2025-11-07 14:11:19] Temp file exists: YES
[2025-11-07 14:11:19] Temp file size: 4040002
[2025-11-07 14:11:19] File moved successfully
[2025-11-07 14:11:19] File verified - Size: 4040002 bytes
[2025-11-07 14:11:19] Applying steganography to photo...
[2025-11-07 14:11:19] Steganography - Image path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/690deff733c72_1762521079.webp
[2025-11-07 14:11:19] Steganography - Encrypted message length: 24
[2025-11-07 14:11:19] Steganography ERROR: Cannot read image info
[2025-11-07 14:11:19] Steganography failed, but continuing without it
[2025-11-07 14:11:19] File upload results - Foto: 690deff733c72_1762521079.webp, PDF: 690deff734c02_1762521079.pdf
[2025-11-07 14:11:19] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran,
                medmsg
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-07 14:11:19] ERROR: Unknown column 'medmsg' in 'field list'
[2025-11-07 14:11:19] Sending error response: Unknown column 'medmsg' in 'field list'
[2025-11-07 14:11:19] === REQUEST COMPLETED ===
[2025-11-07 14:11:19] === NEW REQUEST STARTED ===
[2025-11-07 14:11:19] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-07 14:11:19] Database connected successfully
[2025-11-07 14:11:19] Request method: POST
[2025-11-07 14:11:19] === START PROCESSING FORM DATA ===
[2025-11-07 14:11:19] POST data: Array
(
    [namaPasien] => jajjasdj
    [tanggalLahir] => 2025-11-04
    [alamat] => qwmdjkqmdj
    [jenisLayanan] => pemeriksaan
    [statusPasien] => perawatan
    [hasilPemeriksaan] => navnsasnkskskas
    [medmsg] => halobos
    [jumlahPembayaran] => 543543
)

[2025-11-07 14:11:19] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [type] => image/webp
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpY8toNn
            [error] => 0
            [size] => 70498
        )

    [pdfDokumen] => Array
        (
            [name] => Aplikasi.pdf
            [full_path] => Aplikasi.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpMoquqq
            [error] => 0
            [size] => 4040002
        )

)

[2025-11-07 14:11:19] Detected MIME type: image/webp
[2025-11-07 14:11:19] Image validation: VALID
[2025-11-07 14:11:19] Detected MIME type: application/pdf
[2025-11-07 14:11:19] PDF validation: VALID
[2025-11-07 14:11:19] Form data sanitized successfully
[2025-11-07 14:11:19] Pesan medis: halobos
[2025-11-07 14:11:19] Data encrypted successfully
[2025-11-07 14:11:19] Starting file upload process...
[2025-11-07 14:11:19] === START FILE UPLOAD: fotoPasien ===
[2025-11-07 14:11:19] File info: Array
(
    [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [type] => image/webp
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpY8toNn
    [error] => 0
    [size] => 70498
)

[2025-11-07 14:11:19] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-07 14:11:19] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:19] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:19] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:19] Directory is writable
[2025-11-07 14:11:19] Detected MIME type: image/webp
[2025-11-07 14:11:19] Image validation: VALID
[2025-11-07 14:11:19] File validation passed
[2025-11-07 14:11:19] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/690deff795790_1762521079.webp
[2025-11-07 14:11:19] Temp file exists: YES
[2025-11-07 14:11:19] Temp file size: 70498
[2025-11-07 14:11:19] File moved successfully
[2025-11-07 14:11:19] File verified - Size: 70498 bytes
[2025-11-07 14:11:19] === START FILE UPLOAD: pdfDokumen ===
[2025-11-07 14:11:19] File info: Array
(
    [name] => Aplikasi.pdf
    [full_path] => Aplikasi.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpMoquqq
    [error] => 0
    [size] => 4040002
)

[2025-11-07 14:11:19] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-07 14:11:19] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:19] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:19] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:19] Directory is writable
[2025-11-07 14:11:19] Detected MIME type: application/pdf
[2025-11-07 14:11:19] PDF validation: VALID
[2025-11-07 14:11:19] File validation passed
[2025-11-07 14:11:19] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690deff795fc8_1762521079.pdf
[2025-11-07 14:11:19] Temp file exists: YES
[2025-11-07 14:11:19] Temp file size: 4040002
[2025-11-07 14:11:19] File moved successfully
[2025-11-07 14:11:19] File verified - Size: 4040002 bytes
[2025-11-07 14:11:19] Applying steganography to photo...
[2025-11-07 14:11:19] Steganography - Image path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/690deff795790_1762521079.webp
[2025-11-07 14:11:19] Steganography - Encrypted message length: 24
[2025-11-07 14:11:19] Steganography ERROR: Cannot read image info
[2025-11-07 14:11:19] Steganography failed, but continuing without it
[2025-11-07 14:11:19] File upload results - Foto: 690deff795790_1762521079.webp, PDF: 690deff795fc8_1762521079.pdf
[2025-11-07 14:11:19] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran,
                medmsg
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-07 14:11:19] ERROR: Unknown column 'medmsg' in 'field list'
[2025-11-07 14:11:19] Sending error response: Unknown column 'medmsg' in 'field list'
[2025-11-07 14:11:19] === REQUEST COMPLETED ===
[2025-11-07 14:11:19] === NEW REQUEST STARTED ===
[2025-11-07 14:11:19] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-07 14:11:19] Database connected successfully
[2025-11-07 14:11:19] Request method: POST
[2025-11-07 14:11:19] === START PROCESSING FORM DATA ===
[2025-11-07 14:11:19] POST data: Array
(
    [namaPasien] => jajjasdj
    [tanggalLahir] => 2025-11-04
    [alamat] => qwmdjkqmdj
    [jenisLayanan] => pemeriksaan
    [statusPasien] => perawatan
    [hasilPemeriksaan] => navnsasnkskskas
    [medmsg] => halobos
    [jumlahPembayaran] => 543543
)

[2025-11-07 14:11:19] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [type] => image/webp
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpmLqMTG
            [error] => 0
            [size] => 70498
        )

    [pdfDokumen] => Array
        (
            [name] => Aplikasi.pdf
            [full_path] => Aplikasi.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpvGEmON
            [error] => 0
            [size] => 4040002
        )

)

[2025-11-07 14:11:19] Detected MIME type: image/webp
[2025-11-07 14:11:19] Image validation: VALID
[2025-11-07 14:11:19] Detected MIME type: application/pdf
[2025-11-07 14:11:19] PDF validation: VALID
[2025-11-07 14:11:19] Form data sanitized successfully
[2025-11-07 14:11:19] Pesan medis: halobos
[2025-11-07 14:11:19] Data encrypted successfully
[2025-11-07 14:11:19] Starting file upload process...
[2025-11-07 14:11:19] === START FILE UPLOAD: fotoPasien ===
[2025-11-07 14:11:19] File info: Array
(
    [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [type] => image/webp
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpmLqMTG
    [error] => 0
    [size] => 70498
)

[2025-11-07 14:11:19] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-07 14:11:19] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:19] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:19] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:19] Directory is writable
[2025-11-07 14:11:19] Detected MIME type: image/webp
[2025-11-07 14:11:19] Image validation: VALID
[2025-11-07 14:11:19] File validation passed
[2025-11-07 14:11:19] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/690deff7d89c0_1762521079.webp
[2025-11-07 14:11:19] Temp file exists: YES
[2025-11-07 14:11:19] Temp file size: 70498
[2025-11-07 14:11:19] File moved successfully
[2025-11-07 14:11:19] File verified - Size: 70498 bytes
[2025-11-07 14:11:19] === START FILE UPLOAD: pdfDokumen ===
[2025-11-07 14:11:19] File info: Array
(
    [name] => Aplikasi.pdf
    [full_path] => Aplikasi.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpvGEmON
    [error] => 0
    [size] => 4040002
)

[2025-11-07 14:11:19] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-07 14:11:19] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:19] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:19] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:19] Directory is writable
[2025-11-07 14:11:19] Detected MIME type: application/pdf
[2025-11-07 14:11:19] PDF validation: VALID
[2025-11-07 14:11:19] File validation passed
[2025-11-07 14:11:19] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690deff7d95f5_1762521079.pdf
[2025-11-07 14:11:19] Temp file exists: YES
[2025-11-07 14:11:19] Temp file size: 4040002
[2025-11-07 14:11:19] File moved successfully
[2025-11-07 14:11:19] File verified - Size: 4040002 bytes
[2025-11-07 14:11:19] Applying steganography to photo...
[2025-11-07 14:11:19] Steganography - Image path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/690deff7d89c0_1762521079.webp
[2025-11-07 14:11:19] Steganography - Encrypted message length: 24
[2025-11-07 14:11:19] Steganography ERROR: Cannot read image info
[2025-11-07 14:11:19] Steganography failed, but continuing without it
[2025-11-07 14:11:19] File upload results - Foto: 690deff7d89c0_1762521079.webp, PDF: 690deff7d95f5_1762521079.pdf
[2025-11-07 14:11:19] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran,
                medmsg
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-07 14:11:19] ERROR: Unknown column 'medmsg' in 'field list'
[2025-11-07 14:11:19] Sending error response: Unknown column 'medmsg' in 'field list'
[2025-11-07 14:11:19] === REQUEST COMPLETED ===
[2025-11-07 14:11:20] === NEW REQUEST STARTED ===
[2025-11-07 14:11:20] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-07 14:11:20] Database connected successfully
[2025-11-07 14:11:20] Request method: POST
[2025-11-07 14:11:20] === START PROCESSING FORM DATA ===
[2025-11-07 14:11:20] POST data: Array
(
    [namaPasien] => jajjasdj
    [tanggalLahir] => 2025-11-04
    [alamat] => qwmdjkqmdj
    [jenisLayanan] => pemeriksaan
    [statusPasien] => perawatan
    [hasilPemeriksaan] => navnsasnkskskas
    [medmsg] => halobos
    [jumlahPembayaran] => 543543
)

[2025-11-07 14:11:20] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [type] => image/webp
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php0Jo9Uz
            [error] => 0
            [size] => 70498
        )

    [pdfDokumen] => Array
        (
            [name] => Aplikasi.pdf
            [full_path] => Aplikasi.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php88QdLo
            [error] => 0
            [size] => 4040002
        )

)

[2025-11-07 14:11:20] Detected MIME type: image/webp
[2025-11-07 14:11:20] Image validation: VALID
[2025-11-07 14:11:20] Detected MIME type: application/pdf
[2025-11-07 14:11:20] PDF validation: VALID
[2025-11-07 14:11:20] Form data sanitized successfully
[2025-11-07 14:11:20] Pesan medis: halobos
[2025-11-07 14:11:20] Data encrypted successfully
[2025-11-07 14:11:20] Starting file upload process...
[2025-11-07 14:11:20] === START FILE UPLOAD: fotoPasien ===
[2025-11-07 14:11:20] File info: Array
(
    [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [type] => image/webp
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php0Jo9Uz
    [error] => 0
    [size] => 70498
)

[2025-11-07 14:11:20] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-07 14:11:20] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:20] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:20] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:20] Directory is writable
[2025-11-07 14:11:20] Detected MIME type: image/webp
[2025-11-07 14:11:20] Image validation: VALID
[2025-11-07 14:11:20] File validation passed
[2025-11-07 14:11:20] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/690deff82a0c2_1762521080.webp
[2025-11-07 14:11:20] Temp file exists: YES
[2025-11-07 14:11:20] Temp file size: 70498
[2025-11-07 14:11:20] File moved successfully
[2025-11-07 14:11:20] File verified - Size: 70498 bytes
[2025-11-07 14:11:20] === START FILE UPLOAD: pdfDokumen ===
[2025-11-07 14:11:20] File info: Array
(
    [name] => Aplikasi.pdf
    [full_path] => Aplikasi.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php88QdLo
    [error] => 0
    [size] => 4040002
)

[2025-11-07 14:11:20] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-07 14:11:20] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:20] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:20] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:20] Directory is writable
[2025-11-07 14:11:20] Detected MIME type: application/pdf
[2025-11-07 14:11:20] PDF validation: VALID
[2025-11-07 14:11:20] File validation passed
[2025-11-07 14:11:20] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690deff82a73e_1762521080.pdf
[2025-11-07 14:11:20] Temp file exists: YES
[2025-11-07 14:11:20] Temp file size: 4040002
[2025-11-07 14:11:20] File moved successfully
[2025-11-07 14:11:20] File verified - Size: 4040002 bytes
[2025-11-07 14:11:20] Applying steganography to photo...
[2025-11-07 14:11:20] Steganography - Image path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/690deff82a0c2_1762521080.webp
[2025-11-07 14:11:20] Steganography - Encrypted message length: 24
[2025-11-07 14:11:20] Steganography ERROR: Cannot read image info
[2025-11-07 14:11:20] Steganography failed, but continuing without it
[2025-11-07 14:11:20] File upload results - Foto: 690deff82a0c2_1762521080.webp, PDF: 690deff82a73e_1762521080.pdf
[2025-11-07 14:11:20] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran,
                medmsg
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-07 14:11:20] ERROR: Unknown column 'medmsg' in 'field list'
[2025-11-07 14:11:20] Sending error response: Unknown column 'medmsg' in 'field list'
[2025-11-07 14:11:20] === REQUEST COMPLETED ===
[2025-11-07 14:11:20] === NEW REQUEST STARTED ===
[2025-11-07 14:11:20] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-07 14:11:20] Database connected successfully
[2025-11-07 14:11:20] Request method: POST
[2025-11-07 14:11:20] === START PROCESSING FORM DATA ===
[2025-11-07 14:11:20] POST data: Array
(
    [namaPasien] => jajjasdj
    [tanggalLahir] => 2025-11-04
    [alamat] => qwmdjkqmdj
    [jenisLayanan] => pemeriksaan
    [statusPasien] => perawatan
    [hasilPemeriksaan] => navnsasnkskskas
    [medmsg] => halobos
    [jumlahPembayaran] => 543543
)

[2025-11-07 14:11:20] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [type] => image/webp
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpCivBO2
            [error] => 0
            [size] => 70498
        )

    [pdfDokumen] => Array
        (
            [name] => Aplikasi.pdf
            [full_path] => Aplikasi.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpfxmgVB
            [error] => 0
            [size] => 4040002
        )

)

[2025-11-07 14:11:20] Detected MIME type: image/webp
[2025-11-07 14:11:20] Image validation: VALID
[2025-11-07 14:11:20] Detected MIME type: application/pdf
[2025-11-07 14:11:20] PDF validation: VALID
[2025-11-07 14:11:20] Form data sanitized successfully
[2025-11-07 14:11:20] Pesan medis: halobos
[2025-11-07 14:11:20] Data encrypted successfully
[2025-11-07 14:11:20] Starting file upload process...
[2025-11-07 14:11:20] === START FILE UPLOAD: fotoPasien ===
[2025-11-07 14:11:20] File info: Array
(
    [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [type] => image/webp
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpCivBO2
    [error] => 0
    [size] => 70498
)

[2025-11-07 14:11:20] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-07 14:11:20] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:20] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:20] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:20] Directory is writable
[2025-11-07 14:11:20] Detected MIME type: image/webp
[2025-11-07 14:11:20] Image validation: VALID
[2025-11-07 14:11:20] File validation passed
[2025-11-07 14:11:20] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/690deff85ec43_1762521080.webp
[2025-11-07 14:11:20] Temp file exists: YES
[2025-11-07 14:11:20] Temp file size: 70498
[2025-11-07 14:11:20] File moved successfully
[2025-11-07 14:11:20] File verified - Size: 70498 bytes
[2025-11-07 14:11:20] === START FILE UPLOAD: pdfDokumen ===
[2025-11-07 14:11:20] File info: Array
(
    [name] => Aplikasi.pdf
    [full_path] => Aplikasi.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpfxmgVB
    [error] => 0
    [size] => 4040002
)

[2025-11-07 14:11:20] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-07 14:11:20] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:20] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:20] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:20] Directory is writable
[2025-11-07 14:11:20] Detected MIME type: application/pdf
[2025-11-07 14:11:20] PDF validation: VALID
[2025-11-07 14:11:20] File validation passed
[2025-11-07 14:11:20] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690deff85f494_1762521080.pdf
[2025-11-07 14:11:20] Temp file exists: YES
[2025-11-07 14:11:20] Temp file size: 4040002
[2025-11-07 14:11:20] File moved successfully
[2025-11-07 14:11:20] File verified - Size: 4040002 bytes
[2025-11-07 14:11:20] Applying steganography to photo...
[2025-11-07 14:11:20] Steganography - Image path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/690deff85ec43_1762521080.webp
[2025-11-07 14:11:20] Steganography - Encrypted message length: 24
[2025-11-07 14:11:20] Steganography ERROR: Cannot read image info
[2025-11-07 14:11:20] Steganography failed, but continuing without it
[2025-11-07 14:11:20] File upload results - Foto: 690deff85ec43_1762521080.webp, PDF: 690deff85f494_1762521080.pdf
[2025-11-07 14:11:20] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran,
                medmsg
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-07 14:11:20] ERROR: Unknown column 'medmsg' in 'field list'
[2025-11-07 14:11:20] Sending error response: Unknown column 'medmsg' in 'field list'
[2025-11-07 14:11:20] === REQUEST COMPLETED ===
[2025-11-07 14:11:20] === NEW REQUEST STARTED ===
[2025-11-07 14:11:20] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-07 14:11:20] Database connected successfully
[2025-11-07 14:11:20] Request method: POST
[2025-11-07 14:11:20] === START PROCESSING FORM DATA ===
[2025-11-07 14:11:20] POST data: Array
(
    [namaPasien] => jajjasdj
    [tanggalLahir] => 2025-11-04
    [alamat] => qwmdjkqmdj
    [jenisLayanan] => pemeriksaan
    [statusPasien] => perawatan
    [hasilPemeriksaan] => navnsasnkskskas
    [medmsg] => halobos
    [jumlahPembayaran] => 543543
)

[2025-11-07 14:11:20] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [type] => image/webp
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpRdxHlW
            [error] => 0
            [size] => 70498
        )

    [pdfDokumen] => Array
        (
            [name] => Aplikasi.pdf
            [full_path] => Aplikasi.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpsl7QBc
            [error] => 0
            [size] => 4040002
        )

)

[2025-11-07 14:11:20] Detected MIME type: image/webp
[2025-11-07 14:11:20] Image validation: VALID
[2025-11-07 14:11:20] Detected MIME type: application/pdf
[2025-11-07 14:11:20] PDF validation: VALID
[2025-11-07 14:11:20] Form data sanitized successfully
[2025-11-07 14:11:20] Pesan medis: halobos
[2025-11-07 14:11:20] Data encrypted successfully
[2025-11-07 14:11:20] Starting file upload process...
[2025-11-07 14:11:20] === START FILE UPLOAD: fotoPasien ===
[2025-11-07 14:11:20] File info: Array
(
    [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [type] => image/webp
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpRdxHlW
    [error] => 0
    [size] => 70498
)

[2025-11-07 14:11:20] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-07 14:11:20] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:20] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:20] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:20] Directory is writable
[2025-11-07 14:11:20] Detected MIME type: image/webp
[2025-11-07 14:11:20] Image validation: VALID
[2025-11-07 14:11:20] File validation passed
[2025-11-07 14:11:20] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/690deff89b0c7_1762521080.webp
[2025-11-07 14:11:20] Temp file exists: YES
[2025-11-07 14:11:20] Temp file size: 70498
[2025-11-07 14:11:20] File moved successfully
[2025-11-07 14:11:20] File verified - Size: 70498 bytes
[2025-11-07 14:11:20] === START FILE UPLOAD: pdfDokumen ===
[2025-11-07 14:11:20] File info: Array
(
    [name] => Aplikasi.pdf
    [full_path] => Aplikasi.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpsl7QBc
    [error] => 0
    [size] => 4040002
)

[2025-11-07 14:11:20] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-07 14:11:20] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:20] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:20] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:20] Directory is writable
[2025-11-07 14:11:20] Detected MIME type: application/pdf
[2025-11-07 14:11:20] PDF validation: VALID
[2025-11-07 14:11:20] File validation passed
[2025-11-07 14:11:20] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690deff89b65d_1762521080.pdf
[2025-11-07 14:11:20] Temp file exists: YES
[2025-11-07 14:11:20] Temp file size: 4040002
[2025-11-07 14:11:20] File moved successfully
[2025-11-07 14:11:20] File verified - Size: 4040002 bytes
[2025-11-07 14:11:20] Applying steganography to photo...
[2025-11-07 14:11:20] Steganography - Image path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/690deff89b0c7_1762521080.webp
[2025-11-07 14:11:20] Steganography - Encrypted message length: 24
[2025-11-07 14:11:20] Steganography ERROR: Cannot read image info
[2025-11-07 14:11:20] Steganography failed, but continuing without it
[2025-11-07 14:11:20] File upload results - Foto: 690deff89b0c7_1762521080.webp, PDF: 690deff89b65d_1762521080.pdf
[2025-11-07 14:11:20] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran,
                medmsg
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-07 14:11:20] ERROR: Unknown column 'medmsg' in 'field list'
[2025-11-07 14:11:20] Sending error response: Unknown column 'medmsg' in 'field list'
[2025-11-07 14:11:20] === REQUEST COMPLETED ===
[2025-11-07 14:11:20] === NEW REQUEST STARTED ===
[2025-11-07 14:11:20] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-07 14:11:20] Database connected successfully
[2025-11-07 14:11:20] Request method: POST
[2025-11-07 14:11:20] === START PROCESSING FORM DATA ===
[2025-11-07 14:11:20] POST data: Array
(
    [namaPasien] => jajjasdj
    [tanggalLahir] => 2025-11-04
    [alamat] => qwmdjkqmdj
    [jenisLayanan] => pemeriksaan
    [statusPasien] => perawatan
    [hasilPemeriksaan] => navnsasnkskskas
    [medmsg] => halobos
    [jumlahPembayaran] => 543543
)

[2025-11-07 14:11:20] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [type] => image/webp
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phppVo2Ra
            [error] => 0
            [size] => 70498
        )

    [pdfDokumen] => Array
        (
            [name] => Aplikasi.pdf
            [full_path] => Aplikasi.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpI1QKLl
            [error] => 0
            [size] => 4040002
        )

)

[2025-11-07 14:11:20] Detected MIME type: image/webp
[2025-11-07 14:11:20] Image validation: VALID
[2025-11-07 14:11:20] Detected MIME type: application/pdf
[2025-11-07 14:11:20] PDF validation: VALID
[2025-11-07 14:11:20] Form data sanitized successfully
[2025-11-07 14:11:20] Pesan medis: halobos
[2025-11-07 14:11:20] Data encrypted successfully
[2025-11-07 14:11:20] Starting file upload process...
[2025-11-07 14:11:20] === START FILE UPLOAD: fotoPasien ===
[2025-11-07 14:11:20] File info: Array
(
    [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [type] => image/webp
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phppVo2Ra
    [error] => 0
    [size] => 70498
)

[2025-11-07 14:11:20] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-07 14:11:20] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:20] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:20] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:20] Directory is writable
[2025-11-07 14:11:20] Detected MIME type: image/webp
[2025-11-07 14:11:20] Image validation: VALID
[2025-11-07 14:11:20] File validation passed
[2025-11-07 14:11:20] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/690deff8d3fde_1762521080.webp
[2025-11-07 14:11:20] Temp file exists: YES
[2025-11-07 14:11:20] Temp file size: 70498
[2025-11-07 14:11:20] File moved successfully
[2025-11-07 14:11:20] File verified - Size: 70498 bytes
[2025-11-07 14:11:20] === START FILE UPLOAD: pdfDokumen ===
[2025-11-07 14:11:20] File info: Array
(
    [name] => Aplikasi.pdf
    [full_path] => Aplikasi.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpI1QKLl
    [error] => 0
    [size] => 4040002
)

[2025-11-07 14:11:20] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-07 14:11:20] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:20] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:20] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:20] Directory is writable
[2025-11-07 14:11:20] Detected MIME type: application/pdf
[2025-11-07 14:11:20] PDF validation: VALID
[2025-11-07 14:11:20] File validation passed
[2025-11-07 14:11:20] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690deff8d4609_1762521080.pdf
[2025-11-07 14:11:20] Temp file exists: YES
[2025-11-07 14:11:20] Temp file size: 4040002
[2025-11-07 14:11:20] File moved successfully
[2025-11-07 14:11:20] File verified - Size: 4040002 bytes
[2025-11-07 14:11:20] Applying steganography to photo...
[2025-11-07 14:11:20] Steganography - Image path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/690deff8d3fde_1762521080.webp
[2025-11-07 14:11:20] Steganography - Encrypted message length: 24
[2025-11-07 14:11:20] Steganography ERROR: Cannot read image info
[2025-11-07 14:11:20] Steganography failed, but continuing without it
[2025-11-07 14:11:20] File upload results - Foto: 690deff8d3fde_1762521080.webp, PDF: 690deff8d4609_1762521080.pdf
[2025-11-07 14:11:20] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran,
                medmsg
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-07 14:11:20] ERROR: Unknown column 'medmsg' in 'field list'
[2025-11-07 14:11:20] Sending error response: Unknown column 'medmsg' in 'field list'
[2025-11-07 14:11:20] === REQUEST COMPLETED ===
[2025-11-07 14:11:21] === NEW REQUEST STARTED ===
[2025-11-07 14:11:21] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-07 14:11:21] Database connected successfully
[2025-11-07 14:11:21] Request method: POST
[2025-11-07 14:11:21] === START PROCESSING FORM DATA ===
[2025-11-07 14:11:21] POST data: Array
(
    [namaPasien] => jajjasdj
    [tanggalLahir] => 2025-11-04
    [alamat] => qwmdjkqmdj
    [jenisLayanan] => pemeriksaan
    [statusPasien] => perawatan
    [hasilPemeriksaan] => navnsasnkskskas
    [medmsg] => halobos
    [jumlahPembayaran] => 543543
)

[2025-11-07 14:11:21] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [type] => image/webp
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpat7F44
            [error] => 0
            [size] => 70498
        )

    [pdfDokumen] => Array
        (
            [name] => Aplikasi.pdf
            [full_path] => Aplikasi.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpq5UXR2
            [error] => 0
            [size] => 4040002
        )

)

[2025-11-07 14:11:21] Detected MIME type: image/webp
[2025-11-07 14:11:21] Image validation: VALID
[2025-11-07 14:11:21] Detected MIME type: application/pdf
[2025-11-07 14:11:21] PDF validation: VALID
[2025-11-07 14:11:21] Form data sanitized successfully
[2025-11-07 14:11:21] Pesan medis: halobos
[2025-11-07 14:11:21] Data encrypted successfully
[2025-11-07 14:11:21] Starting file upload process...
[2025-11-07 14:11:21] === START FILE UPLOAD: fotoPasien ===
[2025-11-07 14:11:21] File info: Array
(
    [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [type] => image/webp
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpat7F44
    [error] => 0
    [size] => 70498
)

[2025-11-07 14:11:21] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-07 14:11:21] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:21] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:21] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:21] Directory is writable
[2025-11-07 14:11:21] Detected MIME type: image/webp
[2025-11-07 14:11:21] Image validation: VALID
[2025-11-07 14:11:21] File validation passed
[2025-11-07 14:11:21] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/690deff944bd0_1762521081.webp
[2025-11-07 14:11:21] Temp file exists: YES
[2025-11-07 14:11:21] Temp file size: 70498
[2025-11-07 14:11:21] File moved successfully
[2025-11-07 14:11:21] File verified - Size: 70498 bytes
[2025-11-07 14:11:21] === START FILE UPLOAD: pdfDokumen ===
[2025-11-07 14:11:21] File info: Array
(
    [name] => Aplikasi.pdf
    [full_path] => Aplikasi.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpq5UXR2
    [error] => 0
    [size] => 4040002
)

[2025-11-07 14:11:21] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-07 14:11:21] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:21] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:21] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:21] Directory is writable
[2025-11-07 14:11:21] Detected MIME type: application/pdf
[2025-11-07 14:11:21] PDF validation: VALID
[2025-11-07 14:11:21] File validation passed
[2025-11-07 14:11:21] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690deff945133_1762521081.pdf
[2025-11-07 14:11:21] Temp file exists: YES
[2025-11-07 14:11:21] Temp file size: 4040002
[2025-11-07 14:11:21] File moved successfully
[2025-11-07 14:11:21] File verified - Size: 4040002 bytes
[2025-11-07 14:11:21] Applying steganography to photo...
[2025-11-07 14:11:21] Steganography - Image path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/690deff944bd0_1762521081.webp
[2025-11-07 14:11:21] Steganography - Encrypted message length: 24
[2025-11-07 14:11:21] Steganography ERROR: Cannot read image info
[2025-11-07 14:11:21] Steganography failed, but continuing without it
[2025-11-07 14:11:21] File upload results - Foto: 690deff944bd0_1762521081.webp, PDF: 690deff945133_1762521081.pdf
[2025-11-07 14:11:21] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran,
                medmsg
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-07 14:11:21] ERROR: Unknown column 'medmsg' in 'field list'
[2025-11-07 14:11:21] Sending error response: Unknown column 'medmsg' in 'field list'
[2025-11-07 14:11:21] === REQUEST COMPLETED ===
[2025-11-07 14:11:21] === NEW REQUEST STARTED ===
[2025-11-07 14:11:21] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-07 14:11:21] Database connected successfully
[2025-11-07 14:11:21] Request method: POST
[2025-11-07 14:11:21] === START PROCESSING FORM DATA ===
[2025-11-07 14:11:21] POST data: Array
(
    [namaPasien] => jajjasdj
    [tanggalLahir] => 2025-11-04
    [alamat] => qwmdjkqmdj
    [jenisLayanan] => pemeriksaan
    [statusPasien] => perawatan
    [hasilPemeriksaan] => navnsasnkskskas
    [medmsg] => halobos
    [jumlahPembayaran] => 543543
)

[2025-11-07 14:11:21] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [type] => image/webp
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpaCuR93
            [error] => 0
            [size] => 70498
        )

    [pdfDokumen] => Array
        (
            [name] => Aplikasi.pdf
            [full_path] => Aplikasi.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpxaEtiX
            [error] => 0
            [size] => 4040002
        )

)

[2025-11-07 14:11:21] Detected MIME type: image/webp
[2025-11-07 14:11:21] Image validation: VALID
[2025-11-07 14:11:21] Detected MIME type: application/pdf
[2025-11-07 14:11:21] PDF validation: VALID
[2025-11-07 14:11:21] Form data sanitized successfully
[2025-11-07 14:11:21] Pesan medis: halobos
[2025-11-07 14:11:21] Data encrypted successfully
[2025-11-07 14:11:21] Starting file upload process...
[2025-11-07 14:11:21] === START FILE UPLOAD: fotoPasien ===
[2025-11-07 14:11:21] File info: Array
(
    [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [type] => image/webp
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpaCuR93
    [error] => 0
    [size] => 70498
)

[2025-11-07 14:11:21] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-07 14:11:21] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:21] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:21] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:21] Directory is writable
[2025-11-07 14:11:21] Detected MIME type: image/webp
[2025-11-07 14:11:21] Image validation: VALID
[2025-11-07 14:11:21] File validation passed
[2025-11-07 14:11:21] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/690deff97bca1_1762521081.webp
[2025-11-07 14:11:21] Temp file exists: YES
[2025-11-07 14:11:21] Temp file size: 70498
[2025-11-07 14:11:21] File moved successfully
[2025-11-07 14:11:21] File verified - Size: 70498 bytes
[2025-11-07 14:11:21] === START FILE UPLOAD: pdfDokumen ===
[2025-11-07 14:11:21] File info: Array
(
    [name] => Aplikasi.pdf
    [full_path] => Aplikasi.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpxaEtiX
    [error] => 0
    [size] => 4040002
)

[2025-11-07 14:11:21] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-07 14:11:21] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:21] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:21] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:21] Directory is writable
[2025-11-07 14:11:21] Detected MIME type: application/pdf
[2025-11-07 14:11:21] PDF validation: VALID
[2025-11-07 14:11:21] File validation passed
[2025-11-07 14:11:21] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690deff97c269_1762521081.pdf
[2025-11-07 14:11:21] Temp file exists: YES
[2025-11-07 14:11:21] Temp file size: 4040002
[2025-11-07 14:11:21] File moved successfully
[2025-11-07 14:11:21] File verified - Size: 4040002 bytes
[2025-11-07 14:11:21] Applying steganography to photo...
[2025-11-07 14:11:21] Steganography - Image path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/690deff97bca1_1762521081.webp
[2025-11-07 14:11:21] Steganography - Encrypted message length: 24
[2025-11-07 14:11:21] Steganography ERROR: Cannot read image info
[2025-11-07 14:11:21] Steganography failed, but continuing without it
[2025-11-07 14:11:21] File upload results - Foto: 690deff97bca1_1762521081.webp, PDF: 690deff97c269_1762521081.pdf
[2025-11-07 14:11:21] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran,
                medmsg
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-07 14:11:21] ERROR: Unknown column 'medmsg' in 'field list'
[2025-11-07 14:11:21] Sending error response: Unknown column 'medmsg' in 'field list'
[2025-11-07 14:11:21] === REQUEST COMPLETED ===
[2025-11-07 14:11:21] === NEW REQUEST STARTED ===
[2025-11-07 14:11:21] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-07 14:11:21] Database connected successfully
[2025-11-07 14:11:21] Request method: POST
[2025-11-07 14:11:21] === START PROCESSING FORM DATA ===
[2025-11-07 14:11:21] POST data: Array
(
    [namaPasien] => jajjasdj
    [tanggalLahir] => 2025-11-04
    [alamat] => qwmdjkqmdj
    [jenisLayanan] => pemeriksaan
    [statusPasien] => perawatan
    [hasilPemeriksaan] => navnsasnkskskas
    [medmsg] => halobos
    [jumlahPembayaran] => 543543
)

[2025-11-07 14:11:21] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [type] => image/webp
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpgND2S8
            [error] => 0
            [size] => 70498
        )

    [pdfDokumen] => Array
        (
            [name] => Aplikasi.pdf
            [full_path] => Aplikasi.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpg1wIN1
            [error] => 0
            [size] => 4040002
        )

)

[2025-11-07 14:11:21] Detected MIME type: image/webp
[2025-11-07 14:11:21] Image validation: VALID
[2025-11-07 14:11:21] Detected MIME type: application/pdf
[2025-11-07 14:11:21] PDF validation: VALID
[2025-11-07 14:11:21] Form data sanitized successfully
[2025-11-07 14:11:21] Pesan medis: halobos
[2025-11-07 14:11:21] Data encrypted successfully
[2025-11-07 14:11:21] Starting file upload process...
[2025-11-07 14:11:21] === START FILE UPLOAD: fotoPasien ===
[2025-11-07 14:11:21] File info: Array
(
    [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [type] => image/webp
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpgND2S8
    [error] => 0
    [size] => 70498
)

[2025-11-07 14:11:21] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-07 14:11:21] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:21] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:21] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:21] Directory is writable
[2025-11-07 14:11:21] Detected MIME type: image/webp
[2025-11-07 14:11:21] Image validation: VALID
[2025-11-07 14:11:21] File validation passed
[2025-11-07 14:11:21] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/690deff9afde2_1762521081.webp
[2025-11-07 14:11:21] Temp file exists: YES
[2025-11-07 14:11:21] Temp file size: 70498
[2025-11-07 14:11:21] File moved successfully
[2025-11-07 14:11:21] File verified - Size: 70498 bytes
[2025-11-07 14:11:21] === START FILE UPLOAD: pdfDokumen ===
[2025-11-07 14:11:21] File info: Array
(
    [name] => Aplikasi.pdf
    [full_path] => Aplikasi.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpg1wIN1
    [error] => 0
    [size] => 4040002
)

[2025-11-07 14:11:21] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-07 14:11:21] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:21] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:21] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:21] Directory is writable
[2025-11-07 14:11:21] Detected MIME type: application/pdf
[2025-11-07 14:11:21] PDF validation: VALID
[2025-11-07 14:11:21] File validation passed
[2025-11-07 14:11:21] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690deff9b0448_1762521081.pdf
[2025-11-07 14:11:21] Temp file exists: YES
[2025-11-07 14:11:21] Temp file size: 4040002
[2025-11-07 14:11:21] File moved successfully
[2025-11-07 14:11:21] File verified - Size: 4040002 bytes
[2025-11-07 14:11:21] Applying steganography to photo...
[2025-11-07 14:11:21] Steganography - Image path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/690deff9afde2_1762521081.webp
[2025-11-07 14:11:21] Steganography - Encrypted message length: 24
[2025-11-07 14:11:21] Steganography ERROR: Cannot read image info
[2025-11-07 14:11:21] Steganography failed, but continuing without it
[2025-11-07 14:11:21] File upload results - Foto: 690deff9afde2_1762521081.webp, PDF: 690deff9b0448_1762521081.pdf
[2025-11-07 14:11:21] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran,
                medmsg
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-07 14:11:21] ERROR: Unknown column 'medmsg' in 'field list'
[2025-11-07 14:11:21] Sending error response: Unknown column 'medmsg' in 'field list'
[2025-11-07 14:11:21] === REQUEST COMPLETED ===
[2025-11-07 14:11:21] === NEW REQUEST STARTED ===
[2025-11-07 14:11:21] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-07 14:11:21] Database connected successfully
[2025-11-07 14:11:21] Request method: POST
[2025-11-07 14:11:21] === START PROCESSING FORM DATA ===
[2025-11-07 14:11:21] POST data: Array
(
    [namaPasien] => jajjasdj
    [tanggalLahir] => 2025-11-04
    [alamat] => qwmdjkqmdj
    [jenisLayanan] => pemeriksaan
    [statusPasien] => perawatan
    [hasilPemeriksaan] => navnsasnkskskas
    [medmsg] => halobos
    [jumlahPembayaran] => 543543
)

[2025-11-07 14:11:21] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [type] => image/webp
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpkqkErX
            [error] => 0
            [size] => 70498
        )

    [pdfDokumen] => Array
        (
            [name] => Aplikasi.pdf
            [full_path] => Aplikasi.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php0AHvAf
            [error] => 0
            [size] => 4040002
        )

)

[2025-11-07 14:11:21] Detected MIME type: image/webp
[2025-11-07 14:11:21] Image validation: VALID
[2025-11-07 14:11:21] Detected MIME type: application/pdf
[2025-11-07 14:11:21] PDF validation: VALID
[2025-11-07 14:11:21] Form data sanitized successfully
[2025-11-07 14:11:21] Pesan medis: halobos
[2025-11-07 14:11:21] Data encrypted successfully
[2025-11-07 14:11:21] Starting file upload process...
[2025-11-07 14:11:21] === START FILE UPLOAD: fotoPasien ===
[2025-11-07 14:11:21] File info: Array
(
    [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [type] => image/webp
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpkqkErX
    [error] => 0
    [size] => 70498
)

[2025-11-07 14:11:21] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-07 14:11:21] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:21] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:21] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:11:21] Directory is writable
[2025-11-07 14:11:21] Detected MIME type: image/webp
[2025-11-07 14:11:21] Image validation: VALID
[2025-11-07 14:11:21] File validation passed
[2025-11-07 14:11:21] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/690deff9d3581_1762521081.webp
[2025-11-07 14:11:21] Temp file exists: YES
[2025-11-07 14:11:21] Temp file size: 70498
[2025-11-07 14:11:21] File moved successfully
[2025-11-07 14:11:21] File verified - Size: 70498 bytes
[2025-11-07 14:11:21] === START FILE UPLOAD: pdfDokumen ===
[2025-11-07 14:11:21] File info: Array
(
    [name] => Aplikasi.pdf
    [full_path] => Aplikasi.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php0AHvAf
    [error] => 0
    [size] => 4040002
)

[2025-11-07 14:11:21] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-07 14:11:21] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:21] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:21] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:11:21] Directory is writable
[2025-11-07 14:11:21] Detected MIME type: application/pdf
[2025-11-07 14:11:21] PDF validation: VALID
[2025-11-07 14:11:21] File validation passed
[2025-11-07 14:11:21] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690deff9d3b91_1762521081.pdf
[2025-11-07 14:11:21] Temp file exists: YES
[2025-11-07 14:11:21] Temp file size: 4040002
[2025-11-07 14:11:21] File moved successfully
[2025-11-07 14:11:21] File verified - Size: 4040002 bytes
[2025-11-07 14:11:21] Applying steganography to photo...
[2025-11-07 14:11:21] Steganography - Image path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/690deff9d3581_1762521081.webp
[2025-11-07 14:11:21] Steganography - Encrypted message length: 24
[2025-11-07 14:11:21] Steganography ERROR: Cannot read image info
[2025-11-07 14:11:21] Steganography failed, but continuing without it
[2025-11-07 14:11:21] File upload results - Foto: 690deff9d3581_1762521081.webp, PDF: 690deff9d3b91_1762521081.pdf
[2025-11-07 14:11:21] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran,
                medmsg
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-07 14:11:21] ERROR: Unknown column 'medmsg' in 'field list'
[2025-11-07 14:11:21] Sending error response: Unknown column 'medmsg' in 'field list'
[2025-11-07 14:11:21] === REQUEST COMPLETED ===
[2025-11-07 14:46:42] === NEW REQUEST STARTED ===
[2025-11-07 14:46:42] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-07 14:46:42] Database connected successfully
[2025-11-07 14:46:42] Request method: POST
[2025-11-07 14:46:42] === START PROCESSING FORM DATA ===
[2025-11-07 14:46:42] POST data: Array
(
    [namaPasien] => youyou
    [tanggalLahir] => 2025-11-24
    [alamat] => yazu
    [jenisLayanan] => rawat-jalan
    [statusPasien] => perawatan
    [hasilPemeriksaan] => buset dah
    [medmsg] => Dimitri
    [jumlahPembayaran] => 867586
)

[2025-11-07 14:46:42] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [type] => image/webp
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpSU7yoe
            [error] => 0
            [size] => 70498
        )

    [pdfDokumen] => Array
        (
            [name] => 124230017_Daniel Satria Darmawan.pdf
            [full_path] => 124230017_Daniel Satria Darmawan.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpEcwYeg
            [error] => 0
            [size] => 170820
        )

)

[2025-11-07 14:46:42] Detected MIME type: image/webp
[2025-11-07 14:46:42] Image validation: VALID
[2025-11-07 14:46:42] Detected MIME type: application/pdf
[2025-11-07 14:46:42] PDF validation: VALID
[2025-11-07 14:46:42] Form data sanitized successfully
[2025-11-07 14:46:42] Data encrypted successfully
[2025-11-07 14:46:42] Starting file upload process...
[2025-11-07 14:46:42] === START FILE UPLOAD: fotoPasien ===
[2025-11-07 14:46:42] File info: Array
(
    [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [type] => image/webp
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpSU7yoe
    [error] => 0
    [size] => 70498
)

[2025-11-07 14:46:42] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-07 14:46:42] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:46:42] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:46:42] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:46:42] Directory is writable
[2025-11-07 14:46:42] Detected MIME type: image/webp
[2025-11-07 14:46:42] Image validation: VALID
[2025-11-07 14:46:42] File validation passed
[2025-11-07 14:46:42] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/690df84228844_1762523202.webp
[2025-11-07 14:46:42] Temp file exists: YES
[2025-11-07 14:46:42] Temp file size: 70498
[2025-11-07 14:46:42] File moved successfully
[2025-11-07 14:46:42] File verified - Size: 70498 bytes
[2025-11-07 14:46:42] === START FILE UPLOAD: pdfDokumen ===
[2025-11-07 14:46:42] File info: Array
(
    [name] => 124230017_Daniel Satria Darmawan.pdf
    [full_path] => 124230017_Daniel Satria Darmawan.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpEcwYeg
    [error] => 0
    [size] => 170820
)

[2025-11-07 14:46:42] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-07 14:46:42] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:46:42] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:46:42] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:46:42] Directory is writable
[2025-11-07 14:46:42] Detected MIME type: application/pdf
[2025-11-07 14:46:42] PDF validation: VALID
[2025-11-07 14:46:42] File validation passed
[2025-11-07 14:46:42] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690df84228cc7_1762523202.pdf
[2025-11-07 14:46:42] Temp file exists: YES
[2025-11-07 14:46:42] Temp file size: 170820
[2025-11-07 14:46:42] File moved successfully
[2025-11-07 14:46:42] File verified - Size: 170820 bytes
[2025-11-07 14:46:42] File upload results - Foto: 690df84228844_1762523202.webp, PDF: 690df84228cc7_1762523202.pdf
[2025-11-07 14:46:42] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-07 14:46:42] Data successfully inserted with ID: 63
[2025-11-07 14:46:42] Sending success response
[2025-11-07 14:46:42] === REQUEST COMPLETED ===
[2025-11-07 14:47:44] === NEW REQUEST STARTED ===
[2025-11-07 14:47:44] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-07 14:47:44] Database connected successfully
[2025-11-07 14:47:44] Request method: POST
[2025-11-07 14:47:44] === START PROCESSING FORM DATA ===
[2025-11-07 14:47:44] POST data: Array
(
    [namaPasien] => okebro
    [tanggalLahir] => 2025-11-12
    [alamat] => cek bro
    [jenisLayanan] => rawat-jalan
    [statusPasien] => perawatan
    [hasilPemeriksaan] => best hgjhgjhg
    [medmsg] => buset wkwkwkwkwk
    [jumlahPembayaran] => 978675
)

[2025-11-07 14:47:44] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => Brad_Pitt_2019_by_Glenn_Francis.jpg
            [full_path] => Brad_Pitt_2019_by_Glenn_Francis.jpg
            [type] => image/jpeg
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpBQPBvU
            [error] => 0
            [size] => 22816
        )

    [pdfDokumen] => Array
        (
            [name] => 124230017_Daniel Satria Darmawan.pdf
            [full_path] => 124230017_Daniel Satria Darmawan.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpPb5fVb
            [error] => 0
            [size] => 170820
        )

)

[2025-11-07 14:47:44] Detected MIME type: image/jpeg
[2025-11-07 14:47:44] Image validation: VALID
[2025-11-07 14:47:44] Detected MIME type: application/pdf
[2025-11-07 14:47:44] PDF validation: VALID
[2025-11-07 14:47:44] Form data sanitized successfully
[2025-11-07 14:47:44] Data encrypted successfully
[2025-11-07 14:47:44] Starting file upload process...
[2025-11-07 14:47:44] === START FILE UPLOAD: fotoPasien ===
[2025-11-07 14:47:44] File info: Array
(
    [name] => Brad_Pitt_2019_by_Glenn_Francis.jpg
    [full_path] => Brad_Pitt_2019_by_Glenn_Francis.jpg
    [type] => image/jpeg
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpBQPBvU
    [error] => 0
    [size] => 22816
)

[2025-11-07 14:47:44] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-07 14:47:44] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:47:44] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:47:44] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 14:47:44] Directory is writable
[2025-11-07 14:47:44] Detected MIME type: image/jpeg
[2025-11-07 14:47:44] Image validation: VALID
[2025-11-07 14:47:44] File validation passed
[2025-11-07 14:47:44] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/690df880a1197_1762523264.jpg
[2025-11-07 14:47:44] Temp file exists: YES
[2025-11-07 14:47:44] Temp file size: 22816
[2025-11-07 14:47:44] File moved successfully
[2025-11-07 14:47:44] File verified - Size: 22816 bytes
[2025-11-07 14:47:44] === START FILE UPLOAD: pdfDokumen ===
[2025-11-07 14:47:44] File info: Array
(
    [name] => 124230017_Daniel Satria Darmawan.pdf
    [full_path] => 124230017_Daniel Satria Darmawan.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpPb5fVb
    [error] => 0
    [size] => 170820
)

[2025-11-07 14:47:44] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-07 14:47:44] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:47:44] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:47:44] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 14:47:44] Directory is writable
[2025-11-07 14:47:44] Detected MIME type: application/pdf
[2025-11-07 14:47:44] PDF validation: VALID
[2025-11-07 14:47:44] File validation passed
[2025-11-07 14:47:44] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690df880a161a_1762523264.pdf
[2025-11-07 14:47:44] Temp file exists: YES
[2025-11-07 14:47:44] Temp file size: 170820
[2025-11-07 14:47:44] File moved successfully
[2025-11-07 14:47:44] File verified - Size: 170820 bytes
[2025-11-07 14:47:44] File upload results - Foto: 690df880a1197_1762523264.jpg, PDF: 690df880a161a_1762523264.pdf
[2025-11-07 14:47:44] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-07 14:47:44] Data successfully inserted with ID: 64
[2025-11-07 14:47:44] Sending success response
[2025-11-07 14:47:44] === REQUEST COMPLETED ===
[2025-11-07 15:14:03] === NEW REQUEST STARTED ===
[2025-11-07 15:14:03] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-07 15:14:03] Database connected successfully
[2025-11-07 15:14:03] Request method: POST
[2025-11-07 15:14:03] === START PROCESSING FORM DATA ===
[2025-11-07 15:14:03] POST data: Array
(
    [namaPasien] => sadsadasd
    [tanggalLahir] => 2025-11-25
    [alamat] => asdasdasdas
    [jenisLayanan] => rawat-jalan
    [statusPasien] => selesai
    [hasilPemeriksaan] => asxasddsacascc
    [medmsg] => sasxsxasx
    [jumlahPembayaran] => 6876782
)

[2025-11-07 15:14:03] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [type] => image/webp
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phposouyY
            [error] => 0
            [size] => 70498
        )

    [pdfDokumen] => Array
        (
            [name] => 124230017_Daniel Satria Darmawan.pdf
            [full_path] => 124230017_Daniel Satria Darmawan.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php6hWwp7
            [error] => 0
            [size] => 170820
        )

)

[2025-11-07 15:14:03] Detected MIME type: image/webp
[2025-11-07 15:14:03] Image validation: VALID
[2025-11-07 15:14:03] Detected MIME type: application/pdf
[2025-11-07 15:14:03] PDF validation: VALID
[2025-11-07 15:14:03] Form data sanitized successfully
[2025-11-07 15:14:03] Data encrypted successfully
[2025-11-07 15:14:03] Starting file upload process...
[2025-11-07 15:14:03] === START FILE UPLOAD: fotoPasien ===
[2025-11-07 15:14:03] File info: Array
(
    [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [type] => image/webp
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phposouyY
    [error] => 0
    [size] => 70498
)

[2025-11-07 15:14:03] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-07 15:14:03] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 15:14:03] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 15:14:03] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 15:14:03] Directory is writable
[2025-11-07 15:14:03] Detected MIME type: image/webp
[2025-11-07 15:14:03] Image validation: VALID
[2025-11-07 15:14:03] File validation passed
[2025-11-07 15:14:03] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/690dfeab6a82b_1762524843.webp
[2025-11-07 15:14:03] Temp file exists: YES
[2025-11-07 15:14:03] Temp file size: 70498
[2025-11-07 15:14:03] File moved successfully
[2025-11-07 15:14:03] File verified - Size: 70498 bytes
[2025-11-07 15:14:03] === START FILE UPLOAD: pdfDokumen ===
[2025-11-07 15:14:03] File info: Array
(
    [name] => 124230017_Daniel Satria Darmawan.pdf
    [full_path] => 124230017_Daniel Satria Darmawan.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php6hWwp7
    [error] => 0
    [size] => 170820
)

[2025-11-07 15:14:03] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-07 15:14:03] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 15:14:03] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 15:14:03] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 15:14:03] Directory is writable
[2025-11-07 15:14:03] Detected MIME type: application/pdf
[2025-11-07 15:14:03] PDF validation: VALID
[2025-11-07 15:14:03] File validation passed
[2025-11-07 15:14:03] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690dfeab6aa98_1762524843.pdf
[2025-11-07 15:14:03] Temp file exists: YES
[2025-11-07 15:14:03] Temp file size: 170820
[2025-11-07 15:14:03] File moved successfully
[2025-11-07 15:14:03] File verified - Size: 170820 bytes
[2025-11-07 15:14:03] File upload results - Foto: 690dfeab6a82b_1762524843.webp, PDF: 690dfeab6aa98_1762524843.pdf
[2025-11-07 15:14:03] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-07 15:14:03] Data successfully inserted with ID: 65
[2025-11-07 15:14:03] Sending success response
[2025-11-07 15:14:03] === REQUEST COMPLETED ===
[2025-11-07 15:15:05] === NEW REQUEST STARTED ===
[2025-11-07 15:15:05] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-07 15:15:05] Database connected successfully
[2025-11-07 15:15:05] Request method: POST
[2025-11-07 15:15:05] === START PROCESSING FORM DATA ===
[2025-11-07 15:15:05] POST data: Array
(
    [namaPasien] => sdadasdasd
    [tanggalLahir] => 2025-11-20
    [alamat] => sadasdasda
    [jenisLayanan] => pemeriksaan
    [statusPasien] => perawatan
    [hasilPemeriksaan] => sasdassadsadasdsda
    [medmsg] => ghjhjhjvh
    [jumlahPembayaran] => 876876
)

[2025-11-07 15:15:05] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [type] => image/webp
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php4jz3FZ
            [error] => 0
            [size] => 70498
        )

    [pdfDokumen] => Array
        (
            [name] => 124230017_Daniel Satria Darmawan.pdf
            [full_path] => 124230017_Daniel Satria Darmawan.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpKy5uz7
            [error] => 0
            [size] => 170820
        )

)

[2025-11-07 15:15:05] Detected MIME type: image/webp
[2025-11-07 15:15:05] Image validation: VALID
[2025-11-07 15:15:05] Detected MIME type: application/pdf
[2025-11-07 15:15:05] PDF validation: VALID
[2025-11-07 15:15:05] Form data sanitized successfully
[2025-11-07 15:15:05] Data encrypted successfully
[2025-11-07 15:15:05] Starting file upload process...
[2025-11-07 15:15:05] === START FILE UPLOAD: fotoPasien ===
[2025-11-07 15:15:05] File info: Array
(
    [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [type] => image/webp
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php4jz3FZ
    [error] => 0
    [size] => 70498
)

[2025-11-07 15:15:05] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-07 15:15:05] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 15:15:05] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 15:15:05] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 15:15:05] Directory is writable
[2025-11-07 15:15:05] Detected MIME type: image/webp
[2025-11-07 15:15:05] Image validation: VALID
[2025-11-07 15:15:05] File validation passed
[2025-11-07 15:15:05] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/690dfee962cdd_1762524905.webp
[2025-11-07 15:15:05] Temp file exists: YES
[2025-11-07 15:15:05] Temp file size: 70498
[2025-11-07 15:15:05] File moved successfully
[2025-11-07 15:15:05] File verified - Size: 70498 bytes
[2025-11-07 15:15:05] === START FILE UPLOAD: pdfDokumen ===
[2025-11-07 15:15:05] File info: Array
(
    [name] => 124230017_Daniel Satria Darmawan.pdf
    [full_path] => 124230017_Daniel Satria Darmawan.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpKy5uz7
    [error] => 0
    [size] => 170820
)

[2025-11-07 15:15:05] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-07 15:15:05] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 15:15:05] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 15:15:05] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 15:15:05] Directory is writable
[2025-11-07 15:15:05] Detected MIME type: application/pdf
[2025-11-07 15:15:05] PDF validation: VALID
[2025-11-07 15:15:05] File validation passed
[2025-11-07 15:15:05] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690dfee962f34_1762524905.pdf
[2025-11-07 15:15:05] Temp file exists: YES
[2025-11-07 15:15:05] Temp file size: 170820
[2025-11-07 15:15:05] File moved successfully
[2025-11-07 15:15:05] File verified - Size: 170820 bytes
[2025-11-07 15:15:05] File upload results - Foto: 690dfee962cdd_1762524905.webp, PDF: 690dfee962f34_1762524905.pdf
[2025-11-07 15:15:05] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-07 15:15:05] Data successfully inserted with ID: 66
[2025-11-07 15:15:05] Sending success response
[2025-11-07 15:15:05] === REQUEST COMPLETED ===
[2025-11-07 15:50:32] === NEW REQUEST STARTED ===
[2025-11-07 15:50:32] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-07 15:50:32] Database connected successfully
[2025-11-07 15:50:32] Request method: POST
[2025-11-07 15:50:32] === START PROCESSING FORM DATA ===
[2025-11-07 15:50:32] POST data: Array
(
    [namaPasien] => wdefaaefeaf
    [tanggalLahir] => 2025-11-13
    [alamat] => fdasfdadfsdafs
    [jenisLayanan] => rawat-inap
    [statusPasien] => perawatan
    [hasilPemeriksaan] => adsaddsad
    [medmsg] => sfeadsfasd
    [jumlahPembayaran] => 321421
)

[2025-11-07 15:50:32] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [type] => image/webp
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpqlBaCC
            [error] => 0
            [size] => 70498
        )

    [pdfDokumen] => Array
        (
            [name] => 124230017_Daniel Satria Darmawan.pdf
            [full_path] => 124230017_Daniel Satria Darmawan.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpgaN9uq
            [error] => 0
            [size] => 170820
        )

)

[2025-11-07 15:50:32] Detected MIME type: image/webp
[2025-11-07 15:50:32] Image validation: VALID
[2025-11-07 15:50:32] Detected MIME type: application/pdf
[2025-11-07 15:50:32] PDF validation: VALID
[2025-11-07 15:50:32] Form data sanitized successfully
[2025-11-07 15:50:32] Data encrypted successfully
[2025-11-07 15:50:32] Starting file upload process...
[2025-11-07 15:50:32] === START FILE UPLOAD: fotoPasien ===
[2025-11-07 15:50:32] File info: Array
(
    [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [type] => image/webp
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpqlBaCC
    [error] => 0
    [size] => 70498
)

[2025-11-07 15:50:32] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-07 15:50:32] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 15:50:32] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 15:50:32] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 15:50:32] Directory is writable
[2025-11-07 15:50:32] Detected MIME type: image/webp
[2025-11-07 15:50:32] Image validation: VALID
[2025-11-07 15:50:32] File validation passed
[2025-11-07 15:50:32] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/690e07381b58a_1762527032.webp
[2025-11-07 15:50:32] Temp file exists: YES
[2025-11-07 15:50:32] Temp file size: 70498
[2025-11-07 15:50:32] File moved successfully
[2025-11-07 15:50:32] File verified - Size: 70498 bytes
[2025-11-07 15:50:32] === START FILE UPLOAD: pdfDokumen ===
[2025-11-07 15:50:32] File info: Array
(
    [name] => 124230017_Daniel Satria Darmawan.pdf
    [full_path] => 124230017_Daniel Satria Darmawan.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpgaN9uq
    [error] => 0
    [size] => 170820
)

[2025-11-07 15:50:32] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-07 15:50:32] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 15:50:32] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 15:50:32] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 15:50:32] Directory is writable
[2025-11-07 15:50:32] Detected MIME type: application/pdf
[2025-11-07 15:50:32] PDF validation: VALID
[2025-11-07 15:50:32] File validation passed
[2025-11-07 15:50:32] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690e07381b7f6_1762527032.pdf
[2025-11-07 15:50:32] Temp file exists: YES
[2025-11-07 15:50:32] Temp file size: 170820
[2025-11-07 15:50:32] File moved successfully
[2025-11-07 15:50:32] File verified - Size: 170820 bytes
[2025-11-07 15:50:32] File upload results - Foto: 690e07381b58a_1762527032.webp, PDF: 690e07381b7f6_1762527032.pdf
[2025-11-07 15:50:32] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-07 15:50:32] Data successfully inserted with ID: 67
[2025-11-07 15:50:32] Sending success response
[2025-11-07 15:50:32] === REQUEST COMPLETED ===
[2025-11-07 16:04:06] === NEW REQUEST STARTED ===
[2025-11-07 16:04:06] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-07 16:04:06] Database connected successfully
[2025-11-07 16:04:06] Request method: POST
[2025-11-07 16:04:06] === START PROCESSING FORM DATA ===
[2025-11-07 16:04:06] POST data: Array
(
    [namaPasien] => and nags
    [tanggalLahir] => 2025-11-07
    [alamat] => asdasdnasd
    [jenisLayanan] => rawat-jalan
    [statusPasien] => perawatan
    [hasilPemeriksaan] => and jkansdkja
    [medmsg] => sda dsnajd
    [jumlahPembayaran] => 423432
)

[2025-11-07 16:04:06] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [type] => image/webp
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpEG54bl
            [error] => 0
            [size] => 70498
        )

    [pdfDokumen] => Array
        (
            [name] => 124230017_Daniel Satria Darmawan.pdf
            [full_path] => 124230017_Daniel Satria Darmawan.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpNv1qBT
            [error] => 0
            [size] => 170820
        )

)

[2025-11-07 16:04:06] Detected MIME type: image/webp
[2025-11-07 16:04:06] Image validation: VALID
[2025-11-07 16:04:06] Detected MIME type: application/pdf
[2025-11-07 16:04:06] PDF validation: VALID
[2025-11-07 16:04:06] Form data sanitized successfully
[2025-11-07 16:04:06] Data encrypted successfully
[2025-11-07 16:04:06] Starting file upload process...
[2025-11-07 16:04:06] === START FILE UPLOAD: fotoPasien ===
[2025-11-07 16:04:06] File info: Array
(
    [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [type] => image/webp
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpEG54bl
    [error] => 0
    [size] => 70498
)

[2025-11-07 16:04:06] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-07 16:04:06] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 16:04:06] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 16:04:06] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 16:04:06] Directory is writable
[2025-11-07 16:04:06] Detected MIME type: image/webp
[2025-11-07 16:04:06] Image validation: VALID
[2025-11-07 16:04:06] File validation passed
[2025-11-07 16:04:06] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/690e0a661cd52_1762527846.webp
[2025-11-07 16:04:06] Temp file exists: YES
[2025-11-07 16:04:06] Temp file size: 70498
[2025-11-07 16:04:06] File moved successfully
[2025-11-07 16:04:06] File verified - Size: 70498 bytes
[2025-11-07 16:04:06] === START FILE UPLOAD: pdfDokumen ===
[2025-11-07 16:04:06] File info: Array
(
    [name] => 124230017_Daniel Satria Darmawan.pdf
    [full_path] => 124230017_Daniel Satria Darmawan.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpNv1qBT
    [error] => 0
    [size] => 170820
)

[2025-11-07 16:04:06] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-07 16:04:06] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 16:04:06] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 16:04:06] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 16:04:06] Directory is writable
[2025-11-07 16:04:06] Detected MIME type: application/pdf
[2025-11-07 16:04:06] PDF validation: VALID
[2025-11-07 16:04:06] File validation passed
[2025-11-07 16:04:06] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690e0a661cfc6_1762527846.pdf
[2025-11-07 16:04:06] Temp file exists: YES
[2025-11-07 16:04:06] Temp file size: 170820
[2025-11-07 16:04:06] Starting PDF encryption process...
[2025-11-07 16:04:06] Reading PDF file from: /Applications/XAMPP/xamppfiles/temp/phpNv1qBT
[2025-11-07 16:04:06] PDF file read successfully, size: 170820 bytes
[2025-11-07 16:04:06] Applying Caesar Cipher...
[2025-11-07 16:04:06] Caesar Cipher applied successfully
[2025-11-07 16:04:06] Applying AES encryption...
[2025-11-07 16:04:06] AES encryption applied successfully
[2025-11-07 16:04:06] Writing encrypted PDF to: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690e0a661cfc6_1762527846.pdf
[2025-11-07 16:04:06] Encrypted PDF saved successfully, size: 170832 bytes
[2025-11-07 16:04:06] PDF encrypted and saved successfully
[2025-11-07 16:04:06] File verified - Size: 170832 bytes
[2025-11-07 16:04:06] File upload results - Foto: 690e0a661cd52_1762527846.webp, PDF: 690e0a661cfc6_1762527846.pdf
[2025-11-07 16:04:06] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-07 16:04:06] Data successfully inserted with ID: 68
[2025-11-07 16:04:06] Sending success response
[2025-11-07 16:04:06] === REQUEST COMPLETED ===
[2025-11-07 16:40:02] === NEW REQUEST STARTED ===
[2025-11-07 16:40:02] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-07 16:40:02] Database connected successfully
[2025-11-07 16:40:02] Request method: POST
[2025-11-07 16:40:02] === START PROCESSING FORM DATA ===
[2025-11-07 16:40:02] POST data: Array
(
    [namaPasien] => sadasdasd
    [tanggalLahir] => 2025-11-18
    [alamat] => sadasdsad
    [jenisLayanan] => rawat-inap
    [statusPasien] => perawatan
    [hasilPemeriksaan] => sadasdasdsd
    [medmsg] => sadsadasd
    [jumlahPembayaran] => 532323
)

[2025-11-07 16:40:02] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [type] => image/webp
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php0IXEph
            [error] => 0
            [size] => 70498
        )

    [pdfDokumen] => Array
        (
            [name] => 124230017_Daniel Satria Darmawan.pdf
            [full_path] => 124230017_Daniel Satria Darmawan.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpqA0KoQ
            [error] => 0
            [size] => 170820
        )

)

[2025-11-07 16:40:02] Detected MIME type: image/webp
[2025-11-07 16:40:02] Image validation: VALID
[2025-11-07 16:40:02] Detected MIME type: application/pdf
[2025-11-07 16:40:02] PDF validation: VALID
[2025-11-07 16:40:02] Form data sanitized successfully
[2025-11-07 16:40:02] Medical message: sadsadasd
[2025-11-07 16:40:02] Data encrypted successfully
[2025-11-07 16:40:02] Starting file upload process...
[2025-11-07 16:40:02] === START FILE UPLOAD: fotoPasien ===
[2025-11-07 16:40:02] File info: Array
(
    [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [type] => image/webp
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php0IXEph
    [error] => 0
    [size] => 70498
)

[2025-11-07 16:40:02] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-07 16:40:02] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 16:40:02] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 16:40:02] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 16:40:02] Directory is writable
[2025-11-07 16:40:02] Detected MIME type: image/webp
[2025-11-07 16:40:02] Image validation: VALID
[2025-11-07 16:40:02] File validation passed
[2025-11-07 16:40:02] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/690e12d2988e5_1762530002.webp
[2025-11-07 16:40:02] Temp file exists: YES
[2025-11-07 16:40:02] Temp file size: 70498
[2025-11-07 16:40:02] Starting image steganography process...
[2025-11-07 16:40:02] Medical message for steganography: sadsadasd
[2025-11-07 16:40:02] === START IMAGE STEGANOGRAPHY ===
[2025-11-07 16:40:02] Original message: sadsadasd
[2025-11-07 16:40:02] Encrypting message for steganography: sadsadasd
[2025-11-07 16:40:02] AES encryption successful, encrypted length: 32 bytes
[2025-11-07 16:40:02] Message encrypted with AES
[2025-11-07 16:40:02] Image dimensions: 1275x1600, Type: 18
[2025-11-07 16:40:02] ERROR in applySteganographyToImage: Unsupported image type
[2025-11-07 16:40:02] ERROR: Image steganography failed
[2025-11-07 16:40:02] Fallback: Original image moved without steganography
[2025-11-07 16:40:02] File verified - Size: 70498 bytes
[2025-11-07 16:40:02] === START FILE UPLOAD: pdfDokumen ===
[2025-11-07 16:40:02] File info: Array
(
    [name] => 124230017_Daniel Satria Darmawan.pdf
    [full_path] => 124230017_Daniel Satria Darmawan.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpqA0KoQ
    [error] => 0
    [size] => 170820
)

[2025-11-07 16:40:02] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-07 16:40:02] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 16:40:02] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 16:40:02] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 16:40:02] Directory is writable
[2025-11-07 16:40:02] Detected MIME type: application/pdf
[2025-11-07 16:40:02] PDF validation: VALID
[2025-11-07 16:40:02] File validation passed
[2025-11-07 16:40:02] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690e12d29adeb_1762530002.pdf
[2025-11-07 16:40:02] Temp file exists: YES
[2025-11-07 16:40:02] Temp file size: 170820
[2025-11-07 16:40:02] Starting PDF encryption process...
[2025-11-07 16:40:02] Reading PDF file from: /Applications/XAMPP/xamppfiles/temp/phpqA0KoQ
[2025-11-07 16:40:02] PDF file read successfully, size: 170820 bytes
[2025-11-07 16:40:02] Applying Caesar Cipher...
[2025-11-07 16:40:02] Caesar Cipher applied successfully
[2025-11-07 16:40:02] Applying AES encryption...
[2025-11-07 16:40:02] AES encryption applied successfully
[2025-11-07 16:40:02] Writing encrypted PDF to: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690e12d29adeb_1762530002.pdf
[2025-11-07 16:40:02] Encrypted PDF saved successfully, size: 170832 bytes
[2025-11-07 16:40:02] PDF encrypted and saved successfully
[2025-11-07 16:40:02] File verified - Size: 170832 bytes
[2025-11-07 16:40:02] File upload results - Foto: 690e12d2988e5_1762530002.webp, PDF: 690e12d29adeb_1762530002.pdf
[2025-11-07 16:40:02] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-07 16:40:02] Data successfully inserted with ID: 69
[2025-11-07 16:40:02] Sending success response
[2025-11-07 16:40:02] === REQUEST COMPLETED ===
[2025-11-07 16:40:48] === NEW REQUEST STARTED ===
[2025-11-07 16:40:48] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-07 16:40:48] Database connected successfully
[2025-11-07 16:40:48] Request method: POST
[2025-11-07 16:40:48] === START PROCESSING FORM DATA ===
[2025-11-07 16:40:48] POST data: Array
(
    [namaPasien] => weqeqwe
    [tanggalLahir] => 2025-11-18
    [alamat] => wqffewefwfe
    [jenisLayanan] => rawat-inap
    [statusPasien] => perawatan
    [hasilPemeriksaan] => gagdadgsagd
    [medmsg] => sadasdsa
    [jumlahPembayaran] => 123123
)

[2025-11-07 16:40:48] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [type] => image/webp
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpy6n1mq
            [error] => 0
            [size] => 70498
        )

    [pdfDokumen] => Array
        (
            [name] => Aplikasi.pdf
            [full_path] => Aplikasi.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php5l3V5Q
            [error] => 0
            [size] => 4040002
        )

)

[2025-11-07 16:40:48] Detected MIME type: image/webp
[2025-11-07 16:40:48] Image validation: VALID
[2025-11-07 16:40:48] Detected MIME type: application/pdf
[2025-11-07 16:40:48] PDF validation: VALID
[2025-11-07 16:40:48] Form data sanitized successfully
[2025-11-07 16:40:48] Medical message: sadasdsa
[2025-11-07 16:40:48] Data encrypted successfully
[2025-11-07 16:40:48] Starting file upload process...
[2025-11-07 16:40:48] === START FILE UPLOAD: fotoPasien ===
[2025-11-07 16:40:48] File info: Array
(
    [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [type] => image/webp
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpy6n1mq
    [error] => 0
    [size] => 70498
)

[2025-11-07 16:40:48] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-07 16:40:48] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 16:40:48] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 16:40:48] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-07 16:40:48] Directory is writable
[2025-11-07 16:40:48] Detected MIME type: image/webp
[2025-11-07 16:40:48] Image validation: VALID
[2025-11-07 16:40:48] File validation passed
[2025-11-07 16:40:48] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/690e1300a4b38_1762530048.webp
[2025-11-07 16:40:48] Temp file exists: YES
[2025-11-07 16:40:48] Temp file size: 70498
[2025-11-07 16:40:48] Starting image steganography process...
[2025-11-07 16:40:48] Medical message for steganography: sadasdsa
[2025-11-07 16:40:48] === START IMAGE STEGANOGRAPHY ===
[2025-11-07 16:40:48] Original message: sadasdsa
[2025-11-07 16:40:48] Encrypting message for steganography: sadasdsa
[2025-11-07 16:40:48] AES encryption successful, encrypted length: 32 bytes
[2025-11-07 16:40:48] Message encrypted with AES
[2025-11-07 16:40:48] Image dimensions: 1275x1600, Type: 18
[2025-11-07 16:40:48] ERROR in applySteganographyToImage: Unsupported image type
[2025-11-07 16:40:48] ERROR: Image steganography failed
[2025-11-07 16:40:48] Fallback: Original image moved without steganography
[2025-11-07 16:40:48] File verified - Size: 70498 bytes
[2025-11-07 16:40:48] === START FILE UPLOAD: pdfDokumen ===
[2025-11-07 16:40:48] File info: Array
(
    [name] => Aplikasi.pdf
    [full_path] => Aplikasi.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php5l3V5Q
    [error] => 0
    [size] => 4040002
)

[2025-11-07 16:40:48] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-07 16:40:48] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 16:40:48] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 16:40:48] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-07 16:40:48] Directory is writable
[2025-11-07 16:40:48] Detected MIME type: application/pdf
[2025-11-07 16:40:48] PDF validation: VALID
[2025-11-07 16:40:48] File validation passed
[2025-11-07 16:40:48] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690e1300a619d_1762530048.pdf
[2025-11-07 16:40:48] Temp file exists: YES
[2025-11-07 16:40:48] Temp file size: 4040002
[2025-11-07 16:40:48] Starting PDF encryption process...
[2025-11-07 16:40:48] Reading PDF file from: /Applications/XAMPP/xamppfiles/temp/php5l3V5Q
[2025-11-07 16:40:48] PDF file read successfully, size: 4040002 bytes
[2025-11-07 16:40:48] Applying Caesar Cipher...
[2025-11-07 16:40:48] Caesar Cipher applied successfully
[2025-11-07 16:40:48] Applying AES encryption...
[2025-11-07 16:40:48] AES encryption applied successfully
[2025-11-07 16:40:48] Writing encrypted PDF to: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690e1300a619d_1762530048.pdf
[2025-11-07 16:40:48] Encrypted PDF saved successfully, size: 4040016 bytes
[2025-11-07 16:40:48] PDF encrypted and saved successfully
[2025-11-07 16:40:48] File verified - Size: 4040016 bytes
[2025-11-07 16:40:48] File upload results - Foto: 690e1300a4b38_1762530048.webp, PDF: 690e1300a619d_1762530048.pdf
[2025-11-07 16:40:48] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-07 16:40:49] Data successfully inserted with ID: 70
[2025-11-07 16:40:49] Sending success response
[2025-11-07 16:40:49] === REQUEST COMPLETED ===
[2025-11-08 08:18:50] === NEW REQUEST STARTED ===
[2025-11-08 08:18:50] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-08 08:18:50] Database connected successfully
[2025-11-08 08:18:50] Request method: POST
[2025-11-08 08:18:50] === START PROCESSING FORM DATA ===
[2025-11-08 08:18:50] POST data: Array
(
    [patientId] => 
    [namaPasien] => Cristiano Ronaldo
    [tanggalLahir] => 2025-11-06
    [alamat] => Portugal
    [jenisLayanan] => rawat-jalan
    [statusPasien] => selesai
    [hasilPemeriksaan] => Cedera
    [medmsg] => buset dah bro
    [jumlahPembayaran] => 645323
)

[2025-11-08 08:18:50] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [type] => image/webp
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpBjx9My
            [error] => 0
            [size] => 70498
        )

    [pdfDokumen] => Array
        (
            [name] => 124230017_Daniel Satria Darmawan.pdf
            [full_path] => 124230017_Daniel Satria Darmawan.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpRM6Bmo
            [error] => 0
            [size] => 170820
        )

)

[2025-11-08 08:18:50] Detected MIME type: image/webp
[2025-11-08 08:18:50] Image validation: VALID
[2025-11-08 08:18:50] Detected MIME type: application/pdf
[2025-11-08 08:18:50] PDF validation: VALID
[2025-11-08 08:18:50] Form data sanitized successfully
[2025-11-08 08:18:50] Medical message: buset dah bro
[2025-11-08 08:18:50] Data encrypted successfully
[2025-11-08 08:18:50] Starting file upload process...
[2025-11-08 08:18:50] === START FILE UPLOAD: fotoPasien ===
[2025-11-08 08:18:50] File info: Array
(
    [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [type] => image/webp
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpBjx9My
    [error] => 0
    [size] => 70498
)

[2025-11-08 08:18:50] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-08 08:18:50] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-08 08:18:50] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-08 08:18:50] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-08 08:18:50] Directory is writable
[2025-11-08 08:18:50] Detected MIME type: image/webp
[2025-11-08 08:18:50] Image validation: VALID
[2025-11-08 08:18:50] File validation passed
[2025-11-08 08:18:50] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/690eeeda6f828_1762586330.webp
[2025-11-08 08:18:50] Temp file exists: YES
[2025-11-08 08:18:50] Temp file size: 70498
[2025-11-08 08:18:50] Starting image steganography process...
[2025-11-08 08:18:50] Medical message for steganography: buset dah bro
[2025-11-08 08:18:50] === START IMAGE STEGANOGRAPHY ===
[2025-11-08 08:18:50] Original message: buset dah bro
[2025-11-08 08:18:50] Encrypting message for steganography: buset dah bro
[2025-11-08 08:18:50] AES encryption successful, encrypted length: 32 bytes
[2025-11-08 08:18:50] Message encrypted with AES
[2025-11-08 08:18:50] Image dimensions: 1275x1600, Type: 18
[2025-11-08 08:18:50] ERROR in applySteganographyToImage: Unsupported image type
[2025-11-08 08:18:50] ERROR: Image steganography failed
[2025-11-08 08:18:50] Fallback: Original image moved without steganography
[2025-11-08 08:18:50] File verified - Size: 70498 bytes
[2025-11-08 08:18:50] === START FILE UPLOAD: pdfDokumen ===
[2025-11-08 08:18:50] File info: Array
(
    [name] => 124230017_Daniel Satria Darmawan.pdf
    [full_path] => 124230017_Daniel Satria Darmawan.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpRM6Bmo
    [error] => 0
    [size] => 170820
)

[2025-11-08 08:18:50] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-08 08:18:50] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-08 08:18:50] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-08 08:18:50] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-08 08:18:50] Directory is writable
[2025-11-08 08:18:50] Detected MIME type: application/pdf
[2025-11-08 08:18:50] PDF validation: VALID
[2025-11-08 08:18:50] File validation passed
[2025-11-08 08:18:50] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690eeeda70a89_1762586330.pdf
[2025-11-08 08:18:50] Temp file exists: YES
[2025-11-08 08:18:50] Temp file size: 170820
[2025-11-08 08:18:50] Starting PDF encryption process...
[2025-11-08 08:18:50] Reading PDF file from: /Applications/XAMPP/xamppfiles/temp/phpRM6Bmo
[2025-11-08 08:18:50] PDF file read successfully, size: 170820 bytes
[2025-11-08 08:18:50] Applying Caesar Cipher...
[2025-11-08 08:18:50] Caesar Cipher applied successfully
[2025-11-08 08:18:50] Applying AES encryption...
[2025-11-08 08:18:50] AES encryption applied successfully
[2025-11-08 08:18:50] Writing encrypted PDF to: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690eeeda70a89_1762586330.pdf
[2025-11-08 08:18:50] Encrypted PDF saved successfully, size: 170832 bytes
[2025-11-08 08:18:50] PDF encrypted and saved successfully
[2025-11-08 08:18:50] File verified - Size: 170832 bytes
[2025-11-08 08:18:50] File upload results - Foto: 690eeeda6f828_1762586330.webp, PDF: 690eeeda70a89_1762586330.pdf
[2025-11-08 08:18:50] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-08 08:18:50] Data successfully inserted with ID: 1
[2025-11-08 08:18:50] Sending success response
[2025-11-08 08:18:50] === REQUEST COMPLETED ===
[2025-11-08 09:35:37] === NEW REQUEST STARTED ===
[2025-11-08 09:35:37] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-08 09:35:37] Database connected successfully
[2025-11-08 09:35:37] Request method: POST
[2025-11-08 09:35:37] === START PROCESSING FORM DATA ===
[2025-11-08 09:35:37] POST data: Array
(
    [patientId] => 
    [namaPasien] => Messi
    [tanggalLahir] => 2001-11-08
    [alamat] => wqedqwdwqd
    [jenisLayanan] => rawat-inap
    [statusPasien] => dalam perawatan
    [hasilPemeriksaan] => wqdwqdwdqwd
    [medmsg] => anjay ambar
    [jumlahPembayaran] => 654321
)

[2025-11-08 09:35:37] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [type] => image/webp
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpHltg4b
            [error] => 0
            [size] => 70498
        )

    [pdfDokumen] => Array
        (
            [name] => Aplikasi.pdf
            [full_path] => Aplikasi.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php1ZCJfw
            [error] => 0
            [size] => 4040002
        )

)

[2025-11-08 09:35:37] Detected MIME type: image/webp
[2025-11-08 09:35:37] Image validation: VALID
[2025-11-08 09:35:37] Detected MIME type: application/pdf
[2025-11-08 09:35:37] PDF validation: VALID
[2025-11-08 09:35:37] Form data sanitized successfully
[2025-11-08 09:35:37] Medical message: anjay ambar
[2025-11-08 09:35:37] Data encrypted successfully
[2025-11-08 09:35:37] Starting file upload process...
[2025-11-08 09:35:37] === START FILE UPLOAD: fotoPasien ===
[2025-11-08 09:35:37] File info: Array
(
    [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [type] => image/webp
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpHltg4b
    [error] => 0
    [size] => 70498
)

[2025-11-08 09:35:37] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-08 09:35:37] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-08 09:35:37] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-08 09:35:37] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-08 09:35:37] Directory is writable
[2025-11-08 09:35:37] Detected MIME type: image/webp
[2025-11-08 09:35:37] Image validation: VALID
[2025-11-08 09:35:37] File validation passed
[2025-11-08 09:35:37] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/690f00d9946c2_1762590937.webp
[2025-11-08 09:35:37] Temp file exists: YES
[2025-11-08 09:35:37] Temp file size: 70498
[2025-11-08 09:35:37] Starting image steganography process...
[2025-11-08 09:35:37] Medical message for steganography: anjay ambar
[2025-11-08 09:35:37] === START IMAGE STEGANOGRAPHY ===
[2025-11-08 09:35:37] Original message: anjay ambar
[2025-11-08 09:35:37] Encrypting message for steganography: anjay ambar
[2025-11-08 09:35:37] AES encryption successful, encrypted length: 32 bytes
[2025-11-08 09:35:37] Message encrypted with AES
[2025-11-08 09:35:37] Image dimensions: 1275x1600, Type: 18
[2025-11-08 09:35:37] ERROR in applySteganographyToImage: Unsupported image type
[2025-11-08 09:35:37] ERROR: Image steganography failed
[2025-11-08 09:35:37] Fallback: Original image moved without steganography
[2025-11-08 09:35:37] File verified - Size: 70498 bytes
[2025-11-08 09:35:37] === START FILE UPLOAD: pdfDokumen ===
[2025-11-08 09:35:37] File info: Array
(
    [name] => Aplikasi.pdf
    [full_path] => Aplikasi.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php1ZCJfw
    [error] => 0
    [size] => 4040002
)

[2025-11-08 09:35:37] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-08 09:35:37] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-08 09:35:37] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-08 09:35:37] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-08 09:35:37] Directory is writable
[2025-11-08 09:35:37] Detected MIME type: application/pdf
[2025-11-08 09:35:37] PDF validation: VALID
[2025-11-08 09:35:37] File validation passed
[2025-11-08 09:35:37] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690f00d995aca_1762590937.pdf
[2025-11-08 09:35:37] Temp file exists: YES
[2025-11-08 09:35:37] Temp file size: 4040002
[2025-11-08 09:35:37] Starting PDF encryption process...
[2025-11-08 09:35:37] Reading PDF file from: /Applications/XAMPP/xamppfiles/temp/php1ZCJfw
[2025-11-08 09:35:37] PDF file read successfully, size: 4040002 bytes
[2025-11-08 09:35:37] Applying Caesar Cipher...
[2025-11-08 09:35:37] Caesar Cipher applied successfully
[2025-11-08 09:35:37] Applying AES encryption...
[2025-11-08 09:35:37] AES encryption applied successfully
[2025-11-08 09:35:37] Writing encrypted PDF to: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690f00d995aca_1762590937.pdf
[2025-11-08 09:35:37] Encrypted PDF saved successfully, size: 4040016 bytes
[2025-11-08 09:35:37] PDF encrypted and saved successfully
[2025-11-08 09:35:37] File verified - Size: 4040016 bytes
[2025-11-08 09:35:37] File upload results - Foto: 690f00d9946c2_1762590937.webp, PDF: 690f00d995aca_1762590937.pdf
[2025-11-08 09:35:37] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-08 09:35:37] Data successfully inserted with ID: 2
[2025-11-08 09:35:37] Sending success response
[2025-11-08 09:35:37] === REQUEST COMPLETED ===
[2025-11-08 09:39:51] === NEW REQUEST STARTED ===
[2025-11-08 09:39:51] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-08 09:39:51] Database connected successfully
[2025-11-08 09:39:51] Request method: POST
[2025-11-08 09:39:51] === START PROCESSING FORM DATA ===
[2025-11-08 09:39:51] POST data: Array
(
    [patientId] => 
    [namaPasien] => Pessi
    [tanggalLahir] => 2025-11-04
    [alamat] => Pessi
    [jenisLayanan] => rawat-inap
    [statusPasien] => menunggu
    [hasilPemeriksaan] => Pessi
    [medmsg] => Pessi
    [jumlahPembayaran] => 645321
)

[2025-11-08 09:39:51] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
            [type] => image/webp
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpHRiiQu
            [error] => 0
            [size] => 70498
        )

    [pdfDokumen] => Array
        (
            [name] => 124230017_Daniel Satria Darmawan.pdf
            [full_path] => 124230017_Daniel Satria Darmawan.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpP6DIN1
            [error] => 0
            [size] => 170820
        )

)

[2025-11-08 09:39:51] Detected MIME type: image/webp
[2025-11-08 09:39:51] Image validation: VALID
[2025-11-08 09:39:51] Detected MIME type: application/pdf
[2025-11-08 09:39:51] PDF validation: VALID
[2025-11-08 09:39:51] Form data sanitized successfully
[2025-11-08 09:39:51] Medical message: Pessi
[2025-11-08 09:39:51] Data encrypted successfully
[2025-11-08 09:39:51] Starting file upload process...
[2025-11-08 09:39:51] === START FILE UPLOAD: fotoPasien ===
[2025-11-08 09:39:51] File info: Array
(
    [name] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [full_path] => American-actor-Leonardo-DiCaprio-2016.jpg.webp
    [type] => image/webp
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpHRiiQu
    [error] => 0
    [size] => 70498
)

[2025-11-08 09:39:51] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-08 09:39:51] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-08 09:39:51] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-08 09:39:51] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-08 09:39:51] Directory is writable
[2025-11-08 09:39:51] Detected MIME type: image/webp
[2025-11-08 09:39:51] Image validation: VALID
[2025-11-08 09:39:51] File validation passed
[2025-11-08 09:39:51] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/690f01d7aae0f_1762591191.webp
[2025-11-08 09:39:51] Temp file exists: YES
[2025-11-08 09:39:51] Temp file size: 70498
[2025-11-08 09:39:51] Starting image steganography process...
[2025-11-08 09:39:51] Medical message for steganography: Pessi
[2025-11-08 09:39:51] === START IMAGE STEGANOGRAPHY ===
[2025-11-08 09:39:51] Original message: Pessi
[2025-11-08 09:39:51] Encrypting message for steganography: Pessi
[2025-11-08 09:39:51] AES encryption successful, encrypted length: 32 bytes
[2025-11-08 09:39:51] Message encrypted with AES
[2025-11-08 09:39:51] Image dimensions: 1275x1600, Type: 18
[2025-11-08 09:39:51] ERROR in applySteganographyToImage: Unsupported image type
[2025-11-08 09:39:51] ERROR: Image steganography failed
[2025-11-08 09:39:51] Fallback: Original image moved without steganography
[2025-11-08 09:39:51] File verified - Size: 70498 bytes
[2025-11-08 09:39:51] === START FILE UPLOAD: pdfDokumen ===
[2025-11-08 09:39:51] File info: Array
(
    [name] => 124230017_Daniel Satria Darmawan.pdf
    [full_path] => 124230017_Daniel Satria Darmawan.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpP6DIN1
    [error] => 0
    [size] => 170820
)

[2025-11-08 09:39:51] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-08 09:39:51] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-08 09:39:51] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-08 09:39:51] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-08 09:39:51] Directory is writable
[2025-11-08 09:39:51] Detected MIME type: application/pdf
[2025-11-08 09:39:51] PDF validation: VALID
[2025-11-08 09:39:51] File validation passed
[2025-11-08 09:39:51] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690f01d7ac434_1762591191.pdf
[2025-11-08 09:39:51] Temp file exists: YES
[2025-11-08 09:39:51] Temp file size: 170820
[2025-11-08 09:39:51] Starting PDF encryption process...
[2025-11-08 09:39:51] Reading PDF file from: /Applications/XAMPP/xamppfiles/temp/phpP6DIN1
[2025-11-08 09:39:51] PDF file read successfully, size: 170820 bytes
[2025-11-08 09:39:51] Applying Caesar Cipher...
[2025-11-08 09:39:51] Caesar Cipher applied successfully
[2025-11-08 09:39:51] Applying AES encryption...
[2025-11-08 09:39:51] AES encryption applied successfully
[2025-11-08 09:39:51] Writing encrypted PDF to: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690f01d7ac434_1762591191.pdf
[2025-11-08 09:39:51] Encrypted PDF saved successfully, size: 170832 bytes
[2025-11-08 09:39:51] PDF encrypted and saved successfully
[2025-11-08 09:39:51] File verified - Size: 170832 bytes
[2025-11-08 09:39:51] File upload results - Foto: 690f01d7aae0f_1762591191.webp, PDF: 690f01d7ac434_1762591191.pdf
[2025-11-08 09:39:51] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-08 09:39:51] Data successfully inserted with ID: 3
[2025-11-08 09:39:51] Sending success response
[2025-11-08 09:39:51] === REQUEST COMPLETED ===
[2025-11-08 10:45:50] === NEW REQUEST STARTED ===
[2025-11-08 10:45:50] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-08 10:45:50] Database connected successfully
[2025-11-08 10:45:50] Request method: POST
[2025-11-08 10:45:50] === START PROCESSING FORM DATA ===
[2025-11-08 10:45:50] POST data: Array
(
    [patientId] => 
    [namaPasien] => Bambang
    [tanggalLahir] => 1978-12-31
    [alamat] => Janujaz
    [jenisLayanan] => rawat-inap
    [statusPasien] => menunggu
    [hasilPemeriksaan] => wqdqdqwd
    [medmsg] => okeaja
    [jumlahPembayaran] => 321321
)

[2025-11-08 10:45:50] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => Chainlink Fundamentals 7VBDFRNZB1GT 2025-9-15.png
            [full_path] => Chainlink Fundamentals 7VBDFRNZB1GT 2025-9-15.png
            [type] => image/png
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phphYVYGh
            [error] => 0
            [size] => 331879
        )

    [pdfDokumen] => Array
        (
            [name] => 124230017_Daniel Satria Darmawan.pdf
            [full_path] => 124230017_Daniel Satria Darmawan.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpwewgtv
            [error] => 0
            [size] => 170820
        )

)

[2025-11-08 10:45:50] Detected MIME type: image/png
[2025-11-08 10:45:50] Image validation: VALID
[2025-11-08 10:45:50] Detected MIME type: application/pdf
[2025-11-08 10:45:50] PDF validation: VALID
[2025-11-08 10:45:50] Form data sanitized successfully
[2025-11-08 10:45:50] Medical message: okeaja
[2025-11-08 10:45:50] Data encrypted successfully
[2025-11-08 10:45:50] Starting file upload process...
[2025-11-08 10:45:50] === START FILE UPLOAD: fotoPasien ===
[2025-11-08 10:45:50] File info: Array
(
    [name] => Chainlink Fundamentals 7VBDFRNZB1GT 2025-9-15.png
    [full_path] => Chainlink Fundamentals 7VBDFRNZB1GT 2025-9-15.png
    [type] => image/png
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phphYVYGh
    [error] => 0
    [size] => 331879
)

[2025-11-08 10:45:50] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-08 10:45:50] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-08 10:45:50] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-08 10:45:50] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-08 10:45:50] Directory is writable
[2025-11-08 10:45:50] Detected MIME type: image/png
[2025-11-08 10:45:50] Image validation: VALID
[2025-11-08 10:45:50] File validation passed
[2025-11-08 10:45:50] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/690f114e49877_1762595150.png
[2025-11-08 10:45:50] Temp file exists: YES
[2025-11-08 10:45:50] Temp file size: 331879
[2025-11-08 10:45:50] Starting image steganography process...
[2025-11-08 10:45:50] Medical message for steganography: okeaja
[2025-11-08 10:45:50] === START IMAGE STEGANOGRAPHY ===
[2025-11-08 10:45:50] Original message: okeaja
[2025-11-08 10:45:50] Encrypting message for steganography: okeaja
[2025-11-08 10:45:50] AES encryption successful, encrypted length: 32 bytes
[2025-11-08 10:45:50] Message encrypted with AES
[2025-11-08 10:45:50] Image dimensions: 1024x1024, Type: 3
[2025-11-08 10:45:50] Max capacity: 393216 bytes
[2025-11-08 10:45:50] Encrypted message length: 32 bytes
[2025-11-08 10:45:50] Total data to hide: 36 bytes
[2025-11-08 10:45:50] Binary data length: 288 bits
[2025-11-08 10:45:50] Data embedded successfully. Bits used: 288
[2025-11-08 10:45:50] Steganographed image saved successfully: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/690f114e49877_1762595150.png
[2025-11-08 10:45:50] Final file size: 200952 bytes
[2025-11-08 10:45:50] Image steganography applied successfully
[2025-11-08 10:45:50] File verified - Size: 200952 bytes
[2025-11-08 10:45:50] === START FILE UPLOAD: pdfDokumen ===
[2025-11-08 10:45:50] File info: Array
(
    [name] => 124230017_Daniel Satria Darmawan.pdf
    [full_path] => 124230017_Daniel Satria Darmawan.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpwewgtv
    [error] => 0
    [size] => 170820
)

[2025-11-08 10:45:50] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-08 10:45:50] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-08 10:45:50] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-08 10:45:50] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-08 10:45:50] Directory is writable
[2025-11-08 10:45:50] Detected MIME type: application/pdf
[2025-11-08 10:45:50] PDF validation: VALID
[2025-11-08 10:45:50] File validation passed
[2025-11-08 10:45:50] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690f114eb61f3_1762595150.pdf
[2025-11-08 10:45:50] Temp file exists: YES
[2025-11-08 10:45:50] Temp file size: 170820
[2025-11-08 10:45:50] Starting PDF encryption process...
[2025-11-08 10:45:50] Reading PDF file from: /Applications/XAMPP/xamppfiles/temp/phpwewgtv
[2025-11-08 10:45:50] PDF file read successfully, size: 170820 bytes
[2025-11-08 10:45:50] Applying Caesar Cipher...
[2025-11-08 10:45:50] Caesar Cipher applied successfully
[2025-11-08 10:45:50] Applying AES encryption...
[2025-11-08 10:45:50] AES encryption applied successfully
[2025-11-08 10:45:50] Writing encrypted PDF to: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690f114eb61f3_1762595150.pdf
[2025-11-08 10:45:50] Encrypted PDF saved successfully, size: 170832 bytes
[2025-11-08 10:45:50] PDF encrypted and saved successfully
[2025-11-08 10:45:50] File verified - Size: 170832 bytes
[2025-11-08 10:45:50] File upload results - Foto: 690f114e49877_1762595150.png, PDF: 690f114eb61f3_1762595150.pdf
[2025-11-08 10:45:50] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-08 10:45:50] Data successfully inserted with ID: 4
[2025-11-08 10:45:50] Sending success response
[2025-11-08 10:45:50] === REQUEST COMPLETED ===
[2025-11-08 11:09:25] === NEW REQUEST STARTED ===
[2025-11-08 11:09:25] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-08 11:09:25] Database connected successfully
[2025-11-08 11:09:25] Request method: POST
[2025-11-08 11:09:25] === START PROCESSING FORM DATA ===
[2025-11-08 11:09:25] POST data: Array
(
    [patientId] => 
    [namaPasien] => Korels
    [tanggalLahir] => 2025-11-19
    [alamat] => Okes
    [jenisLayanan] => rawat-inap
    [statusPasien] => dalam perawatan
    [hasilPemeriksaan] => Korel
    [medmsg] => Koreldraw
    [jumlahPembayaran] => 523232
)

[2025-11-08 11:09:25] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => Gemini_Generated_Image_1mdrpo1mdrpo1mdr.png
            [full_path] => Gemini_Generated_Image_1mdrpo1mdrpo1mdr.png
            [type] => image/png
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php4B4NfL
            [error] => 0
            [size] => 1508431
        )

    [pdfDokumen] => Array
        (
            [name] => 124230017_Daniel Satria Darmawan.pdf
            [full_path] => 124230017_Daniel Satria Darmawan.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php5owtmF
            [error] => 0
            [size] => 170820
        )

)

[2025-11-08 11:09:25] Detected MIME type: image/png
[2025-11-08 11:09:25] Image validation: VALID
[2025-11-08 11:09:25] Detected MIME type: application/pdf
[2025-11-08 11:09:25] PDF validation: VALID
[2025-11-08 11:09:25] Form data sanitized successfully
[2025-11-08 11:09:25] Medical message: Koreldraw
[2025-11-08 11:09:25] Data encrypted successfully
[2025-11-08 11:09:25] Starting file upload process...
[2025-11-08 11:09:25] === START FILE UPLOAD: fotoPasien ===
[2025-11-08 11:09:25] File info: Array
(
    [name] => Gemini_Generated_Image_1mdrpo1mdrpo1mdr.png
    [full_path] => Gemini_Generated_Image_1mdrpo1mdrpo1mdr.png
    [type] => image/png
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php4B4NfL
    [error] => 0
    [size] => 1508431
)

[2025-11-08 11:09:25] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-08 11:09:25] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-08 11:09:25] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-08 11:09:25] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-08 11:09:25] Directory is writable
[2025-11-08 11:09:25] Detected MIME type: image/png
[2025-11-08 11:09:25] Image validation: VALID
[2025-11-08 11:09:25] File validation passed
[2025-11-08 11:09:25] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/690f16d58477c_1762596565.png
[2025-11-08 11:09:25] Temp file exists: YES
[2025-11-08 11:09:25] Temp file size: 1508431
[2025-11-08 11:09:25] Starting image steganography process...
[2025-11-08 11:09:25] Medical message for steganography: Koreldraw
[2025-11-08 11:09:25] === START IMAGE STEGANOGRAPHY ===
[2025-11-08 11:09:25] Original message: Koreldraw
[2025-11-08 11:09:25] Encrypting message for steganography: Koreldraw
[2025-11-08 11:09:25] AES encryption successful, encrypted length: 32 bytes
[2025-11-08 11:09:25] Message encrypted with AES
[2025-11-08 11:09:25] Image dimensions: 1184x864, Type: 3
[2025-11-08 11:09:25] Max capacity: 383616 bytes
[2025-11-08 11:09:25] Encrypted message length: 32 bytes
[2025-11-08 11:09:25] Total data to hide: 36 bytes
[2025-11-08 11:09:25] Binary data length: 288 bits
[2025-11-08 11:09:25] Data embedded successfully. Bits used: 288
[2025-11-08 11:09:26] Steganographed image saved successfully: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/690f16d58477c_1762596565.png
[2025-11-08 11:09:26] Final file size: 1498381 bytes
[2025-11-08 11:09:26] Image steganography applied successfully
[2025-11-08 11:09:26] File verified - Size: 1498381 bytes
[2025-11-08 11:09:26] === START FILE UPLOAD: pdfDokumen ===
[2025-11-08 11:09:26] File info: Array
(
    [name] => 124230017_Daniel Satria Darmawan.pdf
    [full_path] => 124230017_Daniel Satria Darmawan.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php5owtmF
    [error] => 0
    [size] => 170820
)

[2025-11-08 11:09:26] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-08 11:09:26] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-08 11:09:26] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-08 11:09:26] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-08 11:09:26] Directory is writable
[2025-11-08 11:09:26] Detected MIME type: application/pdf
[2025-11-08 11:09:26] PDF validation: VALID
[2025-11-08 11:09:26] File validation passed
[2025-11-08 11:09:26] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690f16d62f640_1762596566.pdf
[2025-11-08 11:09:26] Temp file exists: YES
[2025-11-08 11:09:26] Temp file size: 170820
[2025-11-08 11:09:26] Starting PDF encryption process...
[2025-11-08 11:09:26] Reading PDF file from: /Applications/XAMPP/xamppfiles/temp/php5owtmF
[2025-11-08 11:09:26] PDF file read successfully, size: 170820 bytes
[2025-11-08 11:09:26] Applying Caesar Cipher...
[2025-11-08 11:09:26] Caesar Cipher applied successfully
[2025-11-08 11:09:26] Applying AES encryption...
[2025-11-08 11:09:26] AES encryption applied successfully
[2025-11-08 11:09:26] Writing encrypted PDF to: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690f16d62f640_1762596566.pdf
[2025-11-08 11:09:26] Encrypted PDF saved successfully, size: 170832 bytes
[2025-11-08 11:09:26] PDF encrypted and saved successfully
[2025-11-08 11:09:26] File verified - Size: 170832 bytes
[2025-11-08 11:09:26] File upload results - Foto: 690f16d58477c_1762596565.png, PDF: 690f16d62f640_1762596566.pdf
[2025-11-08 11:09:26] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-08 11:09:26] Data successfully inserted with ID: 5
[2025-11-08 11:09:26] Sending success response
[2025-11-08 11:09:26] === REQUEST COMPLETED ===
[2025-11-08 12:12:42] === NEW REQUEST STARTED ===
[2025-11-08 12:12:42] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-08 12:12:42] Database connected successfully
[2025-11-08 12:12:42] Request method: POST
[2025-11-08 12:12:42] === START PROCESSING FORM DATA ===
[2025-11-08 12:12:42] POST data: Array
(
    [patientId] => 
    [namaPasien] => trisudi
    [tanggalLahir] => 1987-11-02
    [alamat] => fdvdfdvdfvd
    [jenisLayanan] => rawat-inap
    [statusPasien] => menunggu
    [hasilPemeriksaan] => ugjhkl
    [medmsg] => sukarno
    [jumlahPembayaran] => 987907
)

[2025-11-08 12:12:42] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => Gemini_Generated_Image_1mdrpo1mdrpo1mdr.png
            [full_path] => Gemini_Generated_Image_1mdrpo1mdrpo1mdr.png
            [type] => image/png
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpu5uiOg
            [error] => 0
            [size] => 1508431
        )

    [pdfDokumen] => Array
        (
            [name] => ijazah daniel.pdf
            [full_path] => ijazah daniel.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php1J5USS
            [error] => 0
            [size] => 559275
        )

)

[2025-11-08 12:12:42] Detected MIME type: image/png
[2025-11-08 12:12:42] Image validation: VALID
[2025-11-08 12:12:42] Detected MIME type: application/pdf
[2025-11-08 12:12:42] PDF validation: VALID
[2025-11-08 12:12:42] Form data sanitized successfully
[2025-11-08 12:12:42] Medical message: sukarno
[2025-11-08 12:12:42] Data encrypted successfully
[2025-11-08 12:12:42] Starting file upload process...
[2025-11-08 12:12:42] === START FILE UPLOAD: fotoPasien ===
[2025-11-08 12:12:42] File info: Array
(
    [name] => Gemini_Generated_Image_1mdrpo1mdrpo1mdr.png
    [full_path] => Gemini_Generated_Image_1mdrpo1mdrpo1mdr.png
    [type] => image/png
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpu5uiOg
    [error] => 0
    [size] => 1508431
)

[2025-11-08 12:12:42] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-08 12:12:42] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-08 12:12:42] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-08 12:12:42] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-08 12:12:42] Directory is writable
[2025-11-08 12:12:42] Detected MIME type: image/png
[2025-11-08 12:12:42] Image validation: VALID
[2025-11-08 12:12:42] File validation passed
[2025-11-08 12:12:42] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/690f25aa7c13e_1762600362.png
[2025-11-08 12:12:42] Temp file exists: YES
[2025-11-08 12:12:42] Temp file size: 1508431
[2025-11-08 12:12:42] Starting image steganography process...
[2025-11-08 12:12:42] Medical message for steganography: sukarno
[2025-11-08 12:12:42] === START IMAGE STEGANOGRAPHY ===
[2025-11-08 12:12:42] Original message: sukarno
[2025-11-08 12:12:42] Encrypting message for steganography: sukarno
[2025-11-08 12:12:42] AES encryption successful, encrypted length: 32 bytes
[2025-11-08 12:12:42] Message encrypted with AES
[2025-11-08 12:12:42] Image dimensions: 1184x864, Type: 3
[2025-11-08 12:12:42] Max capacity: 383616 bytes
[2025-11-08 12:12:42] Encrypted message length: 32 bytes
[2025-11-08 12:12:42] Total data to hide: 36 bytes
[2025-11-08 12:12:42] Binary data length: 288 bits
[2025-11-08 12:12:42] Data embedded successfully. Bits used: 288
[2025-11-08 12:12:43] Steganographed image saved successfully: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/690f25aa7c13e_1762600362.png
[2025-11-08 12:12:43] Final file size: 1498369 bytes
[2025-11-08 12:12:43] Image steganography applied successfully
[2025-11-08 12:12:43] File verified - Size: 1498369 bytes
[2025-11-08 12:12:43] === START FILE UPLOAD: pdfDokumen ===
[2025-11-08 12:12:43] File info: Array
(
    [name] => ijazah daniel.pdf
    [full_path] => ijazah daniel.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php1J5USS
    [error] => 0
    [size] => 559275
)

[2025-11-08 12:12:43] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-08 12:12:43] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-08 12:12:43] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-08 12:12:43] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-08 12:12:43] Directory is writable
[2025-11-08 12:12:43] Detected MIME type: application/pdf
[2025-11-08 12:12:43] PDF validation: VALID
[2025-11-08 12:12:43] File validation passed
[2025-11-08 12:12:43] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690f25ab26865_1762600363.pdf
[2025-11-08 12:12:43] Temp file exists: YES
[2025-11-08 12:12:43] Temp file size: 559275
[2025-11-08 12:12:43] Starting PDF encryption process...
[2025-11-08 12:12:43] Reading PDF file from: /Applications/XAMPP/xamppfiles/temp/php1J5USS
[2025-11-08 12:12:43] PDF file read successfully, size: 559275 bytes
[2025-11-08 12:12:43] Applying Caesar Cipher...
[2025-11-08 12:12:43] Caesar Cipher applied successfully
[2025-11-08 12:12:43] Applying AES encryption...
[2025-11-08 12:12:43] AES encryption applied successfully
[2025-11-08 12:12:43] Writing encrypted PDF to: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690f25ab26865_1762600363.pdf
[2025-11-08 12:12:43] Encrypted PDF saved successfully, size: 559280 bytes
[2025-11-08 12:12:43] PDF encrypted and saved successfully
[2025-11-08 12:12:43] File verified - Size: 559280 bytes
[2025-11-08 12:12:43] File upload results - Foto: 690f25aa7c13e_1762600362.png, PDF: 690f25ab26865_1762600363.pdf
[2025-11-08 12:12:43] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-08 12:12:43] Data successfully inserted with ID: 6
[2025-11-08 12:12:43] Sending success response
[2025-11-08 12:12:43] === REQUEST COMPLETED ===
[2025-11-08 14:56:34] === NEW REQUEST STARTED ===
[2025-11-08 14:56:34] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-08 14:56:34] Database connected successfully
[2025-11-08 14:56:34] Request method: POST
[2025-11-08 14:56:34] === START PROCESSING FORM DATA ===
[2025-11-08 14:56:34] POST data: Array
(
    [patientId] => 
    [namaPasien] => Messi
    [tanggalLahir] => 1994-11-13
    [alamat] => Argentina
    [jenisLayanan] => rawat-inap
    [statusPasien] => menunggu
    [hasilPemeriksaan] => Cukup Baik
    [medmsg] => Sip Mantab
    [jumlahPembayaran] => 978234
)

[2025-11-08 14:56:34] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => Daniel_Logistik-2.png
            [full_path] => Daniel_Logistik-2.png
            [type] => image/png
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpW11tw6
            [error] => 0
            [size] => 3640955
        )

    [pdfDokumen] => Array
        (
            [name] => LAPORAN TUGAS KRIPTOGRAFI_124230006_124230017-2.pdf
            [full_path] => LAPORAN TUGAS KRIPTOGRAFI_124230006_124230017-2.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php53PxwH
            [error] => 0
            [size] => 2068794
        )

)

[2025-11-08 14:56:34] Detected MIME type: image/png
[2025-11-08 14:56:34] Image validation: VALID
[2025-11-08 14:56:34] Detected MIME type: application/pdf
[2025-11-08 14:56:34] PDF validation: VALID
[2025-11-08 14:56:34] Form data sanitized successfully
[2025-11-08 14:56:34] Medical message: Sip Mantab
[2025-11-08 14:56:34] Data encrypted successfully
[2025-11-08 14:56:34] Starting file upload process...
[2025-11-08 14:56:34] === START FILE UPLOAD: fotoPasien ===
[2025-11-08 14:56:34] File info: Array
(
    [name] => Daniel_Logistik-2.png
    [full_path] => Daniel_Logistik-2.png
    [type] => image/png
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpW11tw6
    [error] => 0
    [size] => 3640955
)

[2025-11-08 14:56:34] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-08 14:56:34] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-08 14:56:34] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-08 14:56:34] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-08 14:56:34] Directory is writable
[2025-11-08 14:56:34] Detected MIME type: image/png
[2025-11-08 14:56:34] Image validation: VALID
[2025-11-08 14:56:34] File validation passed
[2025-11-08 14:56:34] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/690f4c1257323_1762610194.png
[2025-11-08 14:56:34] Temp file exists: YES
[2025-11-08 14:56:34] Temp file size: 3640955
[2025-11-08 14:56:34] Starting image steganography process...
[2025-11-08 14:56:34] Medical message for steganography: Sip Mantab
[2025-11-08 14:56:34] === START IMAGE STEGANOGRAPHY ===
[2025-11-08 14:56:34] Original message: Sip Mantab
[2025-11-08 14:56:34] Encrypting message for steganography: Sip Mantab
[2025-11-08 14:56:34] AES encryption successful, encrypted length: 32 bytes
[2025-11-08 14:56:34] Message encrypted with AES
[2025-11-08 14:56:34] Image dimensions: 1856x1660, Type: 3
[2025-11-08 14:56:34] Max capacity: 1155360 bytes
[2025-11-08 14:56:34] Encrypted message length: 32 bytes
[2025-11-08 14:56:34] Total data to hide: 36 bytes
[2025-11-08 14:56:34] Binary data length: 288 bits
[2025-11-08 14:56:34] Data embedded successfully. Bits used: 288
[2025-11-08 14:56:44] Steganographed image saved successfully: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/690f4c1257323_1762610194.png
[2025-11-08 14:56:44] Final file size: 2197023 bytes
[2025-11-08 14:56:44] Image steganography applied successfully
[2025-11-08 14:56:44] File verified - Size: 2197023 bytes
[2025-11-08 14:56:44] === START FILE UPLOAD: pdfDokumen ===
[2025-11-08 14:56:44] File info: Array
(
    [name] => LAPORAN TUGAS KRIPTOGRAFI_124230006_124230017-2.pdf
    [full_path] => LAPORAN TUGAS KRIPTOGRAFI_124230006_124230017-2.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php53PxwH
    [error] => 0
    [size] => 2068794
)

[2025-11-08 14:56:44] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-08 14:56:44] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-08 14:56:44] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-08 14:56:44] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-08 14:56:44] Directory is writable
[2025-11-08 14:56:44] Detected MIME type: application/pdf
[2025-11-08 14:56:44] PDF validation: VALID
[2025-11-08 14:56:44] File validation passed
[2025-11-08 14:56:44] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690f4c1c9efb1_1762610204.pdf
[2025-11-08 14:56:44] Temp file exists: YES
[2025-11-08 14:56:44] Temp file size: 2068794
[2025-11-08 14:56:44] Starting PDF encryption process...
[2025-11-08 14:56:44] Reading PDF file from: /Applications/XAMPP/xamppfiles/temp/php53PxwH
[2025-11-08 14:56:44] PDF file read successfully, size: 2068794 bytes
[2025-11-08 14:56:44] Applying Caesar Cipher...
[2025-11-08 14:56:44] Caesar Cipher applied successfully
[2025-11-08 14:56:44] Applying AES encryption...
[2025-11-08 14:56:44] AES encryption applied successfully
[2025-11-08 14:56:44] Writing encrypted PDF to: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/690f4c1c9efb1_1762610204.pdf
[2025-11-08 14:56:44] Encrypted PDF saved successfully, size: 2068800 bytes
[2025-11-08 14:56:44] PDF encrypted and saved successfully
[2025-11-08 14:56:44] File verified - Size: 2068800 bytes
[2025-11-08 14:56:44] File upload results - Foto: 690f4c1257323_1762610194.png, PDF: 690f4c1c9efb1_1762610204.pdf
[2025-11-08 14:56:44] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-08 14:56:44] Data successfully inserted with ID: 7
[2025-11-08 14:56:44] Sending success response
[2025-11-08 14:56:44] === REQUEST COMPLETED ===
[2025-11-11 09:55:10] === NEW REQUEST STARTED ===
[2025-11-11 09:55:10] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-11 09:55:10] Database connected successfully
[2025-11-11 09:55:10] Request method: POST
[2025-11-11 09:55:10] === START PROCESSING FORM DATA ===
[2025-11-11 09:55:10] POST data: Array
(
    [patientId] => 
    [namaPasien] => jnkjnjk
    [tanggalLahir] => 2025-11-06
    [alamat] => sadsdasd
    [jenisLayanan] => rawat-inap
    [statusPasien] => dalam perawatan
    [hasilPemeriksaan] => Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

    [medmsg] => Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.


    [jumlahPembayaran] => 314332131
)

[2025-11-11 09:55:10] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => Brad_Pitt_2019_by_Glenn_Francis.jpg
            [full_path] => Brad_Pitt_2019_by_Glenn_Francis.jpg
            [type] => image/jpeg
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpoUvsQi
            [error] => 0
            [size] => 22816
        )

    [pdfDokumen] => Array
        (
            [name] => Aplikasi.pdf
            [full_path] => Aplikasi.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpXngN0w
            [error] => 0
            [size] => 4040002
        )

)

[2025-11-11 09:55:10] Detected MIME type: image/jpeg
[2025-11-11 09:55:10] Image validation: VALID
[2025-11-11 09:55:10] Detected MIME type: application/pdf
[2025-11-11 09:55:10] PDF validation: VALID
[2025-11-11 09:55:10] Form data sanitized successfully
[2025-11-11 09:55:10] Medical message: Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.
[2025-11-11 09:55:10] Data encrypted successfully
[2025-11-11 09:55:10] Starting file upload process...
[2025-11-11 09:55:10] === START FILE UPLOAD: fotoPasien ===
[2025-11-11 09:55:10] File info: Array
(
    [name] => Brad_Pitt_2019_by_Glenn_Francis.jpg
    [full_path] => Brad_Pitt_2019_by_Glenn_Francis.jpg
    [type] => image/jpeg
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpoUvsQi
    [error] => 0
    [size] => 22816
)

[2025-11-11 09:55:10] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-11 09:55:10] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-11 09:55:10] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-11 09:55:10] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-11 09:55:10] Directory is writable
[2025-11-11 09:55:10] Detected MIME type: image/jpeg
[2025-11-11 09:55:10] Image validation: VALID
[2025-11-11 09:55:10] File validation passed
[2025-11-11 09:55:10] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/6912f9ee5ea53_1762851310.jpg
[2025-11-11 09:55:10] Temp file exists: YES
[2025-11-11 09:55:10] Temp file size: 22816
[2025-11-11 09:55:10] Starting image steganography process...
[2025-11-11 09:55:10] Medical message for steganography: Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.
[2025-11-11 09:55:10] === START IMAGE STEGANOGRAPHY ===
[2025-11-11 09:55:10] Original message: Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.
[2025-11-11 09:55:10] Encrypting message for steganography: Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.
[2025-11-11 09:55:10] AES encryption successful, encrypted length: 6688 bytes
[2025-11-11 09:55:10] Message encrypted with AES
[2025-11-11 09:55:10] Image dimensions: 250x375, Type: 2
[2025-11-11 09:55:10] Max capacity: 35156.25 bytes
[2025-11-11 09:55:10] Encrypted message length: 6688 bytes
[2025-11-11 09:55:10] Total data to hide: 6692 bytes
[2025-11-11 09:55:10] Binary data length: 53536 bits
[2025-11-11 09:55:10] Data embedded successfully. Bits used: 53536
[2025-11-11 09:55:10] Steganographed image saved successfully: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/6912f9ee5ea53_1762851310.jpg
[2025-11-11 09:55:10] Final file size: 24476 bytes
[2025-11-11 09:55:10] Image steganography applied successfully
[2025-11-11 09:55:10] File verified - Size: 24476 bytes
[2025-11-11 09:55:10] === START FILE UPLOAD: pdfDokumen ===
[2025-11-11 09:55:10] File info: Array
(
    [name] => Aplikasi.pdf
    [full_path] => Aplikasi.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpXngN0w
    [error] => 0
    [size] => 4040002
)

[2025-11-11 09:55:10] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-11 09:55:10] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-11 09:55:10] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-11 09:55:10] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-11 09:55:10] Directory is writable
[2025-11-11 09:55:10] Detected MIME type: application/pdf
[2025-11-11 09:55:10] PDF validation: VALID
[2025-11-11 09:55:10] File validation passed
[2025-11-11 09:55:10] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/6912f9ee682a0_1762851310.pdf
[2025-11-11 09:55:10] Temp file exists: YES
[2025-11-11 09:55:10] Temp file size: 4040002
[2025-11-11 09:55:10] Starting PDF encryption process...
[2025-11-11 09:55:10] Reading PDF file from: /Applications/XAMPP/xamppfiles/temp/phpXngN0w
[2025-11-11 09:55:10] PDF file read successfully, size: 4040002 bytes
[2025-11-11 09:55:10] Applying Caesar Cipher...
[2025-11-11 09:55:10] Caesar Cipher applied successfully
[2025-11-11 09:55:10] Applying AES encryption...
[2025-11-11 09:55:10] AES encryption applied successfully
[2025-11-11 09:55:10] Writing encrypted PDF to: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/6912f9ee682a0_1762851310.pdf
[2025-11-11 09:55:10] Encrypted PDF saved successfully, size: 4040016 bytes
[2025-11-11 09:55:10] PDF encrypted and saved successfully
[2025-11-11 09:55:10] File verified - Size: 4040016 bytes
[2025-11-11 09:55:10] File upload results - Foto: 6912f9ee5ea53_1762851310.jpg, PDF: 6912f9ee682a0_1762851310.pdf
[2025-11-11 09:55:10] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-11 09:55:10] Data successfully inserted with ID: 8
[2025-11-11 09:55:10] Sending success response
[2025-11-11 09:55:10] === REQUEST COMPLETED ===
[2025-11-11 09:59:29] === NEW REQUEST STARTED ===
[2025-11-11 09:59:29] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-11 09:59:29] Database connected successfully
[2025-11-11 09:59:29] Request method: POST
[2025-11-11 09:59:29] === START PROCESSING FORM DATA ===
[2025-11-11 09:59:29] POST data: Array
(
    [patientId] => 
    [namaPasien] => dasdnajsdnjadns
    [tanggalLahir] => 2025-11-11
    [alamat] => adLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

    [jenisLayanan] => rawat-inap
    [statusPasien] => dalam perawatan
    [hasilPemeriksaan] => Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

    [medmsg] => Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

    [jumlahPembayaran] => 423243243
)

[2025-11-11 09:59:29] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => Brad_Pitt_2019_by_Glenn_Francis.jpg
            [full_path] => Brad_Pitt_2019_by_Glenn_Francis.jpg
            [type] => image/jpeg
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpkjPFdU
            [error] => 0
            [size] => 22816
        )

    [pdfDokumen] => Array
        (
            [name] => Aplikasi.pdf
            [full_path] => Aplikasi.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php8d8klM
            [error] => 0
            [size] => 4040002
        )

)

[2025-11-11 09:59:29] Detected MIME type: image/jpeg
[2025-11-11 09:59:29] Image validation: VALID
[2025-11-11 09:59:29] Detected MIME type: application/pdf
[2025-11-11 09:59:29] PDF validation: VALID
[2025-11-11 09:59:29] Form data sanitized successfully
[2025-11-11 09:59:29] Medical message: Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.
[2025-11-11 09:59:29] Data encrypted successfully
[2025-11-11 09:59:29] Starting file upload process...
[2025-11-11 09:59:29] === START FILE UPLOAD: fotoPasien ===
[2025-11-11 09:59:29] File info: Array
(
    [name] => Brad_Pitt_2019_by_Glenn_Francis.jpg
    [full_path] => Brad_Pitt_2019_by_Glenn_Francis.jpg
    [type] => image/jpeg
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpkjPFdU
    [error] => 0
    [size] => 22816
)

[2025-11-11 09:59:29] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-11 09:59:29] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-11 09:59:29] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-11 09:59:29] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-11 09:59:29] Directory is writable
[2025-11-11 09:59:29] Detected MIME type: image/jpeg
[2025-11-11 09:59:29] Image validation: VALID
[2025-11-11 09:59:29] File validation passed
[2025-11-11 09:59:29] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/6912faf1cce86_1762851569.jpg
[2025-11-11 09:59:29] Temp file exists: YES
[2025-11-11 09:59:29] Temp file size: 22816
[2025-11-11 09:59:29] Starting image steganography process...
[2025-11-11 09:59:29] Medical message for steganography: Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.
[2025-11-11 09:59:29] === START IMAGE STEGANOGRAPHY ===
[2025-11-11 09:59:29] Original message: Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.
[2025-11-11 09:59:29] Encrypting message for steganography: Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.\r\n\r\nLorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.
[2025-11-11 09:59:29] AES encryption successful, encrypted length: 6688 bytes
[2025-11-11 09:59:29] Message encrypted with AES
[2025-11-11 09:59:29] Image dimensions: 250x375, Type: 2
[2025-11-11 09:59:29] Max capacity: 35156.25 bytes
[2025-11-11 09:59:29] Encrypted message length: 6688 bytes
[2025-11-11 09:59:29] Total data to hide: 6692 bytes
[2025-11-11 09:59:29] Binary data length: 53536 bits
[2025-11-11 09:59:29] Data embedded successfully. Bits used: 53536
[2025-11-11 09:59:29] Steganographed image saved successfully: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/6912faf1cce86_1762851569.jpg
[2025-11-11 09:59:29] Final file size: 24476 bytes
[2025-11-11 09:59:29] Image steganography applied successfully
[2025-11-11 09:59:29] File verified - Size: 24476 bytes
[2025-11-11 09:59:29] === START FILE UPLOAD: pdfDokumen ===
[2025-11-11 09:59:29] File info: Array
(
    [name] => Aplikasi.pdf
    [full_path] => Aplikasi.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php8d8klM
    [error] => 0
    [size] => 4040002
)

[2025-11-11 09:59:29] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-11 09:59:29] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-11 09:59:29] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-11 09:59:29] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-11 09:59:29] Directory is writable
[2025-11-11 09:59:29] Detected MIME type: application/pdf
[2025-11-11 09:59:29] PDF validation: VALID
[2025-11-11 09:59:29] File validation passed
[2025-11-11 09:59:29] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/6912faf1d4fca_1762851569.pdf
[2025-11-11 09:59:29] Temp file exists: YES
[2025-11-11 09:59:29] Temp file size: 4040002
[2025-11-11 09:59:29] Starting PDF encryption process...
[2025-11-11 09:59:29] Reading PDF file from: /Applications/XAMPP/xamppfiles/temp/php8d8klM
[2025-11-11 09:59:29] PDF file read successfully, size: 4040002 bytes
[2025-11-11 09:59:29] Applying Caesar Cipher...
[2025-11-11 09:59:30] Caesar Cipher applied successfully
[2025-11-11 09:59:30] Applying AES encryption...
[2025-11-11 09:59:30] AES encryption applied successfully
[2025-11-11 09:59:30] Writing encrypted PDF to: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/6912faf1d4fca_1762851569.pdf
[2025-11-11 09:59:30] Encrypted PDF saved successfully, size: 4040016 bytes
[2025-11-11 09:59:30] PDF encrypted and saved successfully
[2025-11-11 09:59:30] File verified - Size: 4040016 bytes
[2025-11-11 09:59:30] File upload results - Foto: 6912faf1cce86_1762851569.jpg, PDF: 6912faf1d4fca_1762851569.pdf
[2025-11-11 09:59:30] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-11 09:59:30] Data successfully inserted with ID: 9
[2025-11-11 09:59:30] Sending success response
[2025-11-11 09:59:30] === REQUEST COMPLETED ===
[2025-11-11 13:31:56] === NEW REQUEST STARTED ===
[2025-11-11 13:31:56] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-11 13:31:56] Database connected successfully
[2025-11-11 13:31:56] Request method: POST
[2025-11-11 13:31:56] === START PROCESSING FORM DATA ===
[2025-11-11 13:31:56] POST data: Array
(
    [patientId] => 
    [namaPasien] => cek ok
    [tanggalLahir] => 2025-11-13
    [alamat] => tes
    [jenisLayanan] => rawat-inap
    [statusPasien] => dalam perawatan
    [hasilPemeriksaan] => oke
    [medmsg] => okebos
    [jumlahPembayaran] => 645342
)

[2025-11-11 13:31:56] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => Brad_Pitt_2019_by_Glenn_Francis.jpg
            [full_path] => Brad_Pitt_2019_by_Glenn_Francis.jpg
            [type] => image/jpeg
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpi76sgN
            [error] => 0
            [size] => 22816
        )

    [pdfDokumen] => Array
        (
            [name] => 124230017_Daniel Satria Darmawan.pdf
            [full_path] => 124230017_Daniel Satria Darmawan.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php06qqZi
            [error] => 0
            [size] => 170820
        )

)

[2025-11-11 13:31:56] Detected MIME type: image/jpeg
[2025-11-11 13:31:56] Image validation: VALID
[2025-11-11 13:31:56] Detected MIME type: application/pdf
[2025-11-11 13:31:56] PDF validation: VALID
[2025-11-11 13:31:56] Form data sanitized successfully
[2025-11-11 13:31:56] Medical message: okebos
[2025-11-11 13:31:56] Data encrypted successfully
[2025-11-11 13:31:56] Starting file upload process...
[2025-11-11 13:31:56] === START FILE UPLOAD: fotoPasien ===
[2025-11-11 13:31:56] File info: Array
(
    [name] => Brad_Pitt_2019_by_Glenn_Francis.jpg
    [full_path] => Brad_Pitt_2019_by_Glenn_Francis.jpg
    [type] => image/jpeg
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpi76sgN
    [error] => 0
    [size] => 22816
)

[2025-11-11 13:31:56] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-11 13:31:56] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-11 13:31:56] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-11 13:31:56] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-11 13:31:56] Directory is writable
[2025-11-11 13:31:56] Detected MIME type: image/jpeg
[2025-11-11 13:31:56] Image validation: VALID
[2025-11-11 13:31:56] File validation passed
[2025-11-11 13:31:56] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/69132cbc744b4_1762864316.jpg
[2025-11-11 13:31:56] Temp file exists: YES
[2025-11-11 13:31:56] Temp file size: 22816
[2025-11-11 13:31:56] Starting image steganography process...
[2025-11-11 13:31:56] Medical message for steganography: okebos
[2025-11-11 13:31:56] === START IMAGE STEGANOGRAPHY ===
[2025-11-11 13:31:56] Original message: okebos
[2025-11-11 13:31:56] Encrypting message for steganography: okebos
[2025-11-11 13:31:56] AES encryption successful, encrypted length: 32 bytes
[2025-11-11 13:31:56] Message encrypted with AES
[2025-11-11 13:31:56] Image dimensions: 250x375, Type: 2
[2025-11-11 13:31:56] Max capacity: 35156.25 bytes
[2025-11-11 13:31:56] Encrypted message length: 32 bytes
[2025-11-11 13:31:56] Total data to hide: 36 bytes
[2025-11-11 13:31:56] Binary data length: 288 bits
[2025-11-11 13:31:56] Data embedded successfully. Bits used: 288
[2025-11-11 13:31:56] Steganographed image saved successfully: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/69132cbc744b4_1762864316.jpg
[2025-11-11 13:31:56] Final file size: 24435 bytes
[2025-11-11 13:31:56] Image steganography applied successfully
[2025-11-11 13:31:56] File verified - Size: 24435 bytes
[2025-11-11 13:31:56] === START FILE UPLOAD: pdfDokumen ===
[2025-11-11 13:31:56] File info: Array
(
    [name] => 124230017_Daniel Satria Darmawan.pdf
    [full_path] => 124230017_Daniel Satria Darmawan.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php06qqZi
    [error] => 0
    [size] => 170820
)

[2025-11-11 13:31:56] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-11 13:31:56] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-11 13:31:56] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-11 13:31:56] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-11 13:31:56] Directory is writable
[2025-11-11 13:31:56] Detected MIME type: application/pdf
[2025-11-11 13:31:56] PDF validation: VALID
[2025-11-11 13:31:56] File validation passed
[2025-11-11 13:31:56] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/69132cbc78b04_1762864316.pdf
[2025-11-11 13:31:56] Temp file exists: YES
[2025-11-11 13:31:56] Temp file size: 170820
[2025-11-11 13:31:56] Starting PDF encryption process...
[2025-11-11 13:31:56] Reading PDF file from: /Applications/XAMPP/xamppfiles/temp/php06qqZi
[2025-11-11 13:31:56] PDF file read successfully, size: 170820 bytes
[2025-11-11 13:31:56] Applying Caesar Cipher...
[2025-11-11 13:31:56] Caesar Cipher applied successfully
[2025-11-11 13:31:56] Applying AES encryption...
[2025-11-11 13:31:56] AES encryption applied successfully
[2025-11-11 13:31:56] Writing encrypted PDF to: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/69132cbc78b04_1762864316.pdf
[2025-11-11 13:31:56] Encrypted PDF saved successfully, size: 170832 bytes
[2025-11-11 13:31:56] PDF encrypted and saved successfully
[2025-11-11 13:31:56] File verified - Size: 170832 bytes
[2025-11-11 13:31:56] File upload results - Foto: 69132cbc744b4_1762864316.jpg, PDF: 69132cbc78b04_1762864316.pdf
[2025-11-11 13:31:56] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-11 13:31:56] Data successfully inserted with ID: 10
[2025-11-11 13:31:56] Sending success response
[2025-11-11 13:31:56] === REQUEST COMPLETED ===
[2025-11-11 13:33:53] === NEW REQUEST STARTED ===
[2025-11-11 13:33:53] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-11 13:33:53] Database connected successfully
[2025-11-11 13:33:53] Request method: POST
[2025-11-11 13:33:53] === START PROCESSING FORM DATA ===
[2025-11-11 13:33:53] POST data: Array
(
    [patientId] => 
    [namaPasien] => brad
    [tanggalLahir] => 2025-11-05
    [alamat] => testes
    [jenisLayanan] => rawat-jalan
    [statusPasien] => dalam perawatan
    [hasilPemeriksaan] => testes
    [medmsg] => okecek
    [jumlahPembayaran] => 453423
)

[2025-11-11 13:33:53] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => Brad_Pitt_2019_by_Glenn_Francis.jpg
            [full_path] => Brad_Pitt_2019_by_Glenn_Francis.jpg
            [type] => image/jpeg
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php3MEJSU
            [error] => 0
            [size] => 22816
        )

    [pdfDokumen] => Array
        (
            [name] => Aplikasi.pdf
            [full_path] => Aplikasi.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpSyeyuX
            [error] => 0
            [size] => 4040002
        )

)

[2025-11-11 13:33:53] Detected MIME type: image/jpeg
[2025-11-11 13:33:53] Image validation: VALID
[2025-11-11 13:33:53] Detected MIME type: application/pdf
[2025-11-11 13:33:53] PDF validation: VALID
[2025-11-11 13:33:53] Form data sanitized successfully
[2025-11-11 13:33:53] Medical message: okecek
[2025-11-11 13:33:53] Data encrypted successfully
[2025-11-11 13:33:53] Starting file upload process...
[2025-11-11 13:33:53] === START FILE UPLOAD: fotoPasien ===
[2025-11-11 13:33:53] File info: Array
(
    [name] => Brad_Pitt_2019_by_Glenn_Francis.jpg
    [full_path] => Brad_Pitt_2019_by_Glenn_Francis.jpg
    [type] => image/jpeg
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php3MEJSU
    [error] => 0
    [size] => 22816
)

[2025-11-11 13:33:53] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-11 13:33:53] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-11 13:33:53] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-11 13:33:53] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-11 13:33:53] Directory is writable
[2025-11-11 13:33:53] Detected MIME type: image/jpeg
[2025-11-11 13:33:53] Image validation: VALID
[2025-11-11 13:33:53] File validation passed
[2025-11-11 13:33:53] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/69132d31ee37d_1762864433.jpg
[2025-11-11 13:33:53] Temp file exists: YES
[2025-11-11 13:33:53] Temp file size: 22816
[2025-11-11 13:33:53] Starting image steganography process...
[2025-11-11 13:33:53] Medical message for steganography: okecek
[2025-11-11 13:33:53] === START IMAGE STEGANOGRAPHY ===
[2025-11-11 13:33:53] Original message: okecek
[2025-11-11 13:33:53] Encrypting message for steganography: okecek
[2025-11-11 13:33:53] AES encryption successful, encrypted length: 32 bytes
[2025-11-11 13:33:53] Message encrypted with AES
[2025-11-11 13:33:53] Image dimensions: 250x375, Type: 2
[2025-11-11 13:33:53] Max capacity: 35156.25 bytes
[2025-11-11 13:33:53] Encrypted message length: 32 bytes
[2025-11-11 13:33:53] Total data to hide: 36 bytes
[2025-11-11 13:33:53] Binary data length: 288 bits
[2025-11-11 13:33:53] Data embedded successfully. Bits used: 288
[2025-11-11 13:33:53] Steganographed image saved successfully: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/69132d31ee37d_1762864433.jpg
[2025-11-11 13:33:53] Final file size: 24437 bytes
[2025-11-11 13:33:53] Image steganography applied successfully
[2025-11-11 13:33:53] File verified - Size: 24437 bytes
[2025-11-11 13:33:53] === START FILE UPLOAD: pdfDokumen ===
[2025-11-11 13:33:53] File info: Array
(
    [name] => Aplikasi.pdf
    [full_path] => Aplikasi.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpSyeyuX
    [error] => 0
    [size] => 4040002
)

[2025-11-11 13:33:53] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-11 13:33:53] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-11 13:33:53] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-11 13:33:53] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-11 13:33:53] Directory is writable
[2025-11-11 13:33:53] Detected MIME type: application/pdf
[2025-11-11 13:33:53] PDF validation: VALID
[2025-11-11 13:33:53] File validation passed
[2025-11-11 13:33:53] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/69132d31f07c6_1762864433.pdf
[2025-11-11 13:33:53] Temp file exists: YES
[2025-11-11 13:33:53] Temp file size: 4040002
[2025-11-11 13:33:53] Starting PDF encryption process...
[2025-11-11 13:33:53] Reading PDF file from: /Applications/XAMPP/xamppfiles/temp/phpSyeyuX
[2025-11-11 13:33:53] PDF file read successfully, size: 4040002 bytes
[2025-11-11 13:33:53] Applying Caesar Cipher...
[2025-11-11 13:33:54] Caesar Cipher applied successfully
[2025-11-11 13:33:54] Applying AES encryption...
[2025-11-11 13:33:54] AES encryption applied successfully
[2025-11-11 13:33:54] Writing encrypted PDF to: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/69132d31f07c6_1762864433.pdf
[2025-11-11 13:33:54] Encrypted PDF saved successfully, size: 4040016 bytes
[2025-11-11 13:33:54] PDF encrypted and saved successfully
[2025-11-11 13:33:54] File verified - Size: 4040016 bytes
[2025-11-11 13:33:54] File upload results - Foto: 69132d31ee37d_1762864433.jpg, PDF: 69132d31f07c6_1762864433.pdf
[2025-11-11 13:33:54] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-11 13:33:54] Data successfully inserted with ID: 11
[2025-11-11 13:33:54] Sending success response
[2025-11-11 13:33:54] === REQUEST COMPLETED ===
[2025-11-11 14:16:28] === NEW REQUEST STARTED ===
[2025-11-11 14:16:28] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-11 14:16:28] Database connected successfully
[2025-11-11 14:16:28] Request method: POST
[2025-11-11 14:16:28] === START PROCESSING FORM DATA ===
[2025-11-11 14:16:28] POST data: Array
(
    [patientId] => 
    [namaPasien] => brad
    [tanggalLahir] => 2025-11-19
    [alamat] => testes
    [jenisLayanan] => rawat-inap
    [statusPasien] => selesai
    [hasilPemeriksaan] => testestes
    [medmsg] => rtsteeg
    [jumlahPembayaran] => 534232
)

[2025-11-11 14:16:28] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => Brad_Pitt_2019_by_Glenn_Francis.jpg
            [full_path] => Brad_Pitt_2019_by_Glenn_Francis.jpg
            [type] => image/jpeg
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpOqZvzd
            [error] => 0
            [size] => 22816
        )

    [pdfDokumen] => Array
        (
            [name] => Aplikasi.pdf
            [full_path] => Aplikasi.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpv2SxeZ
            [error] => 0
            [size] => 4040002
        )

)

[2025-11-11 14:16:28] Detected MIME type: image/jpeg
[2025-11-11 14:16:28] Image validation: VALID
[2025-11-11 14:16:28] Detected MIME type: application/pdf
[2025-11-11 14:16:28] PDF validation: VALID
[2025-11-11 14:16:28] Form data sanitized successfully
[2025-11-11 14:16:28] Medical message: rtsteeg
[2025-11-11 14:16:28] Data encrypted successfully
[2025-11-11 14:16:28] Starting file upload process...
[2025-11-11 14:16:28] === START FILE UPLOAD: fotoPasien ===
[2025-11-11 14:16:28] File info: Array
(
    [name] => Brad_Pitt_2019_by_Glenn_Francis.jpg
    [full_path] => Brad_Pitt_2019_by_Glenn_Francis.jpg
    [type] => image/jpeg
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpOqZvzd
    [error] => 0
    [size] => 22816
)

[2025-11-11 14:16:28] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-11 14:16:28] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-11 14:16:28] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-11 14:16:28] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-11 14:16:28] Directory is writable
[2025-11-11 14:16:28] Detected MIME type: image/jpeg
[2025-11-11 14:16:28] Image validation: VALID
[2025-11-11 14:16:28] File validation passed
[2025-11-11 14:16:28] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/6913372c364ac_1762866988.jpg
[2025-11-11 14:16:28] Temp file exists: YES
[2025-11-11 14:16:28] Temp file size: 22816
[2025-11-11 14:16:28] Starting image steganography process...
[2025-11-11 14:16:28] Medical message for steganography: rtsteeg
[2025-11-11 14:16:28] === START IMAGE STEGANOGRAPHY ===
[2025-11-11 14:16:28] Original message: rtsteeg
[2025-11-11 14:16:28] Encrypting message for steganography: rtsteeg
[2025-11-11 14:16:28] AES encryption successful, encrypted length: 32 bytes
[2025-11-11 14:16:28] Message encrypted with AES
[2025-11-11 14:16:28] Image dimensions: 250x375, Type: 2
[2025-11-11 14:16:28] Max capacity: 35156.25 bytes
[2025-11-11 14:16:28] Encrypted message length: 32 bytes
[2025-11-11 14:16:28] Total data to hide: 36 bytes
[2025-11-11 14:16:28] Binary data length: 288 bits
[2025-11-11 14:16:28] Data embedded successfully. Bits used: 288
[2025-11-11 14:16:28] Steganographed image saved successfully: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/6913372c364ac_1762866988.jpg
[2025-11-11 14:16:28] Final file size: 24428 bytes
[2025-11-11 14:16:28] Image steganography applied successfully
[2025-11-11 14:16:28] File verified - Size: 24428 bytes
[2025-11-11 14:16:28] === START FILE UPLOAD: pdfDokumen ===
[2025-11-11 14:16:28] File info: Array
(
    [name] => Aplikasi.pdf
    [full_path] => Aplikasi.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpv2SxeZ
    [error] => 0
    [size] => 4040002
)

[2025-11-11 14:16:28] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-11 14:16:28] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-11 14:16:28] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-11 14:16:28] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-11 14:16:28] Directory is writable
[2025-11-11 14:16:28] Detected MIME type: application/pdf
[2025-11-11 14:16:28] PDF validation: VALID
[2025-11-11 14:16:28] File validation passed
[2025-11-11 14:16:28] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/6913372c39cbb_1762866988.pdf
[2025-11-11 14:16:28] Temp file exists: YES
[2025-11-11 14:16:28] Temp file size: 4040002
[2025-11-11 14:16:28] Starting PDF encryption process...
[2025-11-11 14:16:28] Reading PDF file from: /Applications/XAMPP/xamppfiles/temp/phpv2SxeZ
[2025-11-11 14:16:28] PDF file read successfully, size: 4040002 bytes
[2025-11-11 14:16:28] Applying Caesar Cipher...
[2025-11-11 14:16:28] Caesar Cipher applied successfully
[2025-11-11 14:16:28] Applying AES encryption...
[2025-11-11 14:16:28] AES encryption applied successfully
[2025-11-11 14:16:28] Writing encrypted PDF to: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/6913372c39cbb_1762866988.pdf
[2025-11-11 14:16:28] Encrypted PDF saved successfully, size: 4040016 bytes
[2025-11-11 14:16:28] PDF encrypted and saved successfully
[2025-11-11 14:16:28] File verified - Size: 4040016 bytes
[2025-11-11 14:16:28] File upload results - Foto: 6913372c364ac_1762866988.jpg, PDF: 6913372c39cbb_1762866988.pdf
[2025-11-11 14:16:28] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-11 14:16:28] Data successfully inserted with ID: 12
[2025-11-11 14:16:28] Sending success response
[2025-11-11 14:16:28] === REQUEST COMPLETED ===
[2025-11-11 14:18:33] === NEW REQUEST STARTED ===
[2025-11-11 14:18:33] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-11 14:18:33] Database connected successfully
[2025-11-11 14:18:33] Request method: POST
[2025-11-11 14:18:33] === START PROCESSING FORM DATA ===
[2025-11-11 14:18:33] POST data: Array
(
    [patientId] => 
    [namaPasien] => bradpitt
    [tanggalLahir] => 2025-11-21
    [alamat] => eststets
    [jenisLayanan] => rawat-inap
    [statusPasien] => selesai
    [hasilPemeriksaan] => testestestest
    [medmsg] => tescek
    [jumlahPembayaran] => 423242
)

[2025-11-11 14:18:33] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => Gemini_Generated_Image_1mdrpo1mdrpo1mdr.png
            [full_path] => Gemini_Generated_Image_1mdrpo1mdrpo1mdr.png
            [type] => image/png
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpAqZfw7
            [error] => 0
            [size] => 1508431
        )

    [pdfDokumen] => Array
        (
            [name] => 124230017_Daniel Satria Darmawan.pdf
            [full_path] => 124230017_Daniel Satria Darmawan.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php3G3IlY
            [error] => 0
            [size] => 170820
        )

)

[2025-11-11 14:18:33] Detected MIME type: image/png
[2025-11-11 14:18:33] Image validation: VALID
[2025-11-11 14:18:33] Detected MIME type: application/pdf
[2025-11-11 14:18:33] PDF validation: VALID
[2025-11-11 14:18:33] Form data sanitized successfully
[2025-11-11 14:18:33] Medical message: tescek
[2025-11-11 14:18:33] Data encrypted successfully
[2025-11-11 14:18:33] Starting file upload process...
[2025-11-11 14:18:33] === START FILE UPLOAD: fotoPasien ===
[2025-11-11 14:18:33] File info: Array
(
    [name] => Gemini_Generated_Image_1mdrpo1mdrpo1mdr.png
    [full_path] => Gemini_Generated_Image_1mdrpo1mdrpo1mdr.png
    [type] => image/png
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpAqZfw7
    [error] => 0
    [size] => 1508431
)

[2025-11-11 14:18:33] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-11 14:18:33] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-11 14:18:33] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-11 14:18:33] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-11 14:18:33] Directory is writable
[2025-11-11 14:18:33] Detected MIME type: image/png
[2025-11-11 14:18:33] Image validation: VALID
[2025-11-11 14:18:33] File validation passed
[2025-11-11 14:18:33] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/691337a9d510f_1762867113.png
[2025-11-11 14:18:33] Temp file exists: YES
[2025-11-11 14:18:33] Temp file size: 1508431
[2025-11-11 14:18:33] Starting image steganography process...
[2025-11-11 14:18:33] Medical message for steganography: tescek
[2025-11-11 14:18:33] === START IMAGE STEGANOGRAPHY ===
[2025-11-11 14:18:33] Original message: tescek
[2025-11-11 14:18:33] Encrypting message for steganography: tescek
[2025-11-11 14:18:33] AES encryption successful, encrypted length: 32 bytes
[2025-11-11 14:18:33] Message encrypted with AES
[2025-11-11 14:18:33] Image dimensions: 1184x864, Type: 3
[2025-11-11 14:18:33] Max capacity: 383616 bytes
[2025-11-11 14:18:33] Encrypted message length: 32 bytes
[2025-11-11 14:18:33] Total data to hide: 36 bytes
[2025-11-11 14:18:33] Binary data length: 288 bits
[2025-11-11 14:18:33] Data embedded successfully. Bits used: 288
[2025-11-11 14:18:34] Steganographed image saved successfully: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/691337a9d510f_1762867113.png
[2025-11-11 14:18:34] Final file size: 1498383 bytes
[2025-11-11 14:18:34] Image steganography applied successfully
[2025-11-11 14:18:34] File verified - Size: 1498383 bytes
[2025-11-11 14:18:34] === START FILE UPLOAD: pdfDokumen ===
[2025-11-11 14:18:34] File info: Array
(
    [name] => 124230017_Daniel Satria Darmawan.pdf
    [full_path] => 124230017_Daniel Satria Darmawan.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php3G3IlY
    [error] => 0
    [size] => 170820
)

[2025-11-11 14:18:34] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-11 14:18:34] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-11 14:18:34] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-11 14:18:34] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-11 14:18:34] Directory is writable
[2025-11-11 14:18:34] Detected MIME type: application/pdf
[2025-11-11 14:18:34] PDF validation: VALID
[2025-11-11 14:18:34] File validation passed
[2025-11-11 14:18:34] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/691337aa801d8_1762867114.pdf
[2025-11-11 14:18:34] Temp file exists: YES
[2025-11-11 14:18:34] Temp file size: 170820
[2025-11-11 14:18:34] Starting PDF encryption process...
[2025-11-11 14:18:34] Reading PDF file from: /Applications/XAMPP/xamppfiles/temp/php3G3IlY
[2025-11-11 14:18:34] PDF file read successfully, size: 170820 bytes
[2025-11-11 14:18:34] Applying Caesar Cipher...
[2025-11-11 14:18:34] Caesar Cipher applied successfully
[2025-11-11 14:18:34] Applying AES encryption...
[2025-11-11 14:18:34] AES encryption applied successfully
[2025-11-11 14:18:34] Writing encrypted PDF to: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/691337aa801d8_1762867114.pdf
[2025-11-11 14:18:34] Encrypted PDF saved successfully, size: 170832 bytes
[2025-11-11 14:18:34] PDF encrypted and saved successfully
[2025-11-11 14:18:34] File verified - Size: 170832 bytes
[2025-11-11 14:18:34] File upload results - Foto: 691337a9d510f_1762867113.png, PDF: 691337aa801d8_1762867114.pdf
[2025-11-11 14:18:34] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-11 14:18:34] Data successfully inserted with ID: 13
[2025-11-11 14:18:34] Sending success response
[2025-11-11 14:18:34] === REQUEST COMPLETED ===
[2025-11-11 14:27:41] === NEW REQUEST STARTED ===
[2025-11-11 14:27:41] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-11 14:27:41] Database connected successfully
[2025-11-11 14:27:41] Request method: POST
[2025-11-11 14:27:41] === START PROCESSING FORM DATA ===
[2025-11-11 14:27:41] POST data: Array
(
    [patientId] => 
    [namaPasien] => lhabeo
    [tanggalLahir] => 2025-11-13
    [alamat] => sadasdasd
    [jenisLayanan] => rawat-inap
    [statusPasien] => dalam perawatan
    [hasilPemeriksaan] => asdsadasd
    [medmsg] => tesvers
    [jumlahPembayaran] => 234232
)

[2025-11-11 14:27:41] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => Daniel_Logistik.png
            [full_path] => Daniel_Logistik.png
            [type] => image/png
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpuSNk9g
            [error] => 0
            [size] => 4167425
        )

    [pdfDokumen] => Array
        (
            [name] => Aplikasi.pdf
            [full_path] => Aplikasi.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpUcZQbu
            [error] => 0
            [size] => 4040002
        )

)

[2025-11-11 14:27:41] Detected MIME type: image/png
[2025-11-11 14:27:41] Image validation: VALID
[2025-11-11 14:27:41] Detected MIME type: application/pdf
[2025-11-11 14:27:41] PDF validation: VALID
[2025-11-11 14:27:41] Form data sanitized successfully
[2025-11-11 14:27:41] Medical message: tesvers
[2025-11-11 14:27:41] Data encrypted successfully
[2025-11-11 14:27:41] Starting file upload process...
[2025-11-11 14:27:41] === START FILE UPLOAD: fotoPasien ===
[2025-11-11 14:27:41] File info: Array
(
    [name] => Daniel_Logistik.png
    [full_path] => Daniel_Logistik.png
    [type] => image/png
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpuSNk9g
    [error] => 0
    [size] => 4167425
)

[2025-11-11 14:27:41] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-11 14:27:41] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-11 14:27:41] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-11 14:27:41] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-11 14:27:41] Directory is writable
[2025-11-11 14:27:41] Detected MIME type: image/png
[2025-11-11 14:27:41] Image validation: VALID
[2025-11-11 14:27:41] File validation passed
[2025-11-11 14:27:41] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/691339cd445a8_1762867661.png
[2025-11-11 14:27:41] Temp file exists: YES
[2025-11-11 14:27:41] Temp file size: 4167425
[2025-11-11 14:27:41] Starting image steganography process...
[2025-11-11 14:27:41] Medical message for steganography: tesvers
[2025-11-11 14:27:41] === START IMAGE STEGANOGRAPHY ===
[2025-11-11 14:27:41] Original message: tesvers
[2025-11-11 14:27:41] Encrypting message for steganography: tesvers
[2025-11-11 14:27:41] AES encryption successful, encrypted length: 32 bytes
[2025-11-11 14:27:41] Message encrypted with AES
[2025-11-11 14:27:41] Image dimensions: 1752x1664, Type: 3
[2025-11-11 14:27:41] Max capacity: 1093248 bytes
[2025-11-11 14:27:41] Encrypted message length: 32 bytes
[2025-11-11 14:27:41] Total data to hide: 36 bytes
[2025-11-11 14:27:41] Binary data length: 288 bits
[2025-11-11 14:27:41] Data embedded successfully. Bits used: 288
[2025-11-11 14:27:50] Steganographed image saved successfully: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/691339cd445a8_1762867661.png
[2025-11-11 14:27:50] Final file size: 2558319 bytes
[2025-11-11 14:27:50] Image steganography applied successfully
[2025-11-11 14:27:50] File verified - Size: 2558319 bytes
[2025-11-11 14:27:50] === START FILE UPLOAD: pdfDokumen ===
[2025-11-11 14:27:50] File info: Array
(
    [name] => Aplikasi.pdf
    [full_path] => Aplikasi.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpUcZQbu
    [error] => 0
    [size] => 4040002
)

[2025-11-11 14:27:50] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-11 14:27:50] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-11 14:27:50] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-11 14:27:50] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-11 14:27:50] Directory is writable
[2025-11-11 14:27:50] Detected MIME type: application/pdf
[2025-11-11 14:27:50] PDF validation: VALID
[2025-11-11 14:27:50] File validation passed
[2025-11-11 14:27:50] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/691339d6b52be_1762867670.pdf
[2025-11-11 14:27:50] Temp file exists: YES
[2025-11-11 14:27:50] Temp file size: 4040002
[2025-11-11 14:27:50] Starting PDF encryption process...
[2025-11-11 14:27:50] Reading PDF file from: /Applications/XAMPP/xamppfiles/temp/phpUcZQbu
[2025-11-11 14:27:50] PDF file read successfully, size: 4040002 bytes
[2025-11-11 14:27:50] Applying Caesar Cipher...
[2025-11-11 14:27:51] Caesar Cipher applied successfully
[2025-11-11 14:27:51] Applying AES encryption...
[2025-11-11 14:27:51] AES encryption applied successfully
[2025-11-11 14:27:51] Writing encrypted PDF to: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/691339d6b52be_1762867670.pdf
[2025-11-11 14:27:51] Encrypted PDF saved successfully, size: 4040016 bytes
[2025-11-11 14:27:51] PDF encrypted and saved successfully
[2025-11-11 14:27:51] File verified - Size: 4040016 bytes
[2025-11-11 14:27:51] File upload results - Foto: 691339cd445a8_1762867661.png, PDF: 691339d6b52be_1762867670.pdf
[2025-11-11 14:27:51] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-11 14:27:51] Data successfully inserted with ID: 14
[2025-11-11 14:27:51] Sending success response
[2025-11-11 14:27:51] === REQUEST COMPLETED ===
[2025-11-11 17:05:40] === NEW REQUEST STARTED ===
[2025-11-11 17:05:40] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-11 17:05:40] Database connected successfully
[2025-11-11 17:05:40] Request method: POST
[2025-11-11 17:05:40] === START PROCESSING FORM DATA ===
[2025-11-11 17:05:40] POST data: Array
(
    [patientId] => 
    [namaPasien] => cek ok
    [tanggalLahir] => 2025-11-13
    [alamat] => <?php

ini_set('display_errors', 1);
ini_set('display_startup_errors', 1);
error_reporting(E_ALL);
ini_set('log_errors', 1);
ini_set('error_log', __DIR__ . '/dashboard_errors.log');

header('Content-Type: application/json; charset=utf-8');
header('Access-Control-Allow-Origin: *');
header('Access-Control-Allow-Methods: GET, POST, OPTIONS');
header('Access-Control-Allow-Headers: Content-Type');

// Database configuration
define('DB_HOST', 'localhost');
define('DB_USER', 'root');
define('DB_PASS', '');
define('DB_NAME', 'kriptoproject');

// Encryption keys (SAMA dengan yang di upload.php)
define('XOR_KEY', 'medicare_secret_key_2024');
define('AES_KEY', 'medicare_aes_key_2024_32bytes_long!');
define('AES_IV', '1234567890123456');

class DashboardView
{
    private $conn;

    public function __construct()
    {
        $this->connectDB();
    }

    private function connectDB()
    {
        try {
            $this->conn = new mysqli(DB_HOST, DB_USER, DB_PASS, DB_NAME);

            if ($this->conn->connect_error) {
                throw new Exception("Koneksi database gagal: " . $this->conn->connect_error);
            }

            $this->conn->set_charset("utf8mb4");
        } catch (Exception $e) {
            $this->sendError($e->getMessage());
        }
    }

    public function handleRequest()
    {
        $action = $_GET['action'] ?? $_POST['action'] ?? '';

        switch ($action) {
            case 'get_stats':
                $this->getDashboardStats();
                break;
            case 'get_recent_patients':
                $this->getRecentPatients();
                break;
            case 'get_patients':
                $this->getPatientsList();
                break;
            case 'get_patient_detail':
                $this->getPatientDetail();
                break;
            case 'update_patient':
                $this->updatePatient();
                break;
            case 'delete_patient':
                $this->deletePatient();
                break;
            case 'download_decrypted_pdf':
                $this->downloadDecryptedPdf();
                break;
            case 'extract_steganography': // NEW ACTION untuk ekstraksi steganografi
                $this->extractSteganographyMessage();
                break;
            default:
                $this->sendError('Action tidak valid');
        }
    }

    // ==================== IMPROVED DECRYPTION METHODS ====================

    /**
     * Decrypt XOR encrypted data
     */
    private function xorDecrypt($encryptedData, $key)
    {
        if (empty($encryptedData)) return '';

        $data = base64_decode($encryptedData);
        $key = mb_convert_encoding($key, 'UTF-8');

        $decrypted = '';
        $dataLen = strlen($data);
        $keyLen = mb_strlen($key, 'UTF-8');

        for ($i = 0; $i < $dataLen; $i++) {
            $dataChar = $data[$i];
            $keyChar = mb_substr($key, $i % $keyLen, 1, 'UTF-8');

            $dataAscii = ord($dataChar);
            $keyAscii = ord($keyChar);
            $decryptedAscii = $dataAscii ^ $keyAscii;

            $decrypted .= chr($decryptedAscii);
        }

        return $decrypted;
    }

    /**
     * Decrypt AES encrypted data
     */
    private function aesDecrypt($encryptedData)
    {
        if (empty($encryptedData)) return '';

        $encrypted = base64_decode($encryptedData);
        
        $decrypted = openssl_decrypt(
            $encrypted,
            'AES-256-CBC',
            AES_KEY,
            OPENSSL_RAW_DATA,
            AES_IV
        );

        return $decrypted ?: '';
    }

    /**
     * Decrypt AltBash + AES encrypted data
     */
    private function altbashAesDecrypt($encryptedData)
    {
        if (empty($encryptedData)) return '';

        // First decrypt AES
        $altbashEncrypted = $this->aesDecrypt($encryptedData);
        if (empty($altbashEncrypted)) return '';

        // Then decrypt AltBash
        return $this->altbashDecrypt($altbashEncrypted);
    }

    /**
     * Decrypt Alphabet-Bashing encrypted data
     */
    private function altbashDecrypt($encryptedData)
    {
        if (empty($encryptedData)) return '';

        $data = base64_decode($encryptedData);
        $reversed = strrev($data);
        $key = mb_convert_encoding(XOR_KEY, 'UTF-8');

        $xorDecrypted = '';
        $dataLen = strlen($reversed);
        $keyLen = mb_strlen($key, 'UTF-8');

        for ($i = 0; $i < $dataLen; $i++) {
            $dataChar = $reversed[$i];
            $keyChar = mb_substr($key, $i % $keyLen, 1, 'UTF-8');

            $dataAscii = ord($dataChar);
            $keyAscii = ord($keyChar);
            $xorAscii = $dataAscii ^ $keyAscii;

            $xorDecrypted .= chr($xorAscii);
        }

        $decrypted = '';
        $dataLen = strlen($xorDecrypted);

        for ($i = 0; $i < $dataLen; $i++) {
            $char = $xorDecrypted[$i];
            $ascii = ord($char);
            $shiftedAscii = ($ascii - 3 + 256) % 256;
            $decrypted .= chr($shiftedAscii);
        }

        return $decrypted;
    }

    /**
     * Decrypt PDF file that was encrypted with Caesar + AES
     */
    private function decryptPdfFile($encryptedContent)
    {
        try {
            // Step 1: AES decryption
            $aesDecrypted = $this->aesDecryptBinary($encryptedContent);
            if ($aesDecrypted === false) {
                throw new Exception("AES decryption failed");
            }

            // Step 2: Caesar Cipher decryption (shift of 5)
            $decrypted = $this->caesarCipherDecrypt($aesDecrypted, 5);

            return $decrypted;
        } catch (Exception $e) {
            $this->logMessage("ERROR in decryptPdfFile: " . $e->getMessage());
            return false;
        }
    }

    /**
     * AES decryption for binary data
     */
    private function aesDecryptBinary($data)
    {
        if (empty($data)) {
            return false;
        }

        $decrypted = openssl_decrypt(
            $data,
            'AES-256-CBC',
            AES_KEY,
            OPENSSL_RAW_DATA,
            AES_IV
        );

        return $decrypted;
    }

    /**
     * Caesar Cipher decryption for binary data
     */
    private function caesarCipherDecrypt($data, $shift)
    {
        $decrypted = '';
        $length = strlen($data);
        
        for ($i = 0; $i < $length; $i++) {
            $byte = ord($data[$i]);
            // Apply Caesar shift (mod 256 for bytes)
            $decryptedByte = ($byte - $shift + 256) % 256;
            $decrypted .= chr($decryptedByte);
        }
        
        return $decrypted;
    }

    /**
     *  FIXED: Extract hidden message from steganographed image menggunakan algoritma yang sama dengan test
     */
    private function extractMessageFromImage($imagePath)
    {
        try {
            $this->logMessage("=== EXTRACTING MESSAGE FROM IMAGE (FIXED ALGORITHM) ===");
            
            if (!file_exists($imagePath)) {
                throw new Exception("Image file not found: " . $imagePath);
            }

            $imageInfo = getimagesize($imagePath);
            if ($imageInfo === false) {
                throw new Exception("Cannot get image information");
            }

            $width = $imageInfo[0];
            $height = $imageInfo[1];
            $imageType = $imageInfo[2];
            
            $this->logMessage("Image dimensions: {$width}x{$height}, Type: {$imageType}");

            // Load image - support WebP dan format lainnya
            $image = null;
            switch ($imageType) {
                case IMAGETYPE_JPEG:
                    $image = imagecreatefromjpeg($imagePath);
                    $this->logMessage("Loaded as JPEG");
                    break;
                case IMAGETYPE_PNG:
                    $image = imagecreatefrompng($imagePath);
                    $this->logMessage("Loaded as PNG");
                    break;
                case IMAGETYPE_GIF:
                    $image = imagecreatefromgif($imagePath);
                    $this->logMessage("Loaded as GIF");
                    break;
                case 18: // IMAGETYPE_WEBP
                    if (function_exists('imagecreatefromwebp')) {
                        $image = imagecreatefromwebp($imagePath);
                        $this->logMessage("Loaded as WEBP");
                    } else {
                        throw new Exception("WebP not supported on this server");
                    }
                    break;
                default:
                    throw new Exception("Unsupported image type: " . $imageType);
            }

            if (!$image) {
                throw new Exception("Cannot create image from source");
            }

            //  FIXED: Extract header menggunakan algoritma yang sama dengan embedding
            $headerBits = '';
            $bitsExtracted = 0;
            $headerSize = 32;

            $this->logMessage("Extracting header...");
            for ($y = 0; $y < $height; $y++) {
                for ($x = 0; $x < $width; $x++) {
                    if ($bitsExtracted >= $headerSize) break 2;
                    
                    $rgb = imagecolorat($image, $x, $y);
                    $r = ($rgb >> 16) & 0xFF;
                    $g = ($rgb >> 8) & 0xFF;
                    $b = $rgb & 0xFF;

                    // Extract dari LSB - URUTAN SAMA dengan enkripsi
                    $headerBits .= $r & 1;
                    $bitsExtracted++;
                    if ($bitsExtracted >= $headerSize) break;
                    
                    $headerBits .= $g & 1;
                    $bitsExtracted++;
                    if ($bitsExtracted >= $headerSize) break;
                    
                    $headerBits .= $b & 1;
                    $bitsExtracted++;
                    if ($bitsExtracted >= $headerSize) break;
                }
            }

            $this->logMessage("Header bits extracted: " . $bitsExtracted);

            // Convert header bits to message length
            $messageLength = 0;
            for ($i = 0; $i < 32; $i += 8) {
                $byte = bindec(substr($headerBits, $i, 8));
                $messageLength = ($messageLength << 8) | $byte;
            }

            $this->logMessage("Message length from header: " . $messageLength);

            if ($messageLength <= 0 || $messageLength > 100000) {
                $this->logMessage("No valid message found (invalid length: $messageLength)");
                imagedestroy($image);
                return false;
            }

            //  FIXED: Extract encrypted message dengan algoritma yang DIPERBAIKI
            $encryptedBits = '';
            $bitsNeeded = $messageLength * 8;
            $bitsExtracted = 0;

            $this->logMessage("Extracting message data ($bitsNeeded bits needed)...");
            
            //  PERBAIKAN: Gunakan counter bit GLOBAL, bukan skip per pixel
            $globalBitCounter = 0;
            
            for ($y = 0; $y < $height; $y++) {
                for ($x = 0; $x < $width; $x++) {
                    $rgb = imagecolorat($image, $x, $y);
                    $r = ($rgb >> 16) & 0xFF;
                    $g = ($rgb >> 8) & 0xFF;
                    $b = $rgb & 0xFF;

                    // Process each channel
                    $channels = [$r, $g, $b];
                    
                    foreach ($channels as $channel) {
                        // Skip bits yang sudah digunakan untuk header
                        if ($globalBitCounter < 32) {
                            $globalBitCounter++;
                            continue;
                        }

                        // Extract message bits setelah header
                        if ($bitsExtracted < $bitsNeeded) {
                            $encryptedBits .= $channel & 1;
                            $bitsExtracted++;
                            $globalBitCounter++;
                        } else {
                            break 3; // Keluar dari semua loop
                        }
                    }
                }
            }

            $this->logMessage("Message bits extracted: " . $bitsExtracted);
            $this->logMessage("Total bits processed: " . $globalBitCounter);

            if ($bitsExtracted < $bitsNeeded) {
                $this->logMessage("ERROR: Not enough bits extracted. Needed: $bitsNeeded, Got: $bitsExtracted");
                imagedestroy($image);
                return false;
            }

            // Convert bits to bytes
            $encryptedMessage = '';
            for ($i = 0; $i < $bitsNeeded; $i += 8) {
                $byteBits = substr($encryptedBits, $i, 8);
                if (strlen($byteBits) < 8) {
                    $this->logMessage("ERROR: Incomplete byte at position $i");
                    break;
                }
                $byte = bindec($byteBits);
                $encryptedMessage .= chr($byte);
            }

            $this->logMessage("Encrypted message length: " . strlen($encryptedMessage) . " bytes");

            //  FIXED: DECRYPTION dengan error handling yang lebih baik
            $this->logMessage("Attempting AES decryption...");
            
            $decrypted = openssl_decrypt(
                $encryptedMessage,
                'AES-256-CBC',
                AES_KEY,
                OPENSSL_RAW_DATA,
                AES_IV
            );

            if ($decrypted === false) {
                $error = openssl_error_string();
                $this->logMessage("AES decryption failed: " . $error);
                
                // Coba alternatif: handle padding manual
                $decrypted = $this->decryptWithPaddingHandling($encryptedMessage);
                if ($decrypted === false) {
                    $this->logMessage("Alternative decryption also failed");
                    imagedestroy($image);
                    return false;
                }
            }

            // Remove PKCS7 padding
            $originalMessage = $this->pkcs7Unpad($decrypted);
            
            if ($originalMessage === false) {
                $this->logMessage("Padding removal failed, using raw decrypted data");
                $originalMessage = $decrypted;
            }
            
            $this->logMessage(" Decryption successful");
            
            imagedestroy($image);
            
            return $originalMessage;

        } catch (Exception $e) {
            $this->logMessage("ERROR in extractMessageFromImage: " . $e->getMessage());
            if (isset($image)) {
                imagedestroy($image);
            }
            return false;
        }
    }

    /**
     * Alternative decryption dengan padding handling
     */
    private function decryptWithPaddingHandling($encryptedMessage)
    {
        $this->logMessage("Trying alternative decryption with padding handling...");
        
        // Coba tanpa OPENSSL_RAW_DATA dulu
        $decrypted = openssl_decrypt(
            $encryptedMessage,
            'AES-256-CBC',
            AES_KEY,
            0, // Bukan raw data
            AES_IV
        );

        if ($decrypted === false) {
            // Coba dengan zero padding
            $decrypted = openssl_decrypt(
                $encryptedMessage,
                'AES-256-CBC',
                AES_KEY,
                OPENSSL_ZERO_PADDING,
                AES_IV
            );
        }

        return $decrypted;
    }

    /**
     * PKCS7 Unpadding dengan error handling
     */
    private function pkcs7Unpad($data)
    {
        if (empty($data)) return '';
        
        $dataLength = strlen($data);
        if ($dataLength == 0) return '';
        
        $padding = ord($data[$dataLength - 1]);
        
        // Validasi padding
        if ($padding > 16 || $padding == 0 || $padding > $dataLength) {
            return $data; // Return data as-is jika padding invalid
        }
        
        // Check semua byte padding
        for ($i = 0; $i < $padding; $i++) {
            if (ord($data[$dataLength - $i - 1]) != $padding) {
                return $data; // Return data as-is jika padding tidak konsisten
            }
        }
        
        return substr($data, 0, -$padding);
    }

    /**
     * New endpoint untuk download decrypted PDF
     */
    private function downloadDecryptedPdf()
    {
        try {
            $patientId = intval($_GET['patient_id'] ?? 0);

            if ($patientId <= 0) {
                throw new Exception("Patient ID tidak valid");
            }

            // Get patient data including PDF filename
            $query = "SELECT dokumen_pdf FROM pasien WHERE id_pasien = ?";
            $stmt = $this->conn->prepare($query);
            $stmt->bind_param("i", $patientId);
            $stmt->execute();
            $result = $stmt->get_result();

            if ($result->num_rows === 0) {
                throw new Exception("Data pasien tidak ditemukan");
            }

            $patient = $result->fetch_assoc();
            $encryptedPdfFilename = $patient['dokumen_pdf'];

            if (empty($encryptedPdfFilename)) {
                throw new Exception("Tidak ada dokumen PDF untuk pasien ini");
            }

            // Find the encrypted PDF file
            $possiblePaths = [
                __DIR__ . '/../../uploads/pdfs/' . $encryptedPdfFilename,
                __DIR__ . '/../uploads/pdfs/' . $encryptedPdfFilename,
                $_SERVER['DOCUMENT_ROOT'] . '/uploads/pdfs/' . $encryptedPdfFilename,
            ];

            $pdfPath = null;
            foreach ($possiblePaths as $path) {
                if (file_exists($path)) {
                    $pdfPath = $path;
                    break;
                }
            }

            if ($pdfPath === null) {
                throw new Exception("File PDF tidak ditemukan");
            }

            // Read encrypted file
            $encryptedContent = file_get_contents($pdfPath);
            if ($encryptedContent === false) {
                throw new Exception("Tidak dapat membaca file PDF");
            }

            // Decrypt PDF
            $decryptedContent = $this->decryptPdfFile($encryptedContent);
            if ($decryptedContent === false) {
                throw new Exception("Gagal mendekripsi PDF");
            }

            // Set headers for download
            header('Content-Type: application/pdf');
            header('Content-Disposition: attachment; filename="decrypted_patient_' . $patientId . '.pdf"');
            header('Content-Length: ' . strlen($decryptedContent));

            echo $decryptedContent;
            exit;

        } catch (Exception $e) {
            $this->sendError("Error downloading PDF: " . $e->getMessage());
        }
    }

    /**
     *  NEW: Endpoint khusus untuk ekstraksi steganografi
     */
    private function extractSteganographyMessage()
    {
        try {
            $patientId = intval($_GET['patient_id'] ?? $_POST['patient_id'] ?? 0);

            if ($patientId <= 0) {
                throw new Exception("Patient ID tidak valid");
            }

            $query = "SELECT foto_pasien FROM pasien WHERE id_pasien = ?";
            $stmt = $this->conn->prepare($query);
            $stmt->bind_param("i", $patientId);
            $stmt->execute();
            $result = $stmt->get_result();

            if ($result->num_rows === 0) {
                throw new Exception("Data pasien tidak ditemukan");
            }

            $patient = $result->fetch_assoc();
            $imageFilename = $patient['foto_pasien'];

            if (empty($imageFilename)) {
                throw new Exception("Tidak ada gambar untuk pasien ini");
            }

            // Find the image file
            $possiblePaths = [
                __DIR__ . '/../../uploads/images/' . $imageFilename,
                __DIR__ . '/../uploads/images/' . $imageFilename,
                $_SERVER['DOCUMENT_ROOT'] . '/uploads/images/' . $imageFilename,
            ];

            $imagePath = null;
            foreach ($possiblePaths as $path) {
                if (file_exists($path)) {
                    $imagePath = $path;
                    break;
                }
            }

            if ($imagePath === null) {
                throw new Exception("File gambar tidak ditemukan");
            }

            // Extract message menggunakan algoritma yang sudah diperbaiki
            $message = $this->extractMessageFromImage($imagePath);

            if ($message === false) {
                throw new Exception("Tidak dapat mengekstrak pesan dari gambar");
            }

            $this->sendSuccess([
                'message' => $message,
                'patient_id' => $patientId,
                'image_file' => $imageFilename
            ], "Pesan berhasil diekstrak dari gambar");

        } catch (Exception $e) {
            $this->sendError("Error extracting steganography: " . $e->getMessage());
        }
    }

    // ==================== DATA RETRIEVAL METHODS ====================

    private function getDashboardStats()
    {
        try {
            // Total patients
            $totalQuery = "SELECT COUNT(*) as total_pasien FROM pasien";
            $totalResult = $this->conn->query($totalQuery);
            $total = $totalResult->fetch_assoc();

            // Rawat inap count
            $inapQuery = "SELECT COUNT(*) as rawat_inap FROM pasien WHERE informasi_medis = 'rawat-inap'";
            $inapResult = $this->conn->query($inapQuery);
            $inap = $inapResult->fetch_assoc();

            // Rawat jalan count
            $jalanQuery = "SELECT COUNT(*) as rawat_jalan FROM pasien WHERE informasi_medis = 'rawat-jalan'";
            $jalanResult = $this->conn->query($jalanQuery);
            $jalan = $jalanResult->fetch_assoc();

            // Pemeriksaan count
            $pemeriksaanQuery = "SELECT COUNT(*) as pemeriksaan FROM pasien WHERE informasi_medis = 'pemeriksaan'";
            $pemeriksaanResult = $this->conn->query($pemeriksaanQuery);
            $pemeriksaan = $pemeriksaanResult->fetch_assoc();

            // Total payment
            $paymentQuery = "SELECT COALESCE(SUM(jumlah_pembayaran), 0) as total_pembayaran FROM pasien";
            $paymentResult = $this->conn->query($paymentQuery);
            $payment = $paymentResult->fetch_assoc();

            // New patients (last 7 days)
            $newQuery = "SELECT COUNT(*) as pasien_baru FROM pasien WHERE created_at >= DATE_SUB(NOW(), INTERVAL 7 DAY)";
            $newResult = $this->conn->query($newQuery);
            $new = $newResult->fetch_assoc();

            $stats = [
                'total_pasien' => (int)$total['total_pasien'],
                'rawat_inap' => (int)$inap['rawat_inap'],
                'rawat_jalan' => (int)$jalan['rawat_jalan'],
                'pemeriksaan' => (int)$pemeriksaan['pemeriksaan'],
                'total_pembayaran' => (float)$payment['total_pembayaran'],
                'pasien_baru' => (int)$new['pasien_baru']
            ];

            $this->sendSuccess($stats, "Stats loaded successfully");

        } catch (Exception $e) {
            $this->sendError("Error loading stats: " . $e->getMessage());
        }
    }

    private function getRecentPatients()
    {
        try {
            $query = "SELECT * FROM pasien ORDER BY created_at DESC LIMIT 5";
            $result = $this->conn->query($query);

            $patients = [];
            while ($row = $result->fetch_assoc()) {
                // Decrypt the data
                $row['nama_lengkap'] = $this->xorDecrypt($row['nama_lengkap'], XOR_KEY);
                $row['alamat_lengkap'] = $this->xorDecrypt($row['alamat_lengkap'], XOR_KEY);
                $row['hasil_pemeriksaan'] = $this->altbashAesDecrypt($row['hasil_pemeriksaan']);
                
                $patients[] = $row;
            }

            $this->sendSuccess($patients, "Recent patients loaded");

        } catch (Exception $e) {
            $this->sendError("Error loading recent patients: " . $e->getMessage());
        }
    }

    private function getPatientsList()
    {
        try {
            $page = intval($_GET['page'] ?? 1);
            $limit = intval($_GET['limit'] ?? 10);
            $search = $_GET['search'] ?? '';
            $status = $_GET['status'] ?? '';
            $service = $_GET['service'] ?? '';

            $offset = ($page - 1) * $limit;

            // Build WHERE conditions
            $whereConditions = [];
            $params = [];
            $types = '';

            if (!empty($search)) {
                $whereConditions[] = "(nama_lengkap LIKE ? OR alamat_lengkap LIKE ?)";
                $searchTerm = "%$search%";
                $params[] = $searchTerm;
                $params[] = $searchTerm;
                $types .= 'ss';
            }

            if (!empty($status)) {
                $whereConditions[] = "status_pasien = ?";
                $params[] = $status;
                $types .= 's';
            }

            if (!empty($service)) {
                $whereConditions[] = "informasi_medis = ?";
                $params[] = $service;
                $types .= 's';
            }

            $whereClause = '';
            if (!empty($whereConditions)) {
                $whereClause = "WHERE " . implode(" AND ", $whereConditions);
            }

            // Count total records
            $countQuery = "SELECT COUNT(*) as total FROM pasien $whereClause";
            $countStmt = $this->conn->prepare($countQuery);
            
            if (!empty($params)) {
                $countStmt->bind_param($types, ...$params);
            }
            
            $countStmt->execute();
            $countResult = $countStmt->get_result();
            $totalCount = $countResult->fetch_assoc()['total'];
            $totalPages = ceil($totalCount / $limit);

            $dataQuery = "SELECT * FROM pasien $whereClause ORDER BY created_at DESC, id_pasien DESC LIMIT ? OFFSET ?";
            $dataStmt = $this->conn->prepare($dataQuery);
            
            $params[] = $limit;
            $params[] = $offset;
            $types .= 'ii';

            if (!empty($params)) {
                $dataStmt->bind_param($types, ...$params);
            }
            
            $dataStmt->execute();
            $result = $dataStmt->get_result();

            $patients = [];
            while ($row = $result->fetch_assoc()) {
                // Decrypt the data for display
                $row['nama_lengkap'] = $this->xorDecrypt($row['nama_lengkap'], XOR_KEY);
                $row['alamat_lengkap'] = $this->xorDecrypt($row['alamat_lengkap'], XOR_KEY);
                $row['hasil_pemeriksaan'] = $this->altbashAesDecrypt($row['hasil_pemeriksaan']);
                
                $patients[] = $row;
            }

            $response = [
                'patients' => $patients,
                'total_pages' => $totalPages,
                'current_page' => $page,
                'total_count' => $totalCount
            ];

            $this->sendSuccess($response, "Patients list loaded");

        } catch (Exception $e) {
            $this->sendError("Error loading patients list: " . $e->getMessage());
        }
    }

    private function getPatientDetail()
    {
        try {
            $patientId = intval($_GET['patient_id'] ?? $_POST['patient_id'] ?? 0);

            if ($patientId <= 0) {
                throw new Exception("Patient ID tidak valid");
            }

            $query = "SELECT * FROM pasien WHERE id_pasien = ?";
            $stmt = $this->conn->prepare($query);
            $stmt->bind_param("i", $patientId);
            $stmt->execute();
            $result = $stmt->get_result();

            if ($result->num_rows === 0) {
                throw new Exception("Data pasien tidak ditemukan");
            }

            $patient = $result->fetch_assoc();

            // Decrypt all encrypted data
            $patient['nama_lengkap'] = $this->xorDecrypt($patient['nama_lengkap'], XOR_KEY);
            $patient['alamat_lengkap'] = $this->xorDecrypt($patient['alamat_lengkap'], XOR_KEY);
            $patient['hasil_pemeriksaan'] = $this->altbashAesDecrypt($patient['hasil_pemeriksaan']);

            //  FIXED: Extract medical message from image menggunakan algoritma yang sudah diperbaiki
            $medicalMessage = '';
            if (!empty($patient['foto_pasien'])) {
                $possiblePaths = [
                    __DIR__ . '/../../uploads/images/' . $patient['foto_pasien'],
                    __DIR__ . '/../uploads/images/' . $patient['foto_pasien'],
                    $_SERVER['DOCUMENT_ROOT'] . '/uploads/images/' . $patient['foto_pasien'],
                ];

                $imagePath = null;
                foreach ($possiblePaths as $path) {
                    if (file_exists($path)) {
                        $imagePath = $path;
                        break;
                    }
                }

                if ($imagePath !== null) {
                    $medicalMessage = $this->extractMessageFromImage($imagePath);
                    if ($medicalMessage === false) {
                        $medicalMessage = ''; // Jika ekstraksi gagal, set kosong
                    }
                }
            }
            $patient['medical_message'] = $medicalMessage;

            $this->sendSuccess($patient, "Patient detail loaded");

        } catch (Exception $e) {
            $this->sendError("Error loading patient detail: " . $e->getMessage());
        }
    }

    private function updatePatient()
    {
        try {
            $patientId = intval($_POST['patient_id'] ?? 0);
            
            if ($patientId <= 0) {
                throw new Exception("Patient ID tidak valid");
            }

            // Get form data
            $nama_pasien = $this->sanitizeInput($_POST['nama_pasien']);
            $tanggal_lahir = $_POST['tanggal_lahir'];
            $alamat = $this->sanitizeInput($_POST['alamat']);
            $jenis_layanan = $this->sanitizeInput($_POST['jenis_layanan']);
            $status_pasien = $this->sanitizeInput($_POST['status_pasien']);
            $hasil_pemeriksaan = $this->sanitizeInput($_POST['hasil_pemeriksaan']);
            $jumlah_pembayaran = floatval($_POST['jumlah_pembayaran']);

            // Encrypt data before updating
            $encrypted_nama = $this->xorEncrypt($nama_pasien, XOR_KEY);
            $encrypted_alamat = $this->xorEncrypt($alamat, XOR_KEY);
            $encrypted_hasil = $this->altbashAesEncrypt($hasil_pemeriksaan);

            $query = "UPDATE pasien SET 
                nama_lengkap = ?, 
                tanggal_lahir = ?, 
                alamat_lengkap = ?, 
                informasi_medis = ?, 
                status_pasien = ?, 
                hasil_pemeriksaan = ?, 
                jumlah_pembayaran = ?,
                updated_at = NOW()
                WHERE id_pasien = ?";

            $stmt = $this->conn->prepare($query);
            $stmt->bind_param(
                "ssssssdi",
                $encrypted_nama,
                $tanggal_lahir,
                $encrypted_alamat,
                $jenis_layanan,
                $status_pasien,
                $encrypted_hasil,
                $jumlah_pembayaran,
                $patientId
            );

            if ($stmt->execute()) {
                $this->sendSuccess([], "Data pasien berhasil diperbarui");
            } else {
                throw new Exception("Gagal memperbarui data: " . $stmt->error);
            }

        } catch (Exception $e) {
            $this->sendError("Error updating patient: " . $e->getMessage());
        }
    }

    private function deletePatient()
    {
        try {
            $patientId = intval($_POST['patient_id'] ?? 0);

            if ($patientId <= 0) {
                throw new Exception("Patient ID tidak valid");
            }

            $query = "DELETE FROM pasien WHERE id_pasien = ?";
            $stmt = $this->conn->prepare($query);
            $stmt->bind_param("i", $patientId);

            if ($stmt->execute()) {
                $this->sendSuccess([], "Data pasien berhasil dihapus");
            } else {
                throw new Exception("Gagal menghapus data: " . $stmt->error);
            }

        } catch (Exception $e) {
            $this->sendError("Error deleting patient: " . $e->getMessage());
        }
    }

    // ==================== ENCRYPTION METHODS (for update) ====================

    private function xorEncrypt($data, $key)
    {
        if (empty($data)) return '';

        $data = mb_convert_encoding($data, 'UTF-8');
        $key = mb_convert_encoding($key, 'UTF-8');

        $encrypted = '';
        $dataLen = mb_strlen($data, 'UTF-8');
        $keyLen = mb_strlen($key, 'UTF-8');

        for ($i = 0; $i < $dataLen; $i++) {
            $dataChar = mb_substr($data, $i, 1, 'UTF-8');
            $keyChar = mb_substr($key, $i % $keyLen, 1, 'UTF-8');

            $dataAscii = ord($dataChar);
            $keyAscii = ord($keyChar);
            $encryptedAscii = $dataAscii ^ $keyAscii;

            $encrypted .= chr($encryptedAscii);
        }

        return base64_encode($encrypted);
    }

    private function altbashAesEncrypt($data)
    {
        if (empty($data)) return '';

        $altbash_encrypted = $this->altbashEncrypt($data);
        $aes_encrypted = $this->aesEncrypt($altbash_encrypted);

        return $aes_encrypted;
    }

    private function altbashEncrypt($data)
    {
        if (empty($data)) return '';

        $data = mb_convert_encoding($data, 'UTF-8');
        $key = mb_convert_encoding(XOR_KEY, 'UTF-8');

        $encrypted = '';
        $dataLen = mb_strlen($data, 'UTF-8');
        $keyLen = mb_strlen($key, 'UTF-8');

        for ($i = 0; $i < $dataLen; $i++) {
            $char = mb_substr($data, $i, 1, 'UTF-8');
            $ascii = ord($char);
            $shifted_ascii = ($ascii + 3) % 256;
            $encrypted .= chr($shifted_ascii);
        }

        $xor_encrypted = '';
        for ($i = 0; $i < $dataLen; $i++) {
            $dataChar = $encrypted[$i];
            $keyChar = mb_substr($key, $i % $keyLen, 1, 'UTF-8');

            $dataAscii = ord($dataChar);
            $keyAscii = ord($keyChar);
            $xorAscii = $dataAscii ^ $keyAscii;

            $xor_encrypted .= chr($xorAscii);
        }

        $reversed = strrev($xor_encrypted);
        return base64_encode($reversed);
    }

    private function aesEncrypt($data)
    {
        if (empty($data)) return '';

        $encrypted = openssl_encrypt(
            $data,
            'AES-256-CBC',
            AES_KEY,
            OPENSSL_RAW_DATA,
            AES_IV
        );

        return base64_encode($encrypted);
    }

    // ==================== UTILITY METHODS ====================

    private function logMessage($message)
    {
        $timestamp = date('Y-m-d H:i:s');
        $logMessage = "[$timestamp] $message\n";
        error_log($logMessage, 3, __DIR__ . '/dashboard_errors.log');
    }

    private function sanitizeInput($data)
    {
        if ($this->conn) {
            return $this->conn->real_escape_string(trim($data));
        }
        return trim($data);
    }

    private function sendSuccess($data, $message = "")
    {
        echo json_encode([
            'success' => true,
            'message' => $message,
            'data' => $data
        ], JSON_UNESCAPED_UNICODE);
        exit;
    }

    private function sendError($message, $code = 400)
    {
        http_response_code($code);
        echo json_encode([
            'success' => false,
            'error' => $message
        ], JSON_UNESCAPED_UNICODE);
        exit;
    }

    public function __destruct()
    {
        if ($this->conn) {
            $this->conn->close();
        }
    }
}

// Handle the request
$handler = new DashboardView();
$handler->handleRequest();
?>
    [jenisLayanan] => rawat-inap
    [statusPasien] => dalam perawatan
    [hasilPemeriksaan] => <?php

ini_set('display_errors', 1);
ini_set('display_startup_errors', 1);
error_reporting(E_ALL);
ini_set('log_errors', 1);
ini_set('error_log', __DIR__ . '/dashboard_errors.log');

header('Content-Type: application/json; charset=utf-8');
header('Access-Control-Allow-Origin: *');
header('Access-Control-Allow-Methods: GET, POST, OPTIONS');
header('Access-Control-Allow-Headers: Content-Type');

// Database configuration
define('DB_HOST', 'localhost');
define('DB_USER', 'root');
define('DB_PASS', '');
define('DB_NAME', 'kriptoproject');

// Encryption keys (SAMA dengan yang di upload.php)
define('XOR_KEY', 'medicare_secret_key_2024');
define('AES_KEY', 'medicare_aes_key_2024_32bytes_long!');
define('AES_IV', '1234567890123456');

class DashboardView
{
    private $conn;

    public function __construct()
    {
        $this->connectDB();
    }

    private function connectDB()
    {
        try {
            $this->conn = new mysqli(DB_HOST, DB_USER, DB_PASS, DB_NAME);

            if ($this->conn->connect_error) {
                throw new Exception("Koneksi database gagal: " . $this->conn->connect_error);
            }

            $this->conn->set_charset("utf8mb4");
        } catch (Exception $e) {
            $this->sendError($e->getMessage());
        }
    }

    public function handleRequest()
    {
        $action = $_GET['action'] ?? $_POST['action'] ?? '';

        switch ($action) {
            case 'get_stats':
                $this->getDashboardStats();
                break;
            case 'get_recent_patients':
                $this->getRecentPatients();
                break;
            case 'get_patients':
                $this->getPatientsList();
                break;
            case 'get_patient_detail':
                $this->getPatientDetail();
                break;
            case 'update_patient':
                $this->updatePatient();
                break;
            case 'delete_patient':
                $this->deletePatient();
                break;
            case 'download_decrypted_pdf':
                $this->downloadDecryptedPdf();
                break;
            case 'extract_steganography': // NEW ACTION untuk ekstraksi steganografi
                $this->extractSteganographyMessage();
                break;
            default:
                $this->sendError('Action tidak valid');
        }
    }

    // ==================== IMPROVED DECRYPTION METHODS ====================

    /**
     * Decrypt XOR encrypted data
     */
    private function xorDecrypt($encryptedData, $key)
    {
        if (empty($encryptedData)) return '';

        $data = base64_decode($encryptedData);
        $key = mb_convert_encoding($key, 'UTF-8');

        $decrypted = '';
        $dataLen = strlen($data);
        $keyLen = mb_strlen($key, 'UTF-8');

        for ($i = 0; $i < $dataLen; $i++) {
            $dataChar = $data[$i];
            $keyChar = mb_substr($key, $i % $keyLen, 1, 'UTF-8');

            $dataAscii = ord($dataChar);
            $keyAscii = ord($keyChar);
            $decryptedAscii = $dataAscii ^ $keyAscii;

            $decrypted .= chr($decryptedAscii);
        }

        return $decrypted;
    }

    /**
     * Decrypt AES encrypted data
     */
    private function aesDecrypt($encryptedData)
    {
        if (empty($encryptedData)) return '';

        $encrypted = base64_decode($encryptedData);
        
        $decrypted = openssl_decrypt(
            $encrypted,
            'AES-256-CBC',
            AES_KEY,
            OPENSSL_RAW_DATA,
            AES_IV
        );

        return $decrypted ?: '';
    }

    /**
     * Decrypt AltBash + AES encrypted data
     */
    private function altbashAesDecrypt($encryptedData)
    {
        if (empty($encryptedData)) return '';

        // First decrypt AES
        $altbashEncrypted = $this->aesDecrypt($encryptedData);
        if (empty($altbashEncrypted)) return '';

        // Then decrypt AltBash
        return $this->altbashDecrypt($altbashEncrypted);
    }

    /**
     * Decrypt Alphabet-Bashing encrypted data
     */
    private function altbashDecrypt($encryptedData)
    {
        if (empty($encryptedData)) return '';

        $data = base64_decode($encryptedData);
        $reversed = strrev($data);
        $key = mb_convert_encoding(XOR_KEY, 'UTF-8');

        $xorDecrypted = '';
        $dataLen = strlen($reversed);
        $keyLen = mb_strlen($key, 'UTF-8');

        for ($i = 0; $i < $dataLen; $i++) {
            $dataChar = $reversed[$i];
            $keyChar = mb_substr($key, $i % $keyLen, 1, 'UTF-8');

            $dataAscii = ord($dataChar);
            $keyAscii = ord($keyChar);
            $xorAscii = $dataAscii ^ $keyAscii;

            $xorDecrypted .= chr($xorAscii);
        }

        $decrypted = '';
        $dataLen = strlen($xorDecrypted);

        for ($i = 0; $i < $dataLen; $i++) {
            $char = $xorDecrypted[$i];
            $ascii = ord($char);
            $shiftedAscii = ($ascii - 3 + 256) % 256;
            $decrypted .= chr($shiftedAscii);
        }

        return $decrypted;
    }

    /**
     * Decrypt PDF file that was encrypted with Caesar + AES
     */
    private function decryptPdfFile($encryptedContent)
    {
        try {
            // Step 1: AES decryption
            $aesDecrypted = $this->aesDecryptBinary($encryptedContent);
            if ($aesDecrypted === false) {
                throw new Exception("AES decryption failed");
            }

            // Step 2: Caesar Cipher decryption (shift of 5)
            $decrypted = $this->caesarCipherDecrypt($aesDecrypted, 5);

            return $decrypted;
        } catch (Exception $e) {
            $this->logMessage("ERROR in decryptPdfFile: " . $e->getMessage());
            return false;
        }
    }

    /**
     * AES decryption for binary data
     */
    private function aesDecryptBinary($data)
    {
        if (empty($data)) {
            return false;
        }

        $decrypted = openssl_decrypt(
            $data,
            'AES-256-CBC',
            AES_KEY,
            OPENSSL_RAW_DATA,
            AES_IV
        );

        return $decrypted;
    }

    /**
     * Caesar Cipher decryption for binary data
     */
    private function caesarCipherDecrypt($data, $shift)
    {
        $decrypted = '';
        $length = strlen($data);
        
        for ($i = 0; $i < $length; $i++) {
            $byte = ord($data[$i]);
            // Apply Caesar shift (mod 256 for bytes)
            $decryptedByte = ($byte - $shift + 256) % 256;
            $decrypted .= chr($decryptedByte);
        }
        
        return $decrypted;
    }

    /**
     *  FIXED: Extract hidden message from steganographed image menggunakan algoritma yang sama dengan test
     */
    private function extractMessageFromImage($imagePath)
    {
        try {
            $this->logMessage("=== EXTRACTING MESSAGE FROM IMAGE (FIXED ALGORITHM) ===");
            
            if (!file_exists($imagePath)) {
                throw new Exception("Image file not found: " . $imagePath);
            }

            $imageInfo = getimagesize($imagePath);
            if ($imageInfo === false) {
                throw new Exception("Cannot get image information");
            }

            $width = $imageInfo[0];
            $height = $imageInfo[1];
            $imageType = $imageInfo[2];
            
            $this->logMessage("Image dimensions: {$width}x{$height}, Type: {$imageType}");

            // Load image - support WebP dan format lainnya
            $image = null;
            switch ($imageType) {
                case IMAGETYPE_JPEG:
                    $image = imagecreatefromjpeg($imagePath);
                    $this->logMessage("Loaded as JPEG");
                    break;
                case IMAGETYPE_PNG:
                    $image = imagecreatefrompng($imagePath);
                    $this->logMessage("Loaded as PNG");
                    break;
                case IMAGETYPE_GIF:
                    $image = imagecreatefromgif($imagePath);
                    $this->logMessage("Loaded as GIF");
                    break;
                case 18: // IMAGETYPE_WEBP
                    if (function_exists('imagecreatefromwebp')) {
                        $image = imagecreatefromwebp($imagePath);
                        $this->logMessage("Loaded as WEBP");
                    } else {
                        throw new Exception("WebP not supported on this server");
                    }
                    break;
                default:
                    throw new Exception("Unsupported image type: " . $imageType);
            }

            if (!$image) {
                throw new Exception("Cannot create image from source");
            }

            //  FIXED: Extract header menggunakan algoritma yang sama dengan embedding
            $headerBits = '';
            $bitsExtracted = 0;
            $headerSize = 32;

            $this->logMessage("Extracting header...");
            for ($y = 0; $y < $height; $y++) {
                for ($x = 0; $x < $width; $x++) {
                    if ($bitsExtracted >= $headerSize) break 2;
                    
                    $rgb = imagecolorat($image, $x, $y);
                    $r = ($rgb >> 16) & 0xFF;
                    $g = ($rgb >> 8) & 0xFF;
                    $b = $rgb & 0xFF;

                    // Extract dari LSB - URUTAN SAMA dengan enkripsi
                    $headerBits .= $r & 1;
                    $bitsExtracted++;
                    if ($bitsExtracted >= $headerSize) break;
                    
                    $headerBits .= $g & 1;
                    $bitsExtracted++;
                    if ($bitsExtracted >= $headerSize) break;
                    
                    $headerBits .= $b & 1;
                    $bitsExtracted++;
                    if ($bitsExtracted >= $headerSize) break;
                }
            }

            $this->logMessage("Header bits extracted: " . $bitsExtracted);

            // Convert header bits to message length
            $messageLength = 0;
            for ($i = 0; $i < 32; $i += 8) {
                $byte = bindec(substr($headerBits, $i, 8));
                $messageLength = ($messageLength << 8) | $byte;
            }

            $this->logMessage("Message length from header: " . $messageLength);

            if ($messageLength <= 0 || $messageLength > 100000) {
                $this->logMessage("No valid message found (invalid length: $messageLength)");
                imagedestroy($image);
                return false;
            }

            //  FIXED: Extract encrypted message dengan algoritma yang DIPERBAIKI
            $encryptedBits = '';
            $bitsNeeded = $messageLength * 8;
            $bitsExtracted = 0;

            $this->logMessage("Extracting message data ($bitsNeeded bits needed)...");
            
            //  PERBAIKAN: Gunakan counter bit GLOBAL, bukan skip per pixel
            $globalBitCounter = 0;
            
            for ($y = 0; $y < $height; $y++) {
                for ($x = 0; $x < $width; $x++) {
                    $rgb = imagecolorat($image, $x, $y);
                    $r = ($rgb >> 16) & 0xFF;
                    $g = ($rgb >> 8) & 0xFF;
                    $b = $rgb & 0xFF;

                    // Process each channel
                    $channels = [$r, $g, $b];
                    
                    foreach ($channels as $channel) {
                        // Skip bits yang sudah digunakan untuk header
                        if ($globalBitCounter < 32) {
                            $globalBitCounter++;
                            continue;
                        }

                        // Extract message bits setelah header
                        if ($bitsExtracted < $bitsNeeded) {
                            $encryptedBits .= $channel & 1;
                            $bitsExtracted++;
                            $globalBitCounter++;
                        } else {
                            break 3; // Keluar dari semua loop
                        }
                    }
                }
            }

            $this->logMessage("Message bits extracted: " . $bitsExtracted);
            $this->logMessage("Total bits processed: " . $globalBitCounter);

            if ($bitsExtracted < $bitsNeeded) {
                $this->logMessage("ERROR: Not enough bits extracted. Needed: $bitsNeeded, Got: $bitsExtracted");
                imagedestroy($image);
                return false;
            }

            // Convert bits to bytes
            $encryptedMessage = '';
            for ($i = 0; $i < $bitsNeeded; $i += 8) {
                $byteBits = substr($encryptedBits, $i, 8);
                if (strlen($byteBits) < 8) {
                    $this->logMessage("ERROR: Incomplete byte at position $i");
                    break;
                }
                $byte = bindec($byteBits);
                $encryptedMessage .= chr($byte);
            }

            $this->logMessage("Encrypted message length: " . strlen($encryptedMessage) . " bytes");

            //  FIXED: DECRYPTION dengan error handling yang lebih baik
            $this->logMessage("Attempting AES decryption...");
            
            $decrypted = openssl_decrypt(
                $encryptedMessage,
                'AES-256-CBC',
                AES_KEY,
                OPENSSL_RAW_DATA,
                AES_IV
            );

            if ($decrypted === false) {
                $error = openssl_error_string();
                $this->logMessage("AES decryption failed: " . $error);
                
                // Coba alternatif: handle padding manual
                $decrypted = $this->decryptWithPaddingHandling($encryptedMessage);
                if ($decrypted === false) {
                    $this->logMessage("Alternative decryption also failed");
                    imagedestroy($image);
                    return false;
                }
            }

            // Remove PKCS7 padding
            $originalMessage = $this->pkcs7Unpad($decrypted);
            
            if ($originalMessage === false) {
                $this->logMessage("Padding removal failed, using raw decrypted data");
                $originalMessage = $decrypted;
            }
            
            $this->logMessage(" Decryption successful");
            
            imagedestroy($image);
            
            return $originalMessage;

        } catch (Exception $e) {
            $this->logMessage("ERROR in extractMessageFromImage: " . $e->getMessage());
            if (isset($image)) {
                imagedestroy($image);
            }
            return false;
        }
    }

    /**
     * Alternative decryption dengan padding handling
     */
    private function decryptWithPaddingHandling($encryptedMessage)
    {
        $this->logMessage("Trying alternative decryption with padding handling...");
        
        // Coba tanpa OPENSSL_RAW_DATA dulu
        $decrypted = openssl_decrypt(
            $encryptedMessage,
            'AES-256-CBC',
            AES_KEY,
            0, // Bukan raw data
            AES_IV
        );

        if ($decrypted === false) {
            // Coba dengan zero padding
            $decrypted = openssl_decrypt(
                $encryptedMessage,
                'AES-256-CBC',
                AES_KEY,
                OPENSSL_ZERO_PADDING,
                AES_IV
            );
        }

        return $decrypted;
    }

    /**
     * PKCS7 Unpadding dengan error handling
     */
    private function pkcs7Unpad($data)
    {
        if (empty($data)) return '';
        
        $dataLength = strlen($data);
        if ($dataLength == 0) return '';
        
        $padding = ord($data[$dataLength - 1]);
        
        // Validasi padding
        if ($padding > 16 || $padding == 0 || $padding > $dataLength) {
            return $data; // Return data as-is jika padding invalid
        }
        
        // Check semua byte padding
        for ($i = 0; $i < $padding; $i++) {
            if (ord($data[$dataLength - $i - 1]) != $padding) {
                return $data; // Return data as-is jika padding tidak konsisten
            }
        }
        
        return substr($data, 0, -$padding);
    }

    /**
     * New endpoint untuk download decrypted PDF
     */
    private function downloadDecryptedPdf()
    {
        try {
            $patientId = intval($_GET['patient_id'] ?? 0);

            if ($patientId <= 0) {
                throw new Exception("Patient ID tidak valid");
            }

            // Get patient data including PDF filename
            $query = "SELECT dokumen_pdf FROM pasien WHERE id_pasien = ?";
            $stmt = $this->conn->prepare($query);
            $stmt->bind_param("i", $patientId);
            $stmt->execute();
            $result = $stmt->get_result();

            if ($result->num_rows === 0) {
                throw new Exception("Data pasien tidak ditemukan");
            }

            $patient = $result->fetch_assoc();
            $encryptedPdfFilename = $patient['dokumen_pdf'];

            if (empty($encryptedPdfFilename)) {
                throw new Exception("Tidak ada dokumen PDF untuk pasien ini");
            }

            // Find the encrypted PDF file
            $possiblePaths = [
                __DIR__ . '/../../uploads/pdfs/' . $encryptedPdfFilename,
                __DIR__ . '/../uploads/pdfs/' . $encryptedPdfFilename,
                $_SERVER['DOCUMENT_ROOT'] . '/uploads/pdfs/' . $encryptedPdfFilename,
            ];

            $pdfPath = null;
            foreach ($possiblePaths as $path) {
                if (file_exists($path)) {
                    $pdfPath = $path;
                    break;
                }
            }

            if ($pdfPath === null) {
                throw new Exception("File PDF tidak ditemukan");
            }

            // Read encrypted file
            $encryptedContent = file_get_contents($pdfPath);
            if ($encryptedContent === false) {
                throw new Exception("Tidak dapat membaca file PDF");
            }

            // Decrypt PDF
            $decryptedContent = $this->decryptPdfFile($encryptedContent);
            if ($decryptedContent === false) {
                throw new Exception("Gagal mendekripsi PDF");
            }

            // Set headers for download
            header('Content-Type: application/pdf');
            header('Content-Disposition: attachment; filename="decrypted_patient_' . $patientId . '.pdf"');
            header('Content-Length: ' . strlen($decryptedContent));

            echo $decryptedContent;
            exit;

        } catch (Exception $e) {
            $this->sendError("Error downloading PDF: " . $e->getMessage());
        }
    }

    /**
     *  NEW: Endpoint khusus untuk ekstraksi steganografi
     */
    private function extractSteganographyMessage()
    {
        try {
            $patientId = intval($_GET['patient_id'] ?? $_POST['patient_id'] ?? 0);

            if ($patientId <= 0) {
                throw new Exception("Patient ID tidak valid");
            }

            $query = "SELECT foto_pasien FROM pasien WHERE id_pasien = ?";
            $stmt = $this->conn->prepare($query);
            $stmt->bind_param("i", $patientId);
            $stmt->execute();
            $result = $stmt->get_result();

            if ($result->num_rows === 0) {
                throw new Exception("Data pasien tidak ditemukan");
            }

            $patient = $result->fetch_assoc();
            $imageFilename = $patient['foto_pasien'];

            if (empty($imageFilename)) {
                throw new Exception("Tidak ada gambar untuk pasien ini");
            }

            // Find the image file
            $possiblePaths = [
                __DIR__ . '/../../uploads/images/' . $imageFilename,
                __DIR__ . '/../uploads/images/' . $imageFilename,
                $_SERVER['DOCUMENT_ROOT'] . '/uploads/images/' . $imageFilename,
            ];

            $imagePath = null;
            foreach ($possiblePaths as $path) {
                if (file_exists($path)) {
                    $imagePath = $path;
                    break;
                }
            }

            if ($imagePath === null) {
                throw new Exception("File gambar tidak ditemukan");
            }

            // Extract message menggunakan algoritma yang sudah diperbaiki
            $message = $this->extractMessageFromImage($imagePath);

            if ($message === false) {
                throw new Exception("Tidak dapat mengekstrak pesan dari gambar");
            }

            $this->sendSuccess([
                'message' => $message,
                'patient_id' => $patientId,
                'image_file' => $imageFilename
            ], "Pesan berhasil diekstrak dari gambar");

        } catch (Exception $e) {
            $this->sendError("Error extracting steganography: " . $e->getMessage());
        }
    }

    // ==================== DATA RETRIEVAL METHODS ====================

    private function getDashboardStats()
    {
        try {
            // Total patients
            $totalQuery = "SELECT COUNT(*) as total_pasien FROM pasien";
            $totalResult = $this->conn->query($totalQuery);
            $total = $totalResult->fetch_assoc();

            // Rawat inap count
            $inapQuery = "SELECT COUNT(*) as rawat_inap FROM pasien WHERE informasi_medis = 'rawat-inap'";
            $inapResult = $this->conn->query($inapQuery);
            $inap = $inapResult->fetch_assoc();

            // Rawat jalan count
            $jalanQuery = "SELECT COUNT(*) as rawat_jalan FROM pasien WHERE informasi_medis = 'rawat-jalan'";
            $jalanResult = $this->conn->query($jalanQuery);
            $jalan = $jalanResult->fetch_assoc();

            // Pemeriksaan count
            $pemeriksaanQuery = "SELECT COUNT(*) as pemeriksaan FROM pasien WHERE informasi_medis = 'pemeriksaan'";
            $pemeriksaanResult = $this->conn->query($pemeriksaanQuery);
            $pemeriksaan = $pemeriksaanResult->fetch_assoc();

            // Total payment
            $paymentQuery = "SELECT COALESCE(SUM(jumlah_pembayaran), 0) as total_pembayaran FROM pasien";
            $paymentResult = $this->conn->query($paymentQuery);
            $payment = $paymentResult->fetch_assoc();

            // New patients (last 7 days)
            $newQuery = "SELECT COUNT(*) as pasien_baru FROM pasien WHERE created_at >= DATE_SUB(NOW(), INTERVAL 7 DAY)";
            $newResult = $this->conn->query($newQuery);
            $new = $newResult->fetch_assoc();

            $stats = [
                'total_pasien' => (int)$total['total_pasien'],
                'rawat_inap' => (int)$inap['rawat_inap'],
                'rawat_jalan' => (int)$jalan['rawat_jalan'],
                'pemeriksaan' => (int)$pemeriksaan['pemeriksaan'],
                'total_pembayaran' => (float)$payment['total_pembayaran'],
                'pasien_baru' => (int)$new['pasien_baru']
            ];

            $this->sendSuccess($stats, "Stats loaded successfully");

        } catch (Exception $e) {
            $this->sendError("Error loading stats: " . $e->getMessage());
        }
    }

    private function getRecentPatients()
    {
        try {
            $query = "SELECT * FROM pasien ORDER BY created_at DESC LIMIT 5";
            $result = $this->conn->query($query);

            $patients = [];
            while ($row = $result->fetch_assoc()) {
                // Decrypt the data
                $row['nama_lengkap'] = $this->xorDecrypt($row['nama_lengkap'], XOR_KEY);
                $row['alamat_lengkap'] = $this->xorDecrypt($row['alamat_lengkap'], XOR_KEY);
                $row['hasil_pemeriksaan'] = $this->altbashAesDecrypt($row['hasil_pemeriksaan']);
                
                $patients[] = $row;
            }

            $this->sendSuccess($patients, "Recent patients loaded");

        } catch (Exception $e) {
            $this->sendError("Error loading recent patients: " . $e->getMessage());
        }
    }

    private function getPatientsList()
    {
        try {
            $page = intval($_GET['page'] ?? 1);
            $limit = intval($_GET['limit'] ?? 10);
            $search = $_GET['search'] ?? '';
            $status = $_GET['status'] ?? '';
            $service = $_GET['service'] ?? '';

            $offset = ($page - 1) * $limit;

            // Build WHERE conditions
            $whereConditions = [];
            $params = [];
            $types = '';

            if (!empty($search)) {
                $whereConditions[] = "(nama_lengkap LIKE ? OR alamat_lengkap LIKE ?)";
                $searchTerm = "%$search%";
                $params[] = $searchTerm;
                $params[] = $searchTerm;
                $types .= 'ss';
            }

            if (!empty($status)) {
                $whereConditions[] = "status_pasien = ?";
                $params[] = $status;
                $types .= 's';
            }

            if (!empty($service)) {
                $whereConditions[] = "informasi_medis = ?";
                $params[] = $service;
                $types .= 's';
            }

            $whereClause = '';
            if (!empty($whereConditions)) {
                $whereClause = "WHERE " . implode(" AND ", $whereConditions);
            }

            // Count total records
            $countQuery = "SELECT COUNT(*) as total FROM pasien $whereClause";
            $countStmt = $this->conn->prepare($countQuery);
            
            if (!empty($params)) {
                $countStmt->bind_param($types, ...$params);
            }
            
            $countStmt->execute();
            $countResult = $countStmt->get_result();
            $totalCount = $countResult->fetch_assoc()['total'];
            $totalPages = ceil($totalCount / $limit);

            $dataQuery = "SELECT * FROM pasien $whereClause ORDER BY created_at DESC, id_pasien DESC LIMIT ? OFFSET ?";
            $dataStmt = $this->conn->prepare($dataQuery);
            
            $params[] = $limit;
            $params[] = $offset;
            $types .= 'ii';

            if (!empty($params)) {
                $dataStmt->bind_param($types, ...$params);
            }
            
            $dataStmt->execute();
            $result = $dataStmt->get_result();

            $patients = [];
            while ($row = $result->fetch_assoc()) {
                // Decrypt the data for display
                $row['nama_lengkap'] = $this->xorDecrypt($row['nama_lengkap'], XOR_KEY);
                $row['alamat_lengkap'] = $this->xorDecrypt($row['alamat_lengkap'], XOR_KEY);
                $row['hasil_pemeriksaan'] = $this->altbashAesDecrypt($row['hasil_pemeriksaan']);
                
                $patients[] = $row;
            }

            $response = [
                'patients' => $patients,
                'total_pages' => $totalPages,
                'current_page' => $page,
                'total_count' => $totalCount
            ];

            $this->sendSuccess($response, "Patients list loaded");

        } catch (Exception $e) {
            $this->sendError("Error loading patients list: " . $e->getMessage());
        }
    }

    private function getPatientDetail()
    {
        try {
            $patientId = intval($_GET['patient_id'] ?? $_POST['patient_id'] ?? 0);

            if ($patientId <= 0) {
                throw new Exception("Patient ID tidak valid");
            }

            $query = "SELECT * FROM pasien WHERE id_pasien = ?";
            $stmt = $this->conn->prepare($query);
            $stmt->bind_param("i", $patientId);
            $stmt->execute();
            $result = $stmt->get_result();

            if ($result->num_rows === 0) {
                throw new Exception("Data pasien tidak ditemukan");
            }

            $patient = $result->fetch_assoc();

            // Decrypt all encrypted data
            $patient['nama_lengkap'] = $this->xorDecrypt($patient['nama_lengkap'], XOR_KEY);
            $patient['alamat_lengkap'] = $this->xorDecrypt($patient['alamat_lengkap'], XOR_KEY);
            $patient['hasil_pemeriksaan'] = $this->altbashAesDecrypt($patient['hasil_pemeriksaan']);

            //  FIXED: Extract medical message from image menggunakan algoritma yang sudah diperbaiki
            $medicalMessage = '';
            if (!empty($patient['foto_pasien'])) {
                $possiblePaths = [
                    __DIR__ . '/../../uploads/images/' . $patient['foto_pasien'],
                    __DIR__ . '/../uploads/images/' . $patient['foto_pasien'],
                    $_SERVER['DOCUMENT_ROOT'] . '/uploads/images/' . $patient['foto_pasien'],
                ];

                $imagePath = null;
                foreach ($possiblePaths as $path) {
                    if (file_exists($path)) {
                        $imagePath = $path;
                        break;
                    }
                }

                if ($imagePath !== null) {
                    $medicalMessage = $this->extractMessageFromImage($imagePath);
                    if ($medicalMessage === false) {
                        $medicalMessage = ''; // Jika ekstraksi gagal, set kosong
                    }
                }
            }
            $patient['medical_message'] = $medicalMessage;

            $this->sendSuccess($patient, "Patient detail loaded");

        } catch (Exception $e) {
            $this->sendError("Error loading patient detail: " . $e->getMessage());
        }
    }

    private function updatePatient()
    {
        try {
            $patientId = intval($_POST['patient_id'] ?? 0);
            
            if ($patientId <= 0) {
                throw new Exception("Patient ID tidak valid");
            }

            // Get form data
            $nama_pasien = $this->sanitizeInput($_POST['nama_pasien']);
            $tanggal_lahir = $_POST['tanggal_lahir'];
            $alamat = $this->sanitizeInput($_POST['alamat']);
            $jenis_layanan = $this->sanitizeInput($_POST['jenis_layanan']);
            $status_pasien = $this->sanitizeInput($_POST['status_pasien']);
            $hasil_pemeriksaan = $this->sanitizeInput($_POST['hasil_pemeriksaan']);
            $jumlah_pembayaran = floatval($_POST['jumlah_pembayaran']);

            // Encrypt data before updating
            $encrypted_nama = $this->xorEncrypt($nama_pasien, XOR_KEY);
            $encrypted_alamat = $this->xorEncrypt($alamat, XOR_KEY);
            $encrypted_hasil = $this->altbashAesEncrypt($hasil_pemeriksaan);

            $query = "UPDATE pasien SET 
                nama_lengkap = ?, 
                tanggal_lahir = ?, 
                alamat_lengkap = ?, 
                informasi_medis = ?, 
                status_pasien = ?, 
                hasil_pemeriksaan = ?, 
                jumlah_pembayaran = ?,
                updated_at = NOW()
                WHERE id_pasien = ?";

            $stmt = $this->conn->prepare($query);
            $stmt->bind_param(
                "ssssssdi",
                $encrypted_nama,
                $tanggal_lahir,
                $encrypted_alamat,
                $jenis_layanan,
                $status_pasien,
                $encrypted_hasil,
                $jumlah_pembayaran,
                $patientId
            );

            if ($stmt->execute()) {
                $this->sendSuccess([], "Data pasien berhasil diperbarui");
            } else {
                throw new Exception("Gagal memperbarui data: " . $stmt->error);
            }

        } catch (Exception $e) {
            $this->sendError("Error updating patient: " . $e->getMessage());
        }
    }

    private function deletePatient()
    {
        try {
            $patientId = intval($_POST['patient_id'] ?? 0);

            if ($patientId <= 0) {
                throw new Exception("Patient ID tidak valid");
            }

            $query = "DELETE FROM pasien WHERE id_pasien = ?";
            $stmt = $this->conn->prepare($query);
            $stmt->bind_param("i", $patientId);

            if ($stmt->execute()) {
                $this->sendSuccess([], "Data pasien berhasil dihapus");
            } else {
                throw new Exception("Gagal menghapus data: " . $stmt->error);
            }

        } catch (Exception $e) {
            $this->sendError("Error deleting patient: " . $e->getMessage());
        }
    }

    // ==================== ENCRYPTION METHODS (for update) ====================

    private function xorEncrypt($data, $key)
    {
        if (empty($data)) return '';

        $data = mb_convert_encoding($data, 'UTF-8');
        $key = mb_convert_encoding($key, 'UTF-8');

        $encrypted = '';
        $dataLen = mb_strlen($data, 'UTF-8');
        $keyLen = mb_strlen($key, 'UTF-8');

        for ($i = 0; $i < $dataLen; $i++) {
            $dataChar = mb_substr($data, $i, 1, 'UTF-8');
            $keyChar = mb_substr($key, $i % $keyLen, 1, 'UTF-8');

            $dataAscii = ord($dataChar);
            $keyAscii = ord($keyChar);
            $encryptedAscii = $dataAscii ^ $keyAscii;

            $encrypted .= chr($encryptedAscii);
        }

        return base64_encode($encrypted);
    }

    private function altbashAesEncrypt($data)
    {
        if (empty($data)) return '';

        $altbash_encrypted = $this->altbashEncrypt($data);
        $aes_encrypted = $this->aesEncrypt($altbash_encrypted);

        return $aes_encrypted;
    }

    private function altbashEncrypt($data)
    {
        if (empty($data)) return '';

        $data = mb_convert_encoding($data, 'UTF-8');
        $key = mb_convert_encoding(XOR_KEY, 'UTF-8');

        $encrypted = '';
        $dataLen = mb_strlen($data, 'UTF-8');
        $keyLen = mb_strlen($key, 'UTF-8');

        for ($i = 0; $i < $dataLen; $i++) {
            $char = mb_substr($data, $i, 1, 'UTF-8');
            $ascii = ord($char);
            $shifted_ascii = ($ascii + 3) % 256;
            $encrypted .= chr($shifted_ascii);
        }

        $xor_encrypted = '';
        for ($i = 0; $i < $dataLen; $i++) {
            $dataChar = $encrypted[$i];
            $keyChar = mb_substr($key, $i % $keyLen, 1, 'UTF-8');

            $dataAscii = ord($dataChar);
            $keyAscii = ord($keyChar);
            $xorAscii = $dataAscii ^ $keyAscii;

            $xor_encrypted .= chr($xorAscii);
        }

        $reversed = strrev($xor_encrypted);
        return base64_encode($reversed);
    }

    private function aesEncrypt($data)
    {
        if (empty($data)) return '';

        $encrypted = openssl_encrypt(
            $data,
            'AES-256-CBC',
            AES_KEY,
            OPENSSL_RAW_DATA,
            AES_IV
        );

        return base64_encode($encrypted);
    }

    // ==================== UTILITY METHODS ====================

    private function logMessage($message)
    {
        $timestamp = date('Y-m-d H:i:s');
        $logMessage = "[$timestamp] $message\n";
        error_log($logMessage, 3, __DIR__ . '/dashboard_errors.log');
    }

    private function sanitizeInput($data)
    {
        if ($this->conn) {
            return $this->conn->real_escape_string(trim($data));
        }
        return trim($data);
    }

    private function sendSuccess($data, $message = "")
    {
        echo json_encode([
            'success' => true,
            'message' => $message,
            'data' => $data
        ], JSON_UNESCAPED_UNICODE);
        exit;
    }

    private function sendError($message, $code = 400)
    {
        http_response_code($code);
        echo json_encode([
            'success' => false,
            'error' => $message
        ], JSON_UNESCAPED_UNICODE);
        exit;
    }

    public function __destruct()
    {
        if ($this->conn) {
            $this->conn->close();
        }
    }
}

// Handle the request
$handler = new DashboardView();
$handler->handleRequest();
?>
    [medmsg] => <?php

ini_set('display_errors', 1);
ini_set('display_startup_errors', 1);
error_reporting(E_ALL);
ini_set('log_errors', 1);
ini_set('error_log', __DIR__ . '/dashboard_errors.log');

header('Content-Type: application/json; charset=utf-8');
header('Access-Control-Allow-Origin: *');
header('Access-Control-Allow-Methods: GET, POST, OPTIONS');
header('Access-Control-Allow-Headers: Content-Type');

// Database configuration
define('DB_HOST', 'localhost');
define('DB_USER', 'root');
define('DB_PASS', '');
define('DB_NAME', 'kriptoproject');

// Encryption keys (SAMA dengan yang di upload.php)
define('XOR_KEY', 'medicare_secret_key_2024');
define('AES_KEY', 'medicare_aes_key_2024_32bytes_long!');
define('AES_IV', '1234567890123456');

class DashboardView
{
    private $conn;

    public function __construct()
    {
        $this->connectDB();
    }

    private function connectDB()
    {
        try {
            $this->conn = new mysqli(DB_HOST, DB_USER, DB_PASS, DB_NAME);

            if ($this->conn->connect_error) {
                throw new Exception("Koneksi database gagal: " . $this->conn->connect_error);
            }

            $this->conn->set_charset("utf8mb4");
        } catch (Exception $e) {
            $this->sendError($e->getMessage());
        }
    }

    public function handleRequest()
    {
        $action = $_GET['action'] ?? $_POST['action'] ?? '';

        switch ($action) {
            case 'get_stats':
                $this->getDashboardStats();
                break;
            case 'get_recent_patients':
                $this->getRecentPatients();
                break;
            case 'get_patients':
                $this->getPatientsList();
                break;
            case 'get_patient_detail':
                $this->getPatientDetail();
                break;
            case 'update_patient':
                $this->updatePatient();
                break;
            case 'delete_patient':
                $this->deletePatient();
                break;
            case 'download_decrypted_pdf':
                $this->downloadDecryptedPdf();
                break;
            case 'extract_steganography': // NEW ACTION untuk ekstraksi steganografi
                $this->extractSteganographyMessage();
                break;
            default:
                $this->sendError('Action tidak valid');
        }
    }

    // ==================== IMPROVED DECRYPTION METHODS ====================

    /**
     * Decrypt XOR encrypted data
     */
    private function xorDecrypt($encryptedData, $key)
    {
        if (empty($encryptedData)) return '';

        $data = base64_decode($encryptedData);
        $key = mb_convert_encoding($key, 'UTF-8');

        $decrypted = '';
        $dataLen = strlen($data);
        $keyLen = mb_strlen($key, 'UTF-8');

        for ($i = 0; $i < $dataLen; $i++) {
            $dataChar = $data[$i];
            $keyChar = mb_substr($key, $i % $keyLen, 1, 'UTF-8');

            $dataAscii = ord($dataChar);
            $keyAscii = ord($keyChar);
            $decryptedAscii = $dataAscii ^ $keyAscii;

            $decrypted .= chr($decryptedAscii);
        }

        return $decrypted;
    }

    /**
     * Decrypt AES encrypted data
     */
    private function aesDecrypt($encryptedData)
    {
        if (empty($encryptedData)) return '';

        $encrypted = base64_decode($encryptedData);
        
        $decrypted = openssl_decrypt(
            $encrypted,
            'AES-256-CBC',
            AES_KEY,
            OPENSSL_RAW_DATA,
            AES_IV
        );

        return $decrypted ?: '';
    }

    /**
     * Decrypt AltBash + AES encrypted data
     */
    private function altbashAesDecrypt($encryptedData)
    {
        if (empty($encryptedData)) return '';

        // First decrypt AES
        $altbashEncrypted = $this->aesDecrypt($encryptedData);
        if (empty($altbashEncrypted)) return '';

        // Then decrypt AltBash
        return $this->altbashDecrypt($altbashEncrypted);
    }

    /**
     * Decrypt Alphabet-Bashing encrypted data
     */
    private function altbashDecrypt($encryptedData)
    {
        if (empty($encryptedData)) return '';

        $data = base64_decode($encryptedData);
        $reversed = strrev($data);
        $key = mb_convert_encoding(XOR_KEY, 'UTF-8');

        $xorDecrypted = '';
        $dataLen = strlen($reversed);
        $keyLen = mb_strlen($key, 'UTF-8');

        for ($i = 0; $i < $dataLen; $i++) {
            $dataChar = $reversed[$i];
            $keyChar = mb_substr($key, $i % $keyLen, 1, 'UTF-8');

            $dataAscii = ord($dataChar);
            $keyAscii = ord($keyChar);
            $xorAscii = $dataAscii ^ $keyAscii;

            $xorDecrypted .= chr($xorAscii);
        }

        $decrypted = '';
        $dataLen = strlen($xorDecrypted);

        for ($i = 0; $i < $dataLen; $i++) {
            $char = $xorDecrypted[$i];
            $ascii = ord($char);
            $shiftedAscii = ($ascii - 3 + 256) % 256;
            $decrypted .= chr($shiftedAscii);
        }

        return $decrypted;
    }

    /**
     * Decrypt PDF file that was encrypted with Caesar + AES
     */
    private function decryptPdfFile($encryptedContent)
    {
        try {
            // Step 1: AES decryption
            $aesDecrypted = $this->aesDecryptBinary($encryptedContent);
            if ($aesDecrypted === false) {
                throw new Exception("AES decryption failed");
            }

            // Step 2: Caesar Cipher decryption (shift of 5)
            $decrypted = $this->caesarCipherDecrypt($aesDecrypted, 5);

            return $decrypted;
        } catch (Exception $e) {
            $this->logMessage("ERROR in decryptPdfFile: " . $e->getMessage());
            return false;
        }
    }

    /**
     * AES decryption for binary data
     */
    private function aesDecryptBinary($data)
    {
        if (empty($data)) {
            return false;
        }

        $decrypted = openssl_decrypt(
            $data,
            'AES-256-CBC',
            AES_KEY,
            OPENSSL_RAW_DATA,
            AES_IV
        );

        return $decrypted;
    }

    /**
     * Caesar Cipher decryption for binary data
     */
    private function caesarCipherDecrypt($data, $shift)
    {
        $decrypted = '';
        $length = strlen($data);
        
        for ($i = 0; $i < $length; $i++) {
            $byte = ord($data[$i]);
            // Apply Caesar shift (mod 256 for bytes)
            $decryptedByte = ($byte - $shift + 256) % 256;
            $decrypted .= chr($decryptedByte);
        }
        
        return $decrypted;
    }

    /**
     *  FIXED: Extract hidden message from steganographed image menggunakan algoritma yang sama dengan test
     */
    private function extractMessageFromImage($imagePath)
    {
        try {
            $this->logMessage("=== EXTRACTING MESSAGE FROM IMAGE (FIXED ALGORITHM) ===");
            
            if (!file_exists($imagePath)) {
                throw new Exception("Image file not found: " . $imagePath);
            }

            $imageInfo = getimagesize($imagePath);
            if ($imageInfo === false) {
                throw new Exception("Cannot get image information");
            }

            $width = $imageInfo[0];
            $height = $imageInfo[1];
            $imageType = $imageInfo[2];
            
            $this->logMessage("Image dimensions: {$width}x{$height}, Type: {$imageType}");

            // Load image - support WebP dan format lainnya
            $image = null;
            switch ($imageType) {
                case IMAGETYPE_JPEG:
                    $image = imagecreatefromjpeg($imagePath);
                    $this->logMessage("Loaded as JPEG");
                    break;
                case IMAGETYPE_PNG:
                    $image = imagecreatefrompng($imagePath);
                    $this->logMessage("Loaded as PNG");
                    break;
                case IMAGETYPE_GIF:
                    $image = imagecreatefromgif($imagePath);
                    $this->logMessage("Loaded as GIF");
                    break;
                case 18: // IMAGETYPE_WEBP
                    if (function_exists('imagecreatefromwebp')) {
                        $image = imagecreatefromwebp($imagePath);
                        $this->logMessage("Loaded as WEBP");
                    } else {
                        throw new Exception("WebP not supported on this server");
                    }
                    break;
                default:
                    throw new Exception("Unsupported image type: " . $imageType);
            }

            if (!$image) {
                throw new Exception("Cannot create image from source");
            }

            //  FIXED: Extract header menggunakan algoritma yang sama dengan embedding
            $headerBits = '';
            $bitsExtracted = 0;
            $headerSize = 32;

            $this->logMessage("Extracting header...");
            for ($y = 0; $y < $height; $y++) {
                for ($x = 0; $x < $width; $x++) {
                    if ($bitsExtracted >= $headerSize) break 2;
                    
                    $rgb = imagecolorat($image, $x, $y);
                    $r = ($rgb >> 16) & 0xFF;
                    $g = ($rgb >> 8) & 0xFF;
                    $b = $rgb & 0xFF;

                    // Extract dari LSB - URUTAN SAMA dengan enkripsi
                    $headerBits .= $r & 1;
                    $bitsExtracted++;
                    if ($bitsExtracted >= $headerSize) break;
                    
                    $headerBits .= $g & 1;
                    $bitsExtracted++;
                    if ($bitsExtracted >= $headerSize) break;
                    
                    $headerBits .= $b & 1;
                    $bitsExtracted++;
                    if ($bitsExtracted >= $headerSize) break;
                }
            }

            $this->logMessage("Header bits extracted: " . $bitsExtracted);

            // Convert header bits to message length
            $messageLength = 0;
            for ($i = 0; $i < 32; $i += 8) {
                $byte = bindec(substr($headerBits, $i, 8));
                $messageLength = ($messageLength << 8) | $byte;
            }

            $this->logMessage("Message length from header: " . $messageLength);

            if ($messageLength <= 0 || $messageLength > 100000) {
                $this->logMessage("No valid message found (invalid length: $messageLength)");
                imagedestroy($image);
                return false;
            }

            //  FIXED: Extract encrypted message dengan algoritma yang DIPERBAIKI
            $encryptedBits = '';
            $bitsNeeded = $messageLength * 8;
            $bitsExtracted = 0;

            $this->logMessage("Extracting message data ($bitsNeeded bits needed)...");
            
            //  PERBAIKAN: Gunakan counter bit GLOBAL, bukan skip per pixel
            $globalBitCounter = 0;
            
            for ($y = 0; $y < $height; $y++) {
                for ($x = 0; $x < $width; $x++) {
                    $rgb = imagecolorat($image, $x, $y);
                    $r = ($rgb >> 16) & 0xFF;
                    $g = ($rgb >> 8) & 0xFF;
                    $b = $rgb & 0xFF;

                    // Process each channel
                    $channels = [$r, $g, $b];
                    
                    foreach ($channels as $channel) {
                        // Skip bits yang sudah digunakan untuk header
                        if ($globalBitCounter < 32) {
                            $globalBitCounter++;
                            continue;
                        }

                        // Extract message bits setelah header
                        if ($bitsExtracted < $bitsNeeded) {
                            $encryptedBits .= $channel & 1;
                            $bitsExtracted++;
                            $globalBitCounter++;
                        } else {
                            break 3; // Keluar dari semua loop
                        }
                    }
                }
            }

            $this->logMessage("Message bits extracted: " . $bitsExtracted);
            $this->logMessage("Total bits processed: " . $globalBitCounter);

            if ($bitsExtracted < $bitsNeeded) {
                $this->logMessage("ERROR: Not enough bits extracted. Needed: $bitsNeeded, Got: $bitsExtracted");
                imagedestroy($image);
                return false;
            }

            // Convert bits to bytes
            $encryptedMessage = '';
            for ($i = 0; $i < $bitsNeeded; $i += 8) {
                $byteBits = substr($encryptedBits, $i, 8);
                if (strlen($byteBits) < 8) {
                    $this->logMessage("ERROR: Incomplete byte at position $i");
                    break;
                }
                $byte = bindec($byteBits);
                $encryptedMessage .= chr($byte);
            }

            $this->logMessage("Encrypted message length: " . strlen($encryptedMessage) . " bytes");

            //  FIXED: DECRYPTION dengan error handling yang lebih baik
            $this->logMessage("Attempting AES decryption...");
            
            $decrypted = openssl_decrypt(
                $encryptedMessage,
                'AES-256-CBC',
                AES_KEY,
                OPENSSL_RAW_DATA,
                AES_IV
            );

            if ($decrypted === false) {
                $error = openssl_error_string();
                $this->logMessage("AES decryption failed: " . $error);
                
                // Coba alternatif: handle padding manual
                $decrypted = $this->decryptWithPaddingHandling($encryptedMessage);
                if ($decrypted === false) {
                    $this->logMessage("Alternative decryption also failed");
                    imagedestroy($image);
                    return false;
                }
            }

            // Remove PKCS7 padding
            $originalMessage = $this->pkcs7Unpad($decrypted);
            
            if ($originalMessage === false) {
                $this->logMessage("Padding removal failed, using raw decrypted data");
                $originalMessage = $decrypted;
            }
            
            $this->logMessage(" Decryption successful");
            
            imagedestroy($image);
            
            return $originalMessage;

        } catch (Exception $e) {
            $this->logMessage("ERROR in extractMessageFromImage: " . $e->getMessage());
            if (isset($image)) {
                imagedestroy($image);
            }
            return false;
        }
    }

    /**
     * Alternative decryption dengan padding handling
     */
    private function decryptWithPaddingHandling($encryptedMessage)
    {
        $this->logMessage("Trying alternative decryption with padding handling...");
        
        // Coba tanpa OPENSSL_RAW_DATA dulu
        $decrypted = openssl_decrypt(
            $encryptedMessage,
            'AES-256-CBC',
            AES_KEY,
            0, // Bukan raw data
            AES_IV
        );

        if ($decrypted === false) {
            // Coba dengan zero padding
            $decrypted = openssl_decrypt(
                $encryptedMessage,
                'AES-256-CBC',
                AES_KEY,
                OPENSSL_ZERO_PADDING,
                AES_IV
            );
        }

        return $decrypted;
    }

    /**
     * PKCS7 Unpadding dengan error handling
     */
    private function pkcs7Unpad($data)
    {
        if (empty($data)) return '';
        
        $dataLength = strlen($data);
        if ($dataLength == 0) return '';
        
        $padding = ord($data[$dataLength - 1]);
        
        // Validasi padding
        if ($padding > 16 || $padding == 0 || $padding > $dataLength) {
            return $data; // Return data as-is jika padding invalid
        }
        
        // Check semua byte padding
        for ($i = 0; $i < $padding; $i++) {
            if (ord($data[$dataLength - $i - 1]) != $padding) {
                return $data; // Return data as-is jika padding tidak konsisten
            }
        }
        
        return substr($data, 0, -$padding);
    }

    /**
     * New endpoint untuk download decrypted PDF
     */
    private function downloadDecryptedPdf()
    {
        try {
            $patientId = intval($_GET['patient_id'] ?? 0);

            if ($patientId <= 0) {
                throw new Exception("Patient ID tidak valid");
            }

            // Get patient data including PDF filename
            $query = "SELECT dokumen_pdf FROM pasien WHERE id_pasien = ?";
            $stmt = $this->conn->prepare($query);
            $stmt->bind_param("i", $patientId);
            $stmt->execute();
            $result = $stmt->get_result();

            if ($result->num_rows === 0) {
                throw new Exception("Data pasien tidak ditemukan");
            }

            $patient = $result->fetch_assoc();
            $encryptedPdfFilename = $patient['dokumen_pdf'];

            if (empty($encryptedPdfFilename)) {
                throw new Exception("Tidak ada dokumen PDF untuk pasien ini");
            }

            // Find the encrypted PDF file
            $possiblePaths = [
                __DIR__ . '/../../uploads/pdfs/' . $encryptedPdfFilename,
                __DIR__ . '/../uploads/pdfs/' . $encryptedPdfFilename,
                $_SERVER['DOCUMENT_ROOT'] . '/uploads/pdfs/' . $encryptedPdfFilename,
            ];

            $pdfPath = null;
            foreach ($possiblePaths as $path) {
                if (file_exists($path)) {
                    $pdfPath = $path;
                    break;
                }
            }

            if ($pdfPath === null) {
                throw new Exception("File PDF tidak ditemukan");
            }

            // Read encrypted file
            $encryptedContent = file_get_contents($pdfPath);
            if ($encryptedContent === false) {
                throw new Exception("Tidak dapat membaca file PDF");
            }

            // Decrypt PDF
            $decryptedContent = $this->decryptPdfFile($encryptedContent);
            if ($decryptedContent === false) {
                throw new Exception("Gagal mendekripsi PDF");
            }

            // Set headers for download
            header('Content-Type: application/pdf');
            header('Content-Disposition: attachment; filename="decrypted_patient_' . $patientId . '.pdf"');
            header('Content-Length: ' . strlen($decryptedContent));

            echo $decryptedContent;
            exit;

        } catch (Exception $e) {
            $this->sendError("Error downloading PDF: " . $e->getMessage());
        }
    }

    /**
     *  NEW: Endpoint khusus untuk ekstraksi steganografi
     */
    private function extractSteganographyMessage()
    {
        try {
            $patientId = intval($_GET['patient_id'] ?? $_POST['patient_id'] ?? 0);

            if ($patientId <= 0) {
                throw new Exception("Patient ID tidak valid");
            }

            $query = "SELECT foto_pasien FROM pasien WHERE id_pasien = ?";
            $stmt = $this->conn->prepare($query);
            $stmt->bind_param("i", $patientId);
            $stmt->execute();
            $result = $stmt->get_result();

            if ($result->num_rows === 0) {
                throw new Exception("Data pasien tidak ditemukan");
            }

            $patient = $result->fetch_assoc();
            $imageFilename = $patient['foto_pasien'];

            if (empty($imageFilename)) {
                throw new Exception("Tidak ada gambar untuk pasien ini");
            }

            // Find the image file
            $possiblePaths = [
                __DIR__ . '/../../uploads/images/' . $imageFilename,
                __DIR__ . '/../uploads/images/' . $imageFilename,
                $_SERVER['DOCUMENT_ROOT'] . '/uploads/images/' . $imageFilename,
            ];

            $imagePath = null;
            foreach ($possiblePaths as $path) {
                if (file_exists($path)) {
                    $imagePath = $path;
                    break;
                }
            }

            if ($imagePath === null) {
                throw new Exception("File gambar tidak ditemukan");
            }

            // Extract message menggunakan algoritma yang sudah diperbaiki
            $message = $this->extractMessageFromImage($imagePath);

            if ($message === false) {
                throw new Exception("Tidak dapat mengekstrak pesan dari gambar");
            }

            $this->sendSuccess([
                'message' => $message,
                'patient_id' => $patientId,
                'image_file' => $imageFilename
            ], "Pesan berhasil diekstrak dari gambar");

        } catch (Exception $e) {
            $this->sendError("Error extracting steganography: " . $e->getMessage());
        }
    }

    // ==================== DATA RETRIEVAL METHODS ====================

    private function getDashboardStats()
    {
        try {
            // Total patients
            $totalQuery = "SELECT COUNT(*) as total_pasien FROM pasien";
            $totalResult = $this->conn->query($totalQuery);
            $total = $totalResult->fetch_assoc();

            // Rawat inap count
            $inapQuery = "SELECT COUNT(*) as rawat_inap FROM pasien WHERE informasi_medis = 'rawat-inap'";
            $inapResult = $this->conn->query($inapQuery);
            $inap = $inapResult->fetch_assoc();

            // Rawat jalan count
            $jalanQuery = "SELECT COUNT(*) as rawat_jalan FROM pasien WHERE informasi_medis = 'rawat-jalan'";
            $jalanResult = $this->conn->query($jalanQuery);
            $jalan = $jalanResult->fetch_assoc();

            // Pemeriksaan count
            $pemeriksaanQuery = "SELECT COUNT(*) as pemeriksaan FROM pasien WHERE informasi_medis = 'pemeriksaan'";
            $pemeriksaanResult = $this->conn->query($pemeriksaanQuery);
            $pemeriksaan = $pemeriksaanResult->fetch_assoc();

            // Total payment
            $paymentQuery = "SELECT COALESCE(SUM(jumlah_pembayaran), 0) as total_pembayaran FROM pasien";
            $paymentResult = $this->conn->query($paymentQuery);
            $payment = $paymentResult->fetch_assoc();

            // New patients (last 7 days)
            $newQuery = "SELECT COUNT(*) as pasien_baru FROM pasien WHERE created_at >= DATE_SUB(NOW(), INTERVAL 7 DAY)";
            $newResult = $this->conn->query($newQuery);
            $new = $newResult->fetch_assoc();

            $stats = [
                'total_pasien' => (int)$total['total_pasien'],
                'rawat_inap' => (int)$inap['rawat_inap'],
                'rawat_jalan' => (int)$jalan['rawat_jalan'],
                'pemeriksaan' => (int)$pemeriksaan['pemeriksaan'],
                'total_pembayaran' => (float)$payment['total_pembayaran'],
                'pasien_baru' => (int)$new['pasien_baru']
            ];

            $this->sendSuccess($stats, "Stats loaded successfully");

        } catch (Exception $e) {
            $this->sendError("Error loading stats: " . $e->getMessage());
        }
    }

    private function getRecentPatients()
    {
        try {
            $query = "SELECT * FROM pasien ORDER BY created_at DESC LIMIT 5";
            $result = $this->conn->query($query);

            $patients = [];
            while ($row = $result->fetch_assoc()) {
                // Decrypt the data
                $row['nama_lengkap'] = $this->xorDecrypt($row['nama_lengkap'], XOR_KEY);
                $row['alamat_lengkap'] = $this->xorDecrypt($row['alamat_lengkap'], XOR_KEY);
                $row['hasil_pemeriksaan'] = $this->altbashAesDecrypt($row['hasil_pemeriksaan']);
                
                $patients[] = $row;
            }

            $this->sendSuccess($patients, "Recent patients loaded");

        } catch (Exception $e) {
            $this->sendError("Error loading recent patients: " . $e->getMessage());
        }
    }

    private function getPatientsList()
    {
        try {
            $page = intval($_GET['page'] ?? 1);
            $limit = intval($_GET['limit'] ?? 10);
            $search = $_GET['search'] ?? '';
            $status = $_GET['status'] ?? '';
            $service = $_GET['service'] ?? '';

            $offset = ($page - 1) * $limit;

            // Build WHERE conditions
            $whereConditions = [];
            $params = [];
            $types = '';

            if (!empty($search)) {
                $whereConditions[] = "(nama_lengkap LIKE ? OR alamat_lengkap LIKE ?)";
                $searchTerm = "%$search%";
                $params[] = $searchTerm;
                $params[] = $searchTerm;
                $types .= 'ss';
            }

            if (!empty($status)) {
                $whereConditions[] = "status_pasien = ?";
                $params[] = $status;
                $types .= 's';
            }

            if (!empty($service)) {
                $whereConditions[] = "informasi_medis = ?";
                $params[] = $service;
                $types .= 's';
            }

            $whereClause = '';
            if (!empty($whereConditions)) {
                $whereClause = "WHERE " . implode(" AND ", $whereConditions);
            }

            // Count total records
            $countQuery = "SELECT COUNT(*) as total FROM pasien $whereClause";
            $countStmt = $this->conn->prepare($countQuery);
            
            if (!empty($params)) {
                $countStmt->bind_param($types, ...$params);
            }
            
            $countStmt->execute();
            $countResult = $countStmt->get_result();
            $totalCount = $countResult->fetch_assoc()['total'];
            $totalPages = ceil($totalCount / $limit);

            $dataQuery = "SELECT * FROM pasien $whereClause ORDER BY created_at DESC, id_pasien DESC LIMIT ? OFFSET ?";
            $dataStmt = $this->conn->prepare($dataQuery);
            
            $params[] = $limit;
            $params[] = $offset;
            $types .= 'ii';

            if (!empty($params)) {
                $dataStmt->bind_param($types, ...$params);
            }
            
            $dataStmt->execute();
            $result = $dataStmt->get_result();

            $patients = [];
            while ($row = $result->fetch_assoc()) {
                // Decrypt the data for display
                $row['nama_lengkap'] = $this->xorDecrypt($row['nama_lengkap'], XOR_KEY);
                $row['alamat_lengkap'] = $this->xorDecrypt($row['alamat_lengkap'], XOR_KEY);
                $row['hasil_pemeriksaan'] = $this->altbashAesDecrypt($row['hasil_pemeriksaan']);
                
                $patients[] = $row;
            }

            $response = [
                'patients' => $patients,
                'total_pages' => $totalPages,
                'current_page' => $page,
                'total_count' => $totalCount
            ];

            $this->sendSuccess($response, "Patients list loaded");

        } catch (Exception $e) {
            $this->sendError("Error loading patients list: " . $e->getMessage());
        }
    }

    private function getPatientDetail()
    {
        try {
            $patientId = intval($_GET['patient_id'] ?? $_POST['patient_id'] ?? 0);

            if ($patientId <= 0) {
                throw new Exception("Patient ID tidak valid");
            }

            $query = "SELECT * FROM pasien WHERE id_pasien = ?";
            $stmt = $this->conn->prepare($query);
            $stmt->bind_param("i", $patientId);
            $stmt->execute();
            $result = $stmt->get_result();

            if ($result->num_rows === 0) {
                throw new Exception("Data pasien tidak ditemukan");
            }

            $patient = $result->fetch_assoc();

            // Decrypt all encrypted data
            $patient['nama_lengkap'] = $this->xorDecrypt($patient['nama_lengkap'], XOR_KEY);
            $patient['alamat_lengkap'] = $this->xorDecrypt($patient['alamat_lengkap'], XOR_KEY);
            $patient['hasil_pemeriksaan'] = $this->altbashAesDecrypt($patient['hasil_pemeriksaan']);

            //  FIXED: Extract medical message from image menggunakan algoritma yang sudah diperbaiki
            $medicalMessage = '';
            if (!empty($patient['foto_pasien'])) {
                $possiblePaths = [
                    __DIR__ . '/../../uploads/images/' . $patient['foto_pasien'],
                    __DIR__ . '/../uploads/images/' . $patient['foto_pasien'],
                    $_SERVER['DOCUMENT_ROOT'] . '/uploads/images/' . $patient['foto_pasien'],
                ];

                $imagePath = null;
                foreach ($possiblePaths as $path) {
                    if (file_exists($path)) {
                        $imagePath = $path;
                        break;
                    }
                }

                if ($imagePath !== null) {
                    $medicalMessage = $this->extractMessageFromImage($imagePath);
                    if ($medicalMessage === false) {
                        $medicalMessage = ''; // Jika ekstraksi gagal, set kosong
                    }
                }
            }
            $patient['medical_message'] = $medicalMessage;

            $this->sendSuccess($patient, "Patient detail loaded");

        } catch (Exception $e) {
            $this->sendError("Error loading patient detail: " . $e->getMessage());
        }
    }

    private function updatePatient()
    {
        try {
            $patientId = intval($_POST['patient_id'] ?? 0);
            
            if ($patientId <= 0) {
                throw new Exception("Patient ID tidak valid");
            }

            // Get form data
            $nama_pasien = $this->sanitizeInput($_POST['nama_pasien']);
            $tanggal_lahir = $_POST['tanggal_lahir'];
            $alamat = $this->sanitizeInput($_POST['alamat']);
            $jenis_layanan = $this->sanitizeInput($_POST['jenis_layanan']);
            $status_pasien = $this->sanitizeInput($_POST['status_pasien']);
            $hasil_pemeriksaan = $this->sanitizeInput($_POST['hasil_pemeriksaan']);
            $jumlah_pembayaran = floatval($_POST['jumlah_pembayaran']);

            // Encrypt data before updating
            $encrypted_nama = $this->xorEncrypt($nama_pasien, XOR_KEY);
            $encrypted_alamat = $this->xorEncrypt($alamat, XOR_KEY);
            $encrypted_hasil = $this->altbashAesEncrypt($hasil_pemeriksaan);

            $query = "UPDATE pasien SET 
                nama_lengkap = ?, 
                tanggal_lahir = ?, 
                alamat_lengkap = ?, 
                informasi_medis = ?, 
                status_pasien = ?, 
                hasil_pemeriksaan = ?, 
                jumlah_pembayaran = ?,
                updated_at = NOW()
                WHERE id_pasien = ?";

            $stmt = $this->conn->prepare($query);
            $stmt->bind_param(
                "ssssssdi",
                $encrypted_nama,
                $tanggal_lahir,
                $encrypted_alamat,
                $jenis_layanan,
                $status_pasien,
                $encrypted_hasil,
                $jumlah_pembayaran,
                $patientId
            );

            if ($stmt->execute()) {
                $this->sendSuccess([], "Data pasien berhasil diperbarui");
            } else {
                throw new Exception("Gagal memperbarui data: " . $stmt->error);
            }

        } catch (Exception $e) {
            $this->sendError("Error updating patient: " . $e->getMessage());
        }
    }

    private function deletePatient()
    {
        try {
            $patientId = intval($_POST['patient_id'] ?? 0);

            if ($patientId <= 0) {
                throw new Exception("Patient ID tidak valid");
            }

            $query = "DELETE FROM pasien WHERE id_pasien = ?";
            $stmt = $this->conn->prepare($query);
            $stmt->bind_param("i", $patientId);

            if ($stmt->execute()) {
                $this->sendSuccess([], "Data pasien berhasil dihapus");
            } else {
                throw new Exception("Gagal menghapus data: " . $stmt->error);
            }

        } catch (Exception $e) {
            $this->sendError("Error deleting patient: " . $e->getMessage());
        }
    }

    // ==================== ENCRYPTION METHODS (for update) ====================

    private function xorEncrypt($data, $key)
    {
        if (empty($data)) return '';

        $data = mb_convert_encoding($data, 'UTF-8');
        $key = mb_convert_encoding($key, 'UTF-8');

        $encrypted = '';
        $dataLen = mb_strlen($data, 'UTF-8');
        $keyLen = mb_strlen($key, 'UTF-8');

        for ($i = 0; $i < $dataLen; $i++) {
            $dataChar = mb_substr($data, $i, 1, 'UTF-8');
            $keyChar = mb_substr($key, $i % $keyLen, 1, 'UTF-8');

            $dataAscii = ord($dataChar);
            $keyAscii = ord($keyChar);
            $encryptedAscii = $dataAscii ^ $keyAscii;

            $encrypted .= chr($encryptedAscii);
        }

        return base64_encode($encrypted);
    }

    private function altbashAesEncrypt($data)
    {
        if (empty($data)) return '';

        $altbash_encrypted = $this->altbashEncrypt($data);
        $aes_encrypted = $this->aesEncrypt($altbash_encrypted);

        return $aes_encrypted;
    }

    private function altbashEncrypt($data)
    {
        if (empty($data)) return '';

        $data = mb_convert_encoding($data, 'UTF-8');
        $key = mb_convert_encoding(XOR_KEY, 'UTF-8');

        $encrypted = '';
        $dataLen = mb_strlen($data, 'UTF-8');
        $keyLen = mb_strlen($key, 'UTF-8');

        for ($i = 0; $i < $dataLen; $i++) {
            $char = mb_substr($data, $i, 1, 'UTF-8');
            $ascii = ord($char);
            $shifted_ascii = ($ascii + 3) % 256;
            $encrypted .= chr($shifted_ascii);
        }

        $xor_encrypted = '';
        for ($i = 0; $i < $dataLen; $i++) {
            $dataChar = $encrypted[$i];
            $keyChar = mb_substr($key, $i % $keyLen, 1, 'UTF-8');

            $dataAscii = ord($dataChar);
            $keyAscii = ord($keyChar);
            $xorAscii = $dataAscii ^ $keyAscii;

            $xor_encrypted .= chr($xorAscii);
        }

        $reversed = strrev($xor_encrypted);
        return base64_encode($reversed);
    }

    private function aesEncrypt($data)
    {
        if (empty($data)) return '';

        $encrypted = openssl_encrypt(
            $data,
            'AES-256-CBC',
            AES_KEY,
            OPENSSL_RAW_DATA,
            AES_IV
        );

        return base64_encode($encrypted);
    }

    // ==================== UTILITY METHODS ====================

    private function logMessage($message)
    {
        $timestamp = date('Y-m-d H:i:s');
        $logMessage = "[$timestamp] $message\n";
        error_log($logMessage, 3, __DIR__ . '/dashboard_errors.log');
    }

    private function sanitizeInput($data)
    {
        if ($this->conn) {
            return $this->conn->real_escape_string(trim($data));
        }
        return trim($data);
    }

    private function sendSuccess($data, $message = "")
    {
        echo json_encode([
            'success' => true,
            'message' => $message,
            'data' => $data
        ], JSON_UNESCAPED_UNICODE);
        exit;
    }

    private function sendError($message, $code = 400)
    {
        http_response_code($code);
        echo json_encode([
            'success' => false,
            'error' => $message
        ], JSON_UNESCAPED_UNICODE);
        exit;
    }

    public function __destruct()
    {
        if ($this->conn) {
            $this->conn->close();
        }
    }
}

// Handle the request
$handler = new DashboardView();
$handler->handleRequest();
?>
    [jumlahPembayaran] => 524352
)

[2025-11-11 17:05:40] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => Gemini_Generated_Image_62snf262snf262sn.png
            [full_path] => Gemini_Generated_Image_62snf262snf262sn.png
            [type] => image/png
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpSvg44l
            [error] => 0
            [size] => 1713178
        )

    [pdfDokumen] => Array
        (
            [name] => Aplikasi.pdf
            [full_path] => Aplikasi.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php1Z5FSD
            [error] => 0
            [size] => 4040002
        )

)

[2025-11-11 17:05:40] Detected MIME type: image/png
[2025-11-11 17:05:40] Image validation: VALID
[2025-11-11 17:05:40] Detected MIME type: application/pdf
[2025-11-11 17:05:40] PDF validation: VALID
[2025-11-11 17:05:40] Form data sanitized successfully
[2025-11-11 17:05:40] Medical message: <?php\r\n\r\nini_set(\'display_errors\', 1);\r\nini_set(\'display_startup_errors\', 1);\r\nerror_reporting(E_ALL);\r\nini_set(\'log_errors\', 1);\r\nini_set(\'error_log\', __DIR__ . \'/dashboard_errors.log\');\r\n\r\nheader(\'Content-Type: application/json; charset=utf-8\');\r\nheader(\'Access-Control-Allow-Origin: *\');\r\nheader(\'Access-Control-Allow-Methods: GET, POST, OPTIONS\');\r\nheader(\'Access-Control-Allow-Headers: Content-Type\');\r\n\r\n// Database configuration\r\ndefine(\'DB_HOST\', \'localhost\');\r\ndefine(\'DB_USER\', \'root\');\r\ndefine(\'DB_PASS\', \'\');\r\ndefine(\'DB_NAME\', \'kriptoproject\');\r\n\r\n// Encryption keys (SAMA dengan yang di upload.php)\r\ndefine(\'XOR_KEY\', \'medicare_secret_key_2024\');\r\ndefine(\'AES_KEY\', \'medicare_aes_key_2024_32bytes_long!\');\r\ndefine(\'AES_IV\', \'1234567890123456\');\r\n\r\nclass DashboardView\r\n{\r\n    private $conn;\r\n\r\n    public function __construct()\r\n    {\r\n        $this->connectDB();\r\n    }\r\n\r\n    private function connectDB()\r\n    {\r\n        try {\r\n            $this->conn = new mysqli(DB_HOST, DB_USER, DB_PASS, DB_NAME);\r\n\r\n            if ($this->conn->connect_error) {\r\n                throw new Exception(\"Koneksi database gagal: \" . $this->conn->connect_error);\r\n            }\r\n\r\n            $this->conn->set_charset(\"utf8mb4\");\r\n        } catch (Exception $e) {\r\n            $this->sendError($e->getMessage());\r\n        }\r\n    }\r\n\r\n    public function handleRequest()\r\n    {\r\n        $action = $_GET[\'action\'] ?? $_POST[\'action\'] ?? \'\';\r\n\r\n        switch ($action) {\r\n            case \'get_stats\':\r\n                $this->getDashboardStats();\r\n                break;\r\n            case \'get_recent_patients\':\r\n                $this->getRecentPatients();\r\n                break;\r\n            case \'get_patients\':\r\n                $this->getPatientsList();\r\n                break;\r\n            case \'get_patient_detail\':\r\n                $this->getPatientDetail();\r\n                break;\r\n            case \'update_patient\':\r\n                $this->updatePatient();\r\n                break;\r\n            case \'delete_patient\':\r\n                $this->deletePatient();\r\n                break;\r\n            case \'download_decrypted_pdf\':\r\n                $this->downloadDecryptedPdf();\r\n                break;\r\n            case \'extract_steganography\': // NEW ACTION untuk ekstraksi steganografi\r\n                $this->extractSteganographyMessage();\r\n                break;\r\n            default:\r\n                $this->sendError(\'Action tidak valid\');\r\n        }\r\n    }\r\n\r\n    // ==================== IMPROVED DECRYPTION METHODS ====================\r\n\r\n    /**\r\n     * Decrypt XOR encrypted data\r\n     */\r\n    private function xorDecrypt($encryptedData, $key)\r\n    {\r\n        if (empty($encryptedData)) return \'\';\r\n\r\n        $data = base64_decode($encryptedData);\r\n        $key = mb_convert_encoding($key, \'UTF-8\');\r\n\r\n        $decrypted = \'\';\r\n        $dataLen = strlen($data);\r\n        $keyLen = mb_strlen($key, \'UTF-8\');\r\n\r\n        for ($i = 0; $i < $dataLen; $i++) {\r\n            $dataChar = $data[$i];\r\n            $keyChar = mb_substr($key, $i % $keyLen, 1, \'UTF-8\');\r\n\r\n            $dataAscii = ord($dataChar);\r\n            $keyAscii = ord($keyChar);\r\n            $decryptedAscii = $dataAscii ^ $keyAscii;\r\n\r\n            $decrypted .= chr($decryptedAscii);\r\n        }\r\n\r\n        return $decrypted;\r\n    }\r\n\r\n    /**\r\n     * Decrypt AES encrypted data\r\n     */\r\n    private function aesDecrypt($encryptedData)\r\n    {\r\n        if (empty($encryptedData)) return \'\';\r\n\r\n        $encrypted = base64_decode($encryptedData);\r\n        \r\n        $decrypted = openssl_decrypt(\r\n            $encrypted,\r\n            \'AES-256-CBC\',\r\n            AES_KEY,\r\n            OPENSSL_RAW_DATA,\r\n            AES_IV\r\n        );\r\n\r\n        return $decrypted ?: \'\';\r\n    }\r\n\r\n    /**\r\n     * Decrypt AltBash + AES encrypted data\r\n     */\r\n    private function altbashAesDecrypt($encryptedData)\r\n    {\r\n        if (empty($encryptedData)) return \'\';\r\n\r\n        // First decrypt AES\r\n        $altbashEncrypted = $this->aesDecrypt($encryptedData);\r\n        if (empty($altbashEncrypted)) return \'\';\r\n\r\n        // Then decrypt AltBash\r\n        return $this->altbashDecrypt($altbashEncrypted);\r\n    }\r\n\r\n    /**\r\n     * Decrypt Alphabet-Bashing encrypted data\r\n     */\r\n    private function altbashDecrypt($encryptedData)\r\n    {\r\n        if (empty($encryptedData)) return \'\';\r\n\r\n        $data = base64_decode($encryptedData);\r\n        $reversed = strrev($data);\r\n        $key = mb_convert_encoding(XOR_KEY, \'UTF-8\');\r\n\r\n        $xorDecrypted = \'\';\r\n        $dataLen = strlen($reversed);\r\n        $keyLen = mb_strlen($key, \'UTF-8\');\r\n\r\n        for ($i = 0; $i < $dataLen; $i++) {\r\n            $dataChar = $reversed[$i];\r\n            $keyChar = mb_substr($key, $i % $keyLen, 1, \'UTF-8\');\r\n\r\n            $dataAscii = ord($dataChar);\r\n            $keyAscii = ord($keyChar);\r\n            $xorAscii = $dataAscii ^ $keyAscii;\r\n\r\n            $xorDecrypted .= chr($xorAscii);\r\n        }\r\n\r\n        $decrypted = \'\';\r\n        $dataLen = strlen($xorDecrypted);\r\n\r\n        for ($i = 0; $i < $dataLen; $i++) {\r\n            $char = $xorDecrypted[$i];\r\n            $ascii = ord($char);\r\n            $shiftedAscii = ($ascii - 3 + 256) % 256;\r\n            $decrypted .= chr($shiftedAscii);\r\n        }\r\n\r\n        return $decrypted;\r\n    }\r\n\r\n    /**\r\n     * Decrypt PDF file that was encrypted with Caesar + AES\r\n     */\r\n    private function decryptPdfFile($encryptedContent)\r\n    {\r\n        try {\r\n            // Step 1: AES decryption\r\n            $aesDecrypted = $this->aesDecryptBinary($encryptedContent);\r\n            if ($aesDecrypted === false) {\r\n                throw new Exception(\"AES decryption failed\");\r\n            }\r\n\r\n            // Step 2: Caesar Cipher decryption (shift of 5)\r\n            $decrypted = $this->caesarCipherDecrypt($aesDecrypted, 5);\r\n\r\n            return $decrypted;\r\n        } catch (Exception $e) {\r\n            $this->logMessage(\"ERROR in decryptPdfFile: \" . $e->getMessage());\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * AES decryption for binary data\r\n     */\r\n    private function aesDecryptBinary($data)\r\n    {\r\n        if (empty($data)) {\r\n            return false;\r\n        }\r\n\r\n        $decrypted = openssl_decrypt(\r\n            $data,\r\n            \'AES-256-CBC\',\r\n            AES_KEY,\r\n            OPENSSL_RAW_DATA,\r\n            AES_IV\r\n        );\r\n\r\n        return $decrypted;\r\n    }\r\n\r\n    /**\r\n     * Caesar Cipher decryption for binary data\r\n     */\r\n    private function caesarCipherDecrypt($data, $shift)\r\n    {\r\n        $decrypted = \'\';\r\n        $length = strlen($data);\r\n        \r\n        for ($i = 0; $i < $length; $i++) {\r\n            $byte = ord($data[$i]);\r\n            // Apply Caesar shift (mod 256 for bytes)\r\n            $decryptedByte = ($byte - $shift + 256) % 256;\r\n            $decrypted .= chr($decryptedByte);\r\n        }\r\n        \r\n        return $decrypted;\r\n    }\r\n\r\n    /**\r\n     *  FIXED: Extract hidden message from steganographed image menggunakan algoritma yang sama dengan test\r\n     */\r\n    private function extractMessageFromImage($imagePath)\r\n    {\r\n        try {\r\n            $this->logMessage(\"=== EXTRACTING MESSAGE FROM IMAGE (FIXED ALGORITHM) ===\");\r\n            \r\n            if (!file_exists($imagePath)) {\r\n                throw new Exception(\"Image file not found: \" . $imagePath);\r\n            }\r\n\r\n            $imageInfo = getimagesize($imagePath);\r\n            if ($imageInfo === false) {\r\n                throw new Exception(\"Cannot get image information\");\r\n            }\r\n\r\n            $width = $imageInfo[0];\r\n            $height = $imageInfo[1];\r\n            $imageType = $imageInfo[2];\r\n            \r\n            $this->logMessage(\"Image dimensions: {$width}x{$height}, Type: {$imageType}\");\r\n\r\n            // Load image - support WebP dan format lainnya\r\n            $image = null;\r\n            switch ($imageType) {\r\n                case IMAGETYPE_JPEG:\r\n                    $image = imagecreatefromjpeg($imagePath);\r\n                    $this->logMessage(\"Loaded as JPEG\");\r\n                    break;\r\n                case IMAGETYPE_PNG:\r\n                    $image = imagecreatefrompng($imagePath);\r\n                    $this->logMessage(\"Loaded as PNG\");\r\n                    break;\r\n                case IMAGETYPE_GIF:\r\n                    $image = imagecreatefromgif($imagePath);\r\n                    $this->logMessage(\"Loaded as GIF\");\r\n                    break;\r\n                case 18: // IMAGETYPE_WEBP\r\n                    if (function_exists(\'imagecreatefromwebp\')) {\r\n                        $image = imagecreatefromwebp($imagePath);\r\n                        $this->logMessage(\"Loaded as WEBP\");\r\n                    } else {\r\n                        throw new Exception(\"WebP not supported on this server\");\r\n                    }\r\n                    break;\r\n                default:\r\n                    throw new Exception(\"Unsupported image type: \" . $imageType);\r\n            }\r\n\r\n            if (!$image) {\r\n                throw new Exception(\"Cannot create image from source\");\r\n            }\r\n\r\n            //  FIXED: Extract header menggunakan algoritma yang sama dengan embedding\r\n            $headerBits = \'\';\r\n            $bitsExtracted = 0;\r\n            $headerSize = 32;\r\n\r\n            $this->logMessage(\"Extracting header...\");\r\n            for ($y = 0; $y < $height; $y++) {\r\n                for ($x = 0; $x < $width; $x++) {\r\n                    if ($bitsExtracted >= $headerSize) break 2;\r\n                    \r\n                    $rgb = imagecolorat($image, $x, $y);\r\n                    $r = ($rgb >> 16) & 0xFF;\r\n                    $g = ($rgb >> 8) & 0xFF;\r\n                    $b = $rgb & 0xFF;\r\n\r\n                    // Extract dari LSB - URUTAN SAMA dengan enkripsi\r\n                    $headerBits .= $r & 1;\r\n                    $bitsExtracted++;\r\n                    if ($bitsExtracted >= $headerSize) break;\r\n                    \r\n                    $headerBits .= $g & 1;\r\n                    $bitsExtracted++;\r\n                    if ($bitsExtracted >= $headerSize) break;\r\n                    \r\n                    $headerBits .= $b & 1;\r\n                    $bitsExtracted++;\r\n                    if ($bitsExtracted >= $headerSize) break;\r\n                }\r\n            }\r\n\r\n            $this->logMessage(\"Header bits extracted: \" . $bitsExtracted);\r\n\r\n            // Convert header bits to message length\r\n            $messageLength = 0;\r\n            for ($i = 0; $i < 32; $i += 8) {\r\n                $byte = bindec(substr($headerBits, $i, 8));\r\n                $messageLength = ($messageLength << 8) | $byte;\r\n            }\r\n\r\n            $this->logMessage(\"Message length from header: \" . $messageLength);\r\n\r\n            if ($messageLength <= 0 || $messageLength > 100000) {\r\n                $this->logMessage(\"No valid message found (invalid length: $messageLength)\");\r\n                imagedestroy($image);\r\n                return false;\r\n            }\r\n\r\n            //  FIXED: Extract encrypted message dengan algoritma yang DIPERBAIKI\r\n            $encryptedBits = \'\';\r\n            $bitsNeeded = $messageLength * 8;\r\n            $bitsExtracted = 0;\r\n\r\n            $this->logMessage(\"Extracting message data ($bitsNeeded bits needed)...\");\r\n            \r\n            //  PERBAIKAN: Gunakan counter bit GLOBAL, bukan skip per pixel\r\n            $globalBitCounter = 0;\r\n            \r\n            for ($y = 0; $y < $height; $y++) {\r\n                for ($x = 0; $x < $width; $x++) {\r\n                    $rgb = imagecolorat($image, $x, $y);\r\n                    $r = ($rgb >> 16) & 0xFF;\r\n                    $g = ($rgb >> 8) & 0xFF;\r\n                    $b = $rgb & 0xFF;\r\n\r\n                    // Process each channel\r\n                    $channels = [$r, $g, $b];\r\n                    \r\n                    foreach ($channels as $channel) {\r\n                        // Skip bits yang sudah digunakan untuk header\r\n                        if ($globalBitCounter < 32) {\r\n                            $globalBitCounter++;\r\n                            continue;\r\n                        }\r\n\r\n                        // Extract message bits setelah header\r\n                        if ($bitsExtracted < $bitsNeeded) {\r\n                            $encryptedBits .= $channel & 1;\r\n                            $bitsExtracted++;\r\n                            $globalBitCounter++;\r\n                        } else {\r\n                            break 3; // Keluar dari semua loop\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            $this->logMessage(\"Message bits extracted: \" . $bitsExtracted);\r\n            $this->logMessage(\"Total bits processed: \" . $globalBitCounter);\r\n\r\n            if ($bitsExtracted < $bitsNeeded) {\r\n                $this->logMessage(\"ERROR: Not enough bits extracted. Needed: $bitsNeeded, Got: $bitsExtracted\");\r\n                imagedestroy($image);\r\n                return false;\r\n            }\r\n\r\n            // Convert bits to bytes\r\n            $encryptedMessage = \'\';\r\n            for ($i = 0; $i < $bitsNeeded; $i += 8) {\r\n                $byteBits = substr($encryptedBits, $i, 8);\r\n                if (strlen($byteBits) < 8) {\r\n                    $this->logMessage(\"ERROR: Incomplete byte at position $i\");\r\n                    break;\r\n                }\r\n                $byte = bindec($byteBits);\r\n                $encryptedMessage .= chr($byte);\r\n            }\r\n\r\n            $this->logMessage(\"Encrypted message length: \" . strlen($encryptedMessage) . \" bytes\");\r\n\r\n            //  FIXED: DECRYPTION dengan error handling yang lebih baik\r\n            $this->logMessage(\"Attempting AES decryption...\");\r\n            \r\n            $decrypted = openssl_decrypt(\r\n                $encryptedMessage,\r\n                \'AES-256-CBC\',\r\n                AES_KEY,\r\n                OPENSSL_RAW_DATA,\r\n                AES_IV\r\n            );\r\n\r\n            if ($decrypted === false) {\r\n                $error = openssl_error_string();\r\n                $this->logMessage(\"AES decryption failed: \" . $error);\r\n                \r\n                // Coba alternatif: handle padding manual\r\n                $decrypted = $this->decryptWithPaddingHandling($encryptedMessage);\r\n                if ($decrypted === false) {\r\n                    $this->logMessage(\"Alternative decryption also failed\");\r\n                    imagedestroy($image);\r\n                    return false;\r\n                }\r\n            }\r\n\r\n            // Remove PKCS7 padding\r\n            $originalMessage = $this->pkcs7Unpad($decrypted);\r\n            \r\n            if ($originalMessage === false) {\r\n                $this->logMessage(\"Padding removal failed, using raw decrypted data\");\r\n                $originalMessage = $decrypted;\r\n            }\r\n            \r\n            $this->logMessage(\" Decryption successful\");\r\n            \r\n            imagedestroy($image);\r\n            \r\n            return $originalMessage;\r\n\r\n        } catch (Exception $e) {\r\n            $this->logMessage(\"ERROR in extractMessageFromImage: \" . $e->getMessage());\r\n            if (isset($image)) {\r\n                imagedestroy($image);\r\n            }\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Alternative decryption dengan padding handling\r\n     */\r\n    private function decryptWithPaddingHandling($encryptedMessage)\r\n    {\r\n        $this->logMessage(\"Trying alternative decryption with padding handling...\");\r\n        \r\n        // Coba tanpa OPENSSL_RAW_DATA dulu\r\n        $decrypted = openssl_decrypt(\r\n            $encryptedMessage,\r\n            \'AES-256-CBC\',\r\n            AES_KEY,\r\n            0, // Bukan raw data\r\n            AES_IV\r\n        );\r\n\r\n        if ($decrypted === false) {\r\n            // Coba dengan zero padding\r\n            $decrypted = openssl_decrypt(\r\n                $encryptedMessage,\r\n                \'AES-256-CBC\',\r\n                AES_KEY,\r\n                OPENSSL_ZERO_PADDING,\r\n                AES_IV\r\n            );\r\n        }\r\n\r\n        return $decrypted;\r\n    }\r\n\r\n    /**\r\n     * PKCS7 Unpadding dengan error handling\r\n     */\r\n    private function pkcs7Unpad($data)\r\n    {\r\n        if (empty($data)) return \'\';\r\n        \r\n        $dataLength = strlen($data);\r\n        if ($dataLength == 0) return \'\';\r\n        \r\n        $padding = ord($data[$dataLength - 1]);\r\n        \r\n        // Validasi padding\r\n        if ($padding > 16 || $padding == 0 || $padding > $dataLength) {\r\n            return $data; // Return data as-is jika padding invalid\r\n        }\r\n        \r\n        // Check semua byte padding\r\n        for ($i = 0; $i < $padding; $i++) {\r\n            if (ord($data[$dataLength - $i - 1]) != $padding) {\r\n                return $data; // Return data as-is jika padding tidak konsisten\r\n            }\r\n        }\r\n        \r\n        return substr($data, 0, -$padding);\r\n    }\r\n\r\n    /**\r\n     * New endpoint untuk download decrypted PDF\r\n     */\r\n    private function downloadDecryptedPdf()\r\n    {\r\n        try {\r\n            $patientId = intval($_GET[\'patient_id\'] ?? 0);\r\n\r\n            if ($patientId <= 0) {\r\n                throw new Exception(\"Patient ID tidak valid\");\r\n            }\r\n\r\n            // Get patient data including PDF filename\r\n            $query = \"SELECT dokumen_pdf FROM pasien WHERE id_pasien = ?\";\r\n            $stmt = $this->conn->prepare($query);\r\n            $stmt->bind_param(\"i\", $patientId);\r\n            $stmt->execute();\r\n            $result = $stmt->get_result();\r\n\r\n            if ($result->num_rows === 0) {\r\n                throw new Exception(\"Data pasien tidak ditemukan\");\r\n            }\r\n\r\n            $patient = $result->fetch_assoc();\r\n            $encryptedPdfFilename = $patient[\'dokumen_pdf\'];\r\n\r\n            if (empty($encryptedPdfFilename)) {\r\n                throw new Exception(\"Tidak ada dokumen PDF untuk pasien ini\");\r\n            }\r\n\r\n            // Find the encrypted PDF file\r\n            $possiblePaths = [\r\n                __DIR__ . \'/../../uploads/pdfs/\' . $encryptedPdfFilename,\r\n                __DIR__ . \'/../uploads/pdfs/\' . $encryptedPdfFilename,\r\n                $_SERVER[\'DOCUMENT_ROOT\'] . \'/uploads/pdfs/\' . $encryptedPdfFilename,\r\n            ];\r\n\r\n            $pdfPath = null;\r\n            foreach ($possiblePaths as $path) {\r\n                if (file_exists($path)) {\r\n                    $pdfPath = $path;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if ($pdfPath === null) {\r\n                throw new Exception(\"File PDF tidak ditemukan\");\r\n            }\r\n\r\n            // Read encrypted file\r\n            $encryptedContent = file_get_contents($pdfPath);\r\n            if ($encryptedContent === false) {\r\n                throw new Exception(\"Tidak dapat membaca file PDF\");\r\n            }\r\n\r\n            // Decrypt PDF\r\n            $decryptedContent = $this->decryptPdfFile($encryptedContent);\r\n            if ($decryptedContent === false) {\r\n                throw new Exception(\"Gagal mendekripsi PDF\");\r\n            }\r\n\r\n            // Set headers for download\r\n            header(\'Content-Type: application/pdf\');\r\n            header(\'Content-Disposition: attachment; filename=\"decrypted_patient_\' . $patientId . \'.pdf\"\');\r\n            header(\'Content-Length: \' . strlen($decryptedContent));\r\n\r\n            echo $decryptedContent;\r\n            exit;\r\n\r\n        } catch (Exception $e) {\r\n            $this->sendError(\"Error downloading PDF: \" . $e->getMessage());\r\n        }\r\n    }\r\n\r\n    /**\r\n     *  NEW: Endpoint khusus untuk ekstraksi steganografi\r\n     */\r\n    private function extractSteganographyMessage()\r\n    {\r\n        try {\r\n            $patientId = intval($_GET[\'patient_id\'] ?? $_POST[\'patient_id\'] ?? 0);\r\n\r\n            if ($patientId <= 0) {\r\n                throw new Exception(\"Patient ID tidak valid\");\r\n            }\r\n\r\n            $query = \"SELECT foto_pasien FROM pasien WHERE id_pasien = ?\";\r\n            $stmt = $this->conn->prepare($query);\r\n            $stmt->bind_param(\"i\", $patientId);\r\n            $stmt->execute();\r\n            $result = $stmt->get_result();\r\n\r\n            if ($result->num_rows === 0) {\r\n                throw new Exception(\"Data pasien tidak ditemukan\");\r\n            }\r\n\r\n            $patient = $result->fetch_assoc();\r\n            $imageFilename = $patient[\'foto_pasien\'];\r\n\r\n            if (empty($imageFilename)) {\r\n                throw new Exception(\"Tidak ada gambar untuk pasien ini\");\r\n            }\r\n\r\n            // Find the image file\r\n            $possiblePaths = [\r\n                __DIR__ . \'/../../uploads/images/\' . $imageFilename,\r\n                __DIR__ . \'/../uploads/images/\' . $imageFilename,\r\n                $_SERVER[\'DOCUMENT_ROOT\'] . \'/uploads/images/\' . $imageFilename,\r\n            ];\r\n\r\n            $imagePath = null;\r\n            foreach ($possiblePaths as $path) {\r\n                if (file_exists($path)) {\r\n                    $imagePath = $path;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if ($imagePath === null) {\r\n                throw new Exception(\"File gambar tidak ditemukan\");\r\n            }\r\n\r\n            // Extract message menggunakan algoritma yang sudah diperbaiki\r\n            $message = $this->extractMessageFromImage($imagePath);\r\n\r\n            if ($message === false) {\r\n                throw new Exception(\"Tidak dapat mengekstrak pesan dari gambar\");\r\n            }\r\n\r\n            $this->sendSuccess([\r\n                \'message\' => $message,\r\n                \'patient_id\' => $patientId,\r\n                \'image_file\' => $imageFilename\r\n            ], \"Pesan berhasil diekstrak dari gambar\");\r\n\r\n        } catch (Exception $e) {\r\n            $this->sendError(\"Error extracting steganography: \" . $e->getMessage());\r\n        }\r\n    }\r\n\r\n    // ==================== DATA RETRIEVAL METHODS ====================\r\n\r\n    private function getDashboardStats()\r\n    {\r\n        try {\r\n            // Total patients\r\n            $totalQuery = \"SELECT COUNT(*) as total_pasien FROM pasien\";\r\n            $totalResult = $this->conn->query($totalQuery);\r\n            $total = $totalResult->fetch_assoc();\r\n\r\n            // Rawat inap count\r\n            $inapQuery = \"SELECT COUNT(*) as rawat_inap FROM pasien WHERE informasi_medis = \'rawat-inap\'\";\r\n            $inapResult = $this->conn->query($inapQuery);\r\n            $inap = $inapResult->fetch_assoc();\r\n\r\n            // Rawat jalan count\r\n            $jalanQuery = \"SELECT COUNT(*) as rawat_jalan FROM pasien WHERE informasi_medis = \'rawat-jalan\'\";\r\n            $jalanResult = $this->conn->query($jalanQuery);\r\n            $jalan = $jalanResult->fetch_assoc();\r\n\r\n            // Pemeriksaan count\r\n            $pemeriksaanQuery = \"SELECT COUNT(*) as pemeriksaan FROM pasien WHERE informasi_medis = \'pemeriksaan\'\";\r\n            $pemeriksaanResult = $this->conn->query($pemeriksaanQuery);\r\n            $pemeriksaan = $pemeriksaanResult->fetch_assoc();\r\n\r\n            // Total payment\r\n            $paymentQuery = \"SELECT COALESCE(SUM(jumlah_pembayaran), 0) as total_pembayaran FROM pasien\";\r\n            $paymentResult = $this->conn->query($paymentQuery);\r\n            $payment = $paymentResult->fetch_assoc();\r\n\r\n            // New patients (last 7 days)\r\n            $newQuery = \"SELECT COUNT(*) as pasien_baru FROM pasien WHERE created_at >= DATE_SUB(NOW(), INTERVAL 7 DAY)\";\r\n            $newResult = $this->conn->query($newQuery);\r\n            $new = $newResult->fetch_assoc();\r\n\r\n            $stats = [\r\n                \'total_pasien\' => (int)$total[\'total_pasien\'],\r\n                \'rawat_inap\' => (int)$inap[\'rawat_inap\'],\r\n                \'rawat_jalan\' => (int)$jalan[\'rawat_jalan\'],\r\n                \'pemeriksaan\' => (int)$pemeriksaan[\'pemeriksaan\'],\r\n                \'total_pembayaran\' => (float)$payment[\'total_pembayaran\'],\r\n                \'pasien_baru\' => (int)$new[\'pasien_baru\']\r\n            ];\r\n\r\n            $this->sendSuccess($stats, \"Stats loaded successfully\");\r\n\r\n        } catch (Exception $e) {\r\n            $this->sendError(\"Error loading stats: \" . $e->getMessage());\r\n        }\r\n    }\r\n\r\n    private function getRecentPatients()\r\n    {\r\n        try {\r\n            $query = \"SELECT * FROM pasien ORDER BY created_at DESC LIMIT 5\";\r\n            $result = $this->conn->query($query);\r\n\r\n            $patients = [];\r\n            while ($row = $result->fetch_assoc()) {\r\n                // Decrypt the data\r\n                $row[\'nama_lengkap\'] = $this->xorDecrypt($row[\'nama_lengkap\'], XOR_KEY);\r\n                $row[\'alamat_lengkap\'] = $this->xorDecrypt($row[\'alamat_lengkap\'], XOR_KEY);\r\n                $row[\'hasil_pemeriksaan\'] = $this->altbashAesDecrypt($row[\'hasil_pemeriksaan\']);\r\n                \r\n                $patients[] = $row;\r\n            }\r\n\r\n            $this->sendSuccess($patients, \"Recent patients loaded\");\r\n\r\n        } catch (Exception $e) {\r\n            $this->sendError(\"Error loading recent patients: \" . $e->getMessage());\r\n        }\r\n    }\r\n\r\n    private function getPatientsList()\r\n    {\r\n        try {\r\n            $page = intval($_GET[\'page\'] ?? 1);\r\n            $limit = intval($_GET[\'limit\'] ?? 10);\r\n            $search = $_GET[\'search\'] ?? \'\';\r\n            $status = $_GET[\'status\'] ?? \'\';\r\n            $service = $_GET[\'service\'] ?? \'\';\r\n\r\n            $offset = ($page - 1) * $limit;\r\n\r\n            // Build WHERE conditions\r\n            $whereConditions = [];\r\n            $params = [];\r\n            $types = \'\';\r\n\r\n            if (!empty($search)) {\r\n                $whereConditions[] = \"(nama_lengkap LIKE ? OR alamat_lengkap LIKE ?)\";\r\n                $searchTerm = \"%$search%\";\r\n                $params[] = $searchTerm;\r\n                $params[] = $searchTerm;\r\n                $types .= \'ss\';\r\n            }\r\n\r\n            if (!empty($status)) {\r\n                $whereConditions[] = \"status_pasien = ?\";\r\n                $params[] = $status;\r\n                $types .= \'s\';\r\n            }\r\n\r\n            if (!empty($service)) {\r\n                $whereConditions[] = \"informasi_medis = ?\";\r\n                $params[] = $service;\r\n                $types .= \'s\';\r\n            }\r\n\r\n            $whereClause = \'\';\r\n            if (!empty($whereConditions)) {\r\n                $whereClause = \"WHERE \" . implode(\" AND \", $whereConditions);\r\n            }\r\n\r\n            // Count total records\r\n            $countQuery = \"SELECT COUNT(*) as total FROM pasien $whereClause\";\r\n            $countStmt = $this->conn->prepare($countQuery);\r\n            \r\n            if (!empty($params)) {\r\n                $countStmt->bind_param($types, ...$params);\r\n            }\r\n            \r\n            $countStmt->execute();\r\n            $countResult = $countStmt->get_result();\r\n            $totalCount = $countResult->fetch_assoc()[\'total\'];\r\n            $totalPages = ceil($totalCount / $limit);\r\n\r\n            $dataQuery = \"SELECT * FROM pasien $whereClause ORDER BY created_at DESC, id_pasien DESC LIMIT ? OFFSET ?\";\r\n            $dataStmt = $this->conn->prepare($dataQuery);\r\n            \r\n            $params[] = $limit;\r\n            $params[] = $offset;\r\n            $types .= \'ii\';\r\n\r\n            if (!empty($params)) {\r\n                $dataStmt->bind_param($types, ...$params);\r\n            }\r\n            \r\n            $dataStmt->execute();\r\n            $result = $dataStmt->get_result();\r\n\r\n            $patients = [];\r\n            while ($row = $result->fetch_assoc()) {\r\n                // Decrypt the data for display\r\n                $row[\'nama_lengkap\'] = $this->xorDecrypt($row[\'nama_lengkap\'], XOR_KEY);\r\n                $row[\'alamat_lengkap\'] = $this->xorDecrypt($row[\'alamat_lengkap\'], XOR_KEY);\r\n                $row[\'hasil_pemeriksaan\'] = $this->altbashAesDecrypt($row[\'hasil_pemeriksaan\']);\r\n                \r\n                $patients[] = $row;\r\n            }\r\n\r\n            $response = [\r\n                \'patients\' => $patients,\r\n                \'total_pages\' => $totalPages,\r\n                \'current_page\' => $page,\r\n                \'total_count\' => $totalCount\r\n            ];\r\n\r\n            $this->sendSuccess($response, \"Patients list loaded\");\r\n\r\n        } catch (Exception $e) {\r\n            $this->sendError(\"Error loading patients list: \" . $e->getMessage());\r\n        }\r\n    }\r\n\r\n    private function getPatientDetail()\r\n    {\r\n        try {\r\n            $patientId = intval($_GET[\'patient_id\'] ?? $_POST[\'patient_id\'] ?? 0);\r\n\r\n            if ($patientId <= 0) {\r\n                throw new Exception(\"Patient ID tidak valid\");\r\n            }\r\n\r\n            $query = \"SELECT * FROM pasien WHERE id_pasien = ?\";\r\n            $stmt = $this->conn->prepare($query);\r\n            $stmt->bind_param(\"i\", $patientId);\r\n            $stmt->execute();\r\n            $result = $stmt->get_result();\r\n\r\n            if ($result->num_rows === 0) {\r\n                throw new Exception(\"Data pasien tidak ditemukan\");\r\n            }\r\n\r\n            $patient = $result->fetch_assoc();\r\n\r\n            // Decrypt all encrypted data\r\n            $patient[\'nama_lengkap\'] = $this->xorDecrypt($patient[\'nama_lengkap\'], XOR_KEY);\r\n            $patient[\'alamat_lengkap\'] = $this->xorDecrypt($patient[\'alamat_lengkap\'], XOR_KEY);\r\n            $patient[\'hasil_pemeriksaan\'] = $this->altbashAesDecrypt($patient[\'hasil_pemeriksaan\']);\r\n\r\n            //  FIXED: Extract medical message from image menggunakan algoritma yang sudah diperbaiki\r\n            $medicalMessage = \'\';\r\n            if (!empty($patient[\'foto_pasien\'])) {\r\n                $possiblePaths = [\r\n                    __DIR__ . \'/../../uploads/images/\' . $patient[\'foto_pasien\'],\r\n                    __DIR__ . \'/../uploads/images/\' . $patient[\'foto_pasien\'],\r\n                    $_SERVER[\'DOCUMENT_ROOT\'] . \'/uploads/images/\' . $patient[\'foto_pasien\'],\r\n                ];\r\n\r\n                $imagePath = null;\r\n                foreach ($possiblePaths as $path) {\r\n                    if (file_exists($path)) {\r\n                        $imagePath = $path;\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                if ($imagePath !== null) {\r\n                    $medicalMessage = $this->extractMessageFromImage($imagePath);\r\n                    if ($medicalMessage === false) {\r\n                        $medicalMessage = \'\'; // Jika ekstraksi gagal, set kosong\r\n                    }\r\n                }\r\n            }\r\n            $patient[\'medical_message\'] = $medicalMessage;\r\n\r\n            $this->sendSuccess($patient, \"Patient detail loaded\");\r\n\r\n        } catch (Exception $e) {\r\n            $this->sendError(\"Error loading patient detail: \" . $e->getMessage());\r\n        }\r\n    }\r\n\r\n    private function updatePatient()\r\n    {\r\n        try {\r\n            $patientId = intval($_POST[\'patient_id\'] ?? 0);\r\n            \r\n            if ($patientId <= 0) {\r\n                throw new Exception(\"Patient ID tidak valid\");\r\n            }\r\n\r\n            // Get form data\r\n            $nama_pasien = $this->sanitizeInput($_POST[\'nama_pasien\']);\r\n            $tanggal_lahir = $_POST[\'tanggal_lahir\'];\r\n            $alamat = $this->sanitizeInput($_POST[\'alamat\']);\r\n            $jenis_layanan = $this->sanitizeInput($_POST[\'jenis_layanan\']);\r\n            $status_pasien = $this->sanitizeInput($_POST[\'status_pasien\']);\r\n            $hasil_pemeriksaan = $this->sanitizeInput($_POST[\'hasil_pemeriksaan\']);\r\n            $jumlah_pembayaran = floatval($_POST[\'jumlah_pembayaran\']);\r\n\r\n            // Encrypt data before updating\r\n            $encrypted_nama = $this->xorEncrypt($nama_pasien, XOR_KEY);\r\n            $encrypted_alamat = $this->xorEncrypt($alamat, XOR_KEY);\r\n            $encrypted_hasil = $this->altbashAesEncrypt($hasil_pemeriksaan);\r\n\r\n            $query = \"UPDATE pasien SET \r\n                nama_lengkap = ?, \r\n                tanggal_lahir = ?, \r\n                alamat_lengkap = ?, \r\n                informasi_medis = ?, \r\n                status_pasien = ?, \r\n                hasil_pemeriksaan = ?, \r\n                jumlah_pembayaran = ?,\r\n                updated_at = NOW()\r\n                WHERE id_pasien = ?\";\r\n\r\n            $stmt = $this->conn->prepare($query);\r\n            $stmt->bind_param(\r\n                \"ssssssdi\",\r\n                $encrypted_nama,\r\n                $tanggal_lahir,\r\n                $encrypted_alamat,\r\n                $jenis_layanan,\r\n                $status_pasien,\r\n                $encrypted_hasil,\r\n                $jumlah_pembayaran,\r\n                $patientId\r\n            );\r\n\r\n            if ($stmt->execute()) {\r\n                $this->sendSuccess([], \"Data pasien berhasil diperbarui\");\r\n            } else {\r\n                throw new Exception(\"Gagal memperbarui data: \" . $stmt->error);\r\n            }\r\n\r\n        } catch (Exception $e) {\r\n            $this->sendError(\"Error updating patient: \" . $e->getMessage());\r\n        }\r\n    }\r\n\r\n    private function deletePatient()\r\n    {\r\n        try {\r\n            $patientId = intval($_POST[\'patient_id\'] ?? 0);\r\n\r\n            if ($patientId <= 0) {\r\n                throw new Exception(\"Patient ID tidak valid\");\r\n            }\r\n\r\n            $query = \"DELETE FROM pasien WHERE id_pasien = ?\";\r\n            $stmt = $this->conn->prepare($query);\r\n            $stmt->bind_param(\"i\", $patientId);\r\n\r\n            if ($stmt->execute()) {\r\n                $this->sendSuccess([], \"Data pasien berhasil dihapus\");\r\n            } else {\r\n                throw new Exception(\"Gagal menghapus data: \" . $stmt->error);\r\n            }\r\n\r\n        } catch (Exception $e) {\r\n            $this->sendError(\"Error deleting patient: \" . $e->getMessage());\r\n        }\r\n    }\r\n\r\n    // ==================== ENCRYPTION METHODS (for update) ====================\r\n\r\n    private function xorEncrypt($data, $key)\r\n    {\r\n        if (empty($data)) return \'\';\r\n\r\n        $data = mb_convert_encoding($data, \'UTF-8\');\r\n        $key = mb_convert_encoding($key, \'UTF-8\');\r\n\r\n        $encrypted = \'\';\r\n        $dataLen = mb_strlen($data, \'UTF-8\');\r\n        $keyLen = mb_strlen($key, \'UTF-8\');\r\n\r\n        for ($i = 0; $i < $dataLen; $i++) {\r\n            $dataChar = mb_substr($data, $i, 1, \'UTF-8\');\r\n            $keyChar = mb_substr($key, $i % $keyLen, 1, \'UTF-8\');\r\n\r\n            $dataAscii = ord($dataChar);\r\n            $keyAscii = ord($keyChar);\r\n            $encryptedAscii = $dataAscii ^ $keyAscii;\r\n\r\n            $encrypted .= chr($encryptedAscii);\r\n        }\r\n\r\n        return base64_encode($encrypted);\r\n    }\r\n\r\n    private function altbashAesEncrypt($data)\r\n    {\r\n        if (empty($data)) return \'\';\r\n\r\n        $altbash_encrypted = $this->altbashEncrypt($data);\r\n        $aes_encrypted = $this->aesEncrypt($altbash_encrypted);\r\n\r\n        return $aes_encrypted;\r\n    }\r\n\r\n    private function altbashEncrypt($data)\r\n    {\r\n        if (empty($data)) return \'\';\r\n\r\n        $data = mb_convert_encoding($data, \'UTF-8\');\r\n        $key = mb_convert_encoding(XOR_KEY, \'UTF-8\');\r\n\r\n        $encrypted = \'\';\r\n        $dataLen = mb_strlen($data, \'UTF-8\');\r\n        $keyLen = mb_strlen($key, \'UTF-8\');\r\n\r\n        for ($i = 0; $i < $dataLen; $i++) {\r\n            $char = mb_substr($data, $i, 1, \'UTF-8\');\r\n            $ascii = ord($char);\r\n            $shifted_ascii = ($ascii + 3) % 256;\r\n            $encrypted .= chr($shifted_ascii);\r\n        }\r\n\r\n        $xor_encrypted = \'\';\r\n        for ($i = 0; $i < $dataLen; $i++) {\r\n            $dataChar = $encrypted[$i];\r\n            $keyChar = mb_substr($key, $i % $keyLen, 1, \'UTF-8\');\r\n\r\n            $dataAscii = ord($dataChar);\r\n            $keyAscii = ord($keyChar);\r\n            $xorAscii = $dataAscii ^ $keyAscii;\r\n\r\n            $xor_encrypted .= chr($xorAscii);\r\n        }\r\n\r\n        $reversed = strrev($xor_encrypted);\r\n        return base64_encode($reversed);\r\n    }\r\n\r\n    private function aesEncrypt($data)\r\n    {\r\n        if (empty($data)) return \'\';\r\n\r\n        $encrypted = openssl_encrypt(\r\n            $data,\r\n            \'AES-256-CBC\',\r\n            AES_KEY,\r\n            OPENSSL_RAW_DATA,\r\n            AES_IV\r\n        );\r\n\r\n        return base64_encode($encrypted);\r\n    }\r\n\r\n    // ==================== UTILITY METHODS ====================\r\n\r\n    private function logMessage($message)\r\n    {\r\n        $timestamp = date(\'Y-m-d H:i:s\');\r\n        $logMessage = \"[$timestamp] $message\\n\";\r\n        error_log($logMessage, 3, __DIR__ . \'/dashboard_errors.log\');\r\n    }\r\n\r\n    private function sanitizeInput($data)\r\n    {\r\n        if ($this->conn) {\r\n            return $this->conn->real_escape_string(trim($data));\r\n        }\r\n        return trim($data);\r\n    }\r\n\r\n    private function sendSuccess($data, $message = \"\")\r\n    {\r\n        echo json_encode([\r\n            \'success\' => true,\r\n            \'message\' => $message,\r\n            \'data\' => $data\r\n        ], JSON_UNESCAPED_UNICODE);\r\n        exit;\r\n    }\r\n\r\n    private function sendError($message, $code = 400)\r\n    {\r\n        http_response_code($code);\r\n        echo json_encode([\r\n            \'success\' => false,\r\n            \'error\' => $message\r\n        ], JSON_UNESCAPED_UNICODE);\r\n        exit;\r\n    }\r\n\r\n    public function __destruct()\r\n    {\r\n        if ($this->conn) {\r\n            $this->conn->close();\r\n        }\r\n    }\r\n}\r\n\r\n// Handle the request\r\n$handler = new DashboardView();\r\n$handler->handleRequest();\r\n?>
[2025-11-11 17:05:41] Data encrypted successfully
[2025-11-11 17:05:41] Starting file upload process...
[2025-11-11 17:05:41] === START FILE UPLOAD: fotoPasien ===
[2025-11-11 17:05:41] File info: Array
(
    [name] => Gemini_Generated_Image_62snf262snf262sn.png
    [full_path] => Gemini_Generated_Image_62snf262snf262sn.png
    [type] => image/png
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpSvg44l
    [error] => 0
    [size] => 1713178
)

[2025-11-11 17:05:41] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-11 17:05:41] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-11 17:05:41] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-11 17:05:41] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-11 17:05:41] Directory is writable
[2025-11-11 17:05:41] Detected MIME type: image/png
[2025-11-11 17:05:41] Image validation: VALID
[2025-11-11 17:05:41] File validation passed
[2025-11-11 17:05:41] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/69135ed59af6d_1762877141.png
[2025-11-11 17:05:41] Temp file exists: YES
[2025-11-11 17:05:41] Temp file size: 1713178
[2025-11-11 17:05:41] Starting image steganography process...
[2025-11-11 17:05:41] Medical message for steganography: <?php\r\n\r\nini_set(\'display_errors\', 1);\r\nini_set(\'display_startup_errors\', 1);\r\nerror_reporting(E_ALL);\r\nini_set(\'log_errors\', 1);\r\nini_set(\'error_log\', __DIR__ . \'/dashboard_errors.log\');\r\n\r\nheader(\'Content-Type: application/json; charset=utf-8\');\r\nheader(\'Access-Control-Allow-Origin: *\');\r\nheader(\'Access-Control-Allow-Methods: GET, POST, OPTIONS\');\r\nheader(\'Access-Control-Allow-Headers: Content-Type\');\r\n\r\n// Database configuration\r\ndefine(\'DB_HOST\', \'localhost\');\r\ndefine(\'DB_USER\', \'root\');\r\ndefine(\'DB_PASS\', \'\');\r\ndefine(\'DB_NAME\', \'kriptoproject\');\r\n\r\n// Encryption keys (SAMA dengan yang di upload.php)\r\ndefine(\'XOR_KEY\', \'medicare_secret_key_2024\');\r\ndefine(\'AES_KEY\', \'medicare_aes_key_2024_32bytes_long!\');\r\ndefine(\'AES_IV\', \'1234567890123456\');\r\n\r\nclass DashboardView\r\n{\r\n    private $conn;\r\n\r\n    public function __construct()\r\n    {\r\n        $this->connectDB();\r\n    }\r\n\r\n    private function connectDB()\r\n    {\r\n        try {\r\n            $this->conn = new mysqli(DB_HOST, DB_USER, DB_PASS, DB_NAME);\r\n\r\n            if ($this->conn->connect_error) {\r\n                throw new Exception(\"Koneksi database gagal: \" . $this->conn->connect_error);\r\n            }\r\n\r\n            $this->conn->set_charset(\"utf8mb4\");\r\n        } catch (Exception $e) {\r\n            $this->sendError($e->getMessage());\r\n        }\r\n    }\r\n\r\n    public function handleRequest()\r\n    {\r\n        $action = $_GET[\'action\'] ?? $_POST[\'action\'] ?? \'\';\r\n\r\n        switch ($action) {\r\n            case \'get_stats\':\r\n                $this->getDashboardStats();\r\n                break;\r\n            case \'get_recent_patients\':\r\n                $this->getRecentPatients();\r\n                break;\r\n            case \'get_patients\':\r\n                $this->getPatientsList();\r\n                break;\r\n            case \'get_patient_detail\':\r\n                $this->getPatientDetail();\r\n                break;\r\n            case \'update_patient\':\r\n                $this->updatePatient();\r\n                break;\r\n            case \'delete_patient\':\r\n                $this->deletePatient();\r\n                break;\r\n            case \'download_decrypted_pdf\':\r\n                $this->downloadDecryptedPdf();\r\n                break;\r\n            case \'extract_steganography\': // NEW ACTION untuk ekstraksi steganografi\r\n                $this->extractSteganographyMessage();\r\n                break;\r\n            default:\r\n                $this->sendError(\'Action tidak valid\');\r\n        }\r\n    }\r\n\r\n    // ==================== IMPROVED DECRYPTION METHODS ====================\r\n\r\n    /**\r\n     * Decrypt XOR encrypted data\r\n     */\r\n    private function xorDecrypt($encryptedData, $key)\r\n    {\r\n        if (empty($encryptedData)) return \'\';\r\n\r\n        $data = base64_decode($encryptedData);\r\n        $key = mb_convert_encoding($key, \'UTF-8\');\r\n\r\n        $decrypted = \'\';\r\n        $dataLen = strlen($data);\r\n        $keyLen = mb_strlen($key, \'UTF-8\');\r\n\r\n        for ($i = 0; $i < $dataLen; $i++) {\r\n            $dataChar = $data[$i];\r\n            $keyChar = mb_substr($key, $i % $keyLen, 1, \'UTF-8\');\r\n\r\n            $dataAscii = ord($dataChar);\r\n            $keyAscii = ord($keyChar);\r\n            $decryptedAscii = $dataAscii ^ $keyAscii;\r\n\r\n            $decrypted .= chr($decryptedAscii);\r\n        }\r\n\r\n        return $decrypted;\r\n    }\r\n\r\n    /**\r\n     * Decrypt AES encrypted data\r\n     */\r\n    private function aesDecrypt($encryptedData)\r\n    {\r\n        if (empty($encryptedData)) return \'\';\r\n\r\n        $encrypted = base64_decode($encryptedData);\r\n        \r\n        $decrypted = openssl_decrypt(\r\n            $encrypted,\r\n            \'AES-256-CBC\',\r\n            AES_KEY,\r\n            OPENSSL_RAW_DATA,\r\n            AES_IV\r\n        );\r\n\r\n        return $decrypted ?: \'\';\r\n    }\r\n\r\n    /**\r\n     * Decrypt AltBash + AES encrypted data\r\n     */\r\n    private function altbashAesDecrypt($encryptedData)\r\n    {\r\n        if (empty($encryptedData)) return \'\';\r\n\r\n        // First decrypt AES\r\n        $altbashEncrypted = $this->aesDecrypt($encryptedData);\r\n        if (empty($altbashEncrypted)) return \'\';\r\n\r\n        // Then decrypt AltBash\r\n        return $this->altbashDecrypt($altbashEncrypted);\r\n    }\r\n\r\n    /**\r\n     * Decrypt Alphabet-Bashing encrypted data\r\n     */\r\n    private function altbashDecrypt($encryptedData)\r\n    {\r\n        if (empty($encryptedData)) return \'\';\r\n\r\n        $data = base64_decode($encryptedData);\r\n        $reversed = strrev($data);\r\n        $key = mb_convert_encoding(XOR_KEY, \'UTF-8\');\r\n\r\n        $xorDecrypted = \'\';\r\n        $dataLen = strlen($reversed);\r\n        $keyLen = mb_strlen($key, \'UTF-8\');\r\n\r\n        for ($i = 0; $i < $dataLen; $i++) {\r\n            $dataChar = $reversed[$i];\r\n            $keyChar = mb_substr($key, $i % $keyLen, 1, \'UTF-8\');\r\n\r\n            $dataAscii = ord($dataChar);\r\n            $keyAscii = ord($keyChar);\r\n            $xorAscii = $dataAscii ^ $keyAscii;\r\n\r\n            $xorDecrypted .= chr($xorAscii);\r\n        }\r\n\r\n        $decrypted = \'\';\r\n        $dataLen = strlen($xorDecrypted);\r\n\r\n        for ($i = 0; $i < $dataLen; $i++) {\r\n            $char = $xorDecrypted[$i];\r\n            $ascii = ord($char);\r\n            $shiftedAscii = ($ascii - 3 + 256) % 256;\r\n            $decrypted .= chr($shiftedAscii);\r\n        }\r\n\r\n        return $decrypted;\r\n    }\r\n\r\n    /**\r\n     * Decrypt PDF file that was encrypted with Caesar + AES\r\n     */\r\n    private function decryptPdfFile($encryptedContent)\r\n    {\r\n        try {\r\n            // Step 1: AES decryption\r\n            $aesDecrypted = $this->aesDecryptBinary($encryptedContent);\r\n            if ($aesDecrypted === false) {\r\n                throw new Exception(\"AES decryption failed\");\r\n            }\r\n\r\n            // Step 2: Caesar Cipher decryption (shift of 5)\r\n            $decrypted = $this->caesarCipherDecrypt($aesDecrypted, 5);\r\n\r\n            return $decrypted;\r\n        } catch (Exception $e) {\r\n            $this->logMessage(\"ERROR in decryptPdfFile: \" . $e->getMessage());\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * AES decryption for binary data\r\n     */\r\n    private function aesDecryptBinary($data)\r\n    {\r\n        if (empty($data)) {\r\n            return false;\r\n        }\r\n\r\n        $decrypted = openssl_decrypt(\r\n            $data,\r\n            \'AES-256-CBC\',\r\n            AES_KEY,\r\n            OPENSSL_RAW_DATA,\r\n            AES_IV\r\n        );\r\n\r\n        return $decrypted;\r\n    }\r\n\r\n    /**\r\n     * Caesar Cipher decryption for binary data\r\n     */\r\n    private function caesarCipherDecrypt($data, $shift)\r\n    {\r\n        $decrypted = \'\';\r\n        $length = strlen($data);\r\n        \r\n        for ($i = 0; $i < $length; $i++) {\r\n            $byte = ord($data[$i]);\r\n            // Apply Caesar shift (mod 256 for bytes)\r\n            $decryptedByte = ($byte - $shift + 256) % 256;\r\n            $decrypted .= chr($decryptedByte);\r\n        }\r\n        \r\n        return $decrypted;\r\n    }\r\n\r\n    /**\r\n     *  FIXED: Extract hidden message from steganographed image menggunakan algoritma yang sama dengan test\r\n     */\r\n    private function extractMessageFromImage($imagePath)\r\n    {\r\n        try {\r\n            $this->logMessage(\"=== EXTRACTING MESSAGE FROM IMAGE (FIXED ALGORITHM) ===\");\r\n            \r\n            if (!file_exists($imagePath)) {\r\n                throw new Exception(\"Image file not found: \" . $imagePath);\r\n            }\r\n\r\n            $imageInfo = getimagesize($imagePath);\r\n            if ($imageInfo === false) {\r\n                throw new Exception(\"Cannot get image information\");\r\n            }\r\n\r\n            $width = $imageInfo[0];\r\n            $height = $imageInfo[1];\r\n            $imageType = $imageInfo[2];\r\n            \r\n            $this->logMessage(\"Image dimensions: {$width}x{$height}, Type: {$imageType}\");\r\n\r\n            // Load image - support WebP dan format lainnya\r\n            $image = null;\r\n            switch ($imageType) {\r\n                case IMAGETYPE_JPEG:\r\n                    $image = imagecreatefromjpeg($imagePath);\r\n                    $this->logMessage(\"Loaded as JPEG\");\r\n                    break;\r\n                case IMAGETYPE_PNG:\r\n                    $image = imagecreatefrompng($imagePath);\r\n                    $this->logMessage(\"Loaded as PNG\");\r\n                    break;\r\n                case IMAGETYPE_GIF:\r\n                    $image = imagecreatefromgif($imagePath);\r\n                    $this->logMessage(\"Loaded as GIF\");\r\n                    break;\r\n                case 18: // IMAGETYPE_WEBP\r\n                    if (function_exists(\'imagecreatefromwebp\')) {\r\n                        $image = imagecreatefromwebp($imagePath);\r\n                        $this->logMessage(\"Loaded as WEBP\");\r\n                    } else {\r\n                        throw new Exception(\"WebP not supported on this server\");\r\n                    }\r\n                    break;\r\n                default:\r\n                    throw new Exception(\"Unsupported image type: \" . $imageType);\r\n            }\r\n\r\n            if (!$image) {\r\n                throw new Exception(\"Cannot create image from source\");\r\n            }\r\n\r\n            //  FIXED: Extract header menggunakan algoritma yang sama dengan embedding\r\n            $headerBits = \'\';\r\n            $bitsExtracted = 0;\r\n            $headerSize = 32;\r\n\r\n            $this->logMessage(\"Extracting header...\");\r\n            for ($y = 0; $y < $height; $y++) {\r\n                for ($x = 0; $x < $width; $x++) {\r\n                    if ($bitsExtracted >= $headerSize) break 2;\r\n                    \r\n                    $rgb = imagecolorat($image, $x, $y);\r\n                    $r = ($rgb >> 16) & 0xFF;\r\n                    $g = ($rgb >> 8) & 0xFF;\r\n                    $b = $rgb & 0xFF;\r\n\r\n                    // Extract dari LSB - URUTAN SAMA dengan enkripsi\r\n                    $headerBits .= $r & 1;\r\n                    $bitsExtracted++;\r\n                    if ($bitsExtracted >= $headerSize) break;\r\n                    \r\n                    $headerBits .= $g & 1;\r\n                    $bitsExtracted++;\r\n                    if ($bitsExtracted >= $headerSize) break;\r\n                    \r\n                    $headerBits .= $b & 1;\r\n                    $bitsExtracted++;\r\n                    if ($bitsExtracted >= $headerSize) break;\r\n                }\r\n            }\r\n\r\n            $this->logMessage(\"Header bits extracted: \" . $bitsExtracted);\r\n\r\n            // Convert header bits to message length\r\n            $messageLength = 0;\r\n            for ($i = 0; $i < 32; $i += 8) {\r\n                $byte = bindec(substr($headerBits, $i, 8));\r\n                $messageLength = ($messageLength << 8) | $byte;\r\n            }\r\n\r\n            $this->logMessage(\"Message length from header: \" . $messageLength);\r\n\r\n            if ($messageLength <= 0 || $messageLength > 100000) {\r\n                $this->logMessage(\"No valid message found (invalid length: $messageLength)\");\r\n                imagedestroy($image);\r\n                return false;\r\n            }\r\n\r\n            //  FIXED: Extract encrypted message dengan algoritma yang DIPERBAIKI\r\n            $encryptedBits = \'\';\r\n            $bitsNeeded = $messageLength * 8;\r\n            $bitsExtracted = 0;\r\n\r\n            $this->logMessage(\"Extracting message data ($bitsNeeded bits needed)...\");\r\n            \r\n            //  PERBAIKAN: Gunakan counter bit GLOBAL, bukan skip per pixel\r\n            $globalBitCounter = 0;\r\n            \r\n            for ($y = 0; $y < $height; $y++) {\r\n                for ($x = 0; $x < $width; $x++) {\r\n                    $rgb = imagecolorat($image, $x, $y);\r\n                    $r = ($rgb >> 16) & 0xFF;\r\n                    $g = ($rgb >> 8) & 0xFF;\r\n                    $b = $rgb & 0xFF;\r\n\r\n                    // Process each channel\r\n                    $channels = [$r, $g, $b];\r\n                    \r\n                    foreach ($channels as $channel) {\r\n                        // Skip bits yang sudah digunakan untuk header\r\n                        if ($globalBitCounter < 32) {\r\n                            $globalBitCounter++;\r\n                            continue;\r\n                        }\r\n\r\n                        // Extract message bits setelah header\r\n                        if ($bitsExtracted < $bitsNeeded) {\r\n                            $encryptedBits .= $channel & 1;\r\n                            $bitsExtracted++;\r\n                            $globalBitCounter++;\r\n                        } else {\r\n                            break 3; // Keluar dari semua loop\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            $this->logMessage(\"Message bits extracted: \" . $bitsExtracted);\r\n            $this->logMessage(\"Total bits processed: \" . $globalBitCounter);\r\n\r\n            if ($bitsExtracted < $bitsNeeded) {\r\n                $this->logMessage(\"ERROR: Not enough bits extracted. Needed: $bitsNeeded, Got: $bitsExtracted\");\r\n                imagedestroy($image);\r\n                return false;\r\n            }\r\n\r\n            // Convert bits to bytes\r\n            $encryptedMessage = \'\';\r\n            for ($i = 0; $i < $bitsNeeded; $i += 8) {\r\n                $byteBits = substr($encryptedBits, $i, 8);\r\n                if (strlen($byteBits) < 8) {\r\n                    $this->logMessage(\"ERROR: Incomplete byte at position $i\");\r\n                    break;\r\n                }\r\n                $byte = bindec($byteBits);\r\n                $encryptedMessage .= chr($byte);\r\n            }\r\n\r\n            $this->logMessage(\"Encrypted message length: \" . strlen($encryptedMessage) . \" bytes\");\r\n\r\n            //  FIXED: DECRYPTION dengan error handling yang lebih baik\r\n            $this->logMessage(\"Attempting AES decryption...\");\r\n            \r\n            $decrypted = openssl_decrypt(\r\n                $encryptedMessage,\r\n                \'AES-256-CBC\',\r\n                AES_KEY,\r\n                OPENSSL_RAW_DATA,\r\n                AES_IV\r\n            );\r\n\r\n            if ($decrypted === false) {\r\n                $error = openssl_error_string();\r\n                $this->logMessage(\"AES decryption failed: \" . $error);\r\n                \r\n                // Coba alternatif: handle padding manual\r\n                $decrypted = $this->decryptWithPaddingHandling($encryptedMessage);\r\n                if ($decrypted === false) {\r\n                    $this->logMessage(\"Alternative decryption also failed\");\r\n                    imagedestroy($image);\r\n                    return false;\r\n                }\r\n            }\r\n\r\n            // Remove PKCS7 padding\r\n            $originalMessage = $this->pkcs7Unpad($decrypted);\r\n            \r\n            if ($originalMessage === false) {\r\n                $this->logMessage(\"Padding removal failed, using raw decrypted data\");\r\n                $originalMessage = $decrypted;\r\n            }\r\n            \r\n            $this->logMessage(\" Decryption successful\");\r\n            \r\n            imagedestroy($image);\r\n            \r\n            return $originalMessage;\r\n\r\n        } catch (Exception $e) {\r\n            $this->logMessage(\"ERROR in extractMessageFromImage: \" . $e->getMessage());\r\n            if (isset($image)) {\r\n                imagedestroy($image);\r\n            }\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Alternative decryption dengan padding handling\r\n     */\r\n    private function decryptWithPaddingHandling($encryptedMessage)\r\n    {\r\n        $this->logMessage(\"Trying alternative decryption with padding handling...\");\r\n        \r\n        // Coba tanpa OPENSSL_RAW_DATA dulu\r\n        $decrypted = openssl_decrypt(\r\n            $encryptedMessage,\r\n            \'AES-256-CBC\',\r\n            AES_KEY,\r\n            0, // Bukan raw data\r\n            AES_IV\r\n        );\r\n\r\n        if ($decrypted === false) {\r\n            // Coba dengan zero padding\r\n            $decrypted = openssl_decrypt(\r\n                $encryptedMessage,\r\n                \'AES-256-CBC\',\r\n                AES_KEY,\r\n                OPENSSL_ZERO_PADDING,\r\n                AES_IV\r\n            );\r\n        }\r\n\r\n        return $decrypted;\r\n    }\r\n\r\n    /**\r\n     * PKCS7 Unpadding dengan error handling\r\n     */\r\n    private function pkcs7Unpad($data)\r\n    {\r\n        if (empty($data)) return \'\';\r\n        \r\n        $dataLength = strlen($data);\r\n        if ($dataLength == 0) return \'\';\r\n        \r\n        $padding = ord($data[$dataLength - 1]);\r\n        \r\n        // Validasi padding\r\n        if ($padding > 16 || $padding == 0 || $padding > $dataLength) {\r\n            return $data; // Return data as-is jika padding invalid\r\n        }\r\n        \r\n        // Check semua byte padding\r\n        for ($i = 0; $i < $padding; $i++) {\r\n            if (ord($data[$dataLength - $i - 1]) != $padding) {\r\n                return $data; // Return data as-is jika padding tidak konsisten\r\n            }\r\n        }\r\n        \r\n        return substr($data, 0, -$padding);\r\n    }\r\n\r\n    /**\r\n     * New endpoint untuk download decrypted PDF\r\n     */\r\n    private function downloadDecryptedPdf()\r\n    {\r\n        try {\r\n            $patientId = intval($_GET[\'patient_id\'] ?? 0);\r\n\r\n            if ($patientId <= 0) {\r\n                throw new Exception(\"Patient ID tidak valid\");\r\n            }\r\n\r\n            // Get patient data including PDF filename\r\n            $query = \"SELECT dokumen_pdf FROM pasien WHERE id_pasien = ?\";\r\n            $stmt = $this->conn->prepare($query);\r\n            $stmt->bind_param(\"i\", $patientId);\r\n            $stmt->execute();\r\n            $result = $stmt->get_result();\r\n\r\n            if ($result->num_rows === 0) {\r\n                throw new Exception(\"Data pasien tidak ditemukan\");\r\n            }\r\n\r\n            $patient = $result->fetch_assoc();\r\n            $encryptedPdfFilename = $patient[\'dokumen_pdf\'];\r\n\r\n            if (empty($encryptedPdfFilename)) {\r\n                throw new Exception(\"Tidak ada dokumen PDF untuk pasien ini\");\r\n            }\r\n\r\n            // Find the encrypted PDF file\r\n            $possiblePaths = [\r\n                __DIR__ . \'/../../uploads/pdfs/\' . $encryptedPdfFilename,\r\n                __DIR__ . \'/../uploads/pdfs/\' . $encryptedPdfFilename,\r\n                $_SERVER[\'DOCUMENT_ROOT\'] . \'/uploads/pdfs/\' . $encryptedPdfFilename,\r\n            ];\r\n\r\n            $pdfPath = null;\r\n            foreach ($possiblePaths as $path) {\r\n                if (file_exists($path)) {\r\n                    $pdfPath = $path;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if ($pdfPath === null) {\r\n                throw new Exception(\"File PDF tidak ditemukan\");\r\n            }\r\n\r\n            // Read encrypted file\r\n            $encryptedContent = file_get_contents($pdfPath);\r\n            if ($encryptedContent === false) {\r\n                throw new Exception(\"Tidak dapat membaca file PDF\");\r\n            }\r\n\r\n            // Decrypt PDF\r\n            $decryptedContent = $this->decryptPdfFile($encryptedContent);\r\n            if ($decryptedContent === false) {\r\n                throw new Exception(\"Gagal mendekripsi PDF\");\r\n            }\r\n\r\n            // Set headers for download\r\n            header(\'Content-Type: application/pdf\');\r\n            header(\'Content-Disposition: attachment; filename=\"decrypted_patient_\' . $patientId . \'.pdf\"\');\r\n            header(\'Content-Length: \' . strlen($decryptedContent));\r\n\r\n            echo $decryptedContent;\r\n            exit;\r\n\r\n        } catch (Exception $e) {\r\n            $this->sendError(\"Error downloading PDF: \" . $e->getMessage());\r\n        }\r\n    }\r\n\r\n    /**\r\n     *  NEW: Endpoint khusus untuk ekstraksi steganografi\r\n     */\r\n    private function extractSteganographyMessage()\r\n    {\r\n        try {\r\n            $patientId = intval($_GET[\'patient_id\'] ?? $_POST[\'patient_id\'] ?? 0);\r\n\r\n            if ($patientId <= 0) {\r\n                throw new Exception(\"Patient ID tidak valid\");\r\n            }\r\n\r\n            $query = \"SELECT foto_pasien FROM pasien WHERE id_pasien = ?\";\r\n            $stmt = $this->conn->prepare($query);\r\n            $stmt->bind_param(\"i\", $patientId);\r\n            $stmt->execute();\r\n            $result = $stmt->get_result();\r\n\r\n            if ($result->num_rows === 0) {\r\n                throw new Exception(\"Data pasien tidak ditemukan\");\r\n            }\r\n\r\n            $patient = $result->fetch_assoc();\r\n            $imageFilename = $patient[\'foto_pasien\'];\r\n\r\n            if (empty($imageFilename)) {\r\n                throw new Exception(\"Tidak ada gambar untuk pasien ini\");\r\n            }\r\n\r\n            // Find the image file\r\n            $possiblePaths = [\r\n                __DIR__ . \'/../../uploads/images/\' . $imageFilename,\r\n                __DIR__ . \'/../uploads/images/\' . $imageFilename,\r\n                $_SERVER[\'DOCUMENT_ROOT\'] . \'/uploads/images/\' . $imageFilename,\r\n            ];\r\n\r\n            $imagePath = null;\r\n            foreach ($possiblePaths as $path) {\r\n                if (file_exists($path)) {\r\n                    $imagePath = $path;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if ($imagePath === null) {\r\n                throw new Exception(\"File gambar tidak ditemukan\");\r\n            }\r\n\r\n            // Extract message menggunakan algoritma yang sudah diperbaiki\r\n            $message = $this->extractMessageFromImage($imagePath);\r\n\r\n            if ($message === false) {\r\n                throw new Exception(\"Tidak dapat mengekstrak pesan dari gambar\");\r\n            }\r\n\r\n            $this->sendSuccess([\r\n                \'message\' => $message,\r\n                \'patient_id\' => $patientId,\r\n                \'image_file\' => $imageFilename\r\n            ], \"Pesan berhasil diekstrak dari gambar\");\r\n\r\n        } catch (Exception $e) {\r\n            $this->sendError(\"Error extracting steganography: \" . $e->getMessage());\r\n        }\r\n    }\r\n\r\n    // ==================== DATA RETRIEVAL METHODS ====================\r\n\r\n    private function getDashboardStats()\r\n    {\r\n        try {\r\n            // Total patients\r\n            $totalQuery = \"SELECT COUNT(*) as total_pasien FROM pasien\";\r\n            $totalResult = $this->conn->query($totalQuery);\r\n            $total = $totalResult->fetch_assoc();\r\n\r\n            // Rawat inap count\r\n            $inapQuery = \"SELECT COUNT(*) as rawat_inap FROM pasien WHERE informasi_medis = \'rawat-inap\'\";\r\n            $inapResult = $this->conn->query($inapQuery);\r\n            $inap = $inapResult->fetch_assoc();\r\n\r\n            // Rawat jalan count\r\n            $jalanQuery = \"SELECT COUNT(*) as rawat_jalan FROM pasien WHERE informasi_medis = \'rawat-jalan\'\";\r\n            $jalanResult = $this->conn->query($jalanQuery);\r\n            $jalan = $jalanResult->fetch_assoc();\r\n\r\n            // Pemeriksaan count\r\n            $pemeriksaanQuery = \"SELECT COUNT(*) as pemeriksaan FROM pasien WHERE informasi_medis = \'pemeriksaan\'\";\r\n            $pemeriksaanResult = $this->conn->query($pemeriksaanQuery);\r\n            $pemeriksaan = $pemeriksaanResult->fetch_assoc();\r\n\r\n            // Total payment\r\n            $paymentQuery = \"SELECT COALESCE(SUM(jumlah_pembayaran), 0) as total_pembayaran FROM pasien\";\r\n            $paymentResult = $this->conn->query($paymentQuery);\r\n            $payment = $paymentResult->fetch_assoc();\r\n\r\n            // New patients (last 7 days)\r\n            $newQuery = \"SELECT COUNT(*) as pasien_baru FROM pasien WHERE created_at >= DATE_SUB(NOW(), INTERVAL 7 DAY)\";\r\n            $newResult = $this->conn->query($newQuery);\r\n            $new = $newResult->fetch_assoc();\r\n\r\n            $stats = [\r\n                \'total_pasien\' => (int)$total[\'total_pasien\'],\r\n                \'rawat_inap\' => (int)$inap[\'rawat_inap\'],\r\n                \'rawat_jalan\' => (int)$jalan[\'rawat_jalan\'],\r\n                \'pemeriksaan\' => (int)$pemeriksaan[\'pemeriksaan\'],\r\n                \'total_pembayaran\' => (float)$payment[\'total_pembayaran\'],\r\n                \'pasien_baru\' => (int)$new[\'pasien_baru\']\r\n            ];\r\n\r\n            $this->sendSuccess($stats, \"Stats loaded successfully\");\r\n\r\n        } catch (Exception $e) {\r\n            $this->sendError(\"Error loading stats: \" . $e->getMessage());\r\n        }\r\n    }\r\n\r\n    private function getRecentPatients()\r\n    {\r\n        try {\r\n            $query = \"SELECT * FROM pasien ORDER BY created_at DESC LIMIT 5\";\r\n            $result = $this->conn->query($query);\r\n\r\n            $patients = [];\r\n            while ($row = $result->fetch_assoc()) {\r\n                // Decrypt the data\r\n                $row[\'nama_lengkap\'] = $this->xorDecrypt($row[\'nama_lengkap\'], XOR_KEY);\r\n                $row[\'alamat_lengkap\'] = $this->xorDecrypt($row[\'alamat_lengkap\'], XOR_KEY);\r\n                $row[\'hasil_pemeriksaan\'] = $this->altbashAesDecrypt($row[\'hasil_pemeriksaan\']);\r\n                \r\n                $patients[] = $row;\r\n            }\r\n\r\n            $this->sendSuccess($patients, \"Recent patients loaded\");\r\n\r\n        } catch (Exception $e) {\r\n            $this->sendError(\"Error loading recent patients: \" . $e->getMessage());\r\n        }\r\n    }\r\n\r\n    private function getPatientsList()\r\n    {\r\n        try {\r\n            $page = intval($_GET[\'page\'] ?? 1);\r\n            $limit = intval($_GET[\'limit\'] ?? 10);\r\n            $search = $_GET[\'search\'] ?? \'\';\r\n            $status = $_GET[\'status\'] ?? \'\';\r\n            $service = $_GET[\'service\'] ?? \'\';\r\n\r\n            $offset = ($page - 1) * $limit;\r\n\r\n            // Build WHERE conditions\r\n            $whereConditions = [];\r\n            $params = [];\r\n            $types = \'\';\r\n\r\n            if (!empty($search)) {\r\n                $whereConditions[] = \"(nama_lengkap LIKE ? OR alamat_lengkap LIKE ?)\";\r\n                $searchTerm = \"%$search%\";\r\n                $params[] = $searchTerm;\r\n                $params[] = $searchTerm;\r\n                $types .= \'ss\';\r\n            }\r\n\r\n            if (!empty($status)) {\r\n                $whereConditions[] = \"status_pasien = ?\";\r\n                $params[] = $status;\r\n                $types .= \'s\';\r\n            }\r\n\r\n            if (!empty($service)) {\r\n                $whereConditions[] = \"informasi_medis = ?\";\r\n                $params[] = $service;\r\n                $types .= \'s\';\r\n            }\r\n\r\n            $whereClause = \'\';\r\n            if (!empty($whereConditions)) {\r\n                $whereClause = \"WHERE \" . implode(\" AND \", $whereConditions);\r\n            }\r\n\r\n            // Count total records\r\n            $countQuery = \"SELECT COUNT(*) as total FROM pasien $whereClause\";\r\n            $countStmt = $this->conn->prepare($countQuery);\r\n            \r\n            if (!empty($params)) {\r\n                $countStmt->bind_param($types, ...$params);\r\n            }\r\n            \r\n            $countStmt->execute();\r\n            $countResult = $countStmt->get_result();\r\n            $totalCount = $countResult->fetch_assoc()[\'total\'];\r\n            $totalPages = ceil($totalCount / $limit);\r\n\r\n            $dataQuery = \"SELECT * FROM pasien $whereClause ORDER BY created_at DESC, id_pasien DESC LIMIT ? OFFSET ?\";\r\n            $dataStmt = $this->conn->prepare($dataQuery);\r\n            \r\n            $params[] = $limit;\r\n            $params[] = $offset;\r\n            $types .= \'ii\';\r\n\r\n            if (!empty($params)) {\r\n                $dataStmt->bind_param($types, ...$params);\r\n            }\r\n            \r\n            $dataStmt->execute();\r\n            $result = $dataStmt->get_result();\r\n\r\n            $patients = [];\r\n            while ($row = $result->fetch_assoc()) {\r\n                // Decrypt the data for display\r\n                $row[\'nama_lengkap\'] = $this->xorDecrypt($row[\'nama_lengkap\'], XOR_KEY);\r\n                $row[\'alamat_lengkap\'] = $this->xorDecrypt($row[\'alamat_lengkap\'], XOR_KEY);\r\n                $row[\'hasil_pemeriksaan\'] = $this->altbashAesDecrypt($row[\'hasil_pemeriksaan\']);\r\n                \r\n                $patients[] = $row;\r\n            }\r\n\r\n            $response = [\r\n                \'patients\' => $patients,\r\n                \'total_pages\' => $totalPages,\r\n                \'current_page\' => $page,\r\n                \'total_count\' => $totalCount\r\n            ];\r\n\r\n            $this->sendSuccess($response, \"Patients list loaded\");\r\n\r\n        } catch (Exception $e) {\r\n            $this->sendError(\"Error loading patients list: \" . $e->getMessage());\r\n        }\r\n    }\r\n\r\n    private function getPatientDetail()\r\n    {\r\n        try {\r\n            $patientId = intval($_GET[\'patient_id\'] ?? $_POST[\'patient_id\'] ?? 0);\r\n\r\n            if ($patientId <= 0) {\r\n                throw new Exception(\"Patient ID tidak valid\");\r\n            }\r\n\r\n            $query = \"SELECT * FROM pasien WHERE id_pasien = ?\";\r\n            $stmt = $this->conn->prepare($query);\r\n            $stmt->bind_param(\"i\", $patientId);\r\n            $stmt->execute();\r\n            $result = $stmt->get_result();\r\n\r\n            if ($result->num_rows === 0) {\r\n                throw new Exception(\"Data pasien tidak ditemukan\");\r\n            }\r\n\r\n            $patient = $result->fetch_assoc();\r\n\r\n            // Decrypt all encrypted data\r\n            $patient[\'nama_lengkap\'] = $this->xorDecrypt($patient[\'nama_lengkap\'], XOR_KEY);\r\n            $patient[\'alamat_lengkap\'] = $this->xorDecrypt($patient[\'alamat_lengkap\'], XOR_KEY);\r\n            $patient[\'hasil_pemeriksaan\'] = $this->altbashAesDecrypt($patient[\'hasil_pemeriksaan\']);\r\n\r\n            //  FIXED: Extract medical message from image menggunakan algoritma yang sudah diperbaiki\r\n            $medicalMessage = \'\';\r\n            if (!empty($patient[\'foto_pasien\'])) {\r\n                $possiblePaths = [\r\n                    __DIR__ . \'/../../uploads/images/\' . $patient[\'foto_pasien\'],\r\n                    __DIR__ . \'/../uploads/images/\' . $patient[\'foto_pasien\'],\r\n                    $_SERVER[\'DOCUMENT_ROOT\'] . \'/uploads/images/\' . $patient[\'foto_pasien\'],\r\n                ];\r\n\r\n                $imagePath = null;\r\n                foreach ($possiblePaths as $path) {\r\n                    if (file_exists($path)) {\r\n                        $imagePath = $path;\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                if ($imagePath !== null) {\r\n                    $medicalMessage = $this->extractMessageFromImage($imagePath);\r\n                    if ($medicalMessage === false) {\r\n                        $medicalMessage = \'\'; // Jika ekstraksi gagal, set kosong\r\n                    }\r\n                }\r\n            }\r\n            $patient[\'medical_message\'] = $medicalMessage;\r\n\r\n            $this->sendSuccess($patient, \"Patient detail loaded\");\r\n\r\n        } catch (Exception $e) {\r\n            $this->sendError(\"Error loading patient detail: \" . $e->getMessage());\r\n        }\r\n    }\r\n\r\n    private function updatePatient()\r\n    {\r\n        try {\r\n            $patientId = intval($_POST[\'patient_id\'] ?? 0);\r\n            \r\n            if ($patientId <= 0) {\r\n                throw new Exception(\"Patient ID tidak valid\");\r\n            }\r\n\r\n            // Get form data\r\n            $nama_pasien = $this->sanitizeInput($_POST[\'nama_pasien\']);\r\n            $tanggal_lahir = $_POST[\'tanggal_lahir\'];\r\n            $alamat = $this->sanitizeInput($_POST[\'alamat\']);\r\n            $jenis_layanan = $this->sanitizeInput($_POST[\'jenis_layanan\']);\r\n            $status_pasien = $this->sanitizeInput($_POST[\'status_pasien\']);\r\n            $hasil_pemeriksaan = $this->sanitizeInput($_POST[\'hasil_pemeriksaan\']);\r\n            $jumlah_pembayaran = floatval($_POST[\'jumlah_pembayaran\']);\r\n\r\n            // Encrypt data before updating\r\n            $encrypted_nama = $this->xorEncrypt($nama_pasien, XOR_KEY);\r\n            $encrypted_alamat = $this->xorEncrypt($alamat, XOR_KEY);\r\n            $encrypted_hasil = $this->altbashAesEncrypt($hasil_pemeriksaan);\r\n\r\n            $query = \"UPDATE pasien SET \r\n                nama_lengkap = ?, \r\n                tanggal_lahir = ?, \r\n                alamat_lengkap = ?, \r\n                informasi_medis = ?, \r\n                status_pasien = ?, \r\n                hasil_pemeriksaan = ?, \r\n                jumlah_pembayaran = ?,\r\n                updated_at = NOW()\r\n                WHERE id_pasien = ?\";\r\n\r\n            $stmt = $this->conn->prepare($query);\r\n            $stmt->bind_param(\r\n                \"ssssssdi\",\r\n                $encrypted_nama,\r\n                $tanggal_lahir,\r\n                $encrypted_alamat,\r\n                $jenis_layanan,\r\n                $status_pasien,\r\n                $encrypted_hasil,\r\n                $jumlah_pembayaran,\r\n                $patientId\r\n            );\r\n\r\n            if ($stmt->execute()) {\r\n                $this->sendSuccess([], \"Data pasien berhasil diperbarui\");\r\n            } else {\r\n                throw new Exception(\"Gagal memperbarui data: \" . $stmt->error);\r\n            }\r\n\r\n        } catch (Exception $e) {\r\n            $this->sendError(\"Error updating patient: \" . $e->getMessage());\r\n        }\r\n    }\r\n\r\n    private function deletePatient()\r\n    {\r\n        try {\r\n            $patientId = intval($_POST[\'patient_id\'] ?? 0);\r\n\r\n            if ($patientId <= 0) {\r\n                throw new Exception(\"Patient ID tidak valid\");\r\n            }\r\n\r\n            $query = \"DELETE FROM pasien WHERE id_pasien = ?\";\r\n            $stmt = $this->conn->prepare($query);\r\n            $stmt->bind_param(\"i\", $patientId);\r\n\r\n            if ($stmt->execute()) {\r\n                $this->sendSuccess([], \"Data pasien berhasil dihapus\");\r\n            } else {\r\n                throw new Exception(\"Gagal menghapus data: \" . $stmt->error);\r\n            }\r\n\r\n        } catch (Exception $e) {\r\n            $this->sendError(\"Error deleting patient: \" . $e->getMessage());\r\n        }\r\n    }\r\n\r\n    // ==================== ENCRYPTION METHODS (for update) ====================\r\n\r\n    private function xorEncrypt($data, $key)\r\n    {\r\n        if (empty($data)) return \'\';\r\n\r\n        $data = mb_convert_encoding($data, \'UTF-8\');\r\n        $key = mb_convert_encoding($key, \'UTF-8\');\r\n\r\n        $encrypted = \'\';\r\n        $dataLen = mb_strlen($data, \'UTF-8\');\r\n        $keyLen = mb_strlen($key, \'UTF-8\');\r\n\r\n        for ($i = 0; $i < $dataLen; $i++) {\r\n            $dataChar = mb_substr($data, $i, 1, \'UTF-8\');\r\n            $keyChar = mb_substr($key, $i % $keyLen, 1, \'UTF-8\');\r\n\r\n            $dataAscii = ord($dataChar);\r\n            $keyAscii = ord($keyChar);\r\n            $encryptedAscii = $dataAscii ^ $keyAscii;\r\n\r\n            $encrypted .= chr($encryptedAscii);\r\n        }\r\n\r\n        return base64_encode($encrypted);\r\n    }\r\n\r\n    private function altbashAesEncrypt($data)\r\n    {\r\n        if (empty($data)) return \'\';\r\n\r\n        $altbash_encrypted = $this->altbashEncrypt($data);\r\n        $aes_encrypted = $this->aesEncrypt($altbash_encrypted);\r\n\r\n        return $aes_encrypted;\r\n    }\r\n\r\n    private function altbashEncrypt($data)\r\n    {\r\n        if (empty($data)) return \'\';\r\n\r\n        $data = mb_convert_encoding($data, \'UTF-8\');\r\n        $key = mb_convert_encoding(XOR_KEY, \'UTF-8\');\r\n\r\n        $encrypted = \'\';\r\n        $dataLen = mb_strlen($data, \'UTF-8\');\r\n        $keyLen = mb_strlen($key, \'UTF-8\');\r\n\r\n        for ($i = 0; $i < $dataLen; $i++) {\r\n            $char = mb_substr($data, $i, 1, \'UTF-8\');\r\n            $ascii = ord($char);\r\n            $shifted_ascii = ($ascii + 3) % 256;\r\n            $encrypted .= chr($shifted_ascii);\r\n        }\r\n\r\n        $xor_encrypted = \'\';\r\n        for ($i = 0; $i < $dataLen; $i++) {\r\n            $dataChar = $encrypted[$i];\r\n            $keyChar = mb_substr($key, $i % $keyLen, 1, \'UTF-8\');\r\n\r\n            $dataAscii = ord($dataChar);\r\n            $keyAscii = ord($keyChar);\r\n            $xorAscii = $dataAscii ^ $keyAscii;\r\n\r\n            $xor_encrypted .= chr($xorAscii);\r\n        }\r\n\r\n        $reversed = strrev($xor_encrypted);\r\n        return base64_encode($reversed);\r\n    }\r\n\r\n    private function aesEncrypt($data)\r\n    {\r\n        if (empty($data)) return \'\';\r\n\r\n        $encrypted = openssl_encrypt(\r\n            $data,\r\n            \'AES-256-CBC\',\r\n            AES_KEY,\r\n            OPENSSL_RAW_DATA,\r\n            AES_IV\r\n        );\r\n\r\n        return base64_encode($encrypted);\r\n    }\r\n\r\n    // ==================== UTILITY METHODS ====================\r\n\r\n    private function logMessage($message)\r\n    {\r\n        $timestamp = date(\'Y-m-d H:i:s\');\r\n        $logMessage = \"[$timestamp] $message\\n\";\r\n        error_log($logMessage, 3, __DIR__ . \'/dashboard_errors.log\');\r\n    }\r\n\r\n    private function sanitizeInput($data)\r\n    {\r\n        if ($this->conn) {\r\n            return $this->conn->real_escape_string(trim($data));\r\n        }\r\n        return trim($data);\r\n    }\r\n\r\n    private function sendSuccess($data, $message = \"\")\r\n    {\r\n        echo json_encode([\r\n            \'success\' => true,\r\n            \'message\' => $message,\r\n            \'data\' => $data\r\n        ], JSON_UNESCAPED_UNICODE);\r\n        exit;\r\n    }\r\n\r\n    private function sendError($message, $code = 400)\r\n    {\r\n        http_response_code($code);\r\n        echo json_encode([\r\n            \'success\' => false,\r\n            \'error\' => $message\r\n        ], JSON_UNESCAPED_UNICODE);\r\n        exit;\r\n    }\r\n\r\n    public function __destruct()\r\n    {\r\n        if ($this->conn) {\r\n            $this->conn->close();\r\n        }\r\n    }\r\n}\r\n\r\n// Handle the request\r\n$handler = new DashboardView();\r\n$handler->handleRequest();\r\n?>
[2025-11-11 17:05:41] === START IMAGE STEGANOGRAPHY ===
[2025-11-11 17:05:41] Original message: <?php\r\n\r\nini_set(\'display_errors\', 1);\r\nini_set(\'display_startup_errors\', 1);\r\nerror_reporting(E_ALL);\r\nini_set(\'log_errors\', 1);\r\nini_set(\'error_log\', __DIR__ . \'/dashboard_errors.log\');\r\n\r\nheader(\'Content-Type: application/json; charset=utf-8\');\r\nheader(\'Access-Control-Allow-Origin: *\');\r\nheader(\'Access-Control-Allow-Methods: GET, POST, OPTIONS\');\r\nheader(\'Access-Control-Allow-Headers: Content-Type\');\r\n\r\n// Database configuration\r\ndefine(\'DB_HOST\', \'localhost\');\r\ndefine(\'DB_USER\', \'root\');\r\ndefine(\'DB_PASS\', \'\');\r\ndefine(\'DB_NAME\', \'kriptoproject\');\r\n\r\n// Encryption keys (SAMA dengan yang di upload.php)\r\ndefine(\'XOR_KEY\', \'medicare_secret_key_2024\');\r\ndefine(\'AES_KEY\', \'medicare_aes_key_2024_32bytes_long!\');\r\ndefine(\'AES_IV\', \'1234567890123456\');\r\n\r\nclass DashboardView\r\n{\r\n    private $conn;\r\n\r\n    public function __construct()\r\n    {\r\n        $this->connectDB();\r\n    }\r\n\r\n    private function connectDB()\r\n    {\r\n        try {\r\n            $this->conn = new mysqli(DB_HOST, DB_USER, DB_PASS, DB_NAME);\r\n\r\n            if ($this->conn->connect_error) {\r\n                throw new Exception(\"Koneksi database gagal: \" . $this->conn->connect_error);\r\n            }\r\n\r\n            $this->conn->set_charset(\"utf8mb4\");\r\n        } catch (Exception $e) {\r\n            $this->sendError($e->getMessage());\r\n        }\r\n    }\r\n\r\n    public function handleRequest()\r\n    {\r\n        $action = $_GET[\'action\'] ?? $_POST[\'action\'] ?? \'\';\r\n\r\n        switch ($action) {\r\n            case \'get_stats\':\r\n                $this->getDashboardStats();\r\n                break;\r\n            case \'get_recent_patients\':\r\n                $this->getRecentPatients();\r\n                break;\r\n            case \'get_patients\':\r\n                $this->getPatientsList();\r\n                break;\r\n            case \'get_patient_detail\':\r\n                $this->getPatientDetail();\r\n                break;\r\n            case \'update_patient\':\r\n                $this->updatePatient();\r\n                break;\r\n            case \'delete_patient\':\r\n                $this->deletePatient();\r\n                break;\r\n            case \'download_decrypted_pdf\':\r\n                $this->downloadDecryptedPdf();\r\n                break;\r\n            case \'extract_steganography\': // NEW ACTION untuk ekstraksi steganografi\r\n                $this->extractSteganographyMessage();\r\n                break;\r\n            default:\r\n                $this->sendError(\'Action tidak valid\');\r\n        }\r\n    }\r\n\r\n    // ==================== IMPROVED DECRYPTION METHODS ====================\r\n\r\n    /**\r\n     * Decrypt XOR encrypted data\r\n     */\r\n    private function xorDecrypt($encryptedData, $key)\r\n    {\r\n        if (empty($encryptedData)) return \'\';\r\n\r\n        $data = base64_decode($encryptedData);\r\n        $key = mb_convert_encoding($key, \'UTF-8\');\r\n\r\n        $decrypted = \'\';\r\n        $dataLen = strlen($data);\r\n        $keyLen = mb_strlen($key, \'UTF-8\');\r\n\r\n        for ($i = 0; $i < $dataLen; $i++) {\r\n            $dataChar = $data[$i];\r\n            $keyChar = mb_substr($key, $i % $keyLen, 1, \'UTF-8\');\r\n\r\n            $dataAscii = ord($dataChar);\r\n            $keyAscii = ord($keyChar);\r\n            $decryptedAscii = $dataAscii ^ $keyAscii;\r\n\r\n            $decrypted .= chr($decryptedAscii);\r\n        }\r\n\r\n        return $decrypted;\r\n    }\r\n\r\n    /**\r\n     * Decrypt AES encrypted data\r\n     */\r\n    private function aesDecrypt($encryptedData)\r\n    {\r\n        if (empty($encryptedData)) return \'\';\r\n\r\n        $encrypted = base64_decode($encryptedData);\r\n        \r\n        $decrypted = openssl_decrypt(\r\n            $encrypted,\r\n            \'AES-256-CBC\',\r\n            AES_KEY,\r\n            OPENSSL_RAW_DATA,\r\n            AES_IV\r\n        );\r\n\r\n        return $decrypted ?: \'\';\r\n    }\r\n\r\n    /**\r\n     * Decrypt AltBash + AES encrypted data\r\n     */\r\n    private function altbashAesDecrypt($encryptedData)\r\n    {\r\n        if (empty($encryptedData)) return \'\';\r\n\r\n        // First decrypt AES\r\n        $altbashEncrypted = $this->aesDecrypt($encryptedData);\r\n        if (empty($altbashEncrypted)) return \'\';\r\n\r\n        // Then decrypt AltBash\r\n        return $this->altbashDecrypt($altbashEncrypted);\r\n    }\r\n\r\n    /**\r\n     * Decrypt Alphabet-Bashing encrypted data\r\n     */\r\n    private function altbashDecrypt($encryptedData)\r\n    {\r\n        if (empty($encryptedData)) return \'\';\r\n\r\n        $data = base64_decode($encryptedData);\r\n        $reversed = strrev($data);\r\n        $key = mb_convert_encoding(XOR_KEY, \'UTF-8\');\r\n\r\n        $xorDecrypted = \'\';\r\n        $dataLen = strlen($reversed);\r\n        $keyLen = mb_strlen($key, \'UTF-8\');\r\n\r\n        for ($i = 0; $i < $dataLen; $i++) {\r\n            $dataChar = $reversed[$i];\r\n            $keyChar = mb_substr($key, $i % $keyLen, 1, \'UTF-8\');\r\n\r\n            $dataAscii = ord($dataChar);\r\n            $keyAscii = ord($keyChar);\r\n            $xorAscii = $dataAscii ^ $keyAscii;\r\n\r\n            $xorDecrypted .= chr($xorAscii);\r\n        }\r\n\r\n        $decrypted = \'\';\r\n        $dataLen = strlen($xorDecrypted);\r\n\r\n        for ($i = 0; $i < $dataLen; $i++) {\r\n            $char = $xorDecrypted[$i];\r\n            $ascii = ord($char);\r\n            $shiftedAscii = ($ascii - 3 + 256) % 256;\r\n            $decrypted .= chr($shiftedAscii);\r\n        }\r\n\r\n        return $decrypted;\r\n    }\r\n\r\n    /**\r\n     * Decrypt PDF file that was encrypted with Caesar + AES\r\n     */\r\n    private function decryptPdfFile($encryptedContent)\r\n    {\r\n        try {\r\n            // Step 1: AES decryption\r\n            $aesDecrypted = $this->aesDecryptBinary($encryptedContent);\r\n            if ($aesDecrypted === false) {\r\n                throw new Exception(\"AES decryption failed\");\r\n            }\r\n\r\n            // Step 2: Caesar Cipher decryption (shift of 5)\r\n            $decrypted = $this->caesarCipherDecrypt($aesDecrypted, 5);\r\n\r\n            return $decrypted;\r\n        } catch (Exception $e) {\r\n            $this->logMessage(\"ERROR in decryptPdfFile: \" . $e->getMessage());\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * AES decryption for binary data\r\n     */\r\n    private function aesDecryptBinary($data)\r\n    {\r\n        if (empty($data)) {\r\n            return false;\r\n        }\r\n\r\n        $decrypted = openssl_decrypt(\r\n            $data,\r\n            \'AES-256-CBC\',\r\n            AES_KEY,\r\n            OPENSSL_RAW_DATA,\r\n            AES_IV\r\n        );\r\n\r\n        return $decrypted;\r\n    }\r\n\r\n    /**\r\n     * Caesar Cipher decryption for binary data\r\n     */\r\n    private function caesarCipherDecrypt($data, $shift)\r\n    {\r\n        $decrypted = \'\';\r\n        $length = strlen($data);\r\n        \r\n        for ($i = 0; $i < $length; $i++) {\r\n            $byte = ord($data[$i]);\r\n            // Apply Caesar shift (mod 256 for bytes)\r\n            $decryptedByte = ($byte - $shift + 256) % 256;\r\n            $decrypted .= chr($decryptedByte);\r\n        }\r\n        \r\n        return $decrypted;\r\n    }\r\n\r\n    /**\r\n     *  FIXED: Extract hidden message from steganographed image menggunakan algoritma yang sama dengan test\r\n     */\r\n    private function extractMessageFromImage($imagePath)\r\n    {\r\n        try {\r\n            $this->logMessage(\"=== EXTRACTING MESSAGE FROM IMAGE (FIXED ALGORITHM) ===\");\r\n            \r\n            if (!file_exists($imagePath)) {\r\n                throw new Exception(\"Image file not found: \" . $imagePath);\r\n            }\r\n\r\n            $imageInfo = getimagesize($imagePath);\r\n            if ($imageInfo === false) {\r\n                throw new Exception(\"Cannot get image information\");\r\n            }\r\n\r\n            $width = $imageInfo[0];\r\n            $height = $imageInfo[1];\r\n            $imageType = $imageInfo[2];\r\n            \r\n            $this->logMessage(\"Image dimensions: {$width}x{$height}, Type: {$imageType}\");\r\n\r\n            // Load image - support WebP dan format lainnya\r\n            $image = null;\r\n            switch ($imageType) {\r\n                case IMAGETYPE_JPEG:\r\n                    $image = imagecreatefromjpeg($imagePath);\r\n                    $this->logMessage(\"Loaded as JPEG\");\r\n                    break;\r\n                case IMAGETYPE_PNG:\r\n                    $image = imagecreatefrompng($imagePath);\r\n                    $this->logMessage(\"Loaded as PNG\");\r\n                    break;\r\n                case IMAGETYPE_GIF:\r\n                    $image = imagecreatefromgif($imagePath);\r\n                    $this->logMessage(\"Loaded as GIF\");\r\n                    break;\r\n                case 18: // IMAGETYPE_WEBP\r\n                    if (function_exists(\'imagecreatefromwebp\')) {\r\n                        $image = imagecreatefromwebp($imagePath);\r\n                        $this->logMessage(\"Loaded as WEBP\");\r\n                    } else {\r\n                        throw new Exception(\"WebP not supported on this server\");\r\n                    }\r\n                    break;\r\n                default:\r\n                    throw new Exception(\"Unsupported image type: \" . $imageType);\r\n            }\r\n\r\n            if (!$image) {\r\n                throw new Exception(\"Cannot create image from source\");\r\n            }\r\n\r\n            //  FIXED: Extract header menggunakan algoritma yang sama dengan embedding\r\n            $headerBits = \'\';\r\n            $bitsExtracted = 0;\r\n            $headerSize = 32;\r\n\r\n            $this->logMessage(\"Extracting header...\");\r\n            for ($y = 0; $y < $height; $y++) {\r\n                for ($x = 0; $x < $width; $x++) {\r\n                    if ($bitsExtracted >= $headerSize) break 2;\r\n                    \r\n                    $rgb = imagecolorat($image, $x, $y);\r\n                    $r = ($rgb >> 16) & 0xFF;\r\n                    $g = ($rgb >> 8) & 0xFF;\r\n                    $b = $rgb & 0xFF;\r\n\r\n                    // Extract dari LSB - URUTAN SAMA dengan enkripsi\r\n                    $headerBits .= $r & 1;\r\n                    $bitsExtracted++;\r\n                    if ($bitsExtracted >= $headerSize) break;\r\n                    \r\n                    $headerBits .= $g & 1;\r\n                    $bitsExtracted++;\r\n                    if ($bitsExtracted >= $headerSize) break;\r\n                    \r\n                    $headerBits .= $b & 1;\r\n                    $bitsExtracted++;\r\n                    if ($bitsExtracted >= $headerSize) break;\r\n                }\r\n            }\r\n\r\n            $this->logMessage(\"Header bits extracted: \" . $bitsExtracted);\r\n\r\n            // Convert header bits to message length\r\n            $messageLength = 0;\r\n            for ($i = 0; $i < 32; $i += 8) {\r\n                $byte = bindec(substr($headerBits, $i, 8));\r\n                $messageLength = ($messageLength << 8) | $byte;\r\n            }\r\n\r\n            $this->logMessage(\"Message length from header: \" . $messageLength);\r\n\r\n            if ($messageLength <= 0 || $messageLength > 100000) {\r\n                $this->logMessage(\"No valid message found (invalid length: $messageLength)\");\r\n                imagedestroy($image);\r\n                return false;\r\n            }\r\n\r\n            //  FIXED: Extract encrypted message dengan algoritma yang DIPERBAIKI\r\n            $encryptedBits = \'\';\r\n            $bitsNeeded = $messageLength * 8;\r\n            $bitsExtracted = 0;\r\n\r\n            $this->logMessage(\"Extracting message data ($bitsNeeded bits needed)...\");\r\n            \r\n            //  PERBAIKAN: Gunakan counter bit GLOBAL, bukan skip per pixel\r\n            $globalBitCounter = 0;\r\n            \r\n            for ($y = 0; $y < $height; $y++) {\r\n                for ($x = 0; $x < $width; $x++) {\r\n                    $rgb = imagecolorat($image, $x, $y);\r\n                    $r = ($rgb >> 16) & 0xFF;\r\n                    $g = ($rgb >> 8) & 0xFF;\r\n                    $b = $rgb & 0xFF;\r\n\r\n                    // Process each channel\r\n                    $channels = [$r, $g, $b];\r\n                    \r\n                    foreach ($channels as $channel) {\r\n                        // Skip bits yang sudah digunakan untuk header\r\n                        if ($globalBitCounter < 32) {\r\n                            $globalBitCounter++;\r\n                            continue;\r\n                        }\r\n\r\n                        // Extract message bits setelah header\r\n                        if ($bitsExtracted < $bitsNeeded) {\r\n                            $encryptedBits .= $channel & 1;\r\n                            $bitsExtracted++;\r\n                            $globalBitCounter++;\r\n                        } else {\r\n                            break 3; // Keluar dari semua loop\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            $this->logMessage(\"Message bits extracted: \" . $bitsExtracted);\r\n            $this->logMessage(\"Total bits processed: \" . $globalBitCounter);\r\n\r\n            if ($bitsExtracted < $bitsNeeded) {\r\n                $this->logMessage(\"ERROR: Not enough bits extracted. Needed: $bitsNeeded, Got: $bitsExtracted\");\r\n                imagedestroy($image);\r\n                return false;\r\n            }\r\n\r\n            // Convert bits to bytes\r\n            $encryptedMessage = \'\';\r\n            for ($i = 0; $i < $bitsNeeded; $i += 8) {\r\n                $byteBits = substr($encryptedBits, $i, 8);\r\n                if (strlen($byteBits) < 8) {\r\n                    $this->logMessage(\"ERROR: Incomplete byte at position $i\");\r\n                    break;\r\n                }\r\n                $byte = bindec($byteBits);\r\n                $encryptedMessage .= chr($byte);\r\n            }\r\n\r\n            $this->logMessage(\"Encrypted message length: \" . strlen($encryptedMessage) . \" bytes\");\r\n\r\n            //  FIXED: DECRYPTION dengan error handling yang lebih baik\r\n            $this->logMessage(\"Attempting AES decryption...\");\r\n            \r\n            $decrypted = openssl_decrypt(\r\n                $encryptedMessage,\r\n                \'AES-256-CBC\',\r\n                AES_KEY,\r\n                OPENSSL_RAW_DATA,\r\n                AES_IV\r\n            );\r\n\r\n            if ($decrypted === false) {\r\n                $error = openssl_error_string();\r\n                $this->logMessage(\"AES decryption failed: \" . $error);\r\n                \r\n                // Coba alternatif: handle padding manual\r\n                $decrypted = $this->decryptWithPaddingHandling($encryptedMessage);\r\n                if ($decrypted === false) {\r\n                    $this->logMessage(\"Alternative decryption also failed\");\r\n                    imagedestroy($image);\r\n                    return false;\r\n                }\r\n            }\r\n\r\n            // Remove PKCS7 padding\r\n            $originalMessage = $this->pkcs7Unpad($decrypted);\r\n            \r\n            if ($originalMessage === false) {\r\n                $this->logMessage(\"Padding removal failed, using raw decrypted data\");\r\n                $originalMessage = $decrypted;\r\n            }\r\n            \r\n            $this->logMessage(\" Decryption successful\");\r\n            \r\n            imagedestroy($image);\r\n            \r\n            return $originalMessage;\r\n\r\n        } catch (Exception $e) {\r\n            $this->logMessage(\"ERROR in extractMessageFromImage: \" . $e->getMessage());\r\n            if (isset($image)) {\r\n                imagedestroy($image);\r\n            }\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Alternative decryption dengan padding handling\r\n     */\r\n    private function decryptWithPaddingHandling($encryptedMessage)\r\n    {\r\n        $this->logMessage(\"Trying alternative decryption with padding handling...\");\r\n        \r\n        // Coba tanpa OPENSSL_RAW_DATA dulu\r\n        $decrypted = openssl_decrypt(\r\n            $encryptedMessage,\r\n            \'AES-256-CBC\',\r\n            AES_KEY,\r\n            0, // Bukan raw data\r\n            AES_IV\r\n        );\r\n\r\n        if ($decrypted === false) {\r\n            // Coba dengan zero padding\r\n            $decrypted = openssl_decrypt(\r\n                $encryptedMessage,\r\n                \'AES-256-CBC\',\r\n                AES_KEY,\r\n                OPENSSL_ZERO_PADDING,\r\n                AES_IV\r\n            );\r\n        }\r\n\r\n        return $decrypted;\r\n    }\r\n\r\n    /**\r\n     * PKCS7 Unpadding dengan error handling\r\n     */\r\n    private function pkcs7Unpad($data)\r\n    {\r\n        if (empty($data)) return \'\';\r\n        \r\n        $dataLength = strlen($data);\r\n        if ($dataLength == 0) return \'\';\r\n        \r\n        $padding = ord($data[$dataLength - 1]);\r\n        \r\n        // Validasi padding\r\n        if ($padding > 16 || $padding == 0 || $padding > $dataLength) {\r\n            return $data; // Return data as-is jika padding invalid\r\n        }\r\n        \r\n        // Check semua byte padding\r\n        for ($i = 0; $i < $padding; $i++) {\r\n            if (ord($data[$dataLength - $i - 1]) != $padding) {\r\n                return $data; // Return data as-is jika padding tidak konsisten\r\n            }\r\n        }\r\n        \r\n        return substr($data, 0, -$padding);\r\n    }\r\n\r\n    /**\r\n     * New endpoint untuk download decrypted PDF\r\n     */\r\n    private function downloadDecryptedPdf()\r\n    {\r\n        try {\r\n            $patientId = intval($_GET[\'patient_id\'] ?? 0);\r\n\r\n            if ($patientId <= 0) {\r\n                throw new Exception(\"Patient ID tidak valid\");\r\n            }\r\n\r\n            // Get patient data including PDF filename\r\n            $query = \"SELECT dokumen_pdf FROM pasien WHERE id_pasien = ?\";\r\n            $stmt = $this->conn->prepare($query);\r\n            $stmt->bind_param(\"i\", $patientId);\r\n            $stmt->execute();\r\n            $result = $stmt->get_result();\r\n\r\n            if ($result->num_rows === 0) {\r\n                throw new Exception(\"Data pasien tidak ditemukan\");\r\n            }\r\n\r\n            $patient = $result->fetch_assoc();\r\n            $encryptedPdfFilename = $patient[\'dokumen_pdf\'];\r\n\r\n            if (empty($encryptedPdfFilename)) {\r\n                throw new Exception(\"Tidak ada dokumen PDF untuk pasien ini\");\r\n            }\r\n\r\n            // Find the encrypted PDF file\r\n            $possiblePaths = [\r\n                __DIR__ . \'/../../uploads/pdfs/\' . $encryptedPdfFilename,\r\n                __DIR__ . \'/../uploads/pdfs/\' . $encryptedPdfFilename,\r\n                $_SERVER[\'DOCUMENT_ROOT\'] . \'/uploads/pdfs/\' . $encryptedPdfFilename,\r\n            ];\r\n\r\n            $pdfPath = null;\r\n            foreach ($possiblePaths as $path) {\r\n                if (file_exists($path)) {\r\n                    $pdfPath = $path;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if ($pdfPath === null) {\r\n                throw new Exception(\"File PDF tidak ditemukan\");\r\n            }\r\n\r\n            // Read encrypted file\r\n            $encryptedContent = file_get_contents($pdfPath);\r\n            if ($encryptedContent === false) {\r\n                throw new Exception(\"Tidak dapat membaca file PDF\");\r\n            }\r\n\r\n            // Decrypt PDF\r\n            $decryptedContent = $this->decryptPdfFile($encryptedContent);\r\n            if ($decryptedContent === false) {\r\n                throw new Exception(\"Gagal mendekripsi PDF\");\r\n            }\r\n\r\n            // Set headers for download\r\n            header(\'Content-Type: application/pdf\');\r\n            header(\'Content-Disposition: attachment; filename=\"decrypted_patient_\' . $patientId . \'.pdf\"\');\r\n            header(\'Content-Length: \' . strlen($decryptedContent));\r\n\r\n            echo $decryptedContent;\r\n            exit;\r\n\r\n        } catch (Exception $e) {\r\n            $this->sendError(\"Error downloading PDF: \" . $e->getMessage());\r\n        }\r\n    }\r\n\r\n    /**\r\n     *  NEW: Endpoint khusus untuk ekstraksi steganografi\r\n     */\r\n    private function extractSteganographyMessage()\r\n    {\r\n        try {\r\n            $patientId = intval($_GET[\'patient_id\'] ?? $_POST[\'patient_id\'] ?? 0);\r\n\r\n            if ($patientId <= 0) {\r\n                throw new Exception(\"Patient ID tidak valid\");\r\n            }\r\n\r\n            $query = \"SELECT foto_pasien FROM pasien WHERE id_pasien = ?\";\r\n            $stmt = $this->conn->prepare($query);\r\n            $stmt->bind_param(\"i\", $patientId);\r\n            $stmt->execute();\r\n            $result = $stmt->get_result();\r\n\r\n            if ($result->num_rows === 0) {\r\n                throw new Exception(\"Data pasien tidak ditemukan\");\r\n            }\r\n\r\n            $patient = $result->fetch_assoc();\r\n            $imageFilename = $patient[\'foto_pasien\'];\r\n\r\n            if (empty($imageFilename)) {\r\n                throw new Exception(\"Tidak ada gambar untuk pasien ini\");\r\n            }\r\n\r\n            // Find the image file\r\n            $possiblePaths = [\r\n                __DIR__ . \'/../../uploads/images/\' . $imageFilename,\r\n                __DIR__ . \'/../uploads/images/\' . $imageFilename,\r\n                $_SERVER[\'DOCUMENT_ROOT\'] . \'/uploads/images/\' . $imageFilename,\r\n            ];\r\n\r\n            $imagePath = null;\r\n            foreach ($possiblePaths as $path) {\r\n                if (file_exists($path)) {\r\n                    $imagePath = $path;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if ($imagePath === null) {\r\n                throw new Exception(\"File gambar tidak ditemukan\");\r\n            }\r\n\r\n            // Extract message menggunakan algoritma yang sudah diperbaiki\r\n            $message = $this->extractMessageFromImage($imagePath);\r\n\r\n            if ($message === false) {\r\n                throw new Exception(\"Tidak dapat mengekstrak pesan dari gambar\");\r\n            }\r\n\r\n            $this->sendSuccess([\r\n                \'message\' => $message,\r\n                \'patient_id\' => $patientId,\r\n                \'image_file\' => $imageFilename\r\n            ], \"Pesan berhasil diekstrak dari gambar\");\r\n\r\n        } catch (Exception $e) {\r\n            $this->sendError(\"Error extracting steganography: \" . $e->getMessage());\r\n        }\r\n    }\r\n\r\n    // ==================== DATA RETRIEVAL METHODS ====================\r\n\r\n    private function getDashboardStats()\r\n    {\r\n        try {\r\n            // Total patients\r\n            $totalQuery = \"SELECT COUNT(*) as total_pasien FROM pasien\";\r\n            $totalResult = $this->conn->query($totalQuery);\r\n            $total = $totalResult->fetch_assoc();\r\n\r\n            // Rawat inap count\r\n            $inapQuery = \"SELECT COUNT(*) as rawat_inap FROM pasien WHERE informasi_medis = \'rawat-inap\'\";\r\n            $inapResult = $this->conn->query($inapQuery);\r\n            $inap = $inapResult->fetch_assoc();\r\n\r\n            // Rawat jalan count\r\n            $jalanQuery = \"SELECT COUNT(*) as rawat_jalan FROM pasien WHERE informasi_medis = \'rawat-jalan\'\";\r\n            $jalanResult = $this->conn->query($jalanQuery);\r\n            $jalan = $jalanResult->fetch_assoc();\r\n\r\n            // Pemeriksaan count\r\n            $pemeriksaanQuery = \"SELECT COUNT(*) as pemeriksaan FROM pasien WHERE informasi_medis = \'pemeriksaan\'\";\r\n            $pemeriksaanResult = $this->conn->query($pemeriksaanQuery);\r\n            $pemeriksaan = $pemeriksaanResult->fetch_assoc();\r\n\r\n            // Total payment\r\n            $paymentQuery = \"SELECT COALESCE(SUM(jumlah_pembayaran), 0) as total_pembayaran FROM pasien\";\r\n            $paymentResult = $this->conn->query($paymentQuery);\r\n            $payment = $paymentResult->fetch_assoc();\r\n\r\n            // New patients (last 7 days)\r\n            $newQuery = \"SELECT COUNT(*) as pasien_baru FROM pasien WHERE created_at >= DATE_SUB(NOW(), INTERVAL 7 DAY)\";\r\n            $newResult = $this->conn->query($newQuery);\r\n            $new = $newResult->fetch_assoc();\r\n\r\n            $stats = [\r\n                \'total_pasien\' => (int)$total[\'total_pasien\'],\r\n                \'rawat_inap\' => (int)$inap[\'rawat_inap\'],\r\n                \'rawat_jalan\' => (int)$jalan[\'rawat_jalan\'],\r\n                \'pemeriksaan\' => (int)$pemeriksaan[\'pemeriksaan\'],\r\n                \'total_pembayaran\' => (float)$payment[\'total_pembayaran\'],\r\n                \'pasien_baru\' => (int)$new[\'pasien_baru\']\r\n            ];\r\n\r\n            $this->sendSuccess($stats, \"Stats loaded successfully\");\r\n\r\n        } catch (Exception $e) {\r\n            $this->sendError(\"Error loading stats: \" . $e->getMessage());\r\n        }\r\n    }\r\n\r\n    private function getRecentPatients()\r\n    {\r\n        try {\r\n            $query = \"SELECT * FROM pasien ORDER BY created_at DESC LIMIT 5\";\r\n            $result = $this->conn->query($query);\r\n\r\n            $patients = [];\r\n            while ($row = $result->fetch_assoc()) {\r\n                // Decrypt the data\r\n                $row[\'nama_lengkap\'] = $this->xorDecrypt($row[\'nama_lengkap\'], XOR_KEY);\r\n                $row[\'alamat_lengkap\'] = $this->xorDecrypt($row[\'alamat_lengkap\'], XOR_KEY);\r\n                $row[\'hasil_pemeriksaan\'] = $this->altbashAesDecrypt($row[\'hasil_pemeriksaan\']);\r\n                \r\n                $patients[] = $row;\r\n            }\r\n\r\n            $this->sendSuccess($patients, \"Recent patients loaded\");\r\n\r\n        } catch (Exception $e) {\r\n            $this->sendError(\"Error loading recent patients: \" . $e->getMessage());\r\n        }\r\n    }\r\n\r\n    private function getPatientsList()\r\n    {\r\n        try {\r\n            $page = intval($_GET[\'page\'] ?? 1);\r\n            $limit = intval($_GET[\'limit\'] ?? 10);\r\n            $search = $_GET[\'search\'] ?? \'\';\r\n            $status = $_GET[\'status\'] ?? \'\';\r\n            $service = $_GET[\'service\'] ?? \'\';\r\n\r\n            $offset = ($page - 1) * $limit;\r\n\r\n            // Build WHERE conditions\r\n            $whereConditions = [];\r\n            $params = [];\r\n            $types = \'\';\r\n\r\n            if (!empty($search)) {\r\n                $whereConditions[] = \"(nama_lengkap LIKE ? OR alamat_lengkap LIKE ?)\";\r\n                $searchTerm = \"%$search%\";\r\n                $params[] = $searchTerm;\r\n                $params[] = $searchTerm;\r\n                $types .= \'ss\';\r\n            }\r\n\r\n            if (!empty($status)) {\r\n                $whereConditions[] = \"status_pasien = ?\";\r\n                $params[] = $status;\r\n                $types .= \'s\';\r\n            }\r\n\r\n            if (!empty($service)) {\r\n                $whereConditions[] = \"informasi_medis = ?\";\r\n                $params[] = $service;\r\n                $types .= \'s\';\r\n            }\r\n\r\n            $whereClause = \'\';\r\n            if (!empty($whereConditions)) {\r\n                $whereClause = \"WHERE \" . implode(\" AND \", $whereConditions);\r\n            }\r\n\r\n            // Count total records\r\n            $countQuery = \"SELECT COUNT(*) as total FROM pasien $whereClause\";\r\n            $countStmt = $this->conn->prepare($countQuery);\r\n            \r\n            if (!empty($params)) {\r\n                $countStmt->bind_param($types, ...$params);\r\n            }\r\n            \r\n            $countStmt->execute();\r\n            $countResult = $countStmt->get_result();\r\n            $totalCount = $countResult->fetch_assoc()[\'total\'];\r\n            $totalPages = ceil($totalCount / $limit);\r\n\r\n            $dataQuery = \"SELECT * FROM pasien $whereClause ORDER BY created_at DESC, id_pasien DESC LIMIT ? OFFSET ?\";\r\n            $dataStmt = $this->conn->prepare($dataQuery);\r\n            \r\n            $params[] = $limit;\r\n            $params[] = $offset;\r\n            $types .= \'ii\';\r\n\r\n            if (!empty($params)) {\r\n                $dataStmt->bind_param($types, ...$params);\r\n            }\r\n            \r\n            $dataStmt->execute();\r\n            $result = $dataStmt->get_result();\r\n\r\n            $patients = [];\r\n            while ($row = $result->fetch_assoc()) {\r\n                // Decrypt the data for display\r\n                $row[\'nama_lengkap\'] = $this->xorDecrypt($row[\'nama_lengkap\'], XOR_KEY);\r\n                $row[\'alamat_lengkap\'] = $this->xorDecrypt($row[\'alamat_lengkap\'], XOR_KEY);\r\n                $row[\'hasil_pemeriksaan\'] = $this->altbashAesDecrypt($row[\'hasil_pemeriksaan\']);\r\n                \r\n                $patients[] = $row;\r\n            }\r\n\r\n            $response = [\r\n                \'patients\' => $patients,\r\n                \'total_pages\' => $totalPages,\r\n                \'current_page\' => $page,\r\n                \'total_count\' => $totalCount\r\n            ];\r\n\r\n            $this->sendSuccess($response, \"Patients list loaded\");\r\n\r\n        } catch (Exception $e) {\r\n            $this->sendError(\"Error loading patients list: \" . $e->getMessage());\r\n        }\r\n    }\r\n\r\n    private function getPatientDetail()\r\n    {\r\n        try {\r\n            $patientId = intval($_GET[\'patient_id\'] ?? $_POST[\'patient_id\'] ?? 0);\r\n\r\n            if ($patientId <= 0) {\r\n                throw new Exception(\"Patient ID tidak valid\");\r\n            }\r\n\r\n            $query = \"SELECT * FROM pasien WHERE id_pasien = ?\";\r\n            $stmt = $this->conn->prepare($query);\r\n            $stmt->bind_param(\"i\", $patientId);\r\n            $stmt->execute();\r\n            $result = $stmt->get_result();\r\n\r\n            if ($result->num_rows === 0) {\r\n                throw new Exception(\"Data pasien tidak ditemukan\");\r\n            }\r\n\r\n            $patient = $result->fetch_assoc();\r\n\r\n            // Decrypt all encrypted data\r\n            $patient[\'nama_lengkap\'] = $this->xorDecrypt($patient[\'nama_lengkap\'], XOR_KEY);\r\n            $patient[\'alamat_lengkap\'] = $this->xorDecrypt($patient[\'alamat_lengkap\'], XOR_KEY);\r\n            $patient[\'hasil_pemeriksaan\'] = $this->altbashAesDecrypt($patient[\'hasil_pemeriksaan\']);\r\n\r\n            //  FIXED: Extract medical message from image menggunakan algoritma yang sudah diperbaiki\r\n            $medicalMessage = \'\';\r\n            if (!empty($patient[\'foto_pasien\'])) {\r\n                $possiblePaths = [\r\n                    __DIR__ . \'/../../uploads/images/\' . $patient[\'foto_pasien\'],\r\n                    __DIR__ . \'/../uploads/images/\' . $patient[\'foto_pasien\'],\r\n                    $_SERVER[\'DOCUMENT_ROOT\'] . \'/uploads/images/\' . $patient[\'foto_pasien\'],\r\n                ];\r\n\r\n                $imagePath = null;\r\n                foreach ($possiblePaths as $path) {\r\n                    if (file_exists($path)) {\r\n                        $imagePath = $path;\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                if ($imagePath !== null) {\r\n                    $medicalMessage = $this->extractMessageFromImage($imagePath);\r\n                    if ($medicalMessage === false) {\r\n                        $medicalMessage = \'\'; // Jika ekstraksi gagal, set kosong\r\n                    }\r\n                }\r\n            }\r\n            $patient[\'medical_message\'] = $medicalMessage;\r\n\r\n            $this->sendSuccess($patient, \"Patient detail loaded\");\r\n\r\n        } catch (Exception $e) {\r\n            $this->sendError(\"Error loading patient detail: \" . $e->getMessage());\r\n        }\r\n    }\r\n\r\n    private function updatePatient()\r\n    {\r\n        try {\r\n            $patientId = intval($_POST[\'patient_id\'] ?? 0);\r\n            \r\n            if ($patientId <= 0) {\r\n                throw new Exception(\"Patient ID tidak valid\");\r\n            }\r\n\r\n            // Get form data\r\n            $nama_pasien = $this->sanitizeInput($_POST[\'nama_pasien\']);\r\n            $tanggal_lahir = $_POST[\'tanggal_lahir\'];\r\n            $alamat = $this->sanitizeInput($_POST[\'alamat\']);\r\n            $jenis_layanan = $this->sanitizeInput($_POST[\'jenis_layanan\']);\r\n            $status_pasien = $this->sanitizeInput($_POST[\'status_pasien\']);\r\n            $hasil_pemeriksaan = $this->sanitizeInput($_POST[\'hasil_pemeriksaan\']);\r\n            $jumlah_pembayaran = floatval($_POST[\'jumlah_pembayaran\']);\r\n\r\n            // Encrypt data before updating\r\n            $encrypted_nama = $this->xorEncrypt($nama_pasien, XOR_KEY);\r\n            $encrypted_alamat = $this->xorEncrypt($alamat, XOR_KEY);\r\n            $encrypted_hasil = $this->altbashAesEncrypt($hasil_pemeriksaan);\r\n\r\n            $query = \"UPDATE pasien SET \r\n                nama_lengkap = ?, \r\n                tanggal_lahir = ?, \r\n                alamat_lengkap = ?, \r\n                informasi_medis = ?, \r\n                status_pasien = ?, \r\n                hasil_pemeriksaan = ?, \r\n                jumlah_pembayaran = ?,\r\n                updated_at = NOW()\r\n                WHERE id_pasien = ?\";\r\n\r\n            $stmt = $this->conn->prepare($query);\r\n            $stmt->bind_param(\r\n                \"ssssssdi\",\r\n                $encrypted_nama,\r\n                $tanggal_lahir,\r\n                $encrypted_alamat,\r\n                $jenis_layanan,\r\n                $status_pasien,\r\n                $encrypted_hasil,\r\n                $jumlah_pembayaran,\r\n                $patientId\r\n            );\r\n\r\n            if ($stmt->execute()) {\r\n                $this->sendSuccess([], \"Data pasien berhasil diperbarui\");\r\n            } else {\r\n                throw new Exception(\"Gagal memperbarui data: \" . $stmt->error);\r\n            }\r\n\r\n        } catch (Exception $e) {\r\n            $this->sendError(\"Error updating patient: \" . $e->getMessage());\r\n        }\r\n    }\r\n\r\n    private function deletePatient()\r\n    {\r\n        try {\r\n            $patientId = intval($_POST[\'patient_id\'] ?? 0);\r\n\r\n            if ($patientId <= 0) {\r\n                throw new Exception(\"Patient ID tidak valid\");\r\n            }\r\n\r\n            $query = \"DELETE FROM pasien WHERE id_pasien = ?\";\r\n            $stmt = $this->conn->prepare($query);\r\n            $stmt->bind_param(\"i\", $patientId);\r\n\r\n            if ($stmt->execute()) {\r\n                $this->sendSuccess([], \"Data pasien berhasil dihapus\");\r\n            } else {\r\n                throw new Exception(\"Gagal menghapus data: \" . $stmt->error);\r\n            }\r\n\r\n        } catch (Exception $e) {\r\n            $this->sendError(\"Error deleting patient: \" . $e->getMessage());\r\n        }\r\n    }\r\n\r\n    // ==================== ENCRYPTION METHODS (for update) ====================\r\n\r\n    private function xorEncrypt($data, $key)\r\n    {\r\n        if (empty($data)) return \'\';\r\n\r\n        $data = mb_convert_encoding($data, \'UTF-8\');\r\n        $key = mb_convert_encoding($key, \'UTF-8\');\r\n\r\n        $encrypted = \'\';\r\n        $dataLen = mb_strlen($data, \'UTF-8\');\r\n        $keyLen = mb_strlen($key, \'UTF-8\');\r\n\r\n        for ($i = 0; $i < $dataLen; $i++) {\r\n            $dataChar = mb_substr($data, $i, 1, \'UTF-8\');\r\n            $keyChar = mb_substr($key, $i % $keyLen, 1, \'UTF-8\');\r\n\r\n            $dataAscii = ord($dataChar);\r\n            $keyAscii = ord($keyChar);\r\n            $encryptedAscii = $dataAscii ^ $keyAscii;\r\n\r\n            $encrypted .= chr($encryptedAscii);\r\n        }\r\n\r\n        return base64_encode($encrypted);\r\n    }\r\n\r\n    private function altbashAesEncrypt($data)\r\n    {\r\n        if (empty($data)) return \'\';\r\n\r\n        $altbash_encrypted = $this->altbashEncrypt($data);\r\n        $aes_encrypted = $this->aesEncrypt($altbash_encrypted);\r\n\r\n        return $aes_encrypted;\r\n    }\r\n\r\n    private function altbashEncrypt($data)\r\n    {\r\n        if (empty($data)) return \'\';\r\n\r\n        $data = mb_convert_encoding($data, \'UTF-8\');\r\n        $key = mb_convert_encoding(XOR_KEY, \'UTF-8\');\r\n\r\n        $encrypted = \'\';\r\n        $dataLen = mb_strlen($data, \'UTF-8\');\r\n        $keyLen = mb_strlen($key, \'UTF-8\');\r\n\r\n        for ($i = 0; $i < $dataLen; $i++) {\r\n            $char = mb_substr($data, $i, 1, \'UTF-8\');\r\n            $ascii = ord($char);\r\n            $shifted_ascii = ($ascii + 3) % 256;\r\n            $encrypted .= chr($shifted_ascii);\r\n        }\r\n\r\n        $xor_encrypted = \'\';\r\n        for ($i = 0; $i < $dataLen; $i++) {\r\n            $dataChar = $encrypted[$i];\r\n            $keyChar = mb_substr($key, $i % $keyLen, 1, \'UTF-8\');\r\n\r\n            $dataAscii = ord($dataChar);\r\n            $keyAscii = ord($keyChar);\r\n            $xorAscii = $dataAscii ^ $keyAscii;\r\n\r\n            $xor_encrypted .= chr($xorAscii);\r\n        }\r\n\r\n        $reversed = strrev($xor_encrypted);\r\n        return base64_encode($reversed);\r\n    }\r\n\r\n    private function aesEncrypt($data)\r\n    {\r\n        if (empty($data)) return \'\';\r\n\r\n        $encrypted = openssl_encrypt(\r\n            $data,\r\n            \'AES-256-CBC\',\r\n            AES_KEY,\r\n            OPENSSL_RAW_DATA,\r\n            AES_IV\r\n        );\r\n\r\n        return base64_encode($encrypted);\r\n    }\r\n\r\n    // ==================== UTILITY METHODS ====================\r\n\r\n    private function logMessage($message)\r\n    {\r\n        $timestamp = date(\'Y-m-d H:i:s\');\r\n        $logMessage = \"[$timestamp] $message\\n\";\r\n        error_log($logMessage, 3, __DIR__ . \'/dashboard_errors.log\');\r\n    }\r\n\r\n    private function sanitizeInput($data)\r\n    {\r\n        if ($this->conn) {\r\n            return $this->conn->real_escape_string(trim($data));\r\n        }\r\n        return trim($data);\r\n    }\r\n\r\n    private function sendSuccess($data, $message = \"\")\r\n    {\r\n        echo json_encode([\r\n            \'success\' => true,\r\n            \'message\' => $message,\r\n            \'data\' => $data\r\n        ], JSON_UNESCAPED_UNICODE);\r\n        exit;\r\n    }\r\n\r\n    private function sendError($message, $code = 400)\r\n    {\r\n        http_response_code($code);\r\n        echo json_encode([\r\n            \'success\' => false,\r\n            \'error\' => $message\r\n        ], JSON_UNESCAPED_UNICODE);\r\n        exit;\r\n    }\r\n\r\n    public function __destruct()\r\n    {\r\n        if ($this->conn) {\r\n            $this->conn->close();\r\n        }\r\n    }\r\n}\r\n\r\n// Handle the request\r\n$handler = new DashboardView();\r\n$handler->handleRequest();\r\n?>
[2025-11-11 17:05:41] Encrypting message for steganography: <?php\r\n\r\nini_set(\'display_errors\', 1);\r\nini_set(\'display_startup_errors\', 1);\r\nerror_reporting(E_ALL);\r\nini_set(\'log_errors\', 1);\r\nini_set(\'error_log\', __DIR__ . \'/dashboard_errors.log\');\r\n\r\nheader(\'Content-Type: application/json; charset=utf-8\');\r\nheader(\'Access-Control-Allow-Origin: *\');\r\nheader(\'Access-Control-Allow-Methods: GET, POST, OPTIONS\');\r\nheader(\'Access-Control-Allow-Headers: Content-Type\');\r\n\r\n// Database configuration\r\ndefine(\'DB_HOST\', \'localhost\');\r\ndefine(\'DB_USER\', \'root\');\r\ndefine(\'DB_PASS\', \'\');\r\ndefine(\'DB_NAME\', \'kriptoproject\');\r\n\r\n// Encryption keys (SAMA dengan yang di upload.php)\r\ndefine(\'XOR_KEY\', \'medicare_secret_key_2024\');\r\ndefine(\'AES_KEY\', \'medicare_aes_key_2024_32bytes_long!\');\r\ndefine(\'AES_IV\', \'1234567890123456\');\r\n\r\nclass DashboardView\r\n{\r\n    private $conn;\r\n\r\n    public function __construct()\r\n    {\r\n        $this->connectDB();\r\n    }\r\n\r\n    private function connectDB()\r\n    {\r\n        try {\r\n            $this->conn = new mysqli(DB_HOST, DB_USER, DB_PASS, DB_NAME);\r\n\r\n            if ($this->conn->connect_error) {\r\n                throw new Exception(\"Koneksi database gagal: \" . $this->conn->connect_error);\r\n            }\r\n\r\n            $this->conn->set_charset(\"utf8mb4\");\r\n        } catch (Exception $e) {\r\n            $this->sendError($e->getMessage());\r\n        }\r\n    }\r\n\r\n    public function handleRequest()\r\n    {\r\n        $action = $_GET[\'action\'] ?? $_POST[\'action\'] ?? \'\';\r\n\r\n        switch ($action) {\r\n            case \'get_stats\':\r\n                $this->getDashboardStats();\r\n                break;\r\n            case \'get_recent_patients\':\r\n                $this->getRecentPatients();\r\n                break;\r\n            case \'get_patients\':\r\n                $this->getPatientsList();\r\n                break;\r\n            case \'get_patient_detail\':\r\n                $this->getPatientDetail();\r\n                break;\r\n            case \'update_patient\':\r\n                $this->updatePatient();\r\n                break;\r\n            case \'delete_patient\':\r\n                $this->deletePatient();\r\n                break;\r\n            case \'download_decrypted_pdf\':\r\n                $this->downloadDecryptedPdf();\r\n                break;\r\n            case \'extract_steganography\': // NEW ACTION untuk ekstraksi steganografi\r\n                $this->extractSteganographyMessage();\r\n                break;\r\n            default:\r\n                $this->sendError(\'Action tidak valid\');\r\n        }\r\n    }\r\n\r\n    // ==================== IMPROVED DECRYPTION METHODS ====================\r\n\r\n    /**\r\n     * Decrypt XOR encrypted data\r\n     */\r\n    private function xorDecrypt($encryptedData, $key)\r\n    {\r\n        if (empty($encryptedData)) return \'\';\r\n\r\n        $data = base64_decode($encryptedData);\r\n        $key = mb_convert_encoding($key, \'UTF-8\');\r\n\r\n        $decrypted = \'\';\r\n        $dataLen = strlen($data);\r\n        $keyLen = mb_strlen($key, \'UTF-8\');\r\n\r\n        for ($i = 0; $i < $dataLen; $i++) {\r\n            $dataChar = $data[$i];\r\n            $keyChar = mb_substr($key, $i % $keyLen, 1, \'UTF-8\');\r\n\r\n            $dataAscii = ord($dataChar);\r\n            $keyAscii = ord($keyChar);\r\n            $decryptedAscii = $dataAscii ^ $keyAscii;\r\n\r\n            $decrypted .= chr($decryptedAscii);\r\n        }\r\n\r\n        return $decrypted;\r\n    }\r\n\r\n    /**\r\n     * Decrypt AES encrypted data\r\n     */\r\n    private function aesDecrypt($encryptedData)\r\n    {\r\n        if (empty($encryptedData)) return \'\';\r\n\r\n        $encrypted = base64_decode($encryptedData);\r\n        \r\n        $decrypted = openssl_decrypt(\r\n            $encrypted,\r\n            \'AES-256-CBC\',\r\n            AES_KEY,\r\n            OPENSSL_RAW_DATA,\r\n            AES_IV\r\n        );\r\n\r\n        return $decrypted ?: \'\';\r\n    }\r\n\r\n    /**\r\n     * Decrypt AltBash + AES encrypted data\r\n     */\r\n    private function altbashAesDecrypt($encryptedData)\r\n    {\r\n        if (empty($encryptedData)) return \'\';\r\n\r\n        // First decrypt AES\r\n        $altbashEncrypted = $this->aesDecrypt($encryptedData);\r\n        if (empty($altbashEncrypted)) return \'\';\r\n\r\n        // Then decrypt AltBash\r\n        return $this->altbashDecrypt($altbashEncrypted);\r\n    }\r\n\r\n    /**\r\n     * Decrypt Alphabet-Bashing encrypted data\r\n     */\r\n    private function altbashDecrypt($encryptedData)\r\n    {\r\n        if (empty($encryptedData)) return \'\';\r\n\r\n        $data = base64_decode($encryptedData);\r\n        $reversed = strrev($data);\r\n        $key = mb_convert_encoding(XOR_KEY, \'UTF-8\');\r\n\r\n        $xorDecrypted = \'\';\r\n        $dataLen = strlen($reversed);\r\n        $keyLen = mb_strlen($key, \'UTF-8\');\r\n\r\n        for ($i = 0; $i < $dataLen; $i++) {\r\n            $dataChar = $reversed[$i];\r\n            $keyChar = mb_substr($key, $i % $keyLen, 1, \'UTF-8\');\r\n\r\n            $dataAscii = ord($dataChar);\r\n            $keyAscii = ord($keyChar);\r\n            $xorAscii = $dataAscii ^ $keyAscii;\r\n\r\n            $xorDecrypted .= chr($xorAscii);\r\n        }\r\n\r\n        $decrypted = \'\';\r\n        $dataLen = strlen($xorDecrypted);\r\n\r\n        for ($i = 0; $i < $dataLen; $i++) {\r\n            $char = $xorDecrypted[$i];\r\n            $ascii = ord($char);\r\n            $shiftedAscii = ($ascii - 3 + 256) % 256;\r\n            $decrypted .= chr($shiftedAscii);\r\n        }\r\n\r\n        return $decrypted;\r\n    }\r\n\r\n    /**\r\n     * Decrypt PDF file that was encrypted with Caesar + AES\r\n     */\r\n    private function decryptPdfFile($encryptedContent)\r\n    {\r\n        try {\r\n            // Step 1: AES decryption\r\n            $aesDecrypted = $this->aesDecryptBinary($encryptedContent);\r\n            if ($aesDecrypted === false) {\r\n                throw new Exception(\"AES decryption failed\");\r\n            }\r\n\r\n            // Step 2: Caesar Cipher decryption (shift of 5)\r\n            $decrypted = $this->caesarCipherDecrypt($aesDecrypted, 5);\r\n\r\n            return $decrypted;\r\n        } catch (Exception $e) {\r\n            $this->logMessage(\"ERROR in decryptPdfFile: \" . $e->getMessage());\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * AES decryption for binary data\r\n     */\r\n    private function aesDecryptBinary($data)\r\n    {\r\n        if (empty($data)) {\r\n            return false;\r\n        }\r\n\r\n        $decrypted = openssl_decrypt(\r\n            $data,\r\n            \'AES-256-CBC\',\r\n            AES_KEY,\r\n            OPENSSL_RAW_DATA,\r\n            AES_IV\r\n        );\r\n\r\n        return $decrypted;\r\n    }\r\n\r\n    /**\r\n     * Caesar Cipher decryption for binary data\r\n     */\r\n    private function caesarCipherDecrypt($data, $shift)\r\n    {\r\n        $decrypted = \'\';\r\n        $length = strlen($data);\r\n        \r\n        for ($i = 0; $i < $length; $i++) {\r\n            $byte = ord($data[$i]);\r\n            // Apply Caesar shift (mod 256 for bytes)\r\n            $decryptedByte = ($byte - $shift + 256) % 256;\r\n            $decrypted .= chr($decryptedByte);\r\n        }\r\n        \r\n        return $decrypted;\r\n    }\r\n\r\n    /**\r\n     *  FIXED: Extract hidden message from steganographed image menggunakan algoritma yang sama dengan test\r\n     */\r\n    private function extractMessageFromImage($imagePath)\r\n    {\r\n        try {\r\n            $this->logMessage(\"=== EXTRACTING MESSAGE FROM IMAGE (FIXED ALGORITHM) ===\");\r\n            \r\n            if (!file_exists($imagePath)) {\r\n                throw new Exception(\"Image file not found: \" . $imagePath);\r\n            }\r\n\r\n            $imageInfo = getimagesize($imagePath);\r\n            if ($imageInfo === false) {\r\n                throw new Exception(\"Cannot get image information\");\r\n            }\r\n\r\n            $width = $imageInfo[0];\r\n            $height = $imageInfo[1];\r\n            $imageType = $imageInfo[2];\r\n            \r\n            $this->logMessage(\"Image dimensions: {$width}x{$height}, Type: {$imageType}\");\r\n\r\n            // Load image - support WebP dan format lainnya\r\n            $image = null;\r\n            switch ($imageType) {\r\n                case IMAGETYPE_JPEG:\r\n                    $image = imagecreatefromjpeg($imagePath);\r\n                    $this->logMessage(\"Loaded as JPEG\");\r\n                    break;\r\n                case IMAGETYPE_PNG:\r\n                    $image = imagecreatefrompng($imagePath);\r\n                    $this->logMessage(\"Loaded as PNG\");\r\n                    break;\r\n                case IMAGETYPE_GIF:\r\n                    $image = imagecreatefromgif($imagePath);\r\n                    $this->logMessage(\"Loaded as GIF\");\r\n                    break;\r\n                case 18: // IMAGETYPE_WEBP\r\n                    if (function_exists(\'imagecreatefromwebp\')) {\r\n                        $image = imagecreatefromwebp($imagePath);\r\n                        $this->logMessage(\"Loaded as WEBP\");\r\n                    } else {\r\n                        throw new Exception(\"WebP not supported on this server\");\r\n                    }\r\n                    break;\r\n                default:\r\n                    throw new Exception(\"Unsupported image type: \" . $imageType);\r\n            }\r\n\r\n            if (!$image) {\r\n                throw new Exception(\"Cannot create image from source\");\r\n            }\r\n\r\n            //  FIXED: Extract header menggunakan algoritma yang sama dengan embedding\r\n            $headerBits = \'\';\r\n            $bitsExtracted = 0;\r\n            $headerSize = 32;\r\n\r\n            $this->logMessage(\"Extracting header...\");\r\n            for ($y = 0; $y < $height; $y++) {\r\n                for ($x = 0; $x < $width; $x++) {\r\n                    if ($bitsExtracted >= $headerSize) break 2;\r\n                    \r\n                    $rgb = imagecolorat($image, $x, $y);\r\n                    $r = ($rgb >> 16) & 0xFF;\r\n                    $g = ($rgb >> 8) & 0xFF;\r\n                    $b = $rgb & 0xFF;\r\n\r\n                    // Extract dari LSB - URUTAN SAMA dengan enkripsi\r\n                    $headerBits .= $r & 1;\r\n                    $bitsExtracted++;\r\n                    if ($bitsExtracted >= $headerSize) break;\r\n                    \r\n                    $headerBits .= $g & 1;\r\n                    $bitsExtracted++;\r\n                    if ($bitsExtracted >= $headerSize) break;\r\n                    \r\n                    $headerBits .= $b & 1;\r\n                    $bitsExtracted++;\r\n                    if ($bitsExtracted >= $headerSize) break;\r\n                }\r\n            }\r\n\r\n            $this->logMessage(\"Header bits extracted: \" . $bitsExtracted);\r\n\r\n            // Convert header bits to message length\r\n            $messageLength = 0;\r\n            for ($i = 0; $i < 32; $i += 8) {\r\n                $byte = bindec(substr($headerBits, $i, 8));\r\n                $messageLength = ($messageLength << 8) | $byte;\r\n            }\r\n\r\n            $this->logMessage(\"Message length from header: \" . $messageLength);\r\n\r\n            if ($messageLength <= 0 || $messageLength > 100000) {\r\n                $this->logMessage(\"No valid message found (invalid length: $messageLength)\");\r\n                imagedestroy($image);\r\n                return false;\r\n            }\r\n\r\n            //  FIXED: Extract encrypted message dengan algoritma yang DIPERBAIKI\r\n            $encryptedBits = \'\';\r\n            $bitsNeeded = $messageLength * 8;\r\n            $bitsExtracted = 0;\r\n\r\n            $this->logMessage(\"Extracting message data ($bitsNeeded bits needed)...\");\r\n            \r\n            //  PERBAIKAN: Gunakan counter bit GLOBAL, bukan skip per pixel\r\n            $globalBitCounter = 0;\r\n            \r\n            for ($y = 0; $y < $height; $y++) {\r\n                for ($x = 0; $x < $width; $x++) {\r\n                    $rgb = imagecolorat($image, $x, $y);\r\n                    $r = ($rgb >> 16) & 0xFF;\r\n                    $g = ($rgb >> 8) & 0xFF;\r\n                    $b = $rgb & 0xFF;\r\n\r\n                    // Process each channel\r\n                    $channels = [$r, $g, $b];\r\n                    \r\n                    foreach ($channels as $channel) {\r\n                        // Skip bits yang sudah digunakan untuk header\r\n                        if ($globalBitCounter < 32) {\r\n                            $globalBitCounter++;\r\n                            continue;\r\n                        }\r\n\r\n                        // Extract message bits setelah header\r\n                        if ($bitsExtracted < $bitsNeeded) {\r\n                            $encryptedBits .= $channel & 1;\r\n                            $bitsExtracted++;\r\n                            $globalBitCounter++;\r\n                        } else {\r\n                            break 3; // Keluar dari semua loop\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            $this->logMessage(\"Message bits extracted: \" . $bitsExtracted);\r\n            $this->logMessage(\"Total bits processed: \" . $globalBitCounter);\r\n\r\n            if ($bitsExtracted < $bitsNeeded) {\r\n                $this->logMessage(\"ERROR: Not enough bits extracted. Needed: $bitsNeeded, Got: $bitsExtracted\");\r\n                imagedestroy($image);\r\n                return false;\r\n            }\r\n\r\n            // Convert bits to bytes\r\n            $encryptedMessage = \'\';\r\n            for ($i = 0; $i < $bitsNeeded; $i += 8) {\r\n                $byteBits = substr($encryptedBits, $i, 8);\r\n                if (strlen($byteBits) < 8) {\r\n                    $this->logMessage(\"ERROR: Incomplete byte at position $i\");\r\n                    break;\r\n                }\r\n                $byte = bindec($byteBits);\r\n                $encryptedMessage .= chr($byte);\r\n            }\r\n\r\n            $this->logMessage(\"Encrypted message length: \" . strlen($encryptedMessage) . \" bytes\");\r\n\r\n            //  FIXED: DECRYPTION dengan error handling yang lebih baik\r\n            $this->logMessage(\"Attempting AES decryption...\");\r\n            \r\n            $decrypted = openssl_decrypt(\r\n                $encryptedMessage,\r\n                \'AES-256-CBC\',\r\n                AES_KEY,\r\n                OPENSSL_RAW_DATA,\r\n                AES_IV\r\n            );\r\n\r\n            if ($decrypted === false) {\r\n                $error = openssl_error_string();\r\n                $this->logMessage(\"AES decryption failed: \" . $error);\r\n                \r\n                // Coba alternatif: handle padding manual\r\n                $decrypted = $this->decryptWithPaddingHandling($encryptedMessage);\r\n                if ($decrypted === false) {\r\n                    $this->logMessage(\"Alternative decryption also failed\");\r\n                    imagedestroy($image);\r\n                    return false;\r\n                }\r\n            }\r\n\r\n            // Remove PKCS7 padding\r\n            $originalMessage = $this->pkcs7Unpad($decrypted);\r\n            \r\n            if ($originalMessage === false) {\r\n                $this->logMessage(\"Padding removal failed, using raw decrypted data\");\r\n                $originalMessage = $decrypted;\r\n            }\r\n            \r\n            $this->logMessage(\" Decryption successful\");\r\n            \r\n            imagedestroy($image);\r\n            \r\n            return $originalMessage;\r\n\r\n        } catch (Exception $e) {\r\n            $this->logMessage(\"ERROR in extractMessageFromImage: \" . $e->getMessage());\r\n            if (isset($image)) {\r\n                imagedestroy($image);\r\n            }\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Alternative decryption dengan padding handling\r\n     */\r\n    private function decryptWithPaddingHandling($encryptedMessage)\r\n    {\r\n        $this->logMessage(\"Trying alternative decryption with padding handling...\");\r\n        \r\n        // Coba tanpa OPENSSL_RAW_DATA dulu\r\n        $decrypted = openssl_decrypt(\r\n            $encryptedMessage,\r\n            \'AES-256-CBC\',\r\n            AES_KEY,\r\n            0, // Bukan raw data\r\n            AES_IV\r\n        );\r\n\r\n        if ($decrypted === false) {\r\n            // Coba dengan zero padding\r\n            $decrypted = openssl_decrypt(\r\n                $encryptedMessage,\r\n                \'AES-256-CBC\',\r\n                AES_KEY,\r\n                OPENSSL_ZERO_PADDING,\r\n                AES_IV\r\n            );\r\n        }\r\n\r\n        return $decrypted;\r\n    }\r\n\r\n    /**\r\n     * PKCS7 Unpadding dengan error handling\r\n     */\r\n    private function pkcs7Unpad($data)\r\n    {\r\n        if (empty($data)) return \'\';\r\n        \r\n        $dataLength = strlen($data);\r\n        if ($dataLength == 0) return \'\';\r\n        \r\n        $padding = ord($data[$dataLength - 1]);\r\n        \r\n        // Validasi padding\r\n        if ($padding > 16 || $padding == 0 || $padding > $dataLength) {\r\n            return $data; // Return data as-is jika padding invalid\r\n        }\r\n        \r\n        // Check semua byte padding\r\n        for ($i = 0; $i < $padding; $i++) {\r\n            if (ord($data[$dataLength - $i - 1]) != $padding) {\r\n                return $data; // Return data as-is jika padding tidak konsisten\r\n            }\r\n        }\r\n        \r\n        return substr($data, 0, -$padding);\r\n    }\r\n\r\n    /**\r\n     * New endpoint untuk download decrypted PDF\r\n     */\r\n    private function downloadDecryptedPdf()\r\n    {\r\n        try {\r\n            $patientId = intval($_GET[\'patient_id\'] ?? 0);\r\n\r\n            if ($patientId <= 0) {\r\n                throw new Exception(\"Patient ID tidak valid\");\r\n            }\r\n\r\n            // Get patient data including PDF filename\r\n            $query = \"SELECT dokumen_pdf FROM pasien WHERE id_pasien = ?\";\r\n            $stmt = $this->conn->prepare($query);\r\n            $stmt->bind_param(\"i\", $patientId);\r\n            $stmt->execute();\r\n            $result = $stmt->get_result();\r\n\r\n            if ($result->num_rows === 0) {\r\n                throw new Exception(\"Data pasien tidak ditemukan\");\r\n            }\r\n\r\n            $patient = $result->fetch_assoc();\r\n            $encryptedPdfFilename = $patient[\'dokumen_pdf\'];\r\n\r\n            if (empty($encryptedPdfFilename)) {\r\n                throw new Exception(\"Tidak ada dokumen PDF untuk pasien ini\");\r\n            }\r\n\r\n            // Find the encrypted PDF file\r\n            $possiblePaths = [\r\n                __DIR__ . \'/../../uploads/pdfs/\' . $encryptedPdfFilename,\r\n                __DIR__ . \'/../uploads/pdfs/\' . $encryptedPdfFilename,\r\n                $_SERVER[\'DOCUMENT_ROOT\'] . \'/uploads/pdfs/\' . $encryptedPdfFilename,\r\n            ];\r\n\r\n            $pdfPath = null;\r\n            foreach ($possiblePaths as $path) {\r\n                if (file_exists($path)) {\r\n                    $pdfPath = $path;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if ($pdfPath === null) {\r\n                throw new Exception(\"File PDF tidak ditemukan\");\r\n            }\r\n\r\n            // Read encrypted file\r\n            $encryptedContent = file_get_contents($pdfPath);\r\n            if ($encryptedContent === false) {\r\n                throw new Exception(\"Tidak dapat membaca file PDF\");\r\n            }\r\n\r\n            // Decrypt PDF\r\n            $decryptedContent = $this->decryptPdfFile($encryptedContent);\r\n            if ($decryptedContent === false) {\r\n                throw new Exception(\"Gagal mendekripsi PDF\");\r\n            }\r\n\r\n            // Set headers for download\r\n            header(\'Content-Type: application/pdf\');\r\n            header(\'Content-Disposition: attachment; filename=\"decrypted_patient_\' . $patientId . \'.pdf\"\');\r\n            header(\'Content-Length: \' . strlen($decryptedContent));\r\n\r\n            echo $decryptedContent;\r\n            exit;\r\n\r\n        } catch (Exception $e) {\r\n            $this->sendError(\"Error downloading PDF: \" . $e->getMessage());\r\n        }\r\n    }\r\n\r\n    /**\r\n     *  NEW: Endpoint khusus untuk ekstraksi steganografi\r\n     */\r\n    private function extractSteganographyMessage()\r\n    {\r\n        try {\r\n            $patientId = intval($_GET[\'patient_id\'] ?? $_POST[\'patient_id\'] ?? 0);\r\n\r\n            if ($patientId <= 0) {\r\n                throw new Exception(\"Patient ID tidak valid\");\r\n            }\r\n\r\n            $query = \"SELECT foto_pasien FROM pasien WHERE id_pasien = ?\";\r\n            $stmt = $this->conn->prepare($query);\r\n            $stmt->bind_param(\"i\", $patientId);\r\n            $stmt->execute();\r\n            $result = $stmt->get_result();\r\n\r\n            if ($result->num_rows === 0) {\r\n                throw new Exception(\"Data pasien tidak ditemukan\");\r\n            }\r\n\r\n            $patient = $result->fetch_assoc();\r\n            $imageFilename = $patient[\'foto_pasien\'];\r\n\r\n            if (empty($imageFilename)) {\r\n                throw new Exception(\"Tidak ada gambar untuk pasien ini\");\r\n            }\r\n\r\n            // Find the image file\r\n            $possiblePaths = [\r\n                __DIR__ . \'/../../uploads/images/\' . $imageFilename,\r\n                __DIR__ . \'/../uploads/images/\' . $imageFilename,\r\n                $_SERVER[\'DOCUMENT_ROOT\'] . \'/uploads/images/\' . $imageFilename,\r\n            ];\r\n\r\n            $imagePath = null;\r\n            foreach ($possiblePaths as $path) {\r\n                if (file_exists($path)) {\r\n                    $imagePath = $path;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if ($imagePath === null) {\r\n                throw new Exception(\"File gambar tidak ditemukan\");\r\n            }\r\n\r\n            // Extract message menggunakan algoritma yang sudah diperbaiki\r\n            $message = $this->extractMessageFromImage($imagePath);\r\n\r\n            if ($message === false) {\r\n                throw new Exception(\"Tidak dapat mengekstrak pesan dari gambar\");\r\n            }\r\n\r\n            $this->sendSuccess([\r\n                \'message\' => $message,\r\n                \'patient_id\' => $patientId,\r\n                \'image_file\' => $imageFilename\r\n            ], \"Pesan berhasil diekstrak dari gambar\");\r\n\r\n        } catch (Exception $e) {\r\n            $this->sendError(\"Error extracting steganography: \" . $e->getMessage());\r\n        }\r\n    }\r\n\r\n    // ==================== DATA RETRIEVAL METHODS ====================\r\n\r\n    private function getDashboardStats()\r\n    {\r\n        try {\r\n            // Total patients\r\n            $totalQuery = \"SELECT COUNT(*) as total_pasien FROM pasien\";\r\n            $totalResult = $this->conn->query($totalQuery);\r\n            $total = $totalResult->fetch_assoc();\r\n\r\n            // Rawat inap count\r\n            $inapQuery = \"SELECT COUNT(*) as rawat_inap FROM pasien WHERE informasi_medis = \'rawat-inap\'\";\r\n            $inapResult = $this->conn->query($inapQuery);\r\n            $inap = $inapResult->fetch_assoc();\r\n\r\n            // Rawat jalan count\r\n            $jalanQuery = \"SELECT COUNT(*) as rawat_jalan FROM pasien WHERE informasi_medis = \'rawat-jalan\'\";\r\n            $jalanResult = $this->conn->query($jalanQuery);\r\n            $jalan = $jalanResult->fetch_assoc();\r\n\r\n            // Pemeriksaan count\r\n            $pemeriksaanQuery = \"SELECT COUNT(*) as pemeriksaan FROM pasien WHERE informasi_medis = \'pemeriksaan\'\";\r\n            $pemeriksaanResult = $this->conn->query($pemeriksaanQuery);\r\n            $pemeriksaan = $pemeriksaanResult->fetch_assoc();\r\n\r\n            // Total payment\r\n            $paymentQuery = \"SELECT COALESCE(SUM(jumlah_pembayaran), 0) as total_pembayaran FROM pasien\";\r\n            $paymentResult = $this->conn->query($paymentQuery);\r\n            $payment = $paymentResult->fetch_assoc();\r\n\r\n            // New patients (last 7 days)\r\n            $newQuery = \"SELECT COUNT(*) as pasien_baru FROM pasien WHERE created_at >= DATE_SUB(NOW(), INTERVAL 7 DAY)\";\r\n            $newResult = $this->conn->query($newQuery);\r\n            $new = $newResult->fetch_assoc();\r\n\r\n            $stats = [\r\n                \'total_pasien\' => (int)$total[\'total_pasien\'],\r\n                \'rawat_inap\' => (int)$inap[\'rawat_inap\'],\r\n                \'rawat_jalan\' => (int)$jalan[\'rawat_jalan\'],\r\n                \'pemeriksaan\' => (int)$pemeriksaan[\'pemeriksaan\'],\r\n                \'total_pembayaran\' => (float)$payment[\'total_pembayaran\'],\r\n                \'pasien_baru\' => (int)$new[\'pasien_baru\']\r\n            ];\r\n\r\n            $this->sendSuccess($stats, \"Stats loaded successfully\");\r\n\r\n        } catch (Exception $e) {\r\n            $this->sendError(\"Error loading stats: \" . $e->getMessage());\r\n        }\r\n    }\r\n\r\n    private function getRecentPatients()\r\n    {\r\n        try {\r\n            $query = \"SELECT * FROM pasien ORDER BY created_at DESC LIMIT 5\";\r\n            $result = $this->conn->query($query);\r\n\r\n            $patients = [];\r\n            while ($row = $result->fetch_assoc()) {\r\n                // Decrypt the data\r\n                $row[\'nama_lengkap\'] = $this->xorDecrypt($row[\'nama_lengkap\'], XOR_KEY);\r\n                $row[\'alamat_lengkap\'] = $this->xorDecrypt($row[\'alamat_lengkap\'], XOR_KEY);\r\n                $row[\'hasil_pemeriksaan\'] = $this->altbashAesDecrypt($row[\'hasil_pemeriksaan\']);\r\n                \r\n                $patients[] = $row;\r\n            }\r\n\r\n            $this->sendSuccess($patients, \"Recent patients loaded\");\r\n\r\n        } catch (Exception $e) {\r\n            $this->sendError(\"Error loading recent patients: \" . $e->getMessage());\r\n        }\r\n    }\r\n\r\n    private function getPatientsList()\r\n    {\r\n        try {\r\n            $page = intval($_GET[\'page\'] ?? 1);\r\n            $limit = intval($_GET[\'limit\'] ?? 10);\r\n            $search = $_GET[\'search\'] ?? \'\';\r\n            $status = $_GET[\'status\'] ?? \'\';\r\n            $service = $_GET[\'service\'] ?? \'\';\r\n\r\n            $offset = ($page - 1) * $limit;\r\n\r\n            // Build WHERE conditions\r\n            $whereConditions = [];\r\n            $params = [];\r\n            $types = \'\';\r\n\r\n            if (!empty($search)) {\r\n                $whereConditions[] = \"(nama_lengkap LIKE ? OR alamat_lengkap LIKE ?)\";\r\n                $searchTerm = \"%$search%\";\r\n                $params[] = $searchTerm;\r\n                $params[] = $searchTerm;\r\n                $types .= \'ss\';\r\n            }\r\n\r\n            if (!empty($status)) {\r\n                $whereConditions[] = \"status_pasien = ?\";\r\n                $params[] = $status;\r\n                $types .= \'s\';\r\n            }\r\n\r\n            if (!empty($service)) {\r\n                $whereConditions[] = \"informasi_medis = ?\";\r\n                $params[] = $service;\r\n                $types .= \'s\';\r\n            }\r\n\r\n            $whereClause = \'\';\r\n            if (!empty($whereConditions)) {\r\n                $whereClause = \"WHERE \" . implode(\" AND \", $whereConditions);\r\n            }\r\n\r\n            // Count total records\r\n            $countQuery = \"SELECT COUNT(*) as total FROM pasien $whereClause\";\r\n            $countStmt = $this->conn->prepare($countQuery);\r\n            \r\n            if (!empty($params)) {\r\n                $countStmt->bind_param($types, ...$params);\r\n            }\r\n            \r\n            $countStmt->execute();\r\n            $countResult = $countStmt->get_result();\r\n            $totalCount = $countResult->fetch_assoc()[\'total\'];\r\n            $totalPages = ceil($totalCount / $limit);\r\n\r\n            $dataQuery = \"SELECT * FROM pasien $whereClause ORDER BY created_at DESC, id_pasien DESC LIMIT ? OFFSET ?\";\r\n            $dataStmt = $this->conn->prepare($dataQuery);\r\n            \r\n            $params[] = $limit;\r\n            $params[] = $offset;\r\n            $types .= \'ii\';\r\n\r\n            if (!empty($params)) {\r\n                $dataStmt->bind_param($types, ...$params);\r\n            }\r\n            \r\n            $dataStmt->execute();\r\n            $result = $dataStmt->get_result();\r\n\r\n            $patients = [];\r\n            while ($row = $result->fetch_assoc()) {\r\n                // Decrypt the data for display\r\n                $row[\'nama_lengkap\'] = $this->xorDecrypt($row[\'nama_lengkap\'], XOR_KEY);\r\n                $row[\'alamat_lengkap\'] = $this->xorDecrypt($row[\'alamat_lengkap\'], XOR_KEY);\r\n                $row[\'hasil_pemeriksaan\'] = $this->altbashAesDecrypt($row[\'hasil_pemeriksaan\']);\r\n                \r\n                $patients[] = $row;\r\n            }\r\n\r\n            $response = [\r\n                \'patients\' => $patients,\r\n                \'total_pages\' => $totalPages,\r\n                \'current_page\' => $page,\r\n                \'total_count\' => $totalCount\r\n            ];\r\n\r\n            $this->sendSuccess($response, \"Patients list loaded\");\r\n\r\n        } catch (Exception $e) {\r\n            $this->sendError(\"Error loading patients list: \" . $e->getMessage());\r\n        }\r\n    }\r\n\r\n    private function getPatientDetail()\r\n    {\r\n        try {\r\n            $patientId = intval($_GET[\'patient_id\'] ?? $_POST[\'patient_id\'] ?? 0);\r\n\r\n            if ($patientId <= 0) {\r\n                throw new Exception(\"Patient ID tidak valid\");\r\n            }\r\n\r\n            $query = \"SELECT * FROM pasien WHERE id_pasien = ?\";\r\n            $stmt = $this->conn->prepare($query);\r\n            $stmt->bind_param(\"i\", $patientId);\r\n            $stmt->execute();\r\n            $result = $stmt->get_result();\r\n\r\n            if ($result->num_rows === 0) {\r\n                throw new Exception(\"Data pasien tidak ditemukan\");\r\n            }\r\n\r\n            $patient = $result->fetch_assoc();\r\n\r\n            // Decrypt all encrypted data\r\n            $patient[\'nama_lengkap\'] = $this->xorDecrypt($patient[\'nama_lengkap\'], XOR_KEY);\r\n            $patient[\'alamat_lengkap\'] = $this->xorDecrypt($patient[\'alamat_lengkap\'], XOR_KEY);\r\n            $patient[\'hasil_pemeriksaan\'] = $this->altbashAesDecrypt($patient[\'hasil_pemeriksaan\']);\r\n\r\n            //  FIXED: Extract medical message from image menggunakan algoritma yang sudah diperbaiki\r\n            $medicalMessage = \'\';\r\n            if (!empty($patient[\'foto_pasien\'])) {\r\n                $possiblePaths = [\r\n                    __DIR__ . \'/../../uploads/images/\' . $patient[\'foto_pasien\'],\r\n                    __DIR__ . \'/../uploads/images/\' . $patient[\'foto_pasien\'],\r\n                    $_SERVER[\'DOCUMENT_ROOT\'] . \'/uploads/images/\' . $patient[\'foto_pasien\'],\r\n                ];\r\n\r\n                $imagePath = null;\r\n                foreach ($possiblePaths as $path) {\r\n                    if (file_exists($path)) {\r\n                        $imagePath = $path;\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                if ($imagePath !== null) {\r\n                    $medicalMessage = $this->extractMessageFromImage($imagePath);\r\n                    if ($medicalMessage === false) {\r\n                        $medicalMessage = \'\'; // Jika ekstraksi gagal, set kosong\r\n                    }\r\n                }\r\n            }\r\n            $patient[\'medical_message\'] = $medicalMessage;\r\n\r\n            $this->sendSuccess($patient, \"Patient detail loaded\");\r\n\r\n        } catch (Exception $e) {\r\n            $this->sendError(\"Error loading patient detail: \" . $e->getMessage());\r\n        }\r\n    }\r\n\r\n    private function updatePatient()\r\n    {\r\n        try {\r\n            $patientId = intval($_POST[\'patient_id\'] ?? 0);\r\n            \r\n            if ($patientId <= 0) {\r\n                throw new Exception(\"Patient ID tidak valid\");\r\n            }\r\n\r\n            // Get form data\r\n            $nama_pasien = $this->sanitizeInput($_POST[\'nama_pasien\']);\r\n            $tanggal_lahir = $_POST[\'tanggal_lahir\'];\r\n            $alamat = $this->sanitizeInput($_POST[\'alamat\']);\r\n            $jenis_layanan = $this->sanitizeInput($_POST[\'jenis_layanan\']);\r\n            $status_pasien = $this->sanitizeInput($_POST[\'status_pasien\']);\r\n            $hasil_pemeriksaan = $this->sanitizeInput($_POST[\'hasil_pemeriksaan\']);\r\n            $jumlah_pembayaran = floatval($_POST[\'jumlah_pembayaran\']);\r\n\r\n            // Encrypt data before updating\r\n            $encrypted_nama = $this->xorEncrypt($nama_pasien, XOR_KEY);\r\n            $encrypted_alamat = $this->xorEncrypt($alamat, XOR_KEY);\r\n            $encrypted_hasil = $this->altbashAesEncrypt($hasil_pemeriksaan);\r\n\r\n            $query = \"UPDATE pasien SET \r\n                nama_lengkap = ?, \r\n                tanggal_lahir = ?, \r\n                alamat_lengkap = ?, \r\n                informasi_medis = ?, \r\n                status_pasien = ?, \r\n                hasil_pemeriksaan = ?, \r\n                jumlah_pembayaran = ?,\r\n                updated_at = NOW()\r\n                WHERE id_pasien = ?\";\r\n\r\n            $stmt = $this->conn->prepare($query);\r\n            $stmt->bind_param(\r\n                \"ssssssdi\",\r\n                $encrypted_nama,\r\n                $tanggal_lahir,\r\n                $encrypted_alamat,\r\n                $jenis_layanan,\r\n                $status_pasien,\r\n                $encrypted_hasil,\r\n                $jumlah_pembayaran,\r\n                $patientId\r\n            );\r\n\r\n            if ($stmt->execute()) {\r\n                $this->sendSuccess([], \"Data pasien berhasil diperbarui\");\r\n            } else {\r\n                throw new Exception(\"Gagal memperbarui data: \" . $stmt->error);\r\n            }\r\n\r\n        } catch (Exception $e) {\r\n            $this->sendError(\"Error updating patient: \" . $e->getMessage());\r\n        }\r\n    }\r\n\r\n    private function deletePatient()\r\n    {\r\n        try {\r\n            $patientId = intval($_POST[\'patient_id\'] ?? 0);\r\n\r\n            if ($patientId <= 0) {\r\n                throw new Exception(\"Patient ID tidak valid\");\r\n            }\r\n\r\n            $query = \"DELETE FROM pasien WHERE id_pasien = ?\";\r\n            $stmt = $this->conn->prepare($query);\r\n            $stmt->bind_param(\"i\", $patientId);\r\n\r\n            if ($stmt->execute()) {\r\n                $this->sendSuccess([], \"Data pasien berhasil dihapus\");\r\n            } else {\r\n                throw new Exception(\"Gagal menghapus data: \" . $stmt->error);\r\n            }\r\n\r\n        } catch (Exception $e) {\r\n            $this->sendError(\"Error deleting patient: \" . $e->getMessage());\r\n        }\r\n    }\r\n\r\n    // ==================== ENCRYPTION METHODS (for update) ====================\r\n\r\n    private function xorEncrypt($data, $key)\r\n    {\r\n        if (empty($data)) return \'\';\r\n\r\n        $data = mb_convert_encoding($data, \'UTF-8\');\r\n        $key = mb_convert_encoding($key, \'UTF-8\');\r\n\r\n        $encrypted = \'\';\r\n        $dataLen = mb_strlen($data, \'UTF-8\');\r\n        $keyLen = mb_strlen($key, \'UTF-8\');\r\n\r\n        for ($i = 0; $i < $dataLen; $i++) {\r\n            $dataChar = mb_substr($data, $i, 1, \'UTF-8\');\r\n            $keyChar = mb_substr($key, $i % $keyLen, 1, \'UTF-8\');\r\n\r\n            $dataAscii = ord($dataChar);\r\n            $keyAscii = ord($keyChar);\r\n            $encryptedAscii = $dataAscii ^ $keyAscii;\r\n\r\n            $encrypted .= chr($encryptedAscii);\r\n        }\r\n\r\n        return base64_encode($encrypted);\r\n    }\r\n\r\n    private function altbashAesEncrypt($data)\r\n    {\r\n        if (empty($data)) return \'\';\r\n\r\n        $altbash_encrypted = $this->altbashEncrypt($data);\r\n        $aes_encrypted = $this->aesEncrypt($altbash_encrypted);\r\n\r\n        return $aes_encrypted;\r\n    }\r\n\r\n    private function altbashEncrypt($data)\r\n    {\r\n        if (empty($data)) return \'\';\r\n\r\n        $data = mb_convert_encoding($data, \'UTF-8\');\r\n        $key = mb_convert_encoding(XOR_KEY, \'UTF-8\');\r\n\r\n        $encrypted = \'\';\r\n        $dataLen = mb_strlen($data, \'UTF-8\');\r\n        $keyLen = mb_strlen($key, \'UTF-8\');\r\n\r\n        for ($i = 0; $i < $dataLen; $i++) {\r\n            $char = mb_substr($data, $i, 1, \'UTF-8\');\r\n            $ascii = ord($char);\r\n            $shifted_ascii = ($ascii + 3) % 256;\r\n            $encrypted .= chr($shifted_ascii);\r\n        }\r\n\r\n        $xor_encrypted = \'\';\r\n        for ($i = 0; $i < $dataLen; $i++) {\r\n            $dataChar = $encrypted[$i];\r\n            $keyChar = mb_substr($key, $i % $keyLen, 1, \'UTF-8\');\r\n\r\n            $dataAscii = ord($dataChar);\r\n            $keyAscii = ord($keyChar);\r\n            $xorAscii = $dataAscii ^ $keyAscii;\r\n\r\n            $xor_encrypted .= chr($xorAscii);\r\n        }\r\n\r\n        $reversed = strrev($xor_encrypted);\r\n        return base64_encode($reversed);\r\n    }\r\n\r\n    private function aesEncrypt($data)\r\n    {\r\n        if (empty($data)) return \'\';\r\n\r\n        $encrypted = openssl_encrypt(\r\n            $data,\r\n            \'AES-256-CBC\',\r\n            AES_KEY,\r\n            OPENSSL_RAW_DATA,\r\n            AES_IV\r\n        );\r\n\r\n        return base64_encode($encrypted);\r\n    }\r\n\r\n    // ==================== UTILITY METHODS ====================\r\n\r\n    private function logMessage($message)\r\n    {\r\n        $timestamp = date(\'Y-m-d H:i:s\');\r\n        $logMessage = \"[$timestamp] $message\\n\";\r\n        error_log($logMessage, 3, __DIR__ . \'/dashboard_errors.log\');\r\n    }\r\n\r\n    private function sanitizeInput($data)\r\n    {\r\n        if ($this->conn) {\r\n            return $this->conn->real_escape_string(trim($data));\r\n        }\r\n        return trim($data);\r\n    }\r\n\r\n    private function sendSuccess($data, $message = \"\")\r\n    {\r\n        echo json_encode([\r\n            \'success\' => true,\r\n            \'message\' => $message,\r\n            \'data\' => $data\r\n        ], JSON_UNESCAPED_UNICODE);\r\n        exit;\r\n    }\r\n\r\n    private function sendError($message, $code = 400)\r\n    {\r\n        http_response_code($code);\r\n        echo json_encode([\r\n            \'success\' => false,\r\n            \'error\' => $message\r\n        ], JSON_UNESCAPED_UNICODE);\r\n        exit;\r\n    }\r\n\r\n    public function __destruct()\r\n    {\r\n        if ($this->conn) {\r\n            $this->conn->close();\r\n        }\r\n    }\r\n}\r\n\r\n// Handle the request\r\n$handler = new DashboardView();\r\n$handler->handleRequest();\r\n?>
[2025-11-11 17:05:41] AES encryption successful, encrypted length: 40048 bytes
[2025-11-11 17:05:41] Message encrypted with AES
[2025-11-11 17:05:41] Image dimensions: 1248x832, Type: 3
[2025-11-11 17:05:41] Max capacity: 389376 bytes
[2025-11-11 17:05:41] Encrypted message length: 40048 bytes
[2025-11-11 17:05:41] Total data to hide: 40052 bytes
[2025-11-11 17:05:41] Binary data length: 320416 bits
[2025-11-11 17:05:41] Data embedded successfully. Bits used: 320416
[2025-11-11 17:05:42] Steganographed image saved successfully: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/69135ed59af6d_1762877141.png
[2025-11-11 17:05:42] Final file size: 1297170 bytes
[2025-11-11 17:05:42] Image steganography applied successfully
[2025-11-11 17:05:42] File verified - Size: 1297170 bytes
[2025-11-11 17:05:42] === START FILE UPLOAD: pdfDokumen ===
[2025-11-11 17:05:42] File info: Array
(
    [name] => Aplikasi.pdf
    [full_path] => Aplikasi.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php1Z5FSD
    [error] => 0
    [size] => 4040002
)

[2025-11-11 17:05:42] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-11 17:05:42] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-11 17:05:42] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-11 17:05:42] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-11 17:05:42] Directory is writable
[2025-11-11 17:05:42] Detected MIME type: application/pdf
[2025-11-11 17:05:42] PDF validation: VALID
[2025-11-11 17:05:42] File validation passed
[2025-11-11 17:05:42] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/69135ed6edd27_1762877142.pdf
[2025-11-11 17:05:42] Temp file exists: YES
[2025-11-11 17:05:42] Temp file size: 4040002
[2025-11-11 17:05:42] Starting PDF encryption process...
[2025-11-11 17:05:42] Reading PDF file from: /Applications/XAMPP/xamppfiles/temp/php1Z5FSD
[2025-11-11 17:05:42] PDF file read successfully, size: 4040002 bytes
[2025-11-11 17:05:42] Applying Caesar Cipher...
[2025-11-11 17:05:43] Caesar Cipher applied successfully
[2025-11-11 17:05:43] Applying AES encryption...
[2025-11-11 17:05:43] AES encryption applied successfully
[2025-11-11 17:05:43] Writing encrypted PDF to: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/69135ed6edd27_1762877142.pdf
[2025-11-11 17:05:43] Encrypted PDF saved successfully, size: 4040016 bytes
[2025-11-11 17:05:43] PDF encrypted and saved successfully
[2025-11-11 17:05:43] File verified - Size: 4040016 bytes
[2025-11-11 17:05:43] File upload results - Foto: 69135ed59af6d_1762877141.png, PDF: 69135ed6edd27_1762877142.pdf
[2025-11-11 17:05:43] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-11 17:05:43] ERROR: Data too long for column 'hasil_pemeriksaan' at row 1
[2025-11-11 17:05:43] Sending error response: Data too long for column 'hasil_pemeriksaan' at row 1
[2025-11-11 17:05:43] === REQUEST COMPLETED ===
[2025-11-11 17:05:55] === NEW REQUEST STARTED ===
[2025-11-11 17:05:55] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-11 17:05:55] Database connected successfully
[2025-11-11 17:05:55] Request method: POST
[2025-11-11 17:05:55] === START PROCESSING FORM DATA ===
[2025-11-11 17:05:55] POST data: Array
(
    [patientId] => 
    [namaPasien] => cek ok
    [tanggalLahir] => 2025-11-13
    [alamat] => <?php

ini_set('display_errors', 1);
ini_set('display_startup_errors', 1);
error_reporting(E_ALL);
ini_set('log_errors', 1);
ini_set('error_log', __DIR__ . '/dashboard_errors.log');

header('Content-Type: application/json; charset=utf-8');
header('Access-Control-Allow-Origin: *');
header('Access-Control-Allow-Methods: GET, POST, OPTIONS');
header('Access-Control-Allow-Headers: Content-Type');

// Database configuration
define('DB_HOST', 'localhost');
define('DB_USER', 'root');
define('DB_PASS', '');
define('DB_NAME', 'kriptoproject');

// Encryption keys (SAMA dengan yang di upload.php)
define('XOR_KEY', 'medicare_secret_key_2024');
define('AES_KEY', 'medicare_aes_key_2024_32bytes_long!');
define('AES_IV', '1234567890123456');

class DashboardView
{
    private $conn;

    public function __construct()
    {
        $this->connectDB();
    }

    private function connectDB()
    {
        try {
            $this->conn = new mysqli(DB_HOST, DB_USER, DB_PASS, DB_NAME);

            if ($this->conn->connect_error) {
                throw new Exception("Koneksi database gagal: " . $this->conn->connect_error);
            }

            $this->conn->set_charset("utf8mb4");
        } catch (Exception $e) {
            $this->sendError($e->getMessage());
        }
    }

    public function handleRequest()
    {
        $action = $_GET['action'] ?? $_POST['action'] ?? '';

        switch ($action) {
            case 'get_stats':
                $this->getDashboardStats();
                break;
            case 'get_recent_patients':
                $this->getRecentPatients();
                break;
            case 'get_patients':
                $this->getPatientsList();
                break;
            case 'get_patient_detail':
                $this->getPatientDetail();
                break;
            case 'update_patient':
                $this->updatePatient();
                break;
            case 'delete_patient':
                $this->deletePatient();
                break;
            case 'download_decrypted_pdf':
                $this->downloadDecryptedPdf();
                break;
            case 'extract_steganography': // NEW ACTION untuk ekstraksi steganografi
                $this->extractSteganographyMessage();
                break;
            default:
                $this->sendError('Action tidak valid');
        }
    }

    // ==================== IMPROVED DECRYPTION METHODS ====================

    /**
     * Decrypt XOR encrypted data
     */
    private function xorDecrypt($encryptedData, $key)
    {
        if (empty($encryptedData)) return '';

        $data = base64_decode($encryptedData);
        $key = mb_convert_encoding($key, 'UTF-8');

        $decrypted = '';
        $dataLen = strlen($data);
        $keyLen = mb_strlen($key, 'UTF-8');

        for ($i = 0; $i < $dataLen; $i++) {
            $dataChar = $data[$i];
            $keyChar = mb_substr($key, $i % $keyLen, 1, 'UTF-8');

            $dataAscii = ord($dataChar);
            $keyAscii = ord($keyChar);
            $decryptedAscii = $dataAscii ^ $keyAscii;

            $decrypted .= chr($decryptedAscii);
        }

        return $decrypted;
    }

    /**
     * Decrypt AES encrypted data
     */
    private function aesDecrypt($encryptedData)
    {
        if (empty($encryptedData)) return '';

        $encrypted = base64_decode($encryptedData);
        
        $decrypted = openssl_decrypt(
            $encrypted,
            'AES-256-CBC',
            AES_KEY,
            OPENSSL_RAW_DATA,
            AES_IV
        );

        return $decrypted ?: '';
    }

    /**
     * Decrypt AltBash + AES encrypted data
     */
    private function altbashAesDecrypt($encryptedData)
    {
        if (empty($encryptedData)) return '';

        // First decrypt AES
        $altbashEncrypted = $this->aesDecrypt($encryptedData);
        if (empty($altbashEncrypted)) return '';

        // Then decrypt AltBash
        return $this->altbashDecrypt($altbashEncrypted);
    }

    /**
     * Decrypt Alphabet-Bashing encrypted data
     */
    private function altbashDecrypt($encryptedData)
    {
        if (empty($encryptedData)) return '';

        $data = base64_decode($encryptedData);
        $reversed = strrev($data);
        $key = mb_convert_encoding(XOR_KEY, 'UTF-8');

        $xorDecrypted = '';
        $dataLen = strlen($reversed);
        $keyLen = mb_strlen($key, 'UTF-8');

        for ($i = 0; $i < $dataLen; $i++) {
            $dataChar = $reversed[$i];
            $keyChar = mb_substr($key, $i % $keyLen, 1, 'UTF-8');

            $dataAscii = ord($dataChar);
            $keyAscii = ord($keyChar);
            $xorAscii = $dataAscii ^ $keyAscii;

            $xorDecrypted .= chr($xorAscii);
        }

        $decrypted = '';
        $dataLen = strlen($xorDecrypted);

        for ($i = 0; $i < $dataLen; $i++) {
            $char = $xorDecrypted[$i];
            $ascii = ord($char);
            $shiftedAscii = ($ascii - 3 + 256) % 256;
            $decrypted .= chr($shiftedAscii);
        }

        return $decrypted;
    }

    /**
     * Decrypt PDF file that was encrypted with Caesar + AES
     */
    private function decryptPdfFile($encryptedContent)
    {
        try {
            // Step 1: AES decryption
            $aesDecrypted = $this->aesDecryptBinary($encryptedContent);
            if ($aesDecrypted === false) {
                throw new Exception("AES decryption failed");
            }

            // Step 2: Caesar Cipher decryption (shift of 5)
            $decrypted = $this->caesarCipherDecrypt($aesDecrypted, 5);

            return $decrypted;
        } catch (Exception $e) {
            $this->logMessage("ERROR in decryptPdfFile: " . $e->getMessage());
            return false;
        }
    }

    /**
     * AES decryption for binary data
     */
    private function aesDecryptBinary($data)
    {
        if (empty($data)) {
            return false;
        }

        $decrypted = openssl_decrypt(
            $data,
            'AES-256-CBC',
            AES_KEY,
            OPENSSL_RAW_DATA,
            AES_IV
        );

        return $decrypted;
    }

    /**
     * Caesar Cipher decryption for binary data
     */
    private function caesarCipherDecrypt($data, $shift)
    {
        $decrypted = '';
        $length = strlen($data);
        
        for ($i = 0; $i < $length; $i++) {
            $byte = ord($data[$i]);
            // Apply Caesar shift (mod 256 for bytes)
            $decryptedByte = ($byte - $shift + 256) % 256;
            $decrypted .= chr($decryptedByte);
        }
        
        return $decrypted;
    }

    /**
     *  FIXED: Extract hidden message from steganographed image menggunakan algoritma yang sama dengan test
     */
    private function extractMessageFromImage($imagePath)
    {
        try {
            $this->logMessage("=== EXTRACTING MESSAGE FROM IMAGE (FIXED ALGORITHM) ===");
            
            if (!file_exists($imagePath)) {
                throw new Exception("Image file not found: " . $imagePath);
            }

            $imageInfo = getimagesize($imagePath);
            if ($imageInfo === false) {
                throw new Exception("Cannot get image information");
            }

            $width = $imageInfo[0];
            $height = $imageInfo[1];
            $imageType = $imageInfo[2];
            
            $this->logMessage("Image dimensions: {$width}x{$height}, Type: {$imageType}");

            // Load image - support WebP dan format lainnya
            $image = null;
            switch ($imageType) {
                case IMAGETYPE_JPEG:
                    $image = imagecreatefromjpeg($imagePath);
                    $this->logMessage("Loaded as JPEG");
                    break;
                case IMAGETYPE_PNG:
                    $image = imagecreatefrompng($imagePath);
                    $this->logMessage("Loaded as PNG");
                    break;
                case IMAGETYPE_GIF:
                    $image = imagecreatefromgif($imagePath);
                    $this->logMessage("Loaded as GIF");
                    break;
                case 18: // IMAGETYPE_WEBP
                    if (function_exists('imagecreatefromwebp')) {
                        $image = imagecreatefromwebp($imagePath);
                        $this->logMessage("Loaded as WEBP");
                    } else {
                        throw new Exception("WebP not supported on this server");
                    }
                    break;
                default:
                    throw new Exception("Unsupported image type: " . $imageType);
            }

            if (!$image) {
                throw new Exception("Cannot create image from source");
            }

            //  FIXED: Extract header menggunakan algoritma yang sama dengan embedding
            $headerBits = '';
            $bitsExtracted = 0;
            $headerSize = 32;

            $this->logMessage("Extracting header...");
            for ($y = 0; $y < $height; $y++) {
                for ($x = 0; $x < $width; $x++) {
                    if ($bitsExtracted >= $headerSize) break 2;
                    
                    $rgb = imagecolorat($image, $x, $y);
                    $r = ($rgb >> 16) & 0xFF;
                    $g = ($rgb >> 8) & 0xFF;
                    $b = $rgb & 0xFF;

                    // Extract dari LSB - URUTAN SAMA dengan enkripsi
                    $headerBits .= $r & 1;
                    $bitsExtracted++;
                    if ($bitsExtracted >= $headerSize) break;
                    
                    $headerBits .= $g & 1;
                    $bitsExtracted++;
                    if ($bitsExtracted >= $headerSize) break;
                    
                    $headerBits .= $b & 1;
                    $bitsExtracted++;
                    if ($bitsExtracted >= $headerSize) break;
                }
            }

            $this->logMessage("Header bits extracted: " . $bitsExtracted);

            // Convert header bits to message length
            $messageLength = 0;
            for ($i = 0; $i < 32; $i += 8) {
                $byte = bindec(substr($headerBits, $i, 8));
                $messageLength = ($messageLength << 8) | $byte;
            }

            $this->logMessage("Message length from header: " . $messageLength);

            if ($messageLength <= 0 || $messageLength > 100000) {
                $this->logMessage("No valid message found (invalid length: $messageLength)");
                imagedestroy($image);
                return false;
            }

            //  FIXED: Extract encrypted message dengan algoritma yang DIPERBAIKI
            $encryptedBits = '';
            $bitsNeeded = $messageLength * 8;
            $bitsExtracted = 0;

            $this->logMessage("Extracting message data ($bitsNeeded bits needed)...");
            
            //  PERBAIKAN: Gunakan counter bit GLOBAL, bukan skip per pixel
            $globalBitCounter = 0;
            
            for ($y = 0; $y < $height; $y++) {
                for ($x = 0; $x < $width; $x++) {
                    $rgb = imagecolorat($image, $x, $y);
                    $r = ($rgb >> 16) & 0xFF;
                    $g = ($rgb >> 8) & 0xFF;
                    $b = $rgb & 0xFF;

                    // Process each channel
                    $channels = [$r, $g, $b];
                    
                    foreach ($channels as $channel) {
                        // Skip bits yang sudah digunakan untuk header
                        if ($globalBitCounter < 32) {
                            $globalBitCounter++;
                            continue;
                        }

                        // Extract message bits setelah header
                        if ($bitsExtracted < $bitsNeeded) {
                            $encryptedBits .= $channel & 1;
                            $bitsExtracted++;
                            $globalBitCounter++;
                        } else {
                            break 3; // Keluar dari semua loop
                        }
                    }
                }
            }

            $this->logMessage("Message bits extracted: " . $bitsExtracted);
            $this->logMessage("Total bits processed: " . $globalBitCounter);

            if ($bitsExtracted < $bitsNeeded) {
                $this->logMessage("ERROR: Not enough bits extracted. Needed: $bitsNeeded, Got: $bitsExtracted");
                imagedestroy($image);
                return false;
            }

            // Convert bits to bytes
            $encryptedMessage = '';
            for ($i = 0; $i < $bitsNeeded; $i += 8) {
                $byteBits = substr($encryptedBits, $i, 8);
                if (strlen($byteBits) < 8) {
                    $this->logMessage("ERROR: Incomplete byte at position $i");
                    break;
                }
                $byte = bindec($byteBits);
                $encryptedMessage .= chr($byte);
            }

            $this->logMessage("Encrypted message length: " . strlen($encryptedMessage) . " bytes");

            //  FIXED: DECRYPTION dengan error handling yang lebih baik
            $this->logMessage("Attempting AES decryption...");
            
            $decrypted = openssl_decrypt(
                $encryptedMessage,
                'AES-256-CBC',
                AES_KEY,
                OPENSSL_RAW_DATA,
                AES_IV
            );

            if ($decrypted === false) {
                $error = openssl_error_string();
                $this->logMessage("AES decryption failed: " . $error);
                
                // Coba alternatif: handle padding manual
                $decrypted = $this->decryptWithPaddingHandling($encryptedMessage);
                if ($decrypted === false) {
                    $this->logMessage("Alternative decryption also failed");
                    imagedestroy($image);
                    return false;
                }
            }

            // Remove PKCS7 padding
            $originalMessage = $this->pkcs7Unpad($decrypted);
            
            if ($originalMessage === false) {
                $this->logMessage("Padding removal failed, using raw decrypted data");
                $originalMessage = $decrypted;
            }
            
            $this->logMessage(" Decryption successful");
            
            imagedestroy($image);
            
            return $originalMessage;

        } catch (Exception $e) {
            $this->logMessage("ERROR in extractMessageFromImage: " . $e->getMessage());
            if (isset($image)) {
                imagedestroy($image);
            }
            return false;
        }
    }

    /**
     * Alternative decryption dengan padding handling
     */
    private function decryptWithPaddingHandling($encryptedMessage)
    {
        $this->logMessage("Trying alternative decryption with padding handling...");
        
        // Coba tanpa OPENSSL_RAW_DATA dulu
        $decrypted = openssl_decrypt(
            $encryptedMessage,
            'AES-256-CBC',
            AES_KEY,
            0, // Bukan raw data
            AES_IV
        );

        if ($decrypted === false) {
            // Coba dengan zero padding
            $decrypted = openssl_decrypt(
                $encryptedMessage,
                'AES-256-CBC',
                AES_KEY,
                OPENSSL_ZERO_PADDING,
                AES_IV
            );
        }

        return $decrypted;
    }

    /**
     * PKCS7 Unpadding dengan error handling
     */
    private function pkcs7Unpad($data)
    {
        if (empty($data)) return '';
        
        $dataLength = strlen($data);
        if ($dataLength == 0) return '';
        
        $padding = ord($data[$dataLength - 1]);
        
        // Validasi padding
        if ($padding > 16 || $padding == 0 || $padding > $dataLength) {
            return $data; // Return data as-is jika padding invalid
        }
        
        // Check semua byte padding
        for ($i = 0; $i < $padding; $i++) {
            if (ord($data[$dataLength - $i - 1]) != $padding) {
                return $data; // Return data as-is jika padding tidak konsisten
            }
        }
        
        return substr($data, 0, -$padding);
    }

    /**
     * New endpoint untuk download decrypted PDF
     */
    private function downloadDecryptedPdf()
    {
        try {
            $patientId = intval($_GET['patient_id'] ?? 0);

            if ($patientId <= 0) {
                throw new Exception("Patient ID tidak valid");
            }

            // Get patient data including PDF filename
            $query = "SELECT dokumen_pdf FROM pasien WHERE id_pasien = ?";
            $stmt = $this->conn->prepare($query);
            $stmt->bind_param("i", $patientId);
            $stmt->execute();
            $result = $stmt->get_result();

            if ($result->num_rows === 0) {
                throw new Exception("Data pasien tidak ditemukan");
            }

            $patient = $result->fetch_assoc();
            $encryptedPdfFilename = $patient['dokumen_pdf'];

            if (empty($encryptedPdfFilename)) {
                throw new Exception("Tidak ada dokumen PDF untuk pasien ini");
            }

            // Find the encrypted PDF file
            $possiblePaths = [
                __DIR__ . '/../../uploads/pdfs/' . $encryptedPdfFilename,
                __DIR__ . '/../uploads/pdfs/' . $encryptedPdfFilename,
                $_SERVER['DOCUMENT_ROOT'] . '/uploads/pdfs/' . $encryptedPdfFilename,
            ];

            $pdfPath = null;
            foreach ($possiblePaths as $path) {
                if (file_exists($path)) {
                    $pdfPath = $path;
                    break;
                }
            }

            if ($pdfPath === null) {
                throw new Exception("File PDF tidak ditemukan");
            }

            // Read encrypted file
            $encryptedContent = file_get_contents($pdfPath);
            if ($encryptedContent === false) {
                throw new Exception("Tidak dapat membaca file PDF");
            }

            // Decrypt PDF
            $decryptedContent = $this->decryptPdfFile($encryptedContent);
            if ($decryptedContent === false) {
                throw new Exception("Gagal mendekripsi PDF");
            }

            // Set headers for download
            header('Content-Type: application/pdf');
            header('Content-Disposition: attachment; filename="decrypted_patient_' . $patientId . '.pdf"');
            header('Content-Length: ' . strlen($decryptedContent));

            echo $decryptedContent;
            exit;

        } catch (Exception $e) {
            $this->sendError("Error downloading PDF: " . $e->getMessage());
        }
    }

    /**
     *  NEW: Endpoint khusus untuk ekstraksi steganografi
     */
    private function extractSteganographyMessage()
    {
        try {
            $patientId = intval($_GET['patient_id'] ?? $_POST['patient_id'] ?? 0);

            if ($patientId <= 0) {
                throw new Exception("Patient ID tidak valid");
            }

            $query = "SELECT foto_pasien FROM pasien WHERE id_pasien = ?";
            $stmt = $this->conn->prepare($query);
            $stmt->bind_param("i", $patientId);
            $stmt->execute();
            $result = $stmt->get_result();

            if ($result->num_rows === 0) {
                throw new Exception("Data pasien tidak ditemukan");
            }

            $patient = $result->fetch_assoc();
            $imageFilename = $patient['foto_pasien'];

            if (empty($imageFilename)) {
                throw new Exception("Tidak ada gambar untuk pasien ini");
            }

            // Find the image file
            $possiblePaths = [
                __DIR__ . '/../../uploads/images/' . $imageFilename,
                __DIR__ . '/../uploads/images/' . $imageFilename,
                $_SERVER['DOCUMENT_ROOT'] . '/uploads/images/' . $imageFilename,
            ];

            $imagePath = null;
            foreach ($possiblePaths as $path) {
                if (file_exists($path)) {
                    $imagePath = $path;
                    break;
                }
            }

            if ($imagePath === null) {
                throw new Exception("File gambar tidak ditemukan");
            }

            // Extract message menggunakan algoritma yang sudah diperbaiki
            $message = $this->extractMessageFromImage($imagePath);

            if ($message === false) {
                throw new Exception("Tidak dapat mengekstrak pesan dari gambar");
            }

            $this->sendSuccess([
                'message' => $message,
                'patient_id' => $patientId,
                'image_file' => $imageFilename
            ], "Pesan berhasil diekstrak dari gambar");

        } catch (Exception $e) {
            $this->sendError("Error extracting steganography: " . $e->getMessage());
        }
    }

    // ==================== DATA RETRIEVAL METHODS ====================

    private function getDashboardStats()
    {
        try {
            // Total patients
            $totalQuery = "SELECT COUNT(*) as total_pasien FROM pasien";
            $totalResult = $this->conn->query($totalQuery);
            $total = $totalResult->fetch_assoc();

            // Rawat inap count
            $inapQuery = "SELECT COUNT(*) as rawat_inap FROM pasien WHERE informasi_medis = 'rawat-inap'";
            $inapResult = $this->conn->query($inapQuery);
            $inap = $inapResult->fetch_assoc();

            // Rawat jalan count
            $jalanQuery = "SELECT COUNT(*) as rawat_jalan FROM pasien WHERE informasi_medis = 'rawat-jalan'";
            $jalanResult = $this->conn->query($jalanQuery);
            $jalan = $jalanResult->fetch_assoc();

            // Pemeriksaan count
            $pemeriksaanQuery = "SELECT COUNT(*) as pemeriksaan FROM pasien WHERE informasi_medis = 'pemeriksaan'";
            $pemeriksaanResult = $this->conn->query($pemeriksaanQuery);
            $pemeriksaan = $pemeriksaanResult->fetch_assoc();

            // Total payment
            $paymentQuery = "SELECT COALESCE(SUM(jumlah_pembayaran), 0) as total_pembayaran FROM pasien";
            $paymentResult = $this->conn->query($paymentQuery);
            $payment = $paymentResult->fetch_assoc();

            // New patients (last 7 days)
            $newQuery = "SELECT COUNT(*) as pasien_baru FROM pasien WHERE created_at >= DATE_SUB(NOW(), INTERVAL 7 DAY)";
            $newResult = $this->conn->query($newQuery);
            $new = $newResult->fetch_assoc();

            $stats = [
                'total_pasien' => (int)$total['total_pasien'],
                'rawat_inap' => (int)$inap['rawat_inap'],
                'rawat_jalan' => (int)$jalan['rawat_jalan'],
                'pemeriksaan' => (int)$pemeriksaan['pemeriksaan'],
                'total_pembayaran' => (float)$payment['total_pembayaran'],
                'pasien_baru' => (int)$new['pasien_baru']
            ];

            $this->sendSuccess($stats, "Stats loaded successfully");

        } catch (Exception $e) {
            $this->sendError("Error loading stats: " . $e->getMessage());
        }
    }

    private function getRecentPatients()
    {
        try {
            $query = "SELECT * FROM pasien ORDER BY created_at DESC LIMIT 5";
            $result = $this->conn->query($query);

            $patients = [];
            while ($row = $result->fetch_assoc()) {
                // Decrypt the data
                $row['nama_lengkap'] = $this->xorDecrypt($row['nama_lengkap'], XOR_KEY);
                $row['alamat_lengkap'] = $this->xorDecrypt($row['alamat_lengkap'], XOR_KEY);
                $row['hasil_pemeriksaan'] = $this->altbashAesDecrypt($row['hasil_pemeriksaan']);
                
                $patients[] = $row;
            }

            $this->sendSuccess($patients, "Recent patients loaded");

        } catch (Exception $e) {
            $this->sendError("Error loading recent patients: " . $e->getMessage());
        }
    }

    private function getPatientsList()
    {
        try {
            $page = intval($_GET['page'] ?? 1);
            $limit = intval($_GET['limit'] ?? 10);
            $search = $_GET['search'] ?? '';
            $status = $_GET['status'] ?? '';
            $service = $_GET['service'] ?? '';

            $offset = ($page - 1) * $limit;

            // Build WHERE conditions
            $whereConditions = [];
            $params = [];
            $types = '';

            if (!empty($search)) {
                $whereConditions[] = "(nama_lengkap LIKE ? OR alamat_lengkap LIKE ?)";
                $searchTerm = "%$search%";
                $params[] = $searchTerm;
                $params[] = $searchTerm;
                $types .= 'ss';
            }

            if (!empty($status)) {
                $whereConditions[] = "status_pasien = ?";
                $params[] = $status;
                $types .= 's';
            }

            if (!empty($service)) {
                $whereConditions[] = "informasi_medis = ?";
                $params[] = $service;
                $types .= 's';
            }

            $whereClause = '';
            if (!empty($whereConditions)) {
                $whereClause = "WHERE " . implode(" AND ", $whereConditions);
            }

            // Count total records
            $countQuery = "SELECT COUNT(*) as total FROM pasien $whereClause";
            $countStmt = $this->conn->prepare($countQuery);
            
            if (!empty($params)) {
                $countStmt->bind_param($types, ...$params);
            }
            
            $countStmt->execute();
            $countResult = $countStmt->get_result();
            $totalCount = $countResult->fetch_assoc()['total'];
            $totalPages = ceil($totalCount / $limit);

            $dataQuery = "SELECT * FROM pasien $whereClause ORDER BY created_at DESC, id_pasien DESC LIMIT ? OFFSET ?";
            $dataStmt = $this->conn->prepare($dataQuery);
            
            $params[] = $limit;
            $params[] = $offset;
            $types .= 'ii';

            if (!empty($params)) {
                $dataStmt->bind_param($types, ...$params);
            }
            
            $dataStmt->execute();
            $result = $dataStmt->get_result();

            $patients = [];
            while ($row = $result->fetch_assoc()) {
                // Decrypt the data for display
                $row['nama_lengkap'] = $this->xorDecrypt($row['nama_lengkap'], XOR_KEY);
                $row['alamat_lengkap'] = $this->xorDecrypt($row['alamat_lengkap'], XOR_KEY);
                $row['hasil_pemeriksaan'] = $this->altbashAesDecrypt($row['hasil_pemeriksaan']);
                
                $patients[] = $row;
            }

            $response = [
                'patients' => $patients,
                'total_pages' => $totalPages,
                'current_page' => $page,
                'total_count' => $totalCount
            ];

            $this->sendSuccess($response, "Patients list loaded");

        } catch (Exception $e) {
            $this->sendError("Error loading patients list: " . $e->getMessage());
        }
    }

    private function getPatientDetail()
    {
        try {
            $patientId = intval($_GET['patient_id'] ?? $_POST['patient_id'] ?? 0);

            if ($patientId <= 0) {
                throw new Exception("Patient ID tidak valid");
            }

            $query = "SELECT * FROM pasien WHERE id_pasien = ?";
            $stmt = $this->conn->prepare($query);
            $stmt->bind_param("i", $patientId);
            $stmt->execute();
            $result = $stmt->get_result();

            if ($result->num_rows === 0) {
                throw new Exception("Data pasien tidak ditemukan");
            }

            $patient = $result->fetch_assoc();

            // Decrypt all encrypted data
            $patient['nama_lengkap'] = $this->xorDecrypt($patient['nama_lengkap'], XOR_KEY);
            $patient['alamat_lengkap'] = $this->xorDecrypt($patient['alamat_lengkap'], XOR_KEY);
            $patient['hasil_pemeriksaan'] = $this->altbashAesDecrypt($patient['hasil_pemeriksaan']);

            //  FIXED: Extract medical message from image menggunakan algoritma yang sudah diperbaiki
            $medicalMessage = '';
            if (!empty($patient['foto_pasien'])) {
                $possiblePaths = [
                    __DIR__ . '/../../uploads/images/' . $patient['foto_pasien'],
                    __DIR__ . '/../uploads/images/' . $patient['foto_pasien'],
                    $_SERVER['DOCUMENT_ROOT'] . '/uploads/images/' . $patient['foto_pasien'],
                ];

                $imagePath = null;
                foreach ($possiblePaths as $path) {
                    if (file_exists($path)) {
                        $imagePath = $path;
                        break;
                    }
                }

                if ($imagePath !== null) {
                    $medicalMessage = $this->extractMessageFromImage($imagePath);
                    if ($medicalMessage === false) {
                        $medicalMessage = ''; // Jika ekstraksi gagal, set kosong
                    }
                }
            }
            $patient['medical_message'] = $medicalMessage;

            $this->sendSuccess($patient, "Patient detail loaded");

        } catch (Exception $e) {
            $this->sendError("Error loading patient detail: " . $e->getMessage());
        }
    }

    private function updatePatient()
    {
        try {
            $patientId = intval($_POST['patient_id'] ?? 0);
            
            if ($patientId <= 0) {
                throw new Exception("Patient ID tidak valid");
            }

            // Get form data
            $nama_pasien = $this->sanitizeInput($_POST['nama_pasien']);
            $tanggal_lahir = $_POST['tanggal_lahir'];
            $alamat = $this->sanitizeInput($_POST['alamat']);
            $jenis_layanan = $this->sanitizeInput($_POST['jenis_layanan']);
            $status_pasien = $this->sanitizeInput($_POST['status_pasien']);
            $hasil_pemeriksaan = $this->sanitizeInput($_POST['hasil_pemeriksaan']);
            $jumlah_pembayaran = floatval($_POST['jumlah_pembayaran']);

            // Encrypt data before updating
            $encrypted_nama = $this->xorEncrypt($nama_pasien, XOR_KEY);
            $encrypted_alamat = $this->xorEncrypt($alamat, XOR_KEY);
            $encrypted_hasil = $this->altbashAesEncrypt($hasil_pemeriksaan);

            $query = "UPDATE pasien SET 
                nama_lengkap = ?, 
                tanggal_lahir = ?, 
                alamat_lengkap = ?, 
                informasi_medis = ?, 
                status_pasien = ?, 
                hasil_pemeriksaan = ?, 
                jumlah_pembayaran = ?,
                updated_at = NOW()
                WHERE id_pasien = ?";

            $stmt = $this->conn->prepare($query);
            $stmt->bind_param(
                "ssssssdi",
                $encrypted_nama,
                $tanggal_lahir,
                $encrypted_alamat,
                $jenis_layanan,
                $status_pasien,
                $encrypted_hasil,
                $jumlah_pembayaran,
                $patientId
            );

            if ($stmt->execute()) {
                $this->sendSuccess([], "Data pasien berhasil diperbarui");
            } else {
                throw new Exception("Gagal memperbarui data: " . $stmt->error);
            }

        } catch (Exception $e) {
            $this->sendError("Error updating patient: " . $e->getMessage());
        }
    }

    private function deletePatient()
    {
        try {
            $patientId = intval($_POST['patient_id'] ?? 0);

            if ($patientId <= 0) {
                throw new Exception("Patient ID tidak valid");
            }

            $query = "DELETE FROM pasien WHERE id_pasien = ?";
            $stmt = $this->conn->prepare($query);
            $stmt->bind_param("i", $patientId);

            if ($stmt->execute()) {
                $this->sendSuccess([], "Data pasien berhasil dihapus");
            } else {
                throw new Exception("Gagal menghapus data: " . $stmt->error);
            }

        } catch (Exception $e) {
            $this->sendError("Error deleting patient: " . $e->getMessage());
        }
    }

    // ==================== ENCRYPTION METHODS (for update) ====================

    private function xorEncrypt($data, $key)
    {
        if (empty($data)) return '';

        $data = mb_convert_encoding($data, 'UTF-8');
        $key = mb_convert_encoding($key, 'UTF-8');

        $encrypted = '';
        $dataLen = mb_strlen($data, 'UTF-8');
        $keyLen = mb_strlen($key, 'UTF-8');

        for ($i = 0; $i < $dataLen; $i++) {
            $dataChar = mb_substr($data, $i, 1, 'UTF-8');
            $keyChar = mb_substr($key, $i % $keyLen, 1, 'UTF-8');

            $dataAscii = ord($dataChar);
            $keyAscii = ord($keyChar);
            $encryptedAscii = $dataAscii ^ $keyAscii;

            $encrypted .= chr($encryptedAscii);
        }

        return base64_encode($encrypted);
    }

    private function altbashAesEncrypt($data)
    {
        if (empty($data)) return '';

        $altbash_encrypted = $this->altbashEncrypt($data);
        $aes_encrypted = $this->aesEncrypt($altbash_encrypted);

        return $aes_encrypted;
    }

    private function altbashEncrypt($data)
    {
        if (empty($data)) return '';

        $data = mb_convert_encoding($data, 'UTF-8');
        $key = mb_convert_encoding(XOR_KEY, 'UTF-8');

        $encrypted = '';
        $dataLen = mb_strlen($data, 'UTF-8');
        $keyLen = mb_strlen($key, 'UTF-8');

        for ($i = 0; $i < $dataLen; $i++) {
            $char = mb_substr($data, $i, 1, 'UTF-8');
            $ascii = ord($char);
            $shifted_ascii = ($ascii + 3) % 256;
            $encrypted .= chr($shifted_ascii);
        }

        $xor_encrypted = '';
        for ($i = 0; $i < $dataLen; $i++) {
            $dataChar = $encrypted[$i];
            $keyChar = mb_substr($key, $i % $keyLen, 1, 'UTF-8');

            $dataAscii = ord($dataChar);
            $keyAscii = ord($keyChar);
            $xorAscii = $dataAscii ^ $keyAscii;

            $xor_encrypted .= chr($xorAscii);
        }

        $reversed = strrev($xor_encrypted);
        return base64_encode($reversed);
    }

    private function aesEncrypt($data)
    {
        if (empty($data)) return '';

        $encrypted = openssl_encrypt(
            $data,
            'AES-256-CBC',
            AES_KEY,
            OPENSSL_RAW_DATA,
            AES_IV
        );

        return base64_encode($encrypted);
    }

    // ==================== UTILITY METHODS ====================

    private function logMessage($message)
    {
        $timestamp = date('Y-m-d H:i:s');
        $logMessage = "[$timestamp] $message\n";
        error_log($logMessage, 3, __DIR__ . '/dashboard_errors.log');
    }

    private function sanitizeInput($data)
    {
        if ($this->conn) {
            return $this->conn->real_escape_string(trim($data));
        }
        return trim($data);
    }

    private function sendSuccess($data, $message = "")
    {
        echo json_encode([
            'success' => true,
            'message' => $message,
            'data' => $data
        ], JSON_UNESCAPED_UNICODE);
        exit;
    }

    private function sendError($message, $code = 400)
    {
        http_response_code($code);
        echo json_encode([
            'success' => false,
            'error' => $message
        ], JSON_UNESCAPED_UNICODE);
        exit;
    }

    public function __destruct()
    {
        if ($this->conn) {
            $this->conn->close();
        }
    }
}

// Handle the request
$handler = new DashboardView();
$handler->handleRequest();
?>
    [jenisLayanan] => rawat-inap
    [statusPasien] => dalam perawatan
    [hasilPemeriksaan] => <?php

ini_set('display_errors', 1);
ini_set('display_startup_errors', 1);
error_reporting(E_ALL);
ini_set('log_errors', 1);
ini_set('error_log', __DIR__ . '/dashboard_errors.log');

header('Content-Type: application/json; charset=utf-8');
header('Access-Control-Allow-Origin: *');
header('Access-Control-Allow-Methods: GET, POST, OPTIONS');
header('Access-Control-Allow-Headers: Content-Type');

// Database configuration
define('DB_HOST', 'localhost');
define('DB_USER', 'root');
define('DB_PASS', '');
define('DB_NAME', 'kriptoproject');

// Encryption keys (SAMA dengan yang di upload.php)
define('XOR_KEY', 'medicare_secret_key_2024');
define('AES_KEY', 'medicare_aes_key_2024_32bytes_long!');
define('AES_IV', '1234567890123456');

class DashboardView
{
    private $conn;

    public function __construct()
    {
        $this->connectDB();
    }

    private function connectDB()
    {
        try {
            $this->conn = new mysqli(DB_HOST, DB_USER, DB_PASS, DB_NAME);

            if ($this->conn->connect_error) {
                throw new Exception("Koneksi database gagal: " . $this->conn->connect_error);
            }

            $this->conn->set_charset("utf8mb4");
        } catch (Exception $e) {
            $this->sendError($e->getMessage());
        }
    }

    public function handleRequest()
    {
        $action = $_GET['action'] ?? $_POST['action'] ?? '';

        switch ($action) {
            case 'get_stats':
                $this->getDashboardStats();
                break;
            case 'get_recent_patients':
                $this->getRecentPatients();
                break;
            case 'get_patients':
                $this->getPatientsList();
                break;
            case 'get_patient_detail':
                $this->getPatientDetail();
                break;
            case 'update_patient':
                $this->updatePatient();
                break;
            case 'delete_patient':
                $this->deletePatient();
                break;
            case 'download_decrypted_pdf':
                $this->downloadDecryptedPdf();
                break;
            case 'extract_steganography': // NEW ACTION untuk ekstraksi steganografi
                $this->extractSteganographyMessage();
                break;
            default:
                $this->sendError('Action tidak valid');
        }
    }

    // ==================== IMPROVED DECRYPTION METHODS ====================

    /**
     * Decrypt XOR encrypted data
     */
    private function xorDecrypt($encryptedData, $key)
    {
        if (empty($encryptedData)) return '';

        $data = base64_decode($encryptedData);
        $key = mb_convert_encoding($key, 'UTF-8');

        $decrypted = '';
        $dataLen = strlen($data);
        $keyLen = mb_strlen($key, 'UTF-8');

        for ($i = 0; $i < $dataLen; $i++) {
            $dataChar = $data[$i];
            $keyChar = mb_substr($key, $i % $keyLen, 1, 'UTF-8');

            $dataAscii = ord($dataChar);
            $keyAscii = ord($keyChar);
            $decryptedAscii = $dataAscii ^ $keyAscii;

            $decrypted .= chr($decryptedAscii);
        }

        return $decrypted;
    }

    /**
     * Decrypt AES encrypted data
     */
    private function aesDecrypt($encryptedData)
    {
        if (empty($encryptedData)) return '';

        $encrypted = base64_decode($encryptedData);
        
        $decrypted = openssl_decrypt(
            $encrypted,
            'AES-256-CBC',
            AES_KEY,
            OPENSSL_RAW_DATA,
            AES_IV
        );

        return $decrypted ?: '';
    }

    /**
     * Decrypt AltBash + AES encrypted data
     */
    private function altbashAesDecrypt($encryptedData)
    {
        if (empty($encryptedData)) return '';

        // First decrypt AES
        $altbashEncrypted = $this->aesDecrypt($encryptedData);
        if (empty($altbashEncrypted)) return '';

        // Then decrypt AltBash
        return $this->altbashDecrypt($altbashEncrypted);
    }

    /**
     * Decrypt Alphabet-Bashing encrypted data
     */
    private function altbashDecrypt($encryptedData)
    {
        if (empty($encryptedData)) return '';

        $data = base64_decode($encryptedData);
        $reversed = strrev($data);
        $key = mb_convert_encoding(XOR_KEY, 'UTF-8');

        $xorDecrypted = '';
        $dataLen = strlen($reversed);
        $keyLen = mb_strlen($key, 'UTF-8');

        for ($i = 0; $i < $dataLen; $i++) {
            $dataChar = $reversed[$i];
            $keyChar = mb_substr($key, $i % $keyLen, 1, 'UTF-8');

            $dataAscii = ord($dataChar);
            $keyAscii = ord($keyChar);
            $xorAscii = $dataAscii ^ $keyAscii;

            $xorDecrypted .= chr($xorAscii);
        }

        $decrypted = '';
        $dataLen = strlen($xorDecrypted);

        for ($i = 0; $i < $dataLen; $i++) {
            $char = $xorDecrypted[$i];
            $ascii = ord($char);
            $shiftedAscii = ($ascii - 3 + 256) % 256;
            $decrypted .= chr($shiftedAscii);
        }

        return $decrypted;
    }

    /**
     * Decrypt PDF file that was encrypted with Caesar + AES
     */
    private function decryptPdfFile($encryptedContent)
    {
        try {
            // Step 1: AES decryption
            $aesDecrypted = $this->aesDecryptBinary($encryptedContent);
            if ($aesDecrypted === false) {
                throw new Exception("AES decryption failed");
            }

            // Step 2: Caesar Cipher decryption (shift of 5)
            $decrypted = $this->caesarCipherDecrypt($aesDecrypted, 5);

            return $decrypted;
        } catch (Exception $e) {
            $this->logMessage("ERROR in decryptPdfFile: " . $e->getMessage());
            return false;
        }
    }

    /**
     * AES decryption for binary data
     */
    private function aesDecryptBinary($data)
    {
        if (empty($data)) {
            return false;
        }

        $decrypted = openssl_decrypt(
            $data,
            'AES-256-CBC',
            AES_KEY,
            OPENSSL_RAW_DATA,
            AES_IV
        );

        return $decrypted;
    }

    /**
     * Caesar Cipher decryption for binary data
     */
    private function caesarCipherDecrypt($data, $shift)
    {
        $decrypted = '';
        $length = strlen($data);
        
        for ($i = 0; $i < $length; $i++) {
            $byte = ord($data[$i]);
            // Apply Caesar shift (mod 256 for bytes)
            $decryptedByte = ($byte - $shift + 256) % 256;
            $decrypted .= chr($decryptedByte);
        }
        
        return $decrypted;
    }

    /**
     *  FIXED: Extract hidden message from steganographed image menggunakan algoritma yang sama dengan test
     */
    private function extractMessageFromImage($imagePath)
    {
        try {
            $this->logMessage("=== EXTRACTING MESSAGE FROM IMAGE (FIXED ALGORITHM) ===");
            
            if (!file_exists($imagePath)) {
                throw new Exception("Image file not found: " . $imagePath);
            }

            $imageInfo = getimagesize($imagePath);
            if ($imageInfo === false) {
                throw new Exception("Cannot get image information");
            }

            $width = $imageInfo[0];
            $height = $imageInfo[1];
            $imageType = $imageInfo[2];
            
            $this->logMessage("Image dimensions: {$width}x{$height}, Type: {$imageType}");

            // Load image - support WebP dan format lainnya
            $image = null;
            switch ($imageType) {
                case IMAGETYPE_JPEG:
                    $image = imagecreatefromjpeg($imagePath);
                    $this->logMessage("Loaded as JPEG");
                    break;
                case IMAGETYPE_PNG:
                    $image = imagecreatefrompng($imagePath);
                    $this->logMessage("Loaded as PNG");
                    break;
                case IMAGETYPE_GIF:
                    $image = imagecreatefromgif($imagePath);
                    $this->logMessage("Loaded as GIF");
                    break;
                case 18: // IMAGETYPE_WEBP
                    if (function_exists('imagecreatefromwebp')) {
                        $image = imagecreatefromwebp($imagePath);
                        $this->logMessage("Loaded as WEBP");
                    } else {
                        throw new Exception("WebP not supported on this server");
                    }
                    break;
                default:
                    throw new Exception("Unsupported image type: " . $imageType);
            }

            if (!$image) {
                throw new Exception("Cannot create image from source");
            }

            //  FIXED: Extract header menggunakan algoritma yang sama dengan embedding
            $headerBits = '';
            $bitsExtracted = 0;
            $headerSize = 32;

            $this->logMessage("Extracting header...");
            for ($y = 0; $y < $height; $y++) {
                for ($x = 0; $x < $width; $x++) {
                    if ($bitsExtracted >= $headerSize) break 2;
                    
                    $rgb = imagecolorat($image, $x, $y);
                    $r = ($rgb >> 16) & 0xFF;
                    $g = ($rgb >> 8) & 0xFF;
                    $b = $rgb & 0xFF;

                    // Extract dari LSB - URUTAN SAMA dengan enkripsi
                    $headerBits .= $r & 1;
                    $bitsExtracted++;
                    if ($bitsExtracted >= $headerSize) break;
                    
                    $headerBits .= $g & 1;
                    $bitsExtracted++;
                    if ($bitsExtracted >= $headerSize) break;
                    
                    $headerBits .= $b & 1;
                    $bitsExtracted++;
                    if ($bitsExtracted >= $headerSize) break;
                }
            }

            $this->logMessage("Header bits extracted: " . $bitsExtracted);

            // Convert header bits to message length
            $messageLength = 0;
            for ($i = 0; $i < 32; $i += 8) {
                $byte = bindec(substr($headerBits, $i, 8));
                $messageLength = ($messageLength << 8) | $byte;
            }

            $this->logMessage("Message length from header: " . $messageLength);

            if ($messageLength <= 0 || $messageLength > 100000) {
                $this->logMessage("No valid message found (invalid length: $messageLength)");
                imagedestroy($image);
                return false;
            }

            //  FIXED: Extract encrypted message dengan algoritma yang DIPERBAIKI
            $encryptedBits = '';
            $bitsNeeded = $messageLength * 8;
            $bitsExtracted = 0;

            $this->logMessage("Extracting message data ($bitsNeeded bits needed)...");
            
            //  PERBAIKAN: Gunakan counter bit GLOBAL, bukan skip per pixel
            $globalBitCounter = 0;
            
            for ($y = 0; $y < $height; $y++) {
                for ($x = 0; $x < $width; $x++) {
                    $rgb = imagecolorat($image, $x, $y);
                    $r = ($rgb >> 16) & 0xFF;
                    $g = ($rgb >> 8) & 0xFF;
                    $b = $rgb & 0xFF;

                    // Process each channel
                    $channels = [$r, $g, $b];
                    
                    foreach ($channels as $channel) {
                        // Skip bits yang sudah digunakan untuk header
                        if ($globalBitCounter < 32) {
                            $globalBitCounter++;
                            continue;
                        }

                        // Extract message bits setelah header
                        if ($bitsExtracted < $bitsNeeded) {
                            $encryptedBits .= $channel & 1;
                            $bitsExtracted++;
                            $globalBitCounter++;
                        } else {
                            break 3; // Keluar dari semua loop
                        }
                    }
                }
            }

            $this->logMessage("Message bits extracted: " . $bitsExtracted);
            $this->logMessage("Total bits processed: " . $globalBitCounter);

            if ($bitsExtracted < $bitsNeeded) {
                $this->logMessage("ERROR: Not enough bits extracted. Needed: $bitsNeeded, Got: $bitsExtracted");
                imagedestroy($image);
                return false;
            }

            // Convert bits to bytes
            $encryptedMessage = '';
            for ($i = 0; $i < $bitsNeeded; $i += 8) {
                $byteBits = substr($encryptedBits, $i, 8);
                if (strlen($byteBits) < 8) {
                    $this->logMessage("ERROR: Incomplete byte at position $i");
                    break;
                }
                $byte = bindec($byteBits);
                $encryptedMessage .= chr($byte);
            }

            $this->logMessage("Encrypted message length: " . strlen($encryptedMessage) . " bytes");

            //  FIXED: DECRYPTION dengan error handling yang lebih baik
            $this->logMessage("Attempting AES decryption...");
            
            $decrypted = openssl_decrypt(
                $encryptedMessage,
                'AES-256-CBC',
                AES_KEY,
                OPENSSL_RAW_DATA,
                AES_IV
            );

            if ($decrypted === false) {
                $error = openssl_error_string();
                $this->logMessage("AES decryption failed: " . $error);
                
                // Coba alternatif: handle padding manual
                $decrypted = $this->decryptWithPaddingHandling($encryptedMessage);
                if ($decrypted === false) {
                    $this->logMessage("Alternative decryption also failed");
                    imagedestroy($image);
                    return false;
                }
            }

            // Remove PKCS7 padding
            $originalMessage = $this->pkcs7Unpad($decrypted);
            
            if ($originalMessage === false) {
                $this->logMessage("Padding removal failed, using raw decrypted data");
                $originalMessage = $decrypted;
            }
            
            $this->logMessage(" Decryption successful");
            
            imagedestroy($image);
            
            return $originalMessage;

        } catch (Exception $e) {
            $this->logMessage("ERROR in extractMessageFromImage: " . $e->getMessage());
            if (isset($image)) {
                imagedestroy($image);
            }
            return false;
        }
    }

    /**
     * Alternative decryption dengan padding handling
     */
    private function decryptWithPaddingHandling($encryptedMessage)
    {
        $this->logMessage("Trying alternative decryption with padding handling...");
        
        // Coba tanpa OPENSSL_RAW_DATA dulu
        $decrypted = openssl_decrypt(
            $encryptedMessage,
            'AES-256-CBC',
            AES_KEY,
            0, // Bukan raw data
            AES_IV
        );

        if ($decrypted === false) {
            // Coba dengan zero padding
            $decrypted = openssl_decrypt(
                $encryptedMessage,
                'AES-256-CBC',
                AES_KEY,
                OPENSSL_ZERO_PADDING,
                AES_IV
            );
        }

        return $decrypted;
    }

    /**
     * PKCS7 Unpadding dengan error handling
     */
    private function pkcs7Unpad($data)
    {
        if (empty($data)) return '';
        
        $dataLength = strlen($data);
        if ($dataLength == 0) return '';
        
        $padding = ord($data[$dataLength - 1]);
        
        // Validasi padding
        if ($padding > 16 || $padding == 0 || $padding > $dataLength) {
            return $data; // Return data as-is jika padding invalid
        }
        
        // Check semua byte padding
        for ($i = 0; $i < $padding; $i++) {
            if (ord($data[$dataLength - $i - 1]) != $padding) {
                return $data; // Return data as-is jika padding tidak konsisten
            }
        }
        
        return substr($data, 0, -$padding);
    }

    /**
     * New endpoint untuk download decrypted PDF
     */
    private function downloadDecryptedPdf()
    {
        try {
            $patientId = intval($_GET['patient_id'] ?? 0);

            if ($patientId <= 0) {
                throw new Exception("Patient ID tidak valid");
            }

            // Get patient data including PDF filename
            $query = "SELECT dokumen_pdf FROM pasien WHERE id_pasien = ?";
            $stmt = $this->conn->prepare($query);
            $stmt->bind_param("i", $patientId);
            $stmt->execute();
            $result = $stmt->get_result();

            if ($result->num_rows === 0) {
                throw new Exception("Data pasien tidak ditemukan");
            }

            $patient = $result->fetch_assoc();
            $encryptedPdfFilename = $patient['dokumen_pdf'];

            if (empty($encryptedPdfFilename)) {
                throw new Exception("Tidak ada dokumen PDF untuk pasien ini");
            }

            // Find the encrypted PDF file
            $possiblePaths = [
                __DIR__ . '/../../uploads/pdfs/' . $encryptedPdfFilename,
                __DIR__ . '/../uploads/pdfs/' . $encryptedPdfFilename,
                $_SERVER['DOCUMENT_ROOT'] . '/uploads/pdfs/' . $encryptedPdfFilename,
            ];

            $pdfPath = null;
            foreach ($possiblePaths as $path) {
                if (file_exists($path)) {
                    $pdfPath = $path;
                    break;
                }
            }

            if ($pdfPath === null) {
                throw new Exception("File PDF tidak ditemukan");
            }

            // Read encrypted file
            $encryptedContent = file_get_contents($pdfPath);
            if ($encryptedContent === false) {
                throw new Exception("Tidak dapat membaca file PDF");
            }

            // Decrypt PDF
            $decryptedContent = $this->decryptPdfFile($encryptedContent);
            if ($decryptedContent === false) {
                throw new Exception("Gagal mendekripsi PDF");
            }

            // Set headers for download
            header('Content-Type: application/pdf');
            header('Content-Disposition: attachment; filename="decrypted_patient_' . $patientId . '.pdf"');
            header('Content-Length: ' . strlen($decryptedContent));

            echo $decryptedContent;
            exit;

        } catch (Exception $e) {
            $this->sendError("Error downloading PDF: " . $e->getMessage());
        }
    }

    /**
     *  NEW: Endpoint khusus untuk ekstraksi steganografi
     */
    private function extractSteganographyMessage()
    {
        try {
            $patientId = intval($_GET['patient_id'] ?? $_POST['patient_id'] ?? 0);

            if ($patientId <= 0) {
                throw new Exception("Patient ID tidak valid");
            }

            $query = "SELECT foto_pasien FROM pasien WHERE id_pasien = ?";
            $stmt = $this->conn->prepare($query);
            $stmt->bind_param("i", $patientId);
            $stmt->execute();
            $result = $stmt->get_result();

            if ($result->num_rows === 0) {
                throw new Exception("Data pasien tidak ditemukan");
            }

            $patient = $result->fetch_assoc();
            $imageFilename = $patient['foto_pasien'];

            if (empty($imageFilename)) {
                throw new Exception("Tidak ada gambar untuk pasien ini");
            }

            // Find the image file
            $possiblePaths = [
                __DIR__ . '/../../uploads/images/' . $imageFilename,
                __DIR__ . '/../uploads/images/' . $imageFilename,
                $_SERVER['DOCUMENT_ROOT'] . '/uploads/images/' . $imageFilename,
            ];

            $imagePath = null;
            foreach ($possiblePaths as $path) {
                if (file_exists($path)) {
                    $imagePath = $path;
                    break;
                }
            }

            if ($imagePath === null) {
                throw new Exception("File gambar tidak ditemukan");
            }

            // Extract message menggunakan algoritma yang sudah diperbaiki
            $message = $this->extractMessageFromImage($imagePath);

            if ($message === false) {
                throw new Exception("Tidak dapat mengekstrak pesan dari gambar");
            }

            $this->sendSuccess([
                'message' => $message,
                'patient_id' => $patientId,
                'image_file' => $imageFilename
            ], "Pesan berhasil diekstrak dari gambar");

        } catch (Exception $e) {
            $this->sendError("Error extracting steganography: " . $e->getMessage());
        }
    }

    // ==================== DATA RETRIEVAL METHODS ====================

    private function getDashboardStats()
    {
        try {
            // Total patients
            $totalQuery = "SELECT COUNT(*) as total_pasien FROM pasien";
            $totalResult = $this->conn->query($totalQuery);
            $total = $totalResult->fetch_assoc();

            // Rawat inap count
            $inapQuery = "SELECT COUNT(*) as rawat_inap FROM pasien WHERE informasi_medis = 'rawat-inap'";
            $inapResult = $this->conn->query($inapQuery);
            $inap = $inapResult->fetch_assoc();

            // Rawat jalan count
            $jalanQuery = "SELECT COUNT(*) as rawat_jalan FROM pasien WHERE informasi_medis = 'rawat-jalan'";
            $jalanResult = $this->conn->query($jalanQuery);
            $jalan = $jalanResult->fetch_assoc();

            // Pemeriksaan count
            $pemeriksaanQuery = "SELECT COUNT(*) as pemeriksaan FROM pasien WHERE informasi_medis = 'pemeriksaan'";
            $pemeriksaanResult = $this->conn->query($pemeriksaanQuery);
            $pemeriksaan = $pemeriksaanResult->fetch_assoc();

            // Total payment
            $paymentQuery = "SELECT COALESCE(SUM(jumlah_pembayaran), 0) as total_pembayaran FROM pasien";
            $paymentResult = $this->conn->query($paymentQuery);
            $payment = $paymentResult->fetch_assoc();

            // New patients (last 7 days)
            $newQuery = "SELECT COUNT(*) as pasien_baru FROM pasien WHERE created_at >= DATE_SUB(NOW(), INTERVAL 7 DAY)";
            $newResult = $this->conn->query($newQuery);
            $new = $newResult->fetch_assoc();

            $stats = [
                'total_pasien' => (int)$total['total_pasien'],
                'rawat_inap' => (int)$inap['rawat_inap'],
                'rawat_jalan' => (int)$jalan['rawat_jalan'],
                'pemeriksaan' => (int)$pemeriksaan['pemeriksaan'],
                'total_pembayaran' => (float)$payment['total_pembayaran'],
                'pasien_baru' => (int)$new['pasien_baru']
            ];

            $this->sendSuccess($stats, "Stats loaded successfully");

        } catch (Exception $e) {
            $this->sendError("Error loading stats: " . $e->getMessage());
        }
    }

    private function getRecentPatients()
    {
        try {
            $query = "SELECT * FROM pasien ORDER BY created_at DESC LIMIT 5";
            $result = $this->conn->query($query);

            $patients = [];
            while ($row = $result->fetch_assoc()) {
                // Decrypt the data
                $row['nama_lengkap'] = $this->xorDecrypt($row['nama_lengkap'], XOR_KEY);
                $row['alamat_lengkap'] = $this->xorDecrypt($row['alamat_lengkap'], XOR_KEY);
                $row['hasil_pemeriksaan'] = $this->altbashAesDecrypt($row['hasil_pemeriksaan']);
                
                $patients[] = $row;
            }

            $this->sendSuccess($patients, "Recent patients loaded");

        } catch (Exception $e) {
            $this->sendError("Error loading recent patients: " . $e->getMessage());
        }
    }

    private function getPatientsList()
    {
        try {
            $page = intval($_GET['page'] ?? 1);
            $limit = intval($_GET['limit'] ?? 10);
            $search = $_GET['search'] ?? '';
            $status = $_GET['status'] ?? '';
            $service = $_GET['service'] ?? '';

            $offset = ($page - 1) * $limit;

            // Build WHERE conditions
            $whereConditions = [];
            $params = [];
            $types = '';

            if (!empty($search)) {
                $whereConditions[] = "(nama_lengkap LIKE ? OR alamat_lengkap LIKE ?)";
                $searchTerm = "%$search%";
                $params[] = $searchTerm;
                $params[] = $searchTerm;
                $types .= 'ss';
            }

            if (!empty($status)) {
                $whereConditions[] = "status_pasien = ?";
                $params[] = $status;
                $types .= 's';
            }

            if (!empty($service)) {
                $whereConditions[] = "informasi_medis = ?";
                $params[] = $service;
                $types .= 's';
            }

            $whereClause = '';
            if (!empty($whereConditions)) {
                $whereClause = "WHERE " . implode(" AND ", $whereConditions);
            }

            // Count total records
            $countQuery = "SELECT COUNT(*) as total FROM pasien $whereClause";
            $countStmt = $this->conn->prepare($countQuery);
            
            if (!empty($params)) {
                $countStmt->bind_param($types, ...$params);
            }
            
            $countStmt->execute();
            $countResult = $countStmt->get_result();
            $totalCount = $countResult->fetch_assoc()['total'];
            $totalPages = ceil($totalCount / $limit);

            $dataQuery = "SELECT * FROM pasien $whereClause ORDER BY created_at DESC, id_pasien DESC LIMIT ? OFFSET ?";
            $dataStmt = $this->conn->prepare($dataQuery);
            
            $params[] = $limit;
            $params[] = $offset;
            $types .= 'ii';

            if (!empty($params)) {
                $dataStmt->bind_param($types, ...$params);
            }
            
            $dataStmt->execute();
            $result = $dataStmt->get_result();

            $patients = [];
            while ($row = $result->fetch_assoc()) {
                // Decrypt the data for display
                $row['nama_lengkap'] = $this->xorDecrypt($row['nama_lengkap'], XOR_KEY);
                $row['alamat_lengkap'] = $this->xorDecrypt($row['alamat_lengkap'], XOR_KEY);
                $row['hasil_pemeriksaan'] = $this->altbashAesDecrypt($row['hasil_pemeriksaan']);
                
                $patients[] = $row;
            }

            $response = [
                'patients' => $patients,
                'total_pages' => $totalPages,
                'current_page' => $page,
                'total_count' => $totalCount
            ];

            $this->sendSuccess($response, "Patients list loaded");

        } catch (Exception $e) {
            $this->sendError("Error loading patients list: " . $e->getMessage());
        }
    }

    private function getPatientDetail()
    {
        try {
            $patientId = intval($_GET['patient_id'] ?? $_POST['patient_id'] ?? 0);

            if ($patientId <= 0) {
                throw new Exception("Patient ID tidak valid");
            }

            $query = "SELECT * FROM pasien WHERE id_pasien = ?";
            $stmt = $this->conn->prepare($query);
            $stmt->bind_param("i", $patientId);
            $stmt->execute();
            $result = $stmt->get_result();

            if ($result->num_rows === 0) {
                throw new Exception("Data pasien tidak ditemukan");
            }

            $patient = $result->fetch_assoc();

            // Decrypt all encrypted data
            $patient['nama_lengkap'] = $this->xorDecrypt($patient['nama_lengkap'], XOR_KEY);
            $patient['alamat_lengkap'] = $this->xorDecrypt($patient['alamat_lengkap'], XOR_KEY);
            $patient['hasil_pemeriksaan'] = $this->altbashAesDecrypt($patient['hasil_pemeriksaan']);

            //  FIXED: Extract medical message from image menggunakan algoritma yang sudah diperbaiki
            $medicalMessage = '';
            if (!empty($patient['foto_pasien'])) {
                $possiblePaths = [
                    __DIR__ . '/../../uploads/images/' . $patient['foto_pasien'],
                    __DIR__ . '/../uploads/images/' . $patient['foto_pasien'],
                    $_SERVER['DOCUMENT_ROOT'] . '/uploads/images/' . $patient['foto_pasien'],
                ];

                $imagePath = null;
                foreach ($possiblePaths as $path) {
                    if (file_exists($path)) {
                        $imagePath = $path;
                        break;
                    }
                }

                if ($imagePath !== null) {
                    $medicalMessage = $this->extractMessageFromImage($imagePath);
                    if ($medicalMessage === false) {
                        $medicalMessage = ''; // Jika ekstraksi gagal, set kosong
                    }
                }
            }
            $patient['medical_message'] = $medicalMessage;

            $this->sendSuccess($patient, "Patient detail loaded");

        } catch (Exception $e) {
            $this->sendError("Error loading patient detail: " . $e->getMessage());
        }
    }

    private function updatePatient()
    {
        try {
            $patientId = intval($_POST['patient_id'] ?? 0);
            
            if ($patientId <= 0) {
                throw new Exception("Patient ID tidak valid");
            }

            // Get form data
            $nama_pasien = $this->sanitizeInput($_POST['nama_pasien']);
            $tanggal_lahir = $_POST['tanggal_lahir'];
            $alamat = $this->sanitizeInput($_POST['alamat']);
            $jenis_layanan = $this->sanitizeInput($_POST['jenis_layanan']);
            $status_pasien = $this->sanitizeInput($_POST['status_pasien']);
            $hasil_pemeriksaan = $this->sanitizeInput($_POST['hasil_pemeriksaan']);
            $jumlah_pembayaran = floatval($_POST['jumlah_pembayaran']);

            // Encrypt data before updating
            $encrypted_nama = $this->xorEncrypt($nama_pasien, XOR_KEY);
            $encrypted_alamat = $this->xorEncrypt($alamat, XOR_KEY);
            $encrypted_hasil = $this->altbashAesEncrypt($hasil_pemeriksaan);

            $query = "UPDATE pasien SET 
                nama_lengkap = ?, 
                tanggal_lahir = ?, 
                alamat_lengkap = ?, 
                informasi_medis = ?, 
                status_pasien = ?, 
                hasil_pemeriksaan = ?, 
                jumlah_pembayaran = ?,
                updated_at = NOW()
                WHERE id_pasien = ?";

            $stmt = $this->conn->prepare($query);
            $stmt->bind_param(
                "ssssssdi",
                $encrypted_nama,
                $tanggal_lahir,
                $encrypted_alamat,
                $jenis_layanan,
                $status_pasien,
                $encrypted_hasil,
                $jumlah_pembayaran,
                $patientId
            );

            if ($stmt->execute()) {
                $this->sendSuccess([], "Data pasien berhasil diperbarui");
            } else {
                throw new Exception("Gagal memperbarui data: " . $stmt->error);
            }

        } catch (Exception $e) {
            $this->sendError("Error updating patient: " . $e->getMessage());
        }
    }

    private function deletePatient()
    {
        try {
            $patientId = intval($_POST['patient_id'] ?? 0);

            if ($patientId <= 0) {
                throw new Exception("Patient ID tidak valid");
            }

            $query = "DELETE FROM pasien WHERE id_pasien = ?";
            $stmt = $this->conn->prepare($query);
            $stmt->bind_param("i", $patientId);

            if ($stmt->execute()) {
                $this->sendSuccess([], "Data pasien berhasil dihapus");
            } else {
                throw new Exception("Gagal menghapus data: " . $stmt->error);
            }

        } catch (Exception $e) {
            $this->sendError("Error deleting patient: " . $e->getMessage());
        }
    }

    // ==================== ENCRYPTION METHODS (for update) ====================

    private function xorEncrypt($data, $key)
    {
        if (empty($data)) return '';

        $data = mb_convert_encoding($data, 'UTF-8');
        $key = mb_convert_encoding($key, 'UTF-8');

        $encrypted = '';
        $dataLen = mb_strlen($data, 'UTF-8');
        $keyLen = mb_strlen($key, 'UTF-8');

        for ($i = 0; $i < $dataLen; $i++) {
            $dataChar = mb_substr($data, $i, 1, 'UTF-8');
            $keyChar = mb_substr($key, $i % $keyLen, 1, 'UTF-8');

            $dataAscii = ord($dataChar);
            $keyAscii = ord($keyChar);
            $encryptedAscii = $dataAscii ^ $keyAscii;

            $encrypted .= chr($encryptedAscii);
        }

        return base64_encode($encrypted);
    }

    private function altbashAesEncrypt($data)
    {
        if (empty($data)) return '';

        $altbash_encrypted = $this->altbashEncrypt($data);
        $aes_encrypted = $this->aesEncrypt($altbash_encrypted);

        return $aes_encrypted;
    }

    private function altbashEncrypt($data)
    {
        if (empty($data)) return '';

        $data = mb_convert_encoding($data, 'UTF-8');
        $key = mb_convert_encoding(XOR_KEY, 'UTF-8');

        $encrypted = '';
        $dataLen = mb_strlen($data, 'UTF-8');
        $keyLen = mb_strlen($key, 'UTF-8');

        for ($i = 0; $i < $dataLen; $i++) {
            $char = mb_substr($data, $i, 1, 'UTF-8');
            $ascii = ord($char);
            $shifted_ascii = ($ascii + 3) % 256;
            $encrypted .= chr($shifted_ascii);
        }

        $xor_encrypted = '';
        for ($i = 0; $i < $dataLen; $i++) {
            $dataChar = $encrypted[$i];
            $keyChar = mb_substr($key, $i % $keyLen, 1, 'UTF-8');

            $dataAscii = ord($dataChar);
            $keyAscii = ord($keyChar);
            $xorAscii = $dataAscii ^ $keyAscii;

            $xor_encrypted .= chr($xorAscii);
        }

        $reversed = strrev($xor_encrypted);
        return base64_encode($reversed);
    }

    private function aesEncrypt($data)
    {
        if (empty($data)) return '';

        $encrypted = openssl_encrypt(
            $data,
            'AES-256-CBC',
            AES_KEY,
            OPENSSL_RAW_DATA,
            AES_IV
        );

        return base64_encode($encrypted);
    }

    // ==================== UTILITY METHODS ====================

    private function logMessage($message)
    {
        $timestamp = date('Y-m-d H:i:s');
        $logMessage = "[$timestamp] $message\n";
        error_log($logMessage, 3, __DIR__ . '/dashboard_errors.log');
    }

    private function sanitizeInput($data)
    {
        if ($this->conn) {
            return $this->conn->real_escape_string(trim($data));
        }
        return trim($data);
    }

    private function sendSuccess($data, $message = "")
    {
        echo json_encode([
            'success' => true,
            'message' => $message,
            'data' => $data
        ], JSON_UNESCAPED_UNICODE);
        exit;
    }

    private function sendError($message, $code = 400)
    {
        http_response_code($code);
        echo json_encode([
            'success' => false,
            'error' => $message
        ], JSON_UNESCAPED_UNICODE);
        exit;
    }

    public function __destruct()
    {
        if ($this->conn) {
            $this->conn->close();
        }
    }
}

// Handle the request
$handler = new DashboardView();
$handler->handleRequest();
?>
    [medmsg] => halah
    [jumlahPembayaran] => 524352
)

[2025-11-11 17:05:55] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => Gemini_Generated_Image_62snf262snf262sn.png
            [full_path] => Gemini_Generated_Image_62snf262snf262sn.png
            [type] => image/png
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php1ADmhn
            [error] => 0
            [size] => 1713178
        )

    [pdfDokumen] => Array
        (
            [name] => Aplikasi.pdf
            [full_path] => Aplikasi.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpq3KI2r
            [error] => 0
            [size] => 4040002
        )

)

[2025-11-11 17:05:55] Detected MIME type: image/png
[2025-11-11 17:05:55] Image validation: VALID
[2025-11-11 17:05:55] Detected MIME type: application/pdf
[2025-11-11 17:05:55] PDF validation: VALID
[2025-11-11 17:05:55] Form data sanitized successfully
[2025-11-11 17:05:55] Medical message: halah
[2025-11-11 17:05:56] Data encrypted successfully
[2025-11-11 17:05:56] Starting file upload process...
[2025-11-11 17:05:56] === START FILE UPLOAD: fotoPasien ===
[2025-11-11 17:05:56] File info: Array
(
    [name] => Gemini_Generated_Image_62snf262snf262sn.png
    [full_path] => Gemini_Generated_Image_62snf262snf262sn.png
    [type] => image/png
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/php1ADmhn
    [error] => 0
    [size] => 1713178
)

[2025-11-11 17:05:56] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-11 17:05:56] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-11 17:05:56] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-11 17:05:56] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-11 17:05:56] Directory is writable
[2025-11-11 17:05:56] Detected MIME type: image/png
[2025-11-11 17:05:56] Image validation: VALID
[2025-11-11 17:05:56] File validation passed
[2025-11-11 17:05:56] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/69135ee44dbab_1762877156.png
[2025-11-11 17:05:56] Temp file exists: YES
[2025-11-11 17:05:56] Temp file size: 1713178
[2025-11-11 17:05:56] Starting image steganography process...
[2025-11-11 17:05:56] Medical message for steganography: halah
[2025-11-11 17:05:56] === START IMAGE STEGANOGRAPHY ===
[2025-11-11 17:05:56] Original message: halah
[2025-11-11 17:05:56] Encrypting message for steganography: halah
[2025-11-11 17:05:56] AES encryption successful, encrypted length: 32 bytes
[2025-11-11 17:05:56] Message encrypted with AES
[2025-11-11 17:05:56] Image dimensions: 1248x832, Type: 3
[2025-11-11 17:05:56] Max capacity: 389376 bytes
[2025-11-11 17:05:56] Encrypted message length: 32 bytes
[2025-11-11 17:05:56] Total data to hide: 36 bytes
[2025-11-11 17:05:56] Binary data length: 288 bits
[2025-11-11 17:05:56] Data embedded successfully. Bits used: 288
[2025-11-11 17:05:57] Steganographed image saved successfully: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/69135ee44dbab_1762877156.png
[2025-11-11 17:05:57] Final file size: 1264150 bytes
[2025-11-11 17:05:57] Image steganography applied successfully
[2025-11-11 17:05:57] File verified - Size: 1264150 bytes
[2025-11-11 17:05:57] === START FILE UPLOAD: pdfDokumen ===
[2025-11-11 17:05:57] File info: Array
(
    [name] => Aplikasi.pdf
    [full_path] => Aplikasi.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpq3KI2r
    [error] => 0
    [size] => 4040002
)

[2025-11-11 17:05:57] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-11 17:05:57] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-11 17:05:57] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-11 17:05:57] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-11 17:05:57] Directory is writable
[2025-11-11 17:05:57] Detected MIME type: application/pdf
[2025-11-11 17:05:57] PDF validation: VALID
[2025-11-11 17:05:57] File validation passed
[2025-11-11 17:05:57] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/69135ee5a870d_1762877157.pdf
[2025-11-11 17:05:57] Temp file exists: YES
[2025-11-11 17:05:57] Temp file size: 4040002
[2025-11-11 17:05:57] Starting PDF encryption process...
[2025-11-11 17:05:57] Reading PDF file from: /Applications/XAMPP/xamppfiles/temp/phpq3KI2r
[2025-11-11 17:05:57] PDF file read successfully, size: 4040002 bytes
[2025-11-11 17:05:57] Applying Caesar Cipher...
[2025-11-11 17:05:57] Caesar Cipher applied successfully
[2025-11-11 17:05:57] Applying AES encryption...
[2025-11-11 17:05:57] AES encryption applied successfully
[2025-11-11 17:05:57] Writing encrypted PDF to: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/69135ee5a870d_1762877157.pdf
[2025-11-11 17:05:57] Encrypted PDF saved successfully, size: 4040016 bytes
[2025-11-11 17:05:57] PDF encrypted and saved successfully
[2025-11-11 17:05:57] File verified - Size: 4040016 bytes
[2025-11-11 17:05:57] File upload results - Foto: 69135ee44dbab_1762877156.png, PDF: 69135ee5a870d_1762877157.pdf
[2025-11-11 17:05:57] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-11 17:05:58] ERROR: Data too long for column 'hasil_pemeriksaan' at row 1
[2025-11-11 17:05:58] Sending error response: Data too long for column 'hasil_pemeriksaan' at row 1
[2025-11-11 17:05:58] === REQUEST COMPLETED ===
[2025-11-11 17:06:07] === NEW REQUEST STARTED ===
[2025-11-11 17:06:07] Script location: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend
[2025-11-11 17:06:07] Database connected successfully
[2025-11-11 17:06:07] Request method: POST
[2025-11-11 17:06:07] === START PROCESSING FORM DATA ===
[2025-11-11 17:06:07] POST data: Array
(
    [patientId] => 
    [namaPasien] => cek ok
    [tanggalLahir] => 2025-11-13
    [alamat] => halah
    [jenisLayanan] => rawat-inap
    [statusPasien] => dalam perawatan
    [hasilPemeriksaan] => halah
    [medmsg] => halah
    [jumlahPembayaran] => 524352
)

[2025-11-11 17:06:07] FILES data: Array
(
    [fotoPasien] => Array
        (
            [name] => Gemini_Generated_Image_62snf262snf262sn.png
            [full_path] => Gemini_Generated_Image_62snf262snf262sn.png
            [type] => image/png
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpWe3atC
            [error] => 0
            [size] => 1713178
        )

    [pdfDokumen] => Array
        (
            [name] => Aplikasi.pdf
            [full_path] => Aplikasi.pdf
            [type] => application/pdf
            [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpsZulWq
            [error] => 0
            [size] => 4040002
        )

)

[2025-11-11 17:06:07] Detected MIME type: image/png
[2025-11-11 17:06:07] Image validation: VALID
[2025-11-11 17:06:07] Detected MIME type: application/pdf
[2025-11-11 17:06:07] PDF validation: VALID
[2025-11-11 17:06:07] Form data sanitized successfully
[2025-11-11 17:06:07] Medical message: halah
[2025-11-11 17:06:07] Data encrypted successfully
[2025-11-11 17:06:07] Starting file upload process...
[2025-11-11 17:06:07] === START FILE UPLOAD: fotoPasien ===
[2025-11-11 17:06:07] File info: Array
(
    [name] => Gemini_Generated_Image_62snf262snf262sn.png
    [full_path] => Gemini_Generated_Image_62snf262snf262sn.png
    [type] => image/png
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpWe3atC
    [error] => 0
    [size] => 1713178
)

[2025-11-11 17:06:07] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/images/
[2025-11-11 17:06:07] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-11 17:06:07] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-11 17:06:07] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/
[2025-11-11 17:06:07] Directory is writable
[2025-11-11 17:06:07] Detected MIME type: image/png
[2025-11-11 17:06:07] Image validation: VALID
[2025-11-11 17:06:07] File validation passed
[2025-11-11 17:06:07] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/69135eef03f2f_1762877167.png
[2025-11-11 17:06:07] Temp file exists: YES
[2025-11-11 17:06:07] Temp file size: 1713178
[2025-11-11 17:06:07] Starting image steganography process...
[2025-11-11 17:06:07] Medical message for steganography: halah
[2025-11-11 17:06:07] === START IMAGE STEGANOGRAPHY ===
[2025-11-11 17:06:07] Original message: halah
[2025-11-11 17:06:07] Encrypting message for steganography: halah
[2025-11-11 17:06:07] AES encryption successful, encrypted length: 32 bytes
[2025-11-11 17:06:07] Message encrypted with AES
[2025-11-11 17:06:07] Image dimensions: 1248x832, Type: 3
[2025-11-11 17:06:07] Max capacity: 389376 bytes
[2025-11-11 17:06:07] Encrypted message length: 32 bytes
[2025-11-11 17:06:07] Total data to hide: 36 bytes
[2025-11-11 17:06:07] Binary data length: 288 bits
[2025-11-11 17:06:07] Data embedded successfully. Bits used: 288
[2025-11-11 17:06:08] Steganographed image saved successfully: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/images/69135eef03f2f_1762877167.png
[2025-11-11 17:06:08] Final file size: 1264150 bytes
[2025-11-11 17:06:08] Image steganography applied successfully
[2025-11-11 17:06:08] File verified - Size: 1264150 bytes
[2025-11-11 17:06:08] === START FILE UPLOAD: pdfDokumen ===
[2025-11-11 17:06:08] File info: Array
(
    [name] => Aplikasi.pdf
    [full_path] => Aplikasi.pdf
    [type] => application/pdf
    [tmp_name] => /Applications/XAMPP/xamppfiles/temp/phpsZulWq
    [error] => 0
    [size] => 4040002
)

[2025-11-11 17:06:08] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../../uploads/pdfs/
[2025-11-11 17:06:08] Checking path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-11 17:06:08] Found existing directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-11 17:06:08] Final upload directory: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/
[2025-11-11 17:06:08] Directory is writable
[2025-11-11 17:06:08] Detected MIME type: application/pdf
[2025-11-11 17:06:08] PDF validation: VALID
[2025-11-11 17:06:08] File validation passed
[2025-11-11 17:06:08] Target path: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/69135ef055039_1762877168.pdf
[2025-11-11 17:06:08] Temp file exists: YES
[2025-11-11 17:06:08] Temp file size: 4040002
[2025-11-11 17:06:08] Starting PDF encryption process...
[2025-11-11 17:06:08] Reading PDF file from: /Applications/XAMPP/xamppfiles/temp/phpsZulWq
[2025-11-11 17:06:08] PDF file read successfully, size: 4040002 bytes
[2025-11-11 17:06:08] Applying Caesar Cipher...
[2025-11-11 17:06:08] Caesar Cipher applied successfully
[2025-11-11 17:06:08] Applying AES encryption...
[2025-11-11 17:06:08] AES encryption applied successfully
[2025-11-11 17:06:08] Writing encrypted PDF to: /Applications/XAMPP/xamppfiles/htdocs/web_kriptografi/backend/../uploads/pdfs/69135ef055039_1762877168.pdf
[2025-11-11 17:06:08] Encrypted PDF saved successfully, size: 4040016 bytes
[2025-11-11 17:06:08] PDF encrypted and saved successfully
[2025-11-11 17:06:08] File verified - Size: 4040016 bytes
[2025-11-11 17:06:08] File upload results - Foto: 69135eef03f2f_1762877167.png, PDF: 69135ef055039_1762877168.pdf
[2025-11-11 17:06:08] SQL: INSERT INTO pasien (
                nama_lengkap, 
                tanggal_lahir, 
                alamat_lengkap, 
                informasi_medis, 
                status_pasien, 
                hasil_pemeriksaan, 
                foto_pasien, 
                dokumen_pdf, 
                jumlah_pembayaran
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
[2025-11-11 17:06:08] Data successfully inserted with ID: 15
[2025-11-11 17:06:08] Sending success response
[2025-11-11 17:06:08] === REQUEST COMPLETED ===
